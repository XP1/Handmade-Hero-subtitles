1
00:00:01,120 --> 00:00:05,278
hello everybody and welcome to handmade

2
00:00:03,198 --> 00:00:07,838
hero we are going to be taking a look at

3
00:00:05,278 --> 00:00:10,080
the lighting code today because uh when

4
00:00:07,839 --> 00:00:12,320
i did my survey last week of stuff i

5
00:00:10,080 --> 00:00:14,559
wanted to improve i was gonna say like

6
00:00:12,320 --> 00:00:16,000
oh we we should simplify the lighting

7
00:00:14,558 --> 00:00:17,599
because it's too complicated and it

8
00:00:16,000 --> 00:00:19,118
doesn't look good enough and whatever

9
00:00:17,600 --> 00:00:19,840
because that was like my recollection of

10
00:00:19,118 --> 00:00:21,759
it

11
00:00:19,839 --> 00:00:23,759
but actually when we looked at it um i

12
00:00:21,760 --> 00:00:25,679
realized the lighting actually seems to

13
00:00:23,760 --> 00:00:28,560
look quite good

14
00:00:25,679 --> 00:00:31,039
um like looking at the lighting here

15
00:00:28,559 --> 00:00:33,439
uh it actually looks quite nice and i

16
00:00:31,039 --> 00:00:36,079
was like uh maybe we're actually pretty

17
00:00:33,439 --> 00:00:39,199
close to having like high end lighting

18
00:00:36,079 --> 00:00:41,679
that that actually is pretty good uh so

19
00:00:39,200 --> 00:00:43,440
i i think maybe i spoke too soon i think

20
00:00:41,679 --> 00:00:44,878
maybe we just keep this

21
00:00:43,439 --> 00:00:48,159
um but there are a couple things that i

22
00:00:44,878 --> 00:00:50,320
wanted to take a look at today

23
00:00:48,159 --> 00:00:52,479
uh because i think there are some things

24
00:00:50,320 --> 00:00:54,238
we can do to improve it so what you can

25
00:00:52,479 --> 00:00:56,078
see here is like the best case for the

26
00:00:54,238 --> 00:00:59,038
lighting this is what happens if we

27
00:00:56,079 --> 00:01:00,320
effectively sort of in nor ignore

28
00:00:59,039 --> 00:01:01,520
um

29
00:01:00,320 --> 00:01:02,320
any high

30
00:01:01,520 --> 00:01:04,079
uh

31
00:01:02,320 --> 00:01:05,840
sort of any high frequency updating to

32
00:01:04,079 --> 00:01:08,079
the lighting uh you can see that it's

33
00:01:05,840 --> 00:01:09,600
quite laggy right now like you can see

34
00:01:08,079 --> 00:01:11,760
it takes a while for the lightning point

35
00:01:09,599 --> 00:01:13,759
to come in so this is a long-term

36
00:01:11,760 --> 00:01:16,320
average blend of the lighting and you

37
00:01:13,760 --> 00:01:19,200
can see that it does look quite nice

38
00:01:16,319 --> 00:01:20,959
when you give it enough time right but

39
00:01:19,200 --> 00:01:23,920
it's too slow

40
00:01:20,959 --> 00:01:25,118
and what i sort of looked at uh the

41
00:01:23,920 --> 00:01:27,680
other day

42
00:01:25,118 --> 00:01:30,640
is that if you actually look at the code

43
00:01:27,680 --> 00:01:32,880
and how the breakdown of performance

44
00:01:30,640 --> 00:01:34,960
looks in it in fact i think we can still

45
00:01:32,879 --> 00:01:37,920
sort of see that here

46
00:01:34,959 --> 00:01:41,039
um if we go into the profile

47
00:01:37,920 --> 00:01:43,359
so if we take a look at uh the the

48
00:01:41,040 --> 00:01:45,040
actual like clocks here i don't know to

49
00:01:43,359 --> 00:01:47,200
what extent i can i can actually look at

50
00:01:45,040 --> 00:01:49,920
these but

51
00:01:47,200 --> 00:01:52,079
um if we actually look at the the way

52
00:01:49,920 --> 00:01:55,519
these clocks break down here if i

53
00:01:52,078 --> 00:01:57,438
remember correctly uh this so you can

54
00:01:55,519 --> 00:01:59,519
see the lighting takes all the time

55
00:01:57,438 --> 00:02:00,959
uh that's that's our pretty much only

56
00:01:59,519 --> 00:02:03,280
real expensive thing we do because we're

57
00:02:00,959 --> 00:02:05,759
doing it on the cpu we haven't

58
00:02:03,280 --> 00:02:07,118
moved it to uh the gpu which we still

59
00:02:05,759 --> 00:02:08,878
might do someday there's a lot of

60
00:02:07,118 --> 00:02:11,199
efficiency to be gained

61
00:02:08,878 --> 00:02:13,039
by moving it to the gpu not necessarily

62
00:02:11,199 --> 00:02:14,799
because the gpu will do it all that much

63
00:02:13,039 --> 00:02:17,120
faster um

64
00:02:14,800 --> 00:02:20,400
it's really not so much that it's more

65
00:02:17,120 --> 00:02:23,039
that because the gpu is the thing that's

66
00:02:20,400 --> 00:02:25,520
doing all the pixel fill uh the fact

67
00:02:23,039 --> 00:02:28,479
that we have to move the data

68
00:02:25,520 --> 00:02:29,840
from the cpu to the gpu every frame is

69
00:02:28,479 --> 00:02:31,759
kind of a waste

70
00:02:29,840 --> 00:02:33,598
of everyone's time

71
00:02:31,759 --> 00:02:35,280
so you know there there are some

72
00:02:33,598 --> 00:02:36,878
efficiency gains to be had here but in

73
00:02:35,280 --> 00:02:39,199
general that's taking all the time but

74
00:02:36,878 --> 00:02:40,959
if you look uh you can kind of see that

75
00:02:39,199 --> 00:02:43,679
we're still like almost getting 16

76
00:02:40,959 --> 00:02:46,400
frames a second even just at the of 60

77
00:02:43,680 --> 00:02:49,519
uh 60 frames a second um we're not quite

78
00:02:46,400 --> 00:02:50,400
hitting it uh reliably but we're close

79
00:02:49,519 --> 00:02:52,719
and

80
00:02:50,400 --> 00:02:54,400
this is with full 3d on the lighting

81
00:02:52,719 --> 00:02:56,800
which we sort of decided we don't really

82
00:02:54,400 --> 00:02:58,400
need the 3d uh and we're probably not

83
00:02:56,800 --> 00:03:00,159
going to stick with the 3d which means

84
00:02:58,400 --> 00:03:03,280
that

85
00:03:00,158 --> 00:03:05,840
a couple things one if we eliminate the

86
00:03:03,280 --> 00:03:07,840
stacking that's going on here right if

87
00:03:05,840 --> 00:03:11,039
the stacking gets eliminated

88
00:03:07,840 --> 00:03:12,479
uh then there's far fewer light probes

89
00:03:11,039 --> 00:03:15,439
to compute

90
00:03:12,479 --> 00:03:18,719
right now i don't remember the exact

91
00:03:15,439 --> 00:03:20,719
z-stack for lighting i think there is uh

92
00:03:18,719 --> 00:03:23,359
some kind of a parameter here that we

93
00:03:20,719 --> 00:03:24,479
threw in there that um

94
00:03:23,360 --> 00:03:26,080
actually i should probably go to the

95
00:03:24,479 --> 00:03:27,518
handmade directory here first before

96
00:03:26,080 --> 00:03:30,000
opening up the editor

97
00:03:27,519 --> 00:03:32,879
um there is like a

98
00:03:30,000 --> 00:03:34,639
set of parameters here that are um

99
00:03:32,878 --> 00:03:36,798
that are related to that

100
00:03:34,639 --> 00:03:37,839
uh i i don't actually like i said it's

101
00:03:36,799 --> 00:03:39,439
been a long time so we looked at this so

102
00:03:37,840 --> 00:03:40,878
i don't actually remember exactly what

103
00:03:39,439 --> 00:03:43,919
they all are but there are like

104
00:03:40,878 --> 00:03:46,000
basically like dimensions here for it

105
00:03:43,919 --> 00:03:47,518
um and you can kind of see that like

106
00:03:46,000 --> 00:03:49,199
there's some

107
00:03:47,519 --> 00:03:51,039
there's some parameters here for tuning

108
00:03:49,199 --> 00:03:53,280
what the voxel dimensions are going to

109
00:03:51,039 --> 00:03:55,679
be for like the lighting

110
00:03:53,280 --> 00:03:57,919
and in a lot of cases we could just

111
00:03:55,680 --> 00:04:01,680
simplify this down quite a bit

112
00:03:57,919 --> 00:04:03,679
and while we i think already call out uh

113
00:04:01,680 --> 00:04:05,360
we don't sample light probes that are

114
00:04:03,680 --> 00:04:06,640
just floating in space and that don't

115
00:04:05,360 --> 00:04:08,480
actually do anything

116
00:04:06,639 --> 00:04:10,559
um so we may not save a whole lot of

117
00:04:08,479 --> 00:04:12,000
processing time in the cpu side for that

118
00:04:10,560 --> 00:04:14,158
we would be

119
00:04:12,000 --> 00:04:15,519
drastically reducing the footprint of

120
00:04:14,158 --> 00:04:16,560
the thing that we're producing because

121
00:04:15,519 --> 00:04:19,040
remember

122
00:04:16,560 --> 00:04:22,800
we have to send this voxel down to the

123
00:04:19,040 --> 00:04:24,879
gpu every frame and if we cut out uh 16

124
00:04:22,800 --> 00:04:28,160
layers of that texture

125
00:04:24,879 --> 00:04:30,719
then that's a dramatic savings both in

126
00:04:28,160 --> 00:04:32,800
terms of like cache footprint

127
00:04:30,720 --> 00:04:34,400
on the cpu side

128
00:04:32,800 --> 00:04:36,160
because remember right now we're also

129
00:04:34,399 --> 00:04:37,519
still using floats we haven't converted

130
00:04:36,160 --> 00:04:41,240
to something smaller than float so these

131
00:04:37,519 --> 00:04:41,240
textures are quite large

132
00:04:42,000 --> 00:04:46,319
so you can kind of get the feel for just

133
00:04:44,079 --> 00:04:48,319
how much savings we could get here

134
00:04:46,319 --> 00:04:50,560
similarly right now i think we're under

135
00:04:48,319 --> 00:04:53,279
casting we were able to

136
00:04:50,560 --> 00:04:54,959
optimize the raycaster quite a bit and

137
00:04:53,279 --> 00:04:56,959
while i don't remember the exact

138
00:04:54,959 --> 00:04:58,638
breakdown between how much time it's

139
00:04:56,959 --> 00:05:01,758
currently taking

140
00:04:58,639 --> 00:05:04,079
uh for us to

141
00:05:01,759 --> 00:05:05,120
to basically do like you know how much

142
00:05:04,079 --> 00:05:06,159
time is going to take us to do raid

143
00:05:05,120 --> 00:05:07,120
casting how much time it's going to take

144
00:05:06,160 --> 00:05:10,560
us to do

145
00:05:07,120 --> 00:05:11,759
uh blending of the texture maps if i

146
00:05:10,560 --> 00:05:14,160
recall correctly blending the texture

147
00:05:11,759 --> 00:05:16,160
maps was a major part of the time sink

148
00:05:14,160 --> 00:05:18,800
which means we could now because the

149
00:05:16,160 --> 00:05:20,320
raycaster is much faster cast more rays

150
00:05:18,800 --> 00:05:22,079
per texture blend

151
00:05:20,319 --> 00:05:24,000
which would get us much more high

152
00:05:22,079 --> 00:05:26,159
frequency lighting for the at the same

153
00:05:24,000 --> 00:05:27,680
quality level right

154
00:05:26,160 --> 00:05:30,240
uh well not exactly the same quality

155
00:05:27,680 --> 00:05:31,439
level necessarily or although perhaps

156
00:05:30,240 --> 00:05:33,360
it's hard to say

157
00:05:31,439 --> 00:05:36,478
so i do think there's like a lot of

158
00:05:33,360 --> 00:05:38,720
things we could do here uh that we could

159
00:05:36,478 --> 00:05:41,279
use to sort of improve

160
00:05:38,720 --> 00:05:43,360
the state of our

161
00:05:41,279 --> 00:05:45,758
uh lighting system

162
00:05:43,360 --> 00:05:48,560
that don't really require us to do much

163
00:05:45,759 --> 00:05:50,240
hard work right like like we're not

164
00:05:48,560 --> 00:05:52,720
confronted with any real research

165
00:05:50,240 --> 00:05:54,160
problems for those things it's literally

166
00:05:52,720 --> 00:05:56,400
just like okay

167
00:05:54,160 --> 00:05:58,160
cut out one dimension of the lighting so

168
00:05:56,399 --> 00:05:59,519
it's just flat plain

169
00:05:58,160 --> 00:06:00,720
um

170
00:05:59,519 --> 00:06:02,318
and it's still doing the lighting

171
00:06:00,720 --> 00:06:04,400
calculations in 3d right but just

172
00:06:02,319 --> 00:06:06,639
doesn't it doesn't calculate stacks of

173
00:06:04,399 --> 00:06:08,318
light probes it just calculates one

174
00:06:06,639 --> 00:06:10,560
sheet of light probes

175
00:06:08,319 --> 00:06:12,720
huge savings for no visual quality

176
00:06:10,560 --> 00:06:13,759
elimination there right uh almost

177
00:06:12,720 --> 00:06:15,440
nothing

178
00:06:13,759 --> 00:06:16,240
uh gets

179
00:06:15,439 --> 00:06:18,240
gets

180
00:06:16,240 --> 00:06:19,120
you know eliminated and that and that so

181
00:06:18,240 --> 00:06:20,720
on

182
00:06:19,120 --> 00:06:22,800
right uh so

183
00:06:20,720 --> 00:06:25,280
all that's good and then similarly we

184
00:06:22,800 --> 00:06:27,038
don't really have uh

185
00:06:25,279 --> 00:06:28,959
we we don't have much limitation to

186
00:06:27,038 --> 00:06:30,639
casting more rays

187
00:06:28,959 --> 00:06:32,638
uh on every frame i don't think i think

188
00:06:30,639 --> 00:06:33,439
we could crank that number up a little

189
00:06:32,639 --> 00:06:36,879
bit

190
00:06:33,439 --> 00:06:38,240
and it would probably be a pretty

191
00:06:36,879 --> 00:06:41,439
substantial improvement in the lighting

192
00:06:38,240 --> 00:06:43,360
for not a huge hit uh to the frame rate

193
00:06:41,439 --> 00:06:45,759
so i think we probably want to do that

194
00:06:43,360 --> 00:06:48,800
um i want to see how hard it is to

195
00:06:45,759 --> 00:06:50,080
actually remove the z sampling here but

196
00:06:48,800 --> 00:06:52,720
i think that's like the first thing i

197
00:06:50,079 --> 00:06:55,279
want to do uh to just get rid of that so

198
00:06:52,720 --> 00:06:57,440
that we're just talking about one sheet

199
00:06:55,279 --> 00:07:00,079
so the light lookup voxel dim z just

200
00:06:57,439 --> 00:07:01,598
goes away basically right

201
00:07:00,079 --> 00:07:03,199
so this is going to be a pretty major

202
00:07:01,598 --> 00:07:04,159
change it's not difficult but it's going

203
00:07:03,199 --> 00:07:05,840
to be

204
00:07:04,160 --> 00:07:07,280
a couple different steps of making the

205
00:07:05,839 --> 00:07:10,478
change so i'm going to try and do it

206
00:07:07,279 --> 00:07:12,638
slowly so what i'd like to do first is

207
00:07:10,478 --> 00:07:14,478
just see what happens if i change this

208
00:07:12,639 --> 00:07:17,360
to 1 right

209
00:07:14,478 --> 00:07:20,719
if we just eliminate one of our of our

210
00:07:17,360 --> 00:07:23,680
uh light look up voxel uh dim z's here

211
00:07:20,720 --> 00:07:26,720
and maybe i take a a quick second a hot

212
00:07:23,680 --> 00:07:30,639
second as well to just look for light

213
00:07:26,720 --> 00:07:32,880
look up uh voxel dim z to see how many

214
00:07:30,639 --> 00:07:35,918
places this is actually being used

215
00:07:32,879 --> 00:07:38,478
because again i don't really have a good

216
00:07:35,918 --> 00:07:39,680
feel for where what that say to that

217
00:07:38,478 --> 00:07:41,120
code is right now because we haven't

218
00:07:39,680 --> 00:07:43,038
worked on it a while

219
00:07:41,120 --> 00:07:46,319
so you can see here where we initialize

220
00:07:43,038 --> 00:07:48,079
the dimensions of the voxel uh lookup

221
00:07:46,319 --> 00:07:50,160
system right

222
00:07:48,079 --> 00:07:52,560
and you can see us doing this make light

223
00:07:50,160 --> 00:07:53,520
atlas we have the

224
00:07:52,560 --> 00:07:54,089
um

225
00:07:53,519 --> 00:07:55,279
the the

226
00:07:54,089 --> 00:07:58,000
[Music]

227
00:07:55,279 --> 00:08:00,000
make light atlas function here

228
00:07:58,000 --> 00:08:02,399
you can see the way this works is it

229
00:08:00,000 --> 00:08:03,759
basically takes any arbitrary voxel

230
00:08:02,399 --> 00:08:06,000
dimension that you want here and

231
00:08:03,759 --> 00:08:08,400
produces

232
00:08:06,000 --> 00:08:10,399
information that it can use to

233
00:08:08,399 --> 00:08:12,719
index into the voxel

234
00:08:10,399 --> 00:08:14,239
now if all i do is change the dimension

235
00:08:12,720 --> 00:08:16,720
in theory if we wrote this code

236
00:08:14,240 --> 00:08:19,120
correctly it should still all work

237
00:08:16,720 --> 00:08:21,520
um one problem that we're going to have

238
00:08:19,120 --> 00:08:23,280
is the lighting bounds are going to be a

239
00:08:21,519 --> 00:08:25,598
little bit trickier for us to compute

240
00:08:23,279 --> 00:08:27,038
now um i mean in some ways they're

241
00:08:25,598 --> 00:08:29,120
actually simpler for us to compute but

242
00:08:27,038 --> 00:08:29,918
we have to go find where that's going to

243
00:08:29,120 --> 00:08:32,479
be

244
00:08:29,918 --> 00:08:35,120
so when we make uh this light atlas for

245
00:08:32,479 --> 00:08:36,959
example you can kind of see that well

246
00:08:35,120 --> 00:08:39,759
you know when it makes the light atlas

247
00:08:36,958 --> 00:08:41,759
it doesn't really think much about the

248
00:08:39,759 --> 00:08:43,439
actual um

249
00:08:41,759 --> 00:08:44,559
like you can see this uh light atlas

250
00:08:43,440 --> 00:08:46,399
tiles dim

251
00:08:44,559 --> 00:08:48,000
uh that gets passed in there

252
00:08:46,399 --> 00:08:49,759
it's thinking more about just like the

253
00:08:48,000 --> 00:08:51,759
texture that has these

254
00:08:49,759 --> 00:08:54,559
tiles in it it's not really thinking

255
00:08:51,759 --> 00:08:57,039
about where they correspond in the world

256
00:08:54,559 --> 00:08:59,759
right that's not a thing uh that they

257
00:08:57,039 --> 00:09:01,120
actually um are used to we're this is in

258
00:08:59,759 --> 00:09:03,600
the profiler i don't even know why we're

259
00:09:01,120 --> 00:09:05,600
looking in that code um hold on a second

260
00:09:03,600 --> 00:09:07,278
how do i get back to the search or the

261
00:09:05,600 --> 00:09:09,040
list

262
00:09:07,278 --> 00:09:10,799
can i do that i don't know if i can

263
00:09:09,039 --> 00:09:12,079
let's let's list again

264
00:09:10,799 --> 00:09:12,958
light

265
00:09:12,080 --> 00:09:14,240
look up

266
00:09:12,958 --> 00:09:15,278
voxel

267
00:09:14,240 --> 00:09:17,759
see

268
00:09:15,278 --> 00:09:17,759
oops

269
00:09:20,240 --> 00:09:24,000
there we go

270
00:09:21,440 --> 00:09:25,680
um so yeah we do have that lighting

271
00:09:24,000 --> 00:09:28,000
profiler which we built separately which

272
00:09:25,679 --> 00:09:30,958
we could also do uh but again i really

273
00:09:28,000 --> 00:09:34,399
just only just mostly care about the the

274
00:09:30,958 --> 00:09:35,679
lighting stuff in the actual code here

275
00:09:34,399 --> 00:09:37,600
let's go over here

276
00:09:35,679 --> 00:09:39,278
uh you can see this is the open gel

277
00:09:37,600 --> 00:09:40,800
initialization of the light look up

278
00:09:39,278 --> 00:09:43,360
voxel right you can see it here you can

279
00:09:40,799 --> 00:09:44,799
see it making the light atlas uh and and

280
00:09:43,360 --> 00:09:46,879
you know allocating

281
00:09:44,799 --> 00:09:49,519
uh this the actual space that it needs

282
00:09:46,879 --> 00:09:51,278
for it and all that sort of stuff right

283
00:09:49,519 --> 00:09:52,959
and uh

284
00:09:51,278 --> 00:09:54,720
like i said so in theory we should be

285
00:09:52,958 --> 00:09:56,079
able to set this to one but we could

286
00:09:54,720 --> 00:09:57,360
also eliminate a lot of the code

287
00:09:56,080 --> 00:09:59,600
complexity here by removing that

288
00:09:57,360 --> 00:10:01,440
parameter entirely uh so that's also

289
00:09:59,600 --> 00:10:05,360
something we would want to do

290
00:10:01,440 --> 00:10:07,200
now in the actual world uh code in world

291
00:10:05,360 --> 00:10:09,919
mode where we're actually running the

292
00:10:07,200 --> 00:10:12,079
main game loop here

293
00:10:09,919 --> 00:10:14,159
which is in in here this code here if we

294
00:10:12,078 --> 00:10:17,439
take a look at the lighting calls

295
00:10:14,159 --> 00:10:20,078
you can see here we do sort of a pass to

296
00:10:17,440 --> 00:10:22,160
gather like stuff that's going to be

297
00:10:20,078 --> 00:10:23,919
in the lighting right

298
00:10:22,159 --> 00:10:24,958
and you

299
00:10:23,919 --> 00:10:26,799
can see

300
00:10:24,958 --> 00:10:29,439
down at the end after everyone has done

301
00:10:26,799 --> 00:10:32,719
everything we call update lighting here

302
00:10:29,440 --> 00:10:35,440
and you can see us passing like you know

303
00:10:32,720 --> 00:10:36,399
a bunch of of primary values to this

304
00:10:35,440 --> 00:10:38,160
thing

305
00:10:36,399 --> 00:10:40,240
so you can see for example us passing

306
00:10:38,159 --> 00:10:42,879
this world mode fundamental unit yeah

307
00:10:40,240 --> 00:10:45,519
you can see us passing like the the two

308
00:10:42,879 --> 00:10:47,360
atlas is down uh you can see us passing

309
00:10:45,519 --> 00:10:49,200
like where the lighting is going to

310
00:10:47,360 --> 00:10:52,079
occur and so on

311
00:10:49,200 --> 00:10:55,680
uh so in the update lighting call you

312
00:10:52,078 --> 00:10:55,679
know it's gonna rely on

313
00:10:55,919 --> 00:10:59,360
uh let's see here we go it's gonna rely

314
00:10:58,399 --> 00:11:00,720
on

315
00:10:59,360 --> 00:11:03,440
what it gets

316
00:11:00,720 --> 00:11:04,560
as these particular values here

317
00:11:03,440 --> 00:11:06,399
to

318
00:11:04,559 --> 00:11:09,359
deter determine like the span of this

319
00:11:06,399 --> 00:11:10,958
voxel grid and you can actually see the

320
00:11:09,360 --> 00:11:14,399
calculations of the

321
00:11:10,958 --> 00:11:17,039
lighting area right here uh every time

322
00:11:14,399 --> 00:11:19,039
that the general size of this thing

323
00:11:17,039 --> 00:11:21,360
changes or whatever happens it

324
00:11:19,039 --> 00:11:24,719
recomputes like how the spatial grid is

325
00:11:21,360 --> 00:11:26,720
aligned and what the walk to it's called

326
00:11:24,720 --> 00:11:28,160
a walk table uh

327
00:11:26,720 --> 00:11:29,680
that we made here it's basically the

328
00:11:28,159 --> 00:11:31,519
thing that allows us to walk through

329
00:11:29,679 --> 00:11:32,799
nodes of the voxel for raycasting and

330
00:11:31,519 --> 00:11:34,799
things like that

331
00:11:32,799 --> 00:11:36,639
um and as far as i know these are sort

332
00:11:34,799 --> 00:11:38,799
of aligned with the lighting grid i

333
00:11:36,639 --> 00:11:40,319
don't remember us using two different

334
00:11:38,799 --> 00:11:41,919
spatial resolutions for those things but

335
00:11:40,320 --> 00:11:43,760
i could be wrong because they there's no

336
00:11:41,919 --> 00:11:45,199
real reason they have to be uh

337
00:11:43,759 --> 00:11:46,958
equivalent but i think we may have made

338
00:11:45,200 --> 00:11:48,720
them equivalent because of certain

339
00:11:46,958 --> 00:11:51,439
efficiencies we could gain from it if i

340
00:11:48,720 --> 00:11:51,440
remember correctly

341
00:11:51,600 --> 00:11:54,560
um so then if you take a look at what

342
00:11:53,120 --> 00:11:56,560
happens here

343
00:11:54,559 --> 00:11:58,000
after we you know ensure that this is

344
00:11:56,559 --> 00:11:59,759
built because this only happens like

345
00:11:58,000 --> 00:12:01,919
once right this only happens if you

346
00:11:59,759 --> 00:12:03,278
change fundamental lighting parameters

347
00:12:01,919 --> 00:12:04,879
um so it's probably only going to happen

348
00:12:03,278 --> 00:12:07,600
once in a run of the game

349
00:12:04,879 --> 00:12:10,000
uh at startup in here you can see update

350
00:12:07,600 --> 00:12:11,839
the alignment of voxels to the view this

351
00:12:10,000 --> 00:12:13,679
is the part that actually tries to like

352
00:12:11,839 --> 00:12:16,560
keep things aligned

353
00:12:13,679 --> 00:12:17,519
and you can see that it's going to do uh

354
00:12:16,559 --> 00:12:19,359
when it

355
00:12:17,519 --> 00:12:20,639
it detects that something

356
00:12:19,360 --> 00:12:22,560
when it detects that the camera has

357
00:12:20,639 --> 00:12:25,360
shifted away from where the voxels are

358
00:12:22,559 --> 00:12:27,838
it shifts the voxel and tries to align

359
00:12:25,360 --> 00:12:29,360
the lighting voxel to wherever the view

360
00:12:27,839 --> 00:12:31,360
is viewing and the reason for this is

361
00:12:29,360 --> 00:12:33,039
because lighting is very expensive so we

362
00:12:31,360 --> 00:12:34,800
only want to compute lighting just where

363
00:12:33,039 --> 00:12:36,958
we can see we don't want to compute

364
00:12:34,799 --> 00:12:39,359
lighting anywhere else and you can see

365
00:12:36,958 --> 00:12:40,958
uh these two set min corners here are

366
00:12:39,360 --> 00:12:43,360
the things that actually like figure out

367
00:12:40,958 --> 00:12:45,119
where the uh atlas grid and the spatial

368
00:12:43,360 --> 00:12:47,360
grid are here right the spatial grid

369
00:12:45,120 --> 00:12:49,759
being the the thing we're actually using

370
00:12:47,360 --> 00:12:51,039
uh to do raycasting and the atlas grid

371
00:12:49,759 --> 00:12:52,720
being the thing that we actually compute

372
00:12:51,039 --> 00:12:54,799
the atlas grid will in general be

373
00:12:52,720 --> 00:12:56,639
smaller than the spatial grid because we

374
00:12:54,799 --> 00:12:59,679
only need to store and compute lighting

375
00:12:56,639 --> 00:13:02,639
values really in the area we can see but

376
00:12:59,679 --> 00:13:05,439
we may need to keep a larger field than

377
00:13:02,639 --> 00:13:07,360
that for spatial intersections because

378
00:13:05,440 --> 00:13:09,440
we want to be able to cast outside of

379
00:13:07,360 --> 00:13:12,720
the visible region to see what we hit

380
00:13:09,440 --> 00:13:15,920
sometimes so the spatial grid is is

381
00:13:12,720 --> 00:13:19,360
potentially larger right

382
00:13:15,919 --> 00:13:21,199
so my question here is again the

383
00:13:19,360 --> 00:13:23,519
it's the z component that i just want to

384
00:13:21,200 --> 00:13:25,440
know about how are we doing like how are

385
00:13:23,519 --> 00:13:27,600
we figuring out where to center

386
00:13:25,440 --> 00:13:30,160
uh the v component right

387
00:13:27,600 --> 00:13:32,720
if you look here we've got sort of this

388
00:13:30,159 --> 00:13:35,199
notion of the voxel cell dimension that

389
00:13:32,720 --> 00:13:36,959
is presumably just going to be whatever

390
00:13:35,200 --> 00:13:39,040
it is right the

391
00:13:36,958 --> 00:13:40,638
the atlas's voxel dimensions are

392
00:13:39,039 --> 00:13:43,120
presumably set to something constant we

393
00:13:40,639 --> 00:13:45,039
can step in here and uh investigate them

394
00:13:43,120 --> 00:13:46,959
certainly but then you can kind of see

395
00:13:45,039 --> 00:13:49,198
it trying to compute like where it's

396
00:13:46,958 --> 00:13:50,799
going to align these things

397
00:13:49,198 --> 00:13:53,359
and presumably to actually set the

398
00:13:50,799 --> 00:13:55,120
dimension of this i assume that the

399
00:13:53,360 --> 00:13:56,720
actual dimensions of this were kind of

400
00:13:55,120 --> 00:13:58,560
just determined by how many cells there

401
00:13:56,720 --> 00:14:00,639
were and what the dimension was

402
00:13:58,559 --> 00:14:03,278
it's going to set the position of this

403
00:14:00,639 --> 00:14:05,919
relative to the camera center somehow

404
00:14:03,278 --> 00:14:07,198
and my concern is that i don't know

405
00:14:05,919 --> 00:14:08,719
whether that's going to be set

406
00:14:07,198 --> 00:14:10,319
appropriately

407
00:14:08,720 --> 00:14:12,399
um for

408
00:14:10,320 --> 00:14:15,680
what we're currently doing if we reduce

409
00:14:12,399 --> 00:14:18,799
this down to one voxel uh

410
00:14:15,679 --> 00:14:19,919
one voxel height right with no no z

411
00:14:18,799 --> 00:14:21,759
stacking

412
00:14:19,919 --> 00:14:23,679
i need to make sure that it's actually

413
00:14:21,759 --> 00:14:26,240
centered around where the player is

414
00:14:23,679 --> 00:14:27,759
which would be a trivial thing

415
00:14:26,240 --> 00:14:30,000
and obviously would be what was

416
00:14:27,759 --> 00:14:31,600
happening if we had started out saying

417
00:14:30,000 --> 00:14:33,519
we're just going to be 2d only but

418
00:14:31,600 --> 00:14:36,480
because we were always 3d that probably

419
00:14:33,519 --> 00:14:36,480
isn't currently the case

420
00:14:42,839 --> 00:14:46,720
right now fortunately i don't really

421
00:14:45,039 --> 00:14:48,240
have to guess uh now that i've looked at

422
00:14:46,720 --> 00:14:49,920
the code and just like it's working the

423
00:14:48,240 --> 00:14:51,519
way i think it is right nothing

424
00:14:49,919 --> 00:14:55,360
particularly weird

425
00:14:51,519 --> 00:14:56,959
um i need to take a look and find out

426
00:14:55,360 --> 00:14:59,759
more specifically here

427
00:14:56,958 --> 00:15:02,159
uh can i you know just draw

428
00:14:59,759 --> 00:15:03,838
where this lighting bound actually

429
00:15:02,159 --> 00:15:05,360
exists right like where is the lighting

430
00:15:03,839 --> 00:15:08,399
actually occurring

431
00:15:05,360 --> 00:15:10,240
um and to the extent that we want to do

432
00:15:08,399 --> 00:15:12,399
that i think we already have the code in

433
00:15:10,240 --> 00:15:15,278
place you can see here there's a thing

434
00:15:12,399 --> 00:15:17,278
that draws the lighting bounds um and so

435
00:15:15,278 --> 00:15:18,799
this this piece of code just this one

436
00:15:17,278 --> 00:15:21,759
wrecked out line here

437
00:15:18,799 --> 00:15:24,078
uh i believe will we can make uh draw

438
00:15:21,759 --> 00:15:25,439
the the part of

439
00:15:24,078 --> 00:15:28,000
we can make this draw like sort of the

440
00:15:25,440 --> 00:15:30,240
thing that bounds the area that we're

441
00:15:28,000 --> 00:15:32,000
actually lighting um now of course i

442
00:15:30,240 --> 00:15:33,919
don't actually know

443
00:15:32,000 --> 00:15:36,639
it looks like though

444
00:15:33,919 --> 00:15:38,399
maybe that's not true anymore uh because

445
00:15:36,639 --> 00:15:40,480
the light bounds don't get passed down

446
00:15:38,399 --> 00:15:42,639
here so i suppose

447
00:15:40,480 --> 00:15:45,920
we actually need to draw them in here

448
00:15:42,639 --> 00:15:48,399
which i suspect we do like i suspect

449
00:15:45,919 --> 00:15:50,559
it's this right here right um when we do

450
00:15:48,399 --> 00:15:52,559
push lighting

451
00:15:50,559 --> 00:15:54,239
render values so this is actually the

452
00:15:52,559 --> 00:15:56,000
one we would want which shows the hot

453
00:15:54,240 --> 00:15:58,079
voxel rectangle here

454
00:15:56,000 --> 00:15:59,600
um which would allow us to see sort of

455
00:15:58,078 --> 00:16:01,599
where we're actually computing the

456
00:15:59,600 --> 00:16:03,040
lighting at right

457
00:16:01,600 --> 00:16:04,480
and you can see how it's completely

458
00:16:03,039 --> 00:16:06,799
black right now and you know i'm

459
00:16:04,480 --> 00:16:08,959
assuming that that's mostly just because

460
00:16:06,799 --> 00:16:10,000
again like the the lights aren't

461
00:16:08,958 --> 00:16:13,359
actually

462
00:16:10,000 --> 00:16:15,440
uh they're there to this this boundary

463
00:16:13,360 --> 00:16:16,959
is going to be too narrow right

464
00:16:15,440 --> 00:16:19,199
so our first

465
00:16:16,958 --> 00:16:22,479
you know our first goal is to just get

466
00:16:19,198 --> 00:16:24,719
this working at only one voxel high and

467
00:16:22,480 --> 00:16:25,839
also i can test to see like how

468
00:16:24,720 --> 00:16:27,120
[Music]

469
00:16:25,839 --> 00:16:28,800
um

470
00:16:27,120 --> 00:16:30,879
like i i can

471
00:16:28,799 --> 00:16:32,958
i can test to see like how flexible this

472
00:16:30,879 --> 00:16:34,879
is like if i set this up to something

473
00:16:32,958 --> 00:16:36,399
else like eight would it continue

474
00:16:34,879 --> 00:16:38,559
working so at what point does it

475
00:16:36,399 --> 00:16:40,000
actually fail in terms of setting the

476
00:16:38,559 --> 00:16:42,078
lookups just to let us know if it's just

477
00:16:40,000 --> 00:16:43,679
if we've got bugs or something so you

478
00:16:42,078 --> 00:16:46,239
know you can see here it looks like if

479
00:16:43,679 --> 00:16:47,679
you make it that high right it's still

480
00:16:46,240 --> 00:16:51,919
working just fine

481
00:16:47,679 --> 00:16:51,919
um if we drop it down now to four

482
00:16:55,120 --> 00:17:01,198
still fine right so it's just when you

483
00:16:57,919 --> 00:17:02,879
get it down small enough it no longer is

484
00:17:01,198 --> 00:17:04,879
working properly maybe because we have

485
00:17:02,879 --> 00:17:07,599
some bugs at the boundary maybe because

486
00:17:04,880 --> 00:17:09,360
the size is too small so the lights are

487
00:17:07,599 --> 00:17:11,119
like outside of it

488
00:17:09,359 --> 00:17:13,038
right we just don't really know but

489
00:17:11,119 --> 00:17:15,759
there's a two high one and it's still

490
00:17:13,038 --> 00:17:18,160
working just fine so i suspect really

491
00:17:15,759 --> 00:17:20,400
mostly what we need to do here is just

492
00:17:18,160 --> 00:17:23,439
to make sure that the

493
00:17:20,400 --> 00:17:25,519
uh voxel the the way that we're actually

494
00:17:23,439 --> 00:17:27,519
doing this light look up voxel

495
00:17:25,519 --> 00:17:29,038
here uh doesn't have some kind of a bug

496
00:17:27,519 --> 00:17:31,119
in it when it gets down to one like

497
00:17:29,038 --> 00:17:33,359
maybe that's the case here or it could

498
00:17:31,119 --> 00:17:35,678
just be that this is now too thin and

499
00:17:33,359 --> 00:17:37,519
it's not picking up uh light sources for

500
00:17:35,679 --> 00:17:39,679
some reason right we really just don't

501
00:17:37,519 --> 00:17:41,359
know uh what the actual problem is so

502
00:17:39,679 --> 00:17:42,160
you can see i'm walking around now in

503
00:17:41,359 --> 00:17:43,199
there

504
00:17:42,160 --> 00:17:46,080
um

505
00:17:43,200 --> 00:17:47,519
so you know

506
00:17:46,079 --> 00:17:49,038
take a look at this more carefully and

507
00:17:47,519 --> 00:17:51,759
i'll set this up to 2 because that's the

508
00:17:49,038 --> 00:17:53,279
lowest version that's currently working

509
00:17:51,759 --> 00:17:55,279
but again we can kind of see that like

510
00:17:53,279 --> 00:17:58,720
there's no real reason

511
00:17:55,279 --> 00:18:00,480
that we need the lighting bounds to be

512
00:17:58,720 --> 00:18:02,400
particularly large because

513
00:18:00,480 --> 00:18:04,319
even just setting it to two it looks the

514
00:18:02,400 --> 00:18:05,519
exact same now right like the game

515
00:18:04,319 --> 00:18:07,678
really doesn't look particularly

516
00:18:05,519 --> 00:18:08,798
different this way you can see a couple

517
00:18:07,679 --> 00:18:10,480
bugs

518
00:18:08,798 --> 00:18:12,558
again with that height problem as it

519
00:18:10,480 --> 00:18:14,960
moves up and down you can kind of see

520
00:18:12,558 --> 00:18:16,720
that the lighting voxels uh we're

521
00:18:14,960 --> 00:18:19,120
hopping in and out of you can see like

522
00:18:16,720 --> 00:18:21,120
we're missing samples as we get too high

523
00:18:19,119 --> 00:18:23,759
so and the other thing that i guess i

524
00:18:21,119 --> 00:18:25,759
would say is i also am not sure we want

525
00:18:23,759 --> 00:18:29,519
to drop to one

526
00:18:25,759 --> 00:18:31,919
uh we may want to keep it at two because

527
00:18:29,519 --> 00:18:34,240
we may want a high and a low sample on

528
00:18:31,919 --> 00:18:36,480
each tile to give it some

529
00:18:34,240 --> 00:18:38,480
a little bit of uh

530
00:18:36,480 --> 00:18:39,599
of range there so to be completely

531
00:18:38,480 --> 00:18:41,759
honest i don't actually know that we

532
00:18:39,599 --> 00:18:43,279
don't want to leave it at two but even

533
00:18:41,759 --> 00:18:45,359
just assuming like let's assume we do

534
00:18:43,279 --> 00:18:48,879
want to leave it at two uh we still

535
00:18:45,359 --> 00:18:50,399
probably want to go ahead and try to fix

536
00:18:48,880 --> 00:18:52,400
the way that the heights work here

537
00:18:50,400 --> 00:18:56,000
because we don't really want to move up

538
00:18:52,400 --> 00:18:57,919
and down in z anymore like our our new

539
00:18:56,000 --> 00:18:59,440
um kind of rule that we decided when we

540
00:18:57,919 --> 00:19:02,080
just looked at what was good for cost

541
00:18:59,440 --> 00:19:03,919
benefit analysis um

542
00:19:02,079 --> 00:19:05,918
for the game is we just want to keep one

543
00:19:03,919 --> 00:19:08,080
uh level and we're gonna eliminate this

544
00:19:05,919 --> 00:19:09,360
kind of stairwell stuff right we're just

545
00:19:08,079 --> 00:19:11,199
not gonna have it anymore because we

546
00:19:09,359 --> 00:19:13,519
decided it just wasn't interesting

547
00:19:11,200 --> 00:19:14,240
enough for the cost that we were paying

548
00:19:13,519 --> 00:19:15,839
so

549
00:19:14,240 --> 00:19:18,798
assuming that we're going to do that it

550
00:19:15,839 --> 00:19:20,798
means that now like the actual z

551
00:19:18,798 --> 00:19:22,400
range of the lighting isn't really going

552
00:19:20,798 --> 00:19:24,558
to change those values are just going to

553
00:19:22,400 --> 00:19:27,519
be fixed in space

554
00:19:24,558 --> 00:19:29,359
and we can't assume something like oh

555
00:19:27,519 --> 00:19:31,599
we're just going to pick some bounds

556
00:19:29,359 --> 00:19:33,279
between you know negative 1 or 1 or

557
00:19:31,599 --> 00:19:34,879
something like that

558
00:19:33,279 --> 00:19:36,319
we can

559
00:19:34,880 --> 00:19:38,880
we can do

560
00:19:36,319 --> 00:19:40,000
some kind of a

561
00:19:38,880 --> 00:19:41,760
just a re

562
00:19:40,000 --> 00:19:43,440
some kind of predefined value that just

563
00:19:41,759 --> 00:19:44,480
tells us what these z bounds are going

564
00:19:43,440 --> 00:19:47,480
to be and we're just going to go from

565
00:19:44,480 --> 00:19:47,480
there

566
00:19:52,000 --> 00:19:55,839
what that would translate to uh in

567
00:19:53,839 --> 00:19:57,359
practice is things things like the sim

568
00:19:55,839 --> 00:19:59,199
region

569
00:19:57,359 --> 00:20:01,839
uh and other things like that are always

570
00:19:59,200 --> 00:20:03,840
gonna end up we're gonna be taking z out

571
00:20:01,839 --> 00:20:05,519
of all of their computations

572
00:20:03,839 --> 00:20:07,599
and so what that means for the lighting

573
00:20:05,519 --> 00:20:10,158
system is when it goes through here to

574
00:20:07,599 --> 00:20:13,359
do like the update lighting

575
00:20:10,159 --> 00:20:15,440
as it does uh whenever we do this sort

576
00:20:13,359 --> 00:20:17,359
of set min bounds here this all of this

577
00:20:15,440 --> 00:20:19,038
stuff that we're looking at uh to see

578
00:20:17,359 --> 00:20:22,319
whether the centers moved and that sort

579
00:20:19,038 --> 00:20:24,798
of thing uh we're not going to want to

580
00:20:22,319 --> 00:20:26,639
to have z be involved here at all right

581
00:20:24,798 --> 00:20:30,400
we're going to want to

582
00:20:26,640 --> 00:20:32,000
uh always adjust after the fact the

583
00:20:30,400 --> 00:20:34,320
values we're using to compute the

584
00:20:32,000 --> 00:20:36,720
alignment of the grid

585
00:20:34,319 --> 00:20:37,889
to just assume that z is not a thing

586
00:20:36,720 --> 00:20:39,200
so if you

587
00:20:37,890 --> 00:20:40,640
[Music]

588
00:20:39,200 --> 00:20:42,558
take a look at what's going on here you

589
00:20:40,640 --> 00:20:44,880
can see we have like the origin p and

590
00:20:42,558 --> 00:20:46,839
the last origin p

591
00:20:44,880 --> 00:20:48,400
set up here

592
00:20:46,839 --> 00:20:51,759
um

593
00:20:48,400 --> 00:20:51,759
in theory

594
00:20:55,440 --> 00:21:02,080
so in theory i i think probably i would

595
00:20:59,440 --> 00:21:04,400
start by locking

596
00:21:02,079 --> 00:21:04,399
the

597
00:21:05,440 --> 00:21:09,919
i would start by locking

598
00:21:08,000 --> 00:21:11,519
like the

599
00:21:09,919 --> 00:21:16,080
the

600
00:21:11,519 --> 00:21:19,038
sim regions to always have a constant z

601
00:21:16,079 --> 00:21:20,720
then i assume we also because this

602
00:21:19,038 --> 00:21:25,119
tracks the camera

603
00:21:20,720 --> 00:21:25,120
i assume we would also need

604
00:21:25,919 --> 00:21:31,440
we would also need the camera z's to be

605
00:21:28,720 --> 00:21:33,759
ignored

606
00:21:31,440 --> 00:21:33,759
um

607
00:21:34,400 --> 00:21:38,559
and i'm not sure exactly how i want to

608
00:21:36,880 --> 00:21:41,039
do that you know

609
00:21:38,558 --> 00:21:43,440
you can see here like there's an origin

610
00:21:41,038 --> 00:21:44,558
p and a sim origin p that are passed in

611
00:21:43,440 --> 00:21:46,480
here

612
00:21:44,558 --> 00:21:49,599
um and if we just start to assume that

613
00:21:46,480 --> 00:21:52,000
those are always zeroed you know i could

614
00:21:49,599 --> 00:21:54,399
do something like say

615
00:21:52,000 --> 00:21:56,400
that the sim origin p

616
00:21:54,400 --> 00:21:57,519
uh

617
00:21:56,400 --> 00:21:59,360
you know if you take a look at how these

618
00:21:57,519 --> 00:22:02,558
world positions work there's like a a

619
00:21:59,359 --> 00:22:04,639
chunk z at an offset uh if we always

620
00:22:02,558 --> 00:22:06,798
just assumed that all the z values were

621
00:22:04,640 --> 00:22:09,200
zero you know what would this look like

622
00:22:06,798 --> 00:22:11,519
so if we said like look the chunk z is

623
00:22:09,200 --> 00:22:14,558
always zero

624
00:22:11,519 --> 00:22:16,480
um and the offset z is always zero we're

625
00:22:14,558 --> 00:22:20,000
just never going to allow

626
00:22:16,480 --> 00:22:21,038
uh anything other than that to occur

627
00:22:20,000 --> 00:22:23,759
so

628
00:22:21,038 --> 00:22:23,759
let's just

629
00:22:24,000 --> 00:22:28,960
zero these out here

630
00:22:26,720 --> 00:22:29,919
um if we always assume that those are

631
00:22:28,960 --> 00:22:31,679
zero

632
00:22:29,919 --> 00:22:33,360
what happens like let's just look

633
00:22:31,679 --> 00:22:34,798
because that's the entirety of the data

634
00:22:33,359 --> 00:22:37,119
that's coming in here

635
00:22:34,798 --> 00:22:39,759
in terms of alignment so if we just take

636
00:22:37,119 --> 00:22:42,158
z alignment out of the equation

637
00:22:39,759 --> 00:22:43,599
where does that actually put our bounds

638
00:22:42,159 --> 00:22:45,600
right

639
00:22:43,599 --> 00:22:47,918
so you can see them here

640
00:22:45,599 --> 00:22:49,519
uh and you can see that they are

641
00:22:47,919 --> 00:22:52,240
probably

642
00:22:49,519 --> 00:22:54,639
well i mean it's really hard to say but

643
00:22:52,240 --> 00:22:55,519
they're probably a little too

644
00:22:54,640 --> 00:22:57,440
uh

645
00:22:55,519 --> 00:22:58,798
they're definitely oriented a little

646
00:22:57,440 --> 00:23:01,840
wrong in the sense that this should

647
00:22:58,798 --> 00:23:03,200
actually be moved up right um

648
00:23:01,839 --> 00:23:04,720
considerably

649
00:23:03,200 --> 00:23:05,919
uh and

650
00:23:04,720 --> 00:23:09,279
you know honestly it looks like it

651
00:23:05,919 --> 00:23:10,480
probably is high enough though so mostly

652
00:23:09,279 --> 00:23:13,359
it looks like what we would need to do

653
00:23:10,480 --> 00:23:15,759
is just shift this upward right so when

654
00:23:13,359 --> 00:23:18,959
we look at what the origin z values are

655
00:23:15,759 --> 00:23:22,400
there it looks like uh you know it looks

656
00:23:18,960 --> 00:23:24,000
like the alignment of those is is off in

657
00:23:22,400 --> 00:23:25,840
that sense now there's a couple

658
00:23:24,000 --> 00:23:28,079
different things we can do here but the

659
00:23:25,839 --> 00:23:28,879
first problem that i have is i don't

660
00:23:28,079 --> 00:23:30,960
know

661
00:23:28,880 --> 00:23:32,480
who is off right

662
00:23:30,960 --> 00:23:34,640
if we're going to switch to a new

663
00:23:32,480 --> 00:23:36,400
unified like we always assume we're on

664
00:23:34,640 --> 00:23:37,520
chunk z zero

665
00:23:36,400 --> 00:23:38,720
um

666
00:23:37,519 --> 00:23:41,679
are these

667
00:23:38,720 --> 00:23:44,240
on that chunk or not right if we take z

668
00:23:41,679 --> 00:23:46,000
out of the system

669
00:23:44,240 --> 00:23:48,720
it could be that the lighting is now

670
00:23:46,000 --> 00:23:50,640
properly aligned and these are all just

671
00:23:48,720 --> 00:23:53,038
high because there was no reason in the

672
00:23:50,640 --> 00:23:54,880
past why they should be aligned because

673
00:23:53,038 --> 00:23:57,119
we were just assuming you know z can be

674
00:23:54,880 --> 00:23:58,880
anything so we wouldn't have been like

675
00:23:57,119 --> 00:24:02,479
particularly careful to make sure these

676
00:23:58,880 --> 00:24:04,159
fell within our uh appropriate 2d range

677
00:24:02,480 --> 00:24:06,000
so the other thing that i i think i

678
00:24:04,159 --> 00:24:08,480
would like to uh

679
00:24:06,000 --> 00:24:12,000
try to do here is to draw in the sim

680
00:24:08,480 --> 00:24:14,400
region so let's suppose that we

681
00:24:12,000 --> 00:24:14,400
take a

682
00:24:15,278 --> 00:24:19,839
let's take a look at the outside here

683
00:24:20,400 --> 00:24:22,798
where we're actually calling update

684
00:24:21,759 --> 00:24:24,240
lighting

685
00:24:22,798 --> 00:24:27,038
so if you take a look at what we're

686
00:24:24,240 --> 00:24:29,278
actually passing for those values

687
00:24:27,038 --> 00:24:31,759
you can see that

688
00:24:29,278 --> 00:24:33,038
after the diffuse atlas and the specular

689
00:24:31,759 --> 00:24:35,679
atlas here

690
00:24:33,038 --> 00:24:37,919
uh we're passing the symbol origin p so

691
00:24:35,679 --> 00:24:40,480
it's this lighting sim center

692
00:24:37,919 --> 00:24:42,480
and lighting center right those two

693
00:24:40,480 --> 00:24:45,038
um if we go look at where those are

694
00:24:42,480 --> 00:24:45,038
coming from

695
00:24:45,679 --> 00:24:50,559
you can see them here

696
00:24:47,359 --> 00:24:52,558
uh the simulation center that should we

697
00:24:50,558 --> 00:24:53,839
should always peg to xero as well

698
00:24:52,558 --> 00:24:55,200
outside of this because everyone wants

699
00:24:53,839 --> 00:24:57,278
to do that now

700
00:24:55,200 --> 00:24:59,440
and the lighting sim center you can see

701
00:24:57,278 --> 00:25:01,679
is using that camera

702
00:24:59,440 --> 00:25:04,159
simulation center there and that also

703
00:25:01,679 --> 00:25:06,720
now wants to be pegged to zero so

704
00:25:04,159 --> 00:25:09,360
probably if we move these outward a

705
00:25:06,720 --> 00:25:10,159
little bit we can then also see

706
00:25:09,359 --> 00:25:12,399
uh

707
00:25:10,159 --> 00:25:14,480
to what extent those are

708
00:25:12,400 --> 00:25:16,080
align with the world and maybe we draw

709
00:25:14,480 --> 00:25:16,960
like something in there that lets us

710
00:25:16,079 --> 00:25:19,839
know

711
00:25:16,960 --> 00:25:22,159
uh where that's happening so

712
00:25:19,839 --> 00:25:24,798
let's try to back this out here and

713
00:25:22,159 --> 00:25:25,919
figure out like exactly where

714
00:25:24,798 --> 00:25:27,278
um

715
00:25:25,919 --> 00:25:29,440
where is the right place to make sure

716
00:25:27,278 --> 00:25:32,000
that these are always clamped so if we

717
00:25:29,440 --> 00:25:34,000
take a look at the

718
00:25:32,000 --> 00:25:35,839
like if we take a look at the simulation

719
00:25:34,000 --> 00:25:36,960
center

720
00:25:35,839 --> 00:25:37,839
in fact

721
00:25:36,960 --> 00:25:41,720
actually

722
00:25:37,839 --> 00:25:41,720
these are the same right

723
00:25:43,119 --> 00:25:48,479
so these are always the same value it

724
00:25:45,519 --> 00:25:50,720
looks like sort of uh i mean not exactly

725
00:25:48,480 --> 00:25:50,720
the

726
00:25:51,839 --> 00:25:56,639
this is calling map into chunk space

727
00:25:54,558 --> 00:25:58,639
uh

728
00:25:56,640 --> 00:26:00,559
using the simulation center of i guess

729
00:25:58,640 --> 00:26:02,799
whatever the world camera rectangle is

730
00:26:00,558 --> 00:26:04,720
so wherever the center of where you're

731
00:26:02,798 --> 00:26:05,759
looking is right

732
00:26:04,720 --> 00:26:08,240
um

733
00:26:05,759 --> 00:26:08,960
so i suppose not exactly

734
00:26:08,240 --> 00:26:10,798
but

735
00:26:08,960 --> 00:26:12,640
yeah like

736
00:26:10,798 --> 00:26:14,639
if you look at these two values they're

737
00:26:12,640 --> 00:26:16,159
basically just being derived from each

738
00:26:14,640 --> 00:26:18,000
other right this simulation center is

739
00:26:16,159 --> 00:26:18,799
still the thing that matters in this

740
00:26:18,000 --> 00:26:22,079
case

741
00:26:18,798 --> 00:26:23,519
and this is probably

742
00:26:22,079 --> 00:26:25,278
this is just looking at what the camera

743
00:26:23,519 --> 00:26:27,440
rectangle is that we're viewing and

744
00:26:25,278 --> 00:26:30,558
saying the center of it is going to be

745
00:26:27,440 --> 00:26:32,320
uh where that you know

746
00:26:30,558 --> 00:26:33,278
where we actually take

747
00:26:32,319 --> 00:26:36,278
um

748
00:26:33,278 --> 00:26:37,839
the the lighting to be aligned so

749
00:26:36,278 --> 00:26:40,240
this

750
00:26:37,839 --> 00:26:43,359
this will take care of itself but this

751
00:26:40,240 --> 00:26:45,038
wouldn't right because that world camera

752
00:26:43,359 --> 00:26:46,240
wrecked you know is is going to be

753
00:26:45,038 --> 00:26:48,240
computed

754
00:26:46,240 --> 00:26:50,880
um in a different way so you can see it

755
00:26:48,240 --> 00:26:53,120
calling get camera rectangle at target

756
00:26:50,880 --> 00:26:55,039
uh with a focus z here

757
00:26:53,119 --> 00:26:58,000
and this computation

758
00:26:55,038 --> 00:27:00,400
is going to produce some kind of a up

759
00:26:58,000 --> 00:27:01,679
and down range right

760
00:27:00,400 --> 00:27:04,320
so let's take a look at how that's

761
00:27:01,679 --> 00:27:07,200
actually working

762
00:27:04,319 --> 00:27:08,960
so get camera rectangular target here uh

763
00:27:07,200 --> 00:27:11,600
it's it's basically just saying look

764
00:27:08,960 --> 00:27:12,960
we're going to unproject the the cube of

765
00:27:11,599 --> 00:27:14,879
visibility

766
00:27:12,960 --> 00:27:17,200
uh and we're going to produce it here

767
00:27:14,880 --> 00:27:18,159
with a rectman max right

768
00:27:17,200 --> 00:27:19,919
so

769
00:27:18,159 --> 00:27:22,399
to be honest i don't know that we really

770
00:27:19,919 --> 00:27:23,919
want to play with that uh i'm guessing

771
00:27:22,398 --> 00:27:26,239
really what we want to do is just

772
00:27:23,919 --> 00:27:28,320
flatten these rectangles down uh to

773
00:27:26,240 --> 00:27:31,519
exist within a

774
00:27:28,319 --> 00:27:33,839
predefined sort of range right so that

775
00:27:31,519 --> 00:27:36,079
we basically like take the camera rec

776
00:27:33,839 --> 00:27:38,000
that comes out but we want to flatten it

777
00:27:36,079 --> 00:27:41,519
so that we're generally talking about

778
00:27:38,000 --> 00:27:43,200
looking at um a range close to zero and

779
00:27:41,519 --> 00:27:45,038
z

780
00:27:43,200 --> 00:27:46,558
because otherwise you know we other

781
00:27:45,038 --> 00:27:48,319
there's really nothing wrong with this

782
00:27:46,558 --> 00:27:50,319
on project that tells us that the region

783
00:27:48,319 --> 00:27:52,000
that we're actually looking at here

784
00:27:50,319 --> 00:27:53,038
let's take a look at that world camera

785
00:27:52,000 --> 00:27:55,278
rect

786
00:27:53,038 --> 00:27:58,640
where we're actually viewing that

787
00:27:55,278 --> 00:28:01,679
we can push that as well

788
00:27:58,640 --> 00:28:04,000
so this is going to be a white

789
00:28:01,679 --> 00:28:05,919
volume that's overlaid on top of what

790
00:28:04,000 --> 00:28:08,319
we've got here

791
00:28:05,919 --> 00:28:11,679
so you can see here

792
00:28:08,319 --> 00:28:13,678
the the two different actual

793
00:28:11,679 --> 00:28:16,159
rectangles in question

794
00:28:13,679 --> 00:28:18,960
so what we see here is the camera view

795
00:28:16,159 --> 00:28:21,360
volume and what we see here is the

796
00:28:18,960 --> 00:28:22,240
lighting volume so

797
00:28:21,359 --> 00:28:25,119
uh

798
00:28:22,240 --> 00:28:26,960
don't ask me why they're quite so

799
00:28:25,119 --> 00:28:27,799
off-center aligned

800
00:28:26,960 --> 00:28:29,038
they're um

801
00:28:27,799 --> 00:28:31,599
[Music]

802
00:28:29,038 --> 00:28:34,798
i think we decided that hopping

803
00:28:31,599 --> 00:28:36,000
backwards you'd be less likely to

804
00:28:34,798 --> 00:28:38,000
because the

805
00:28:36,000 --> 00:28:40,319
the camera sees more forwards than it

806
00:28:38,000 --> 00:28:42,319
sees backwards i think we skewed it

807
00:28:40,319 --> 00:28:44,000
intentionally there so i don't think

808
00:28:42,319 --> 00:28:46,480
that's a bug i think that's actually by

809
00:28:44,000 --> 00:28:48,240
design uh but you know you can correct

810
00:28:46,480 --> 00:28:49,440
me if i'm wrong and go back and watch

811
00:28:48,240 --> 00:28:51,359
the tape

812
00:28:49,440 --> 00:28:53,759
um

813
00:28:51,359 --> 00:28:56,319
so looking at this you can see

814
00:28:53,759 --> 00:28:58,558
that uh honestly it's it's pretty

815
00:28:56,319 --> 00:29:00,879
reasonable right um

816
00:28:58,558 --> 00:29:02,960
like like that actually looks

817
00:29:00,880 --> 00:29:05,278
again about right

818
00:29:02,960 --> 00:29:05,278
and

819
00:29:06,398 --> 00:29:11,439
yeah so you know really i think just

820
00:29:09,278 --> 00:29:14,159
making sure all of this stuff now exists

821
00:29:11,440 --> 00:29:15,200
at a predefined z range which would move

822
00:29:14,159 --> 00:29:16,480
everything down and we'll probably have

823
00:29:15,200 --> 00:29:18,240
to change the world gen to move

824
00:29:16,480 --> 00:29:20,480
everything down a little bit uh is

825
00:29:18,240 --> 00:29:22,640
probably fine so the other thing i guess

826
00:29:20,480 --> 00:29:23,370
i want to do is at any given time here

827
00:29:22,640 --> 00:29:24,840
i'd like to

828
00:29:23,369 --> 00:29:27,759
[Music]

829
00:29:24,839 --> 00:29:30,079
render what is effectively like just

830
00:29:27,759 --> 00:29:31,278
where is the zero

831
00:29:30,079 --> 00:29:32,720
axis

832
00:29:31,278 --> 00:29:35,599
so like

833
00:29:32,720 --> 00:29:36,720
you know if i was going to to do a

834
00:29:35,599 --> 00:29:39,439
negative

835
00:29:36,720 --> 00:29:42,000
one to one cube like where would that

836
00:29:39,440 --> 00:29:43,600
cube sit um

837
00:29:42,000 --> 00:29:45,200
or maybe just a

838
00:29:43,599 --> 00:29:47,759
yeah i mean i think that's the right

839
00:29:45,200 --> 00:29:51,440
thing to do so let's suppose i did a

840
00:29:47,759 --> 00:29:53,519
negative uh one unit

841
00:29:51,440 --> 00:29:56,320
to a one

842
00:29:53,519 --> 00:29:58,000
let's suppose i throw in a yellow cube

843
00:29:56,319 --> 00:29:59,918
that looks like that

844
00:29:58,000 --> 00:30:01,759
uh and

845
00:29:59,919 --> 00:30:03,520
where is that right

846
00:30:01,759 --> 00:30:06,079
so this is just saying like where is the

847
00:30:03,519 --> 00:30:08,558
origin in our space so that we can see

848
00:30:06,079 --> 00:30:12,240
how we end up aligning these things

849
00:30:08,558 --> 00:30:15,278
um so what you can see there is that

850
00:30:12,240 --> 00:30:16,960
yeah we are floating a bit above

851
00:30:15,278 --> 00:30:17,759
uh

852
00:30:16,960 --> 00:30:19,759
and

853
00:30:17,759 --> 00:30:21,839
well you know not really i guess it's

854
00:30:19,759 --> 00:30:23,759
not that that much above it's hard to

855
00:30:21,839 --> 00:30:26,240
say a little bit above

856
00:30:23,759 --> 00:30:28,240
where the zero region is so if we were

857
00:30:26,240 --> 00:30:31,200
to pat uh if we were to sort of align

858
00:30:28,240 --> 00:30:32,960
these things directly to zero uh you can

859
00:30:31,200 --> 00:30:34,480
sort of see we would be right in the

860
00:30:32,960 --> 00:30:36,399
middle boundary of that which you know

861
00:30:34,480 --> 00:30:38,240
honestly is is not that far from where

862
00:30:36,398 --> 00:30:41,359
we are at the moment

863
00:30:38,240 --> 00:30:43,759
um but if we were to do that uh you can

864
00:30:41,359 --> 00:30:45,839
kind of see how we would need to make

865
00:30:43,759 --> 00:30:47,440
sure we span enough on either side to

866
00:30:45,839 --> 00:30:49,918
make sure that we're you know within

867
00:30:47,440 --> 00:30:52,640
reason there but you're not too bad

868
00:30:49,919 --> 00:30:53,679
right not too bad

869
00:30:52,640 --> 00:30:55,520
okay

870
00:30:53,679 --> 00:30:57,200
um so now that we have and you can also

871
00:30:55,519 --> 00:30:58,879
see as we move around you can see how

872
00:30:57,200 --> 00:31:00,880
the origin shifts remember we use a

873
00:30:58,880 --> 00:31:02,880
relative origin so that we never run out

874
00:31:00,880 --> 00:31:04,720
of float precision we're always centered

875
00:31:02,880 --> 00:31:06,640
around the origin roughly

876
00:31:04,720 --> 00:31:09,120
so as you hop around the game as you can

877
00:31:06,640 --> 00:31:12,399
kind of see the outside of the game

878
00:31:09,119 --> 00:31:15,918
shifts the origin in order to keep that

879
00:31:12,398 --> 00:31:19,199
space you know relative properly

880
00:31:15,919 --> 00:31:23,120
so my guess here

881
00:31:19,200 --> 00:31:25,919
uh is that yeah if we just kind of first

882
00:31:23,119 --> 00:31:27,518
lock the simulation center z and then

883
00:31:25,919 --> 00:31:29,440
lock the lighting center well the light

884
00:31:27,519 --> 00:31:30,399
center was sort of automatically locked

885
00:31:29,440 --> 00:31:31,679
to it

886
00:31:30,398 --> 00:31:34,079
um

887
00:31:31,679 --> 00:31:37,840
that should pretty much do it

888
00:31:34,079 --> 00:31:39,519
so in terms of simulation center

889
00:31:37,839 --> 00:31:43,199
to be completely honest with you i do

890
00:31:39,519 --> 00:31:45,919
not remember exactly how we set up those

891
00:31:43,200 --> 00:31:48,480
i think the simulation center just gets

892
00:31:45,919 --> 00:31:51,120
shifted around as the camera like we

893
00:31:48,480 --> 00:31:53,599
basically have a camera

894
00:31:51,119 --> 00:31:56,798
update routine that runs at the end

895
00:31:53,599 --> 00:31:59,759
that's like i don't know where we call

896
00:31:56,798 --> 00:32:01,759
it exactly but it happens

897
00:31:59,759 --> 00:32:04,798
somewhere in here update camera for

898
00:32:01,759 --> 00:32:06,798
entity movement um update camera for

899
00:32:04,798 --> 00:32:08,879
entity movement is really the place i

900
00:32:06,798 --> 00:32:10,798
think where we shift the simulation

901
00:32:08,880 --> 00:32:12,320
center around it all

902
00:32:10,798 --> 00:32:16,720
um so

903
00:32:12,319 --> 00:32:16,720
yeah like if you take a look at

904
00:32:18,480 --> 00:32:23,919
uh how this works you can see that the

905
00:32:20,798 --> 00:32:26,480
camera itself moves around uh with this

906
00:32:23,919 --> 00:32:29,840
map into chunk space for camera pdp and

907
00:32:26,480 --> 00:32:30,960
target p uh the simulation center part

908
00:32:29,839 --> 00:32:32,959
of things

909
00:32:30,960 --> 00:32:33,840
i don't know when we actually update

910
00:32:32,960 --> 00:32:35,278
that

911
00:32:33,839 --> 00:32:38,240
uh for it

912
00:32:35,278 --> 00:32:38,240
let's find out here

913
00:32:40,558 --> 00:32:46,639
right here so you can see

914
00:32:44,079 --> 00:32:48,158
uh this this code here where we see that

915
00:32:46,640 --> 00:32:50,080
we're inside a room

916
00:32:48,159 --> 00:32:51,919
you can see that the simulation center

917
00:32:50,079 --> 00:32:54,639
when we map into trunk space it's

918
00:32:51,919 --> 00:32:57,919
basically always pushing

919
00:32:54,640 --> 00:32:59,840
um this align to movement voxel version

920
00:32:57,919 --> 00:33:00,799
of the simulation center so it's always

921
00:32:59,839 --> 00:33:01,599
kind of

922
00:33:00,798 --> 00:33:04,079
uh

923
00:33:01,599 --> 00:33:06,639
taking this room volume minzy as a

924
00:33:04,079 --> 00:33:08,158
simulation center

925
00:33:06,640 --> 00:33:10,000
i i want to say

926
00:33:08,159 --> 00:33:12,240
that we could literally just zero that

927
00:33:10,000 --> 00:33:15,200
out so you know this is how we used to

928
00:33:12,240 --> 00:33:16,558
do it uh and now we can literally just

929
00:33:15,200 --> 00:33:19,919
say

930
00:33:16,558 --> 00:33:21,759
we're taking z out of the system

931
00:33:19,919 --> 00:33:23,600
and i think that would be it i think now

932
00:33:21,759 --> 00:33:26,158
no matter what we do we would never

933
00:33:23,599 --> 00:33:27,839
shift upwards or downwards right

934
00:33:26,159 --> 00:33:29,200
for simulation center for simulation

935
00:33:27,839 --> 00:33:32,798
center

936
00:33:29,200 --> 00:33:36,240
so taking a look at it now right

937
00:33:32,798 --> 00:33:40,079
again the simulation center itself

938
00:33:36,240 --> 00:33:42,240
is not being drawn so we may want to

939
00:33:40,079 --> 00:33:44,000
i mean it sort of is that zero box that

940
00:33:42,240 --> 00:33:46,000
we've got in there but the simulation

941
00:33:44,000 --> 00:33:47,679
region i guess i would say so if we

942
00:33:46,000 --> 00:33:49,839
wanted if we want to show this the

943
00:33:47,679 --> 00:33:52,640
simulation region i believe this right

944
00:33:49,839 --> 00:33:54,879
here uh is what does that although it

945
00:33:52,640 --> 00:33:57,120
looks like for some reason yeah it's it

946
00:33:54,880 --> 00:33:58,240
does the bounds on x y so i think this

947
00:33:57,119 --> 00:34:00,479
is

948
00:33:58,240 --> 00:34:02,720
um

949
00:34:00,480 --> 00:34:04,079
i think this is probably not exactly how

950
00:34:02,720 --> 00:34:05,200
you want to do it

951
00:34:04,079 --> 00:34:06,480
because

952
00:34:05,200 --> 00:34:07,679
we're sort of already assuming that it

953
00:34:06,480 --> 00:34:09,519
gets centered around zero which we kind

954
00:34:07,679 --> 00:34:11,119
of know the access system is so yeah i

955
00:34:09,519 --> 00:34:13,039
mean i guess i guess what i would say is

956
00:34:11,119 --> 00:34:14,559
that that is showing the simulation

957
00:34:13,039 --> 00:34:16,960
center right because everything is

958
00:34:14,559 --> 00:34:19,358
centered around the simulation center

959
00:34:16,960 --> 00:34:21,280
um so as we hop around now we should be

960
00:34:19,358 --> 00:34:22,319
always pegged to zero so there shouldn't

961
00:34:21,280 --> 00:34:25,599
ever be

962
00:34:22,320 --> 00:34:28,720
a a simulation center value uh where the

963
00:34:25,599 --> 00:34:30,559
z is anything other than zero

964
00:34:28,719 --> 00:34:32,799
which means that as we go like for

965
00:34:30,559 --> 00:34:34,559
example down into lower levels now it

966
00:34:32,800 --> 00:34:36,159
shouldn't shift and you see that it

967
00:34:34,559 --> 00:34:39,199
doesn't right it used to

968
00:34:36,159 --> 00:34:42,079
um so now we're we are going lower down

969
00:34:39,199 --> 00:34:43,439
um and the the actual simulation center

970
00:34:42,079 --> 00:34:45,200
uh should not

971
00:34:43,440 --> 00:34:47,119
um you know we won't even really be able

972
00:34:45,199 --> 00:34:49,279
to see where we're going but uh should

973
00:34:47,119 --> 00:34:50,639
not ever shift downward to follow us and

974
00:34:49,280 --> 00:34:52,639
you can see it doesn't we're down in

975
00:34:50,639 --> 00:34:54,559
this second level now

976
00:34:52,639 --> 00:34:57,680
and you can see that although the camera

977
00:34:54,559 --> 00:35:00,480
rectangle clearly is shifting downward

978
00:34:57,679 --> 00:35:03,039
right um the simulation center isn't

979
00:35:00,480 --> 00:35:05,838
right

980
00:35:03,039 --> 00:35:09,519
so i think that's step one um

981
00:35:05,838 --> 00:35:11,119
step two is that we don't actually want

982
00:35:09,519 --> 00:35:15,519
the camera

983
00:35:11,119 --> 00:35:17,760
so when we do the camera uh rectangle

984
00:35:15,519 --> 00:35:20,320
that we pass into the lighting we don't

985
00:35:17,760 --> 00:35:22,480
ever want that camera rectangle to have

986
00:35:20,320 --> 00:35:24,320
that offset either so i think what we

987
00:35:22,480 --> 00:35:26,159
probably want to do here is again head

988
00:35:24,320 --> 00:35:28,720
that off at the pass

989
00:35:26,159 --> 00:35:31,920
so that when we do our lighting values

990
00:35:28,719 --> 00:35:33,838
and we are computing those two uh

991
00:35:31,920 --> 00:35:35,760
offsets one of them we know is always

992
00:35:33,838 --> 00:35:39,279
back to zero the other one we should

993
00:35:35,760 --> 00:35:42,240
also make sure we constantly peg to zero

994
00:35:39,280 --> 00:35:45,040
and so if we look here at the simulation

995
00:35:42,239 --> 00:35:46,399
bounds

996
00:35:45,039 --> 00:35:48,239
we know that these should always be

997
00:35:46,400 --> 00:35:51,440
pegged to zero properly when we get down

998
00:35:48,239 --> 00:35:52,719
to here this part this get center world

999
00:35:51,440 --> 00:35:55,519
camera rect

1000
00:35:52,719 --> 00:35:57,598
that may produce an offset in z and so

1001
00:35:55,519 --> 00:36:00,079
at least for the time being

1002
00:35:57,599 --> 00:36:02,400
i'm going to go ahead and just peg that

1003
00:36:00,079 --> 00:36:03,519
so that the the chunk z is going to be

1004
00:36:02,400 --> 00:36:07,200
zero

1005
00:36:03,519 --> 00:36:09,679
and the offset z is going to be zero

1006
00:36:07,199 --> 00:36:12,319
uh just to make sure that now the

1007
00:36:09,679 --> 00:36:14,399
lighting rectangle is also properly

1008
00:36:12,320 --> 00:36:16,079
always floored to

1009
00:36:14,400 --> 00:36:18,240
zero

1010
00:36:16,079 --> 00:36:21,599
which will give us something that should

1011
00:36:18,239 --> 00:36:23,679
always float right sort of on

1012
00:36:21,599 --> 00:36:25,760
um

1013
00:36:23,679 --> 00:36:30,799
that that boundary now one of the things

1014
00:36:25,760 --> 00:36:30,800
that you can see here is that the the

1015
00:36:31,039 --> 00:36:35,759
the way these two things span is going

1016
00:36:34,000 --> 00:36:37,760
to have to be adjusted slightly and

1017
00:36:35,760 --> 00:36:40,480
again that may mean

1018
00:36:37,760 --> 00:36:41,680
adjusting this stuff or it may mean

1019
00:36:40,480 --> 00:36:43,760
something else

1020
00:36:41,679 --> 00:36:44,960
right we we have some flexibility in how

1021
00:36:43,760 --> 00:36:46,960
we do this

1022
00:36:44,960 --> 00:36:49,039
but if you look at what's happening now

1023
00:36:46,960 --> 00:36:51,838
you can see that the

1024
00:36:49,039 --> 00:36:53,920
uh the lighting rectangle is properly

1025
00:36:51,838 --> 00:36:56,960
sort of floating

1026
00:36:53,920 --> 00:36:58,880
at the z equals zero area and it can't

1027
00:36:56,960 --> 00:37:00,880
actually or shouldn't be able to move up

1028
00:36:58,880 --> 00:37:03,838
and down right

1029
00:37:00,880 --> 00:37:03,838
so you know

1030
00:37:05,440 --> 00:37:09,519
it can move sort of in other directions

1031
00:37:07,760 --> 00:37:10,640
you can see there's a bit of a of wiggle

1032
00:37:09,519 --> 00:37:13,119
there which i'm not sure exactly what

1033
00:37:10,639 --> 00:37:13,118
that's from

1034
00:37:13,760 --> 00:37:17,520
the hopping comp you know the hopping

1035
00:37:16,159 --> 00:37:19,440
introduces a little bit of bounce there

1036
00:37:17,519 --> 00:37:21,119
but it doesn't it doesn't appear to be z

1037
00:37:19,440 --> 00:37:24,480
bounce i don't know maybe it is b bounce

1038
00:37:21,119 --> 00:37:24,480
let's make sure it shouldn't be

1039
00:37:25,679 --> 00:37:29,598
it's kind of hard to say

1040
00:37:27,760 --> 00:37:31,680
right

1041
00:37:29,599 --> 00:37:33,440
but at least in theory hopefully we

1042
00:37:31,679 --> 00:37:34,239
aren't getting any z bounce now because

1043
00:37:33,440 --> 00:37:36,320
that

1044
00:37:34,239 --> 00:37:37,838
the offset in z should be zeroed it

1045
00:37:36,320 --> 00:37:38,800
shouldn't really be

1046
00:37:37,838 --> 00:37:41,838
um

1047
00:37:38,800 --> 00:37:44,640
possible to get something that's not

1048
00:37:41,838 --> 00:37:46,320
z zeroed out out there right

1049
00:37:44,639 --> 00:37:47,920
um but that's the only thing that isn't

1050
00:37:46,320 --> 00:37:50,320
derived off the simulation center it's

1051
00:37:47,920 --> 00:37:51,920
because of the world camera part that we

1052
00:37:50,320 --> 00:37:53,760
could get a z offset there so this just

1053
00:37:51,920 --> 00:37:55,358
prevents that from happening and then of

1054
00:37:53,760 --> 00:37:56,800
course this part should always be peg to

1055
00:37:55,358 --> 00:37:59,039
zero now because we don't allow the

1056
00:37:56,800 --> 00:38:00,960
simulation center uh to everybody ever

1057
00:37:59,039 --> 00:38:02,960
be anything else either so what we can

1058
00:38:00,960 --> 00:38:04,720
do here is we can put in some asserts

1059
00:38:02,960 --> 00:38:06,800
like for example i can assert the

1060
00:38:04,719 --> 00:38:08,480
lighting sim center here

1061
00:38:06,800 --> 00:38:11,039
that it's chunk z is always zero and i

1062
00:38:08,480 --> 00:38:12,400
can put in another assert here uh that

1063
00:38:11,039 --> 00:38:16,159
the offset

1064
00:38:12,400 --> 00:38:16,160
z is always zero um

1065
00:38:16,239 --> 00:38:20,078
uh just to make sure that we're actually

1066
00:38:18,239 --> 00:38:22,319
getting that like that we're not uh

1067
00:38:20,079 --> 00:38:24,480
somehow introducing some wobble uh in

1068
00:38:22,320 --> 00:38:26,160
fact i could do that in a more opportune

1069
00:38:24,480 --> 00:38:28,320
place as well what i could do is

1070
00:38:26,159 --> 00:38:30,719
actually go to the update lighting call

1071
00:38:28,320 --> 00:38:33,200
so when it gets passed in here in fact

1072
00:38:30,719 --> 00:38:36,799
we could assert that we're never getting

1073
00:38:33,199 --> 00:38:40,480
anything else uh from our sim origin

1074
00:38:36,800 --> 00:38:42,400
um or our lighting origin right so

1075
00:38:40,480 --> 00:38:46,079
neither of those two things

1076
00:38:42,400 --> 00:38:48,079
uh anymore is allowed to have a z offset

1077
00:38:46,079 --> 00:38:50,960
so you know it's just

1078
00:38:48,079 --> 00:38:50,960
not going to happen

1079
00:38:53,519 --> 00:38:57,838
um so now if we run that

1080
00:38:55,838 --> 00:39:00,239
we should be able to get like a hard

1081
00:38:57,838 --> 00:39:02,639
crash like it would would assert and

1082
00:39:00,239 --> 00:39:04,879
stop if any time anything was non-zero

1083
00:39:02,639 --> 00:39:07,279
so it looks like it's not right

1084
00:39:04,880 --> 00:39:09,200
so uh we may have to do some other

1085
00:39:07,280 --> 00:39:12,079
tweaking to it but but now we're at

1086
00:39:09,199 --> 00:39:13,519
least fairly uh you know assured that

1087
00:39:12,079 --> 00:39:15,280
we're not getting

1088
00:39:13,519 --> 00:39:17,039
any kind of

1089
00:39:15,280 --> 00:39:18,720
you know

1090
00:39:17,039 --> 00:39:22,320
basically any kind of

1091
00:39:18,719 --> 00:39:22,319
errant motion in z

1092
00:39:25,039 --> 00:39:29,759
all right

1093
00:39:27,358 --> 00:39:34,078
so we now have to decide how we want to

1094
00:39:29,760 --> 00:39:37,040
actually structure this i would say that

1095
00:39:34,079 --> 00:39:38,160
uh you know i don't have a particularly

1096
00:39:37,039 --> 00:39:40,559
strong

1097
00:39:38,159 --> 00:39:43,920
opinion about

1098
00:39:40,559 --> 00:39:45,759
where i want the

1099
00:39:43,920 --> 00:39:47,440
origin of the world to be

1100
00:39:45,760 --> 00:39:49,680
you know like what should be the lowest

1101
00:39:47,440 --> 00:39:51,679
z value that we contemplate uh being

1102
00:39:49,679 --> 00:39:52,480
able to see

1103
00:39:51,679 --> 00:39:55,440
so

1104
00:39:52,480 --> 00:39:57,199
my feeling is that we just make that be

1105
00:39:55,440 --> 00:40:00,159
zero

1106
00:39:57,199 --> 00:40:02,960
so in other words anything

1107
00:40:00,159 --> 00:40:03,838
that's below zero will not be tracked

1108
00:40:02,960 --> 00:40:04,280
right

1109
00:40:03,838 --> 00:40:05,440
so

1110
00:40:04,280 --> 00:40:07,359
[Music]

1111
00:40:05,440 --> 00:40:09,519
we just assume that maybe the world is

1112
00:40:07,358 --> 00:40:12,400
built a little bit higher than zero and

1113
00:40:09,519 --> 00:40:14,639
if there was a pit or something that pit

1114
00:40:12,400 --> 00:40:15,680
it it's just like a blackness at zero or

1115
00:40:14,639 --> 00:40:18,078
something

1116
00:40:15,679 --> 00:40:20,480
um and so things don't really get

1117
00:40:18,079 --> 00:40:22,079
lighting when they fall if they were to

1118
00:40:20,480 --> 00:40:24,000
go past zero

1119
00:40:22,079 --> 00:40:25,760
you just get the lighting from whatever

1120
00:40:24,000 --> 00:40:27,280
was at zero you don't you don't keep

1121
00:40:25,760 --> 00:40:29,920
getting lighting going down or things

1122
00:40:27,280 --> 00:40:33,760
like that right

1123
00:40:29,920 --> 00:40:35,838
so uh again that's less realistic but

1124
00:40:33,760 --> 00:40:37,200
we're sort of saying like we're taking z

1125
00:40:35,838 --> 00:40:39,358
out because it just doesn't give us

1126
00:40:37,199 --> 00:40:42,159
enough bang for the buck there so let's

1127
00:40:39,358 --> 00:40:44,559
go ahead and uh actually sort of make

1128
00:40:42,159 --> 00:40:47,118
that assumption so what that means is

1129
00:40:44,559 --> 00:40:48,719
that this the lighting voxel is kind of

1130
00:40:47,119 --> 00:40:51,358
aligned oddly

1131
00:40:48,719 --> 00:40:52,879
it appears that when you pass in

1132
00:40:51,358 --> 00:40:55,358
the uh

1133
00:40:52,880 --> 00:40:57,760
z at zero it's it's treating that more

1134
00:40:55,358 --> 00:40:59,358
as like a center point rather than a

1135
00:40:57,760 --> 00:41:01,760
minimum right

1136
00:40:59,358 --> 00:41:04,318
um and that makes some sense for the

1137
00:41:01,760 --> 00:41:08,480
other components but it doesn't make a

1138
00:41:04,318 --> 00:41:10,318
whole lot of sense for z right

1139
00:41:08,480 --> 00:41:12,400
um and so when we look at what happens

1140
00:41:10,318 --> 00:41:14,079
here we can sort of simplify a bunch of

1141
00:41:12,400 --> 00:41:15,920
these things because now we don't have

1142
00:41:14,079 --> 00:41:18,480
to have so you know for example we had

1143
00:41:15,920 --> 00:41:20,400
when we did block copy atlas

1144
00:41:18,480 --> 00:41:22,800
you can see in here we've got a whole

1145
00:41:20,400 --> 00:41:25,838
bunch of stuff to handle like z

1146
00:41:22,800 --> 00:41:26,640
which now we would no longer have to do

1147
00:41:25,838 --> 00:41:29,599
right

1148
00:41:26,639 --> 00:41:32,559
um so this sort of stuff would would

1149
00:41:29,599 --> 00:41:34,160
simplify certainly uh because it removes

1150
00:41:32,559 --> 00:41:36,318
one entire set of the loops here we

1151
00:41:34,159 --> 00:41:37,519
could we could simply simplify a lot of

1152
00:41:36,318 --> 00:41:38,880
this code

1153
00:41:37,519 --> 00:41:40,159
now i'm not going to bother with that

1154
00:41:38,880 --> 00:41:42,640
because we could only be introducing

1155
00:41:40,159 --> 00:41:44,239
bugs at this point

1156
00:41:42,639 --> 00:41:45,679
because we know that stuff works for the

1157
00:41:44,239 --> 00:41:47,519
full case so we don't really need to get

1158
00:41:45,679 --> 00:41:50,078
rid of it but what i would like to do

1159
00:41:47,519 --> 00:41:53,039
first is say well okay let's figure out

1160
00:41:50,079 --> 00:41:54,800
why this is how this is aligned in z and

1161
00:41:53,039 --> 00:41:56,559
kind of change it a little bit so that

1162
00:41:54,800 --> 00:41:58,079
it's always aligning ourselves to zero

1163
00:41:56,559 --> 00:41:59,679
and up because it just gives us

1164
00:41:58,079 --> 00:42:01,359
something we can

1165
00:41:59,679 --> 00:42:04,318
be more uh

1166
00:42:01,358 --> 00:42:06,078
we can be more afraid of it now you know

1167
00:42:04,318 --> 00:42:07,279
saying that maybe that's wrong because

1168
00:42:06,079 --> 00:42:08,720
since we're

1169
00:42:07,280 --> 00:42:10,720
since we're providing a center for all

1170
00:42:08,719 --> 00:42:12,239
the other axes maybe we want to provide

1171
00:42:10,719 --> 00:42:13,759
a center for that too you know i don't

1172
00:42:12,239 --> 00:42:15,598
know it's hard to

1173
00:42:13,760 --> 00:42:17,200
make that call so we could actually also

1174
00:42:15,599 --> 00:42:19,359
say the opposite right which is that we

1175
00:42:17,199 --> 00:42:21,838
we are passing in zero as the center and

1176
00:42:19,358 --> 00:42:23,519
we kind of go up and down from there um

1177
00:42:21,838 --> 00:42:25,199
that's also a plausible thing we could

1178
00:42:23,519 --> 00:42:26,400
say so maybe you know that makes more

1179
00:42:25,199 --> 00:42:30,118
sense let's take a look at this code

1180
00:42:26,400 --> 00:42:30,119
first before we decide

1181
00:42:30,239 --> 00:42:34,399
so

1182
00:42:31,599 --> 00:42:36,160
you know here's the alignment

1183
00:42:34,400 --> 00:42:38,720
code

1184
00:42:36,159 --> 00:42:41,519
it first says look let's find out

1185
00:42:38,719 --> 00:42:43,759
um if we were to take the origin p which

1186
00:42:41,519 --> 00:42:45,838
is where we want to compute the lighting

1187
00:42:43,760 --> 00:42:48,720
let's find where that offset is right

1188
00:42:45,838 --> 00:42:50,960
you can see it computing the offset here

1189
00:42:48,719 --> 00:42:54,159
um and then it says well

1190
00:42:50,960 --> 00:42:58,159
where was the last where was the last

1191
00:42:54,159 --> 00:43:00,559
place we did this right

1192
00:42:58,159 --> 00:43:02,159
so it just tracks the center

1193
00:43:00,559 --> 00:43:04,880
that's all it's doing here

1194
00:43:02,159 --> 00:43:06,639
um and then moves the voxel based on the

1195
00:43:04,880 --> 00:43:08,960
movement of the center makes perfect

1196
00:43:06,639 --> 00:43:11,118
sense no worries right

1197
00:43:08,960 --> 00:43:12,960
that would be the same no matter what we

1198
00:43:11,119 --> 00:43:15,358
did because that's just tracking

1199
00:43:12,960 --> 00:43:16,960
relative movement so the point whether

1200
00:43:15,358 --> 00:43:18,639
we pick the center or the corner or

1201
00:43:16,960 --> 00:43:20,000
anything else doesn't matter as long as

1202
00:43:18,639 --> 00:43:21,838
it's the same point each time that code

1203
00:43:20,000 --> 00:43:25,199
will work because it's just sliding the

1204
00:43:21,838 --> 00:43:26,400
voxel to match the world space

1205
00:43:25,199 --> 00:43:28,639
so

1206
00:43:26,400 --> 00:43:30,400
really this is the code here

1207
00:43:28,639 --> 00:43:32,960
that we're talking about

1208
00:43:30,400 --> 00:43:35,119
um and what you can see is this is the

1209
00:43:32,960 --> 00:43:38,559
part where we compute those corners

1210
00:43:35,119 --> 00:43:40,880
you can see us doing a minus 0.5 of the

1211
00:43:38,559 --> 00:43:42,880
hot dimension so you can see us doing

1212
00:43:40,880 --> 00:43:45,200
that computation is as is coming out

1213
00:43:42,880 --> 00:43:46,960
from the center

1214
00:43:45,199 --> 00:43:47,838
so i guess what i would say about that

1215
00:43:46,960 --> 00:43:51,440
is

1216
00:43:47,838 --> 00:43:52,880
probably we just want to keep that um

1217
00:43:51,440 --> 00:43:55,200
like because it's just a simpler

1218
00:43:52,880 --> 00:43:57,680
computation so we probably do want to

1219
00:43:55,199 --> 00:44:01,039
say zero is like the center point

1220
00:43:57,679 --> 00:44:04,078
um and so the world expands a little bit

1221
00:44:01,039 --> 00:44:06,559
up and a little bit down from zero

1222
00:44:04,079 --> 00:44:09,119
uh and we just kind of change a little

1223
00:44:06,559 --> 00:44:11,599
bit like when we're looking at something

1224
00:44:09,119 --> 00:44:13,838
like the room gen code uh right now

1225
00:44:11,599 --> 00:44:16,000
things are sort of skewed upward and

1226
00:44:13,838 --> 00:44:18,880
maybe we just don't do that anymore

1227
00:44:16,000 --> 00:44:20,719
right uh so when we're talking about

1228
00:44:18,880 --> 00:44:23,838
figuring out where these walls actually

1229
00:44:20,719 --> 00:44:26,159
occur uh we instead of what we're doing

1230
00:44:23,838 --> 00:44:29,679
right now we sort of shift them uh in

1231
00:44:26,159 --> 00:44:33,199
another way so like for example when we

1232
00:44:29,679 --> 00:44:36,480
take a look at how the uh the p-value is

1233
00:44:33,199 --> 00:44:38,480
getting set up here the uh you can kind

1234
00:44:36,480 --> 00:44:40,639
of look in and see how this this is some

1235
00:44:38,480 --> 00:44:42,400
pretty crappy code but you can see get

1236
00:44:40,639 --> 00:44:45,679
minzy center p

1237
00:44:42,400 --> 00:44:48,318
right uh it's asking for a tile

1238
00:44:45,679 --> 00:44:50,559
where is the uh the center point at the

1239
00:44:48,318 --> 00:44:51,759
minimum z value it's going to come back

1240
00:44:50,559 --> 00:44:54,159
uh with this

1241
00:44:51,760 --> 00:44:55,920
we can sort of say well all right how

1242
00:44:54,159 --> 00:44:57,199
were we defining these tiles and maybe

1243
00:44:55,920 --> 00:44:59,680
what we need to do is say that these

1244
00:44:57,199 --> 00:45:01,358
tiles are defined uh as being a little

1245
00:44:59,679 --> 00:45:03,519
bit downward or something from where

1246
00:45:01,358 --> 00:45:05,358
they were uh so that things are aligned

1247
00:45:03,519 --> 00:45:07,440
a little bit differently

1248
00:45:05,358 --> 00:45:09,598
if we take a look again get minzy center

1249
00:45:07,440 --> 00:45:12,159
p you can see here where we point the

1250
00:45:09,599 --> 00:45:14,640
tile uh and we want to get the total

1251
00:45:12,159 --> 00:45:17,679
volume of of this tile right here is our

1252
00:45:14,639 --> 00:45:18,559
definition for what a tile uh consists

1253
00:45:17,679 --> 00:45:19,519
of

1254
00:45:18,559 --> 00:45:22,159
it's

1255
00:45:19,519 --> 00:45:25,679
like wherever the relative index of this

1256
00:45:22,159 --> 00:45:28,078
tile is is the minimum p-value uh times

1257
00:45:25,679 --> 00:45:29,598
the tile dim

1258
00:45:28,079 --> 00:45:32,640
and so

1259
00:45:29,599 --> 00:45:34,400
the relative index z right like if it

1260
00:45:32,639 --> 00:45:35,199
was zero

1261
00:45:34,400 --> 00:45:38,480
um

1262
00:45:35,199 --> 00:45:40,000
would end up being at zero for this

1263
00:45:38,480 --> 00:45:42,719
particular thing

1264
00:45:40,000 --> 00:45:44,800
and you know really we probably want

1265
00:45:42,719 --> 00:45:47,039
that to be offset a little bit right so

1266
00:45:44,800 --> 00:45:49,760
the total volume total tile volume here

1267
00:45:47,039 --> 00:45:53,358
like this probably wants to be offset

1268
00:45:49,760 --> 00:45:54,880
by some value if this is the minimum p

1269
00:45:53,358 --> 00:45:55,838
uh for

1270
00:45:54,880 --> 00:45:57,680
you know

1271
00:45:55,838 --> 00:45:59,358
for this tile

1272
00:45:57,679 --> 00:46:01,838
uh and another way we could look at this

1273
00:45:59,358 --> 00:46:03,279
is these values if we're going to take z

1274
00:46:01,838 --> 00:46:05,759
out of the equation

1275
00:46:03,280 --> 00:46:07,920
maybe these values are always cold set

1276
00:46:05,760 --> 00:46:10,319
right like maybe it's always negative

1277
00:46:07,920 --> 00:46:12,480
one you know to one or something like

1278
00:46:10,318 --> 00:46:15,440
that

1279
00:46:12,480 --> 00:46:19,358
i'm not sure uh if we look at the floor

1280
00:46:15,440 --> 00:46:19,358
height we have a um

1281
00:46:19,838 --> 00:46:23,440
i'm not sure where this v

1282
00:46:21,679 --> 00:46:25,279
value uh

1283
00:46:23,440 --> 00:46:29,200
actually gets computed but we have this

1284
00:46:25,280 --> 00:46:32,000
concept of the typical floor height here

1285
00:46:29,199 --> 00:46:33,118
um and the typical floor height

1286
00:46:32,000 --> 00:46:34,800
is

1287
00:46:33,119 --> 00:46:36,079
just a thing we picked

1288
00:46:34,800 --> 00:46:38,160
based on like okay how many meters

1289
00:46:36,079 --> 00:46:40,480
should this be

1290
00:46:38,159 --> 00:46:42,318
you can see that it's it's three

1291
00:46:40,480 --> 00:46:44,400
of whatever the fundamental unit is

1292
00:46:42,318 --> 00:46:45,759
right like that's how big uh this thing

1293
00:46:44,400 --> 00:46:48,559
was

1294
00:46:45,760 --> 00:46:52,000
so what we presumably want to do here is

1295
00:46:48,559 --> 00:46:53,920
have that value uh be reflected in that

1296
00:46:52,000 --> 00:46:56,480
like it should be basically

1297
00:46:53,920 --> 00:46:58,880
negative half of that and negative

1298
00:46:56,480 --> 00:47:02,800
and positive of that right

1299
00:46:58,880 --> 00:47:04,720
so the tile dim value here

1300
00:47:02,800 --> 00:47:07,680
we really want the z to sort of be

1301
00:47:04,719 --> 00:47:08,959
centered around that in a way right

1302
00:47:07,679 --> 00:47:11,279
so

1303
00:47:08,960 --> 00:47:14,800
you know maybe the right way to look at

1304
00:47:11,280 --> 00:47:17,519
this is to say well it's

1305
00:47:14,800 --> 00:47:19,920
minus half so it's if it was centered

1306
00:47:17,519 --> 00:47:23,400
around this dim it would be something

1307
00:47:19,920 --> 00:47:23,400
more like this

1308
00:47:30,639 --> 00:47:33,199
right

1309
00:47:31,760 --> 00:47:35,680
um

1310
00:47:33,199 --> 00:47:37,519
i also don't really know why this is

1311
00:47:35,679 --> 00:47:39,039
being computed this way that's a very

1312
00:47:37,519 --> 00:47:40,000
strange

1313
00:47:39,039 --> 00:47:42,079
uh

1314
00:47:40,000 --> 00:47:44,400
way to compute this you know

1315
00:47:42,079 --> 00:47:49,000
this is just kind of weird code like

1316
00:47:44,400 --> 00:47:49,000
normally wouldn't you just do this

1317
00:47:54,079 --> 00:47:58,318
i mean

1318
00:47:55,358 --> 00:48:00,799
right the max p is always one tile dim

1319
00:47:58,318 --> 00:48:02,400
away from the min piece so why you would

1320
00:48:00,800 --> 00:48:03,519
multiply them both for no reason i have

1321
00:48:02,400 --> 00:48:06,160
no idea

1322
00:48:03,519 --> 00:48:08,000
um so you know it would just i would

1323
00:48:06,159 --> 00:48:10,480
assume that this is how you would

1324
00:48:08,000 --> 00:48:12,400
normally do it uh so

1325
00:48:10,480 --> 00:48:15,050
yeah i don't i don't really know uh what

1326
00:48:12,400 --> 00:48:16,559
was up with that but you know

1327
00:48:15,050 --> 00:48:18,839
[Music]

1328
00:48:16,559 --> 00:48:22,480
you got me

1329
00:48:18,838 --> 00:48:25,440
um so anyway uh looking at at how that's

1330
00:48:22,480 --> 00:48:27,599
aligned now you can see that

1331
00:48:25,440 --> 00:48:30,480
excuse me

1332
00:48:27,599 --> 00:48:32,240
um you can see that we now have first

1333
00:48:30,480 --> 00:48:34,960
that's a bit weird i'm not sure why the

1334
00:48:32,239 --> 00:48:36,479
lighting looks like it's down there

1335
00:48:34,960 --> 00:48:37,838
i'm going to have to we're going to have

1336
00:48:36,480 --> 00:48:39,358
to take a look at that a little more

1337
00:48:37,838 --> 00:48:41,358
carefully

1338
00:48:39,358 --> 00:48:43,679
but you can see now that

1339
00:48:41,358 --> 00:48:46,000
everything is sort of aligned a little

1340
00:48:43,679 --> 00:48:48,799
more sensibly

1341
00:48:46,000 --> 00:48:52,800
where we're going positive and negative

1342
00:48:48,800 --> 00:48:52,800
of the uh you know

1343
00:48:53,599 --> 00:48:59,119
if this right here is the origin so z

1344
00:48:56,800 --> 00:49:00,880
equals zero is right in the middle of

1345
00:48:59,119 --> 00:49:02,960
that right is the way to think about

1346
00:49:00,880 --> 00:49:05,200
that

1347
00:49:02,960 --> 00:49:07,280
uh then you can kind of see how now the

1348
00:49:05,199 --> 00:49:09,519
world is sort of built a little more

1349
00:49:07,280 --> 00:49:11,680
sanely around

1350
00:49:09,519 --> 00:49:14,318
around that value right

1351
00:49:11,679 --> 00:49:16,480
now it's not quite what i would like

1352
00:49:14,318 --> 00:49:18,960
because probably the floor should maybe

1353
00:49:16,480 --> 00:49:19,760
be more around negative one would be my

1354
00:49:18,960 --> 00:49:21,838
guess

1355
00:49:19,760 --> 00:49:23,599
um so we're you know we're not quite as

1356
00:49:21,838 --> 00:49:25,279
aligned as i would like but we're more

1357
00:49:23,599 --> 00:49:28,400
aligned and also coincidentally the

1358
00:49:25,280 --> 00:49:31,119
lighting now works um

1359
00:49:28,400 --> 00:49:32,639
uh around the the only problem we're

1360
00:49:31,119 --> 00:49:34,640
getting is for some reason we have a

1361
00:49:32,639 --> 00:49:38,000
weird like the camera

1362
00:49:34,639 --> 00:49:39,838
is not actually aligned to like where

1363
00:49:38,000 --> 00:49:41,519
the camera is looking

1364
00:49:39,838 --> 00:49:43,519
does not actually seem to be aligned to

1365
00:49:41,519 --> 00:49:45,440
where the world was constructed and lit

1366
00:49:43,519 --> 00:49:47,039
so we've got some kind of a bug with the

1367
00:49:45,440 --> 00:49:48,639
camera thing there but that's all right

1368
00:49:47,039 --> 00:49:50,639
well we're getting there

1369
00:49:48,639 --> 00:49:52,879
we're modifying one thing at a time

1370
00:49:50,639 --> 00:49:52,879
right

1371
00:49:52,960 --> 00:49:57,519
so it seems straightforward relatively

1372
00:49:55,599 --> 00:49:59,039
straightforward right to take z out of

1373
00:49:57,519 --> 00:50:01,039
the equation there

1374
00:49:59,039 --> 00:50:02,318
um and

1375
00:50:01,039 --> 00:50:05,199
you know

1376
00:50:02,318 --> 00:50:08,079
it's not immediately clear exactly how

1377
00:50:05,199 --> 00:50:10,159
uh we want this code to function

1378
00:50:08,079 --> 00:50:12,480
but this seems

1379
00:50:10,159 --> 00:50:14,318
reasonable right uh that seems

1380
00:50:12,480 --> 00:50:16,000
reasonable and we can look into this a

1381
00:50:14,318 --> 00:50:18,880
little bit further

1382
00:50:16,000 --> 00:50:21,119
um so we could start to say like all

1383
00:50:18,880 --> 00:50:22,800
right this relative z index gets taken

1384
00:50:21,119 --> 00:50:24,559
out of the equation as well so like we

1385
00:50:22,800 --> 00:50:27,200
know for example that this is not going

1386
00:50:24,559 --> 00:50:30,240
to be a thing like there's no rel index

1387
00:50:27,199 --> 00:50:32,000
uh so on the tile right

1388
00:50:30,239 --> 00:50:34,399
when we look at the relative index of

1389
00:50:32,000 --> 00:50:38,079
this thing

1390
00:50:34,400 --> 00:50:39,440
um what actually tile rail index where

1391
00:50:38,079 --> 00:50:41,039
is that

1392
00:50:39,440 --> 00:50:43,760
that's in

1393
00:50:41,039 --> 00:50:46,000
ed yeah this guy right here right

1394
00:50:43,760 --> 00:50:47,920
um so the relative index here that we're

1395
00:50:46,000 --> 00:50:50,318
using we know that that will always get

1396
00:50:47,920 --> 00:50:52,159
pegged as well and that we don't really

1397
00:50:50,318 --> 00:50:55,039
want to iterate over any of those values

1398
00:50:52,159 --> 00:50:56,879
it's just going to be real index x and y

1399
00:50:55,039 --> 00:50:59,759
and again we'll slowly peel that off

1400
00:50:56,880 --> 00:51:03,119
like we'll probably change um

1401
00:50:59,760 --> 00:51:06,079
the gen v3 here we'll change that

1402
00:51:03,119 --> 00:51:08,240
from a gen v3 to a gen v2 at some point

1403
00:51:06,079 --> 00:51:09,440
and just remove that third component

1404
00:51:08,239 --> 00:51:12,239
entirely

1405
00:51:09,440 --> 00:51:14,880
because it's not going to be involved

1406
00:51:12,239 --> 00:51:16,558
so um yeah okay

1407
00:51:14,880 --> 00:51:18,000
so let's take a quick look because

1408
00:51:16,559 --> 00:51:19,519
before i go any further i'd like to

1409
00:51:18,000 --> 00:51:20,318
figure out why

1410
00:51:19,519 --> 00:51:23,519
the

1411
00:51:20,318 --> 00:51:26,079
uh remember the things we're looking at

1412
00:51:23,519 --> 00:51:28,880
here is this is the lighting bounds and

1413
00:51:26,079 --> 00:51:31,119
this is the camera uh like what the

1414
00:51:28,880 --> 00:51:32,400
camera says it's looking at

1415
00:51:31,119 --> 00:51:34,480
and i'm not

1416
00:51:32,400 --> 00:51:37,519
quite sure i understand why these two

1417
00:51:34,480 --> 00:51:39,280
would be uh offset in the way that they

1418
00:51:37,519 --> 00:51:42,400
appear to be because

1419
00:51:39,280 --> 00:51:43,440
if we look at the camera

1420
00:51:42,400 --> 00:51:46,240
i mean

1421
00:51:43,440 --> 00:51:48,318
maybe this is just a case of the camera

1422
00:51:46,239 --> 00:51:49,838
offset is computed like we didn't really

1423
00:51:48,318 --> 00:51:51,599
look at how that was being done so maybe

1424
00:51:49,838 --> 00:51:53,679
it's just case of forgetting the

1425
00:51:51,599 --> 00:51:55,440
specifics of that

1426
00:51:53,679 --> 00:51:57,679
but if you take a look at how this works

1427
00:51:55,440 --> 00:51:58,720
uh you can see the simulation center

1428
00:51:57,679 --> 00:52:00,799
here

1429
00:51:58,719 --> 00:52:03,039
um we're using directly we know that

1430
00:52:00,800 --> 00:52:06,079
that's a line we're looking at that

1431
00:52:03,039 --> 00:52:06,079
that yellow cube

1432
00:52:10,480 --> 00:52:12,639
um

1433
00:52:11,519 --> 00:52:15,679
and

1434
00:52:12,639 --> 00:52:17,279
so we we know that everything's uh

1435
00:52:15,679 --> 00:52:19,919
presumably working properly here except

1436
00:52:17,280 --> 00:52:22,800
for this world camera rect

1437
00:52:19,920 --> 00:52:23,599
the world camera rect is just doing the

1438
00:52:22,800 --> 00:52:25,280
the

1439
00:52:23,599 --> 00:52:27,440
get camera rectangle at target here with

1440
00:52:25,280 --> 00:52:31,760
the focus z and this

1441
00:52:27,440 --> 00:52:33,599
uh here this focus equals 0.5 times

1442
00:52:31,760 --> 00:52:37,440
world mode camera expected focus uh

1443
00:52:33,599 --> 00:52:38,240
minzy uh expected uh focus max z so

1444
00:52:37,440 --> 00:52:39,358
this

1445
00:52:38,239 --> 00:52:40,479
here

1446
00:52:39,358 --> 00:52:42,960
is

1447
00:52:40,480 --> 00:52:45,760
presumably like erroneous the way that

1448
00:52:42,960 --> 00:52:47,599
we're thinking about this is not correct

1449
00:52:45,760 --> 00:52:48,880
right

1450
00:52:47,599 --> 00:52:51,200
so what this function is doing is it's

1451
00:52:48,880 --> 00:52:53,519
saying at this distance from the camera

1452
00:52:51,199 --> 00:52:55,358
please compute what we would see

1453
00:52:53,519 --> 00:52:57,280
and you know

1454
00:52:55,358 --> 00:52:59,119
i can understand

1455
00:52:57,280 --> 00:53:01,040
why we were doing that because we

1456
00:52:59,119 --> 00:53:03,440
imagined we were going to have complete

1457
00:53:01,039 --> 00:53:05,199
uh freedom of how far z would be and so

1458
00:53:03,440 --> 00:53:07,760
on

1459
00:53:05,199 --> 00:53:10,799
when we pass this value in

1460
00:53:07,760 --> 00:53:13,599
i don't actually know

1461
00:53:10,800 --> 00:53:14,960
those are presumably camera relative

1462
00:53:13,599 --> 00:53:17,200
right i don't actually know let's take a

1463
00:53:14,960 --> 00:53:17,199
look

1464
00:53:20,159 --> 00:53:22,879
because i'm not sure

1465
00:53:25,920 --> 00:53:28,920
so

1466
00:53:29,760 --> 00:53:35,680
so okay you can kind of see a bit of a

1467
00:53:32,960 --> 00:53:37,679
oddity here right um

1468
00:53:35,679 --> 00:53:40,719
the expected focus minzy and the

1469
00:53:37,679 --> 00:53:42,960
expected focus maxi is getting set based

1470
00:53:40,719 --> 00:53:45,279
on where you are so you can kind of see

1471
00:53:42,960 --> 00:53:48,800
why this would be wrong so these

1472
00:53:45,280 --> 00:53:51,040
actually now want to be pegged values um

1473
00:53:48,800 --> 00:53:52,480
so yeah i mean

1474
00:53:51,039 --> 00:53:55,599
you you can see

1475
00:53:52,480 --> 00:53:57,199
pretty much why this is this is broken

1476
00:53:55,599 --> 00:53:58,960
because if we're taking z out of the

1477
00:53:57,199 --> 00:54:01,439
equation this is still trying to compute

1478
00:53:58,960 --> 00:54:03,199
some bounds about where the z is going

1479
00:54:01,440 --> 00:54:05,519
to be focused on right

1480
00:54:03,199 --> 00:54:07,598
um and you can see us doing a bunch of

1481
00:54:05,519 --> 00:54:10,079
of work here to do stuff like setting

1482
00:54:07,599 --> 00:54:12,000
the camera um

1483
00:54:10,079 --> 00:54:14,318
z values because we were using

1484
00:54:12,000 --> 00:54:15,920
uh some dynamic alpha blending to get

1485
00:54:14,318 --> 00:54:17,759
rid of like floors that were above and

1486
00:54:15,920 --> 00:54:19,119
below us all of that can go away now

1487
00:54:17,760 --> 00:54:20,960
right we don't actually need that code

1488
00:54:19,119 --> 00:54:22,079
anymore which again is why i say like

1489
00:54:20,960 --> 00:54:24,000
it's going to be good to remove this

1490
00:54:22,079 --> 00:54:26,000
code because it was extra complexity

1491
00:54:24,000 --> 00:54:26,880
that really wasn't getting us very much

1492
00:54:26,000 --> 00:54:28,960
um

1493
00:54:26,880 --> 00:54:30,079
so yeah so this code doesn't really need

1494
00:54:28,960 --> 00:54:32,480
to happen

1495
00:54:30,079 --> 00:54:35,119
because it actually isn't camera

1496
00:54:32,480 --> 00:54:37,599
relative it's actually

1497
00:54:35,119 --> 00:54:39,200
literal in the world and so what we're

1498
00:54:37,599 --> 00:54:41,519
expecting now is that look we're just

1499
00:54:39,199 --> 00:54:45,199
focusing on z zero that's that's the

1500
00:54:41,519 --> 00:54:46,719
focus that in the world from now on um

1501
00:54:45,199 --> 00:54:49,919
is that z zero we're never going to let

1502
00:54:46,719 --> 00:54:51,519
it go uh anywhere else really

1503
00:54:49,920 --> 00:54:52,960
that's just where it is

1504
00:54:51,519 --> 00:54:54,798
uh and so now what we need to do is

1505
00:54:52,960 --> 00:54:57,119
figure out like where that's going to be

1506
00:54:54,798 --> 00:54:58,798
it's a little bit weird that

1507
00:54:57,119 --> 00:55:00,640
didn't produce something centered around

1508
00:54:58,798 --> 00:55:03,599
here so that focus value might must not

1509
00:55:00,639 --> 00:55:06,598
really be world relative

1510
00:55:03,599 --> 00:55:06,599
um

1511
00:55:11,920 --> 00:55:18,240
i'm not entirely certain um

1512
00:55:15,199 --> 00:55:18,239
because that's a bit strange

1513
00:55:18,559 --> 00:55:23,119
right

1514
00:55:19,440 --> 00:55:23,119
if we look at that world camera rect

1515
00:55:24,480 --> 00:55:28,240
that computation if that's uh world

1516
00:55:26,798 --> 00:55:29,280
relative we should be able to produce

1517
00:55:28,239 --> 00:55:30,798
you know we should be able to pretty

1518
00:55:29,280 --> 00:55:32,640
much plug in any value that we want here

1519
00:55:30,798 --> 00:55:34,480
so that's a little bit odd

1520
00:55:32,639 --> 00:55:36,078
uh that plugging in focus e of zero so

1521
00:55:34,480 --> 00:55:38,240
maybe that's not let me look at how this

1522
00:55:36,079 --> 00:55:40,798
code works just so i can see how we were

1523
00:55:38,239 --> 00:55:40,798
computing it

1524
00:55:42,798 --> 00:55:48,719
so i get camera rectangle at distance

1525
00:55:46,318 --> 00:55:52,318
it's this one right here so if we

1526
00:55:48,719 --> 00:55:54,959
do world distance from camera z

1527
00:55:52,318 --> 00:55:57,039
so okay so that is camera relative i'm

1528
00:55:54,960 --> 00:55:58,960
so confused right now that is camera

1529
00:55:57,039 --> 00:56:02,759
relative it didn't look like it was

1530
00:55:58,960 --> 00:56:02,760
camera relative though

1531
00:56:06,000 --> 00:56:09,599
so how let's let's look at how are we

1532
00:56:08,000 --> 00:56:11,199
computing this here

1533
00:56:09,599 --> 00:56:13,519
uh those are

1534
00:56:11,199 --> 00:56:17,199
those are derived from

1535
00:56:13,519 --> 00:56:18,239
uh target expected focus right

1536
00:56:17,199 --> 00:56:21,519
so

1537
00:56:18,239 --> 00:56:24,078
target expected focus

1538
00:56:21,519 --> 00:56:27,280
room focus z and entity focus z so all

1539
00:56:24,079 --> 00:56:31,280
right room focus z

1540
00:56:27,280 --> 00:56:34,319
entity focus z how are we updating those

1541
00:56:31,280 --> 00:56:35,599
okay so it is relative to the camera

1542
00:56:34,318 --> 00:56:36,880
right

1543
00:56:35,599 --> 00:56:39,440
all right so

1544
00:56:36,880 --> 00:56:40,798
what's the focus z here

1545
00:56:39,440 --> 00:56:42,798
uh

1546
00:56:40,798 --> 00:56:46,759
relative to the camera

1547
00:56:42,798 --> 00:56:46,759
is this measured

1548
00:56:47,920 --> 00:56:52,880
so i don't we would need to know the

1549
00:56:50,318 --> 00:56:55,119
camera arm here so you know what i could

1550
00:56:52,880 --> 00:56:55,119
say

1551
00:56:55,679 --> 00:56:58,399
uh

1552
00:56:57,119 --> 00:57:00,720
i could leave this

1553
00:56:58,400 --> 00:57:02,639
quote-unquote computation in place

1554
00:57:00,719 --> 00:57:05,439
although i think we probably just want

1555
00:57:02,639 --> 00:57:05,819
uh expected focus z

1556
00:57:05,440 --> 00:57:07,119
uh

1557
00:57:05,820 --> 00:57:09,200
[Music]

1558
00:57:07,119 --> 00:57:12,720
to just be a value on its own so so

1559
00:57:09,199 --> 00:57:15,358
maybe we'll just say look the focus z

1560
00:57:12,719 --> 00:57:15,358
is this

1561
00:57:16,880 --> 00:57:23,039
and then we'll we'll eliminate that

1562
00:57:20,798 --> 00:57:27,000
that actual value

1563
00:57:23,039 --> 00:57:27,000
so from camera

1564
00:57:27,760 --> 00:57:33,040
we will say

1565
00:57:30,000 --> 00:57:34,880
world camera where was the

1566
00:57:33,039 --> 00:57:37,838
if

1567
00:57:34,880 --> 00:57:40,160
if this is our camera why

1568
00:57:37,838 --> 00:57:43,440
world mode camera expected focus z that

1569
00:57:40,159 --> 00:57:43,440
is not the actual camera

1570
00:57:44,719 --> 00:57:48,639
again too much complexity

1571
00:57:46,880 --> 00:57:50,640
uh you can see why i want to do one

1572
00:57:48,639 --> 00:57:53,440
simplification pass

1573
00:57:50,639 --> 00:57:55,519
so uh it's the game camera

1574
00:57:53,440 --> 00:57:57,119
is the thing that generates the camera

1575
00:57:55,519 --> 00:57:58,719
because the actual camera is just for

1576
00:57:57,119 --> 00:58:01,599
rendering right

1577
00:57:58,719 --> 00:58:04,318
uh you can see here we've got all of the

1578
00:58:01,599 --> 00:58:06,240
target expectancy all that stuff so this

1579
00:58:04,318 --> 00:58:08,480
i'm going to simplify down to just

1580
00:58:06,239 --> 00:58:09,358
expected focus z

1581
00:58:08,480 --> 00:58:12,079
and

1582
00:58:09,358 --> 00:58:13,759
that we don't really need to compute

1583
00:58:12,079 --> 00:58:15,680
every frame it's just going to more or

1584
00:58:13,760 --> 00:58:18,400
less be well i mean i guess we do if the

1585
00:58:15,679 --> 00:58:21,358
camera like pulls back or goes forwards

1586
00:58:18,400 --> 00:58:22,960
so i suppose the yeah i mean maybe we do

1587
00:58:21,358 --> 00:58:25,119
kind of do it every frame for that

1588
00:58:22,960 --> 00:58:27,358
reason

1589
00:58:25,119 --> 00:58:30,000
but that's all we actually need so if

1590
00:58:27,358 --> 00:58:33,039
you take a look here you can see there's

1591
00:58:30,000 --> 00:58:36,880
uh this camera arm concept right

1592
00:58:33,039 --> 00:58:39,279
which is like the camera z value which

1593
00:58:36,880 --> 00:58:41,519
is presumably just something we build up

1594
00:58:39,280 --> 00:58:41,519
here

1595
00:58:42,880 --> 00:58:45,920
yeah

1596
00:58:43,760 --> 00:58:48,559
so the camera z value well we're even

1597
00:58:45,920 --> 00:58:50,480
just passing it in right so when we do

1598
00:58:48,559 --> 00:58:53,359
update camera for entity movement you

1599
00:58:50,480 --> 00:58:55,920
can see us passing in the camera z here

1600
00:58:53,358 --> 00:58:57,119
that's the camera z axis

1601
00:58:55,920 --> 00:58:59,519
right

1602
00:58:57,119 --> 00:59:00,960
so i would say we just back out all of

1603
00:58:59,519 --> 00:59:03,358
this code

1604
00:59:00,960 --> 00:59:05,358
we just nuke it from orbit because the

1605
00:59:03,358 --> 00:59:06,719
only person who cares about this value

1606
00:59:05,358 --> 00:59:10,000
now

1607
00:59:06,719 --> 00:59:12,318
is going to be the person who sets uh

1608
00:59:10,000 --> 00:59:15,039
that lighting offset value right so when

1609
00:59:12,318 --> 00:59:17,358
it when it tries to determine

1610
00:59:15,039 --> 00:59:18,480
what the camera rect is

1611
00:59:17,358 --> 00:59:20,639
this right here

1612
00:59:18,480 --> 00:59:23,199
we can use the camera z that we

1613
00:59:20,639 --> 00:59:25,440
ourselves computed to figure out this

1614
00:59:23,199 --> 00:59:27,679
value trivially because it's just

1615
00:59:25,440 --> 00:59:30,240
wherever the camera is

1616
00:59:27,679 --> 00:59:32,399
it's that it's not producted with that

1617
00:59:30,239 --> 00:59:35,279
axis right it's just a measure along

1618
00:59:32,400 --> 00:59:37,599
this axis how far away the camera was

1619
00:59:35,280 --> 00:59:39,760
so we no longer need to do this because

1620
00:59:37,599 --> 00:59:43,119
we're not actually going to be we're

1621
00:59:39,760 --> 00:59:45,280
always going to peg our z distance so i

1622
00:59:43,119 --> 00:59:47,119
think that basically simplifies all of

1623
00:59:45,280 --> 00:59:48,960
this code uh like all of this code will

1624
00:59:47,119 --> 00:59:50,559
now go away uh which is great because

1625
00:59:48,960 --> 00:59:54,240
like i said

1626
00:59:50,559 --> 00:59:55,119
it's too complicated right

1627
00:59:54,239 --> 00:59:56,318
um

1628
00:59:55,119 --> 00:59:58,640
so

1629
00:59:56,318 --> 00:59:59,920
yeah uh

1630
00:59:58,639 --> 01:00:01,358
although i guess now that i think about

1631
00:59:59,920 --> 01:00:02,720
it too though the only thing that we do

1632
01:00:01,358 --> 01:00:04,798
want to do is we probably still do want

1633
01:00:02,719 --> 01:00:06,239
to pass it in after we trim all the code

1634
01:00:04,798 --> 01:00:07,838
because in order to produce the new

1635
01:00:06,239 --> 01:00:09,598
target location

1636
01:00:07,838 --> 01:00:11,679
we would still have that z-arm come out

1637
01:00:09,599 --> 01:00:13,838
of it so it still needs to kind of know

1638
01:00:11,679 --> 01:00:15,279
like how far it should move out based on

1639
01:00:13,838 --> 01:00:18,078
what it's looking at

1640
01:00:15,280 --> 01:00:19,760
um so so i'm going to just trim this

1641
01:00:18,079 --> 01:00:21,920
code really quick here

1642
01:00:19,760 --> 01:00:24,079
but then we still do kind of want it

1643
01:00:21,920 --> 01:00:26,400
just for this we don't need

1644
01:00:24,079 --> 01:00:28,000
this anymore right

1645
01:00:26,400 --> 01:00:29,680
but we do kind of want to trim all of

1646
01:00:28,000 --> 01:00:30,798
this stuff so i think all of this goes

1647
01:00:29,679 --> 01:00:36,078
away

1648
01:00:30,798 --> 01:00:36,079
um the entirety of it um

1649
01:00:36,798 --> 01:00:40,639
yeah

1650
01:00:38,159 --> 01:00:42,879
none of this still exists

1651
01:00:40,639 --> 01:00:45,519
but but i spoke too soon we still do

1652
01:00:42,880 --> 01:00:46,960
want the camera zx so because it needs

1653
01:00:45,519 --> 01:00:48,559
to know how far

1654
01:00:46,960 --> 01:00:49,599
out it needs to know how to move the

1655
01:00:48,559 --> 01:00:52,798
camera

1656
01:00:49,599 --> 01:00:55,680
um how for how far away uh

1657
01:00:52,798 --> 01:00:57,679
how far pulled back it needs to be right

1658
01:00:55,679 --> 01:01:00,159
so so that's okay

1659
01:00:57,679 --> 01:01:01,679
um so now we just need to take this uh

1660
01:01:00,159 --> 01:01:04,480
piece of code here uh we don't care

1661
01:01:01,679 --> 01:01:07,279
about any of this so this focus z mac

1662
01:01:04,480 --> 01:01:10,960
and the like the fog params uh we're not

1663
01:01:07,280 --> 01:01:11,920
really gonna do those anymore right uh

1664
01:01:10,960 --> 01:01:14,159
so

1665
01:01:11,920 --> 01:01:16,400
but we can still set these

1666
01:01:14,159 --> 01:01:19,598
uh i don't know exactly what the values

1667
01:01:16,400 --> 01:01:19,599
here want to be but

1668
01:01:19,920 --> 01:01:25,400
i don't know these can be set to like

1669
01:01:21,920 --> 01:01:25,400
something fairly

1670
01:01:25,760 --> 01:01:29,920
fairly wide here temporarily but i'm

1671
01:01:27,599 --> 01:01:32,798
going to put to do in here and just say

1672
01:01:29,920 --> 01:01:35,358
simplify all this code now that z

1673
01:01:32,798 --> 01:01:36,239
doesn't vary

1674
01:01:35,358 --> 01:01:38,798
so

1675
01:01:36,239 --> 01:01:40,879
we're going to do a few simplification

1676
01:01:38,798 --> 01:01:43,039
passes here put the camera z back in

1677
01:01:40,880 --> 01:01:44,160
there

1678
01:01:43,039 --> 01:01:46,400
um

1679
01:01:44,159 --> 01:01:49,679
and yeah we don't care about any of this

1680
01:01:46,400 --> 01:01:52,639
stuff it's just printing that stuff out

1681
01:01:49,679 --> 01:01:55,118
um and so now i just need to go and make

1682
01:01:52,639 --> 01:01:56,318
it so that we compute that camera z

1683
01:01:55,119 --> 01:01:58,880
uh

1684
01:01:56,318 --> 01:01:59,920
offset this expected focus here

1685
01:01:58,880 --> 01:02:02,000
so

1686
01:01:59,920 --> 01:02:04,639
the camera z would just be the inner

1687
01:02:02,000 --> 01:02:06,880
product sorry the expected focus z so

1688
01:02:04,639 --> 01:02:09,759
this value that we want here

1689
01:02:06,880 --> 01:02:11,119
the expected focus z which we can get

1690
01:02:09,760 --> 01:02:12,880
rid of the

1691
01:02:11,119 --> 01:02:15,519
that in the actual game camera we don't

1692
01:02:12,880 --> 01:02:17,039
need it anymore um this is

1693
01:02:15,519 --> 01:02:18,880
always known

1694
01:02:17,039 --> 01:02:20,640
uh we can just say look wherever the

1695
01:02:18,880 --> 01:02:23,280
camera actually is

1696
01:02:20,639 --> 01:02:25,598
um the expected focus z is just the the

1697
01:02:23,280 --> 01:02:27,440
measurement along the camera z axis of

1698
01:02:25,599 --> 01:02:30,079
that so we just need like the camera

1699
01:02:27,440 --> 01:02:32,159
position here

1700
01:02:30,079 --> 01:02:35,119
right is all we actually need because

1701
01:02:32,159 --> 01:02:36,719
that off that back from zero is is all

1702
01:02:35,119 --> 01:02:39,358
we really need to know

1703
01:02:36,719 --> 01:02:41,759
now the problem that we're gonna have is

1704
01:02:39,358 --> 01:02:44,078
that we don't actually uh

1705
01:02:41,760 --> 01:02:46,079
the expected focus z value there like

1706
01:02:44,079 --> 01:02:49,280
how far far back it's gonna be

1707
01:02:46,079 --> 01:02:52,318
we do need the two we need the the

1708
01:02:49,280 --> 01:02:54,880
target and the world position we need to

1709
01:02:52,318 --> 01:02:56,960
to measure those uh so we need you know

1710
01:02:54,880 --> 01:02:59,280
we effectively need like

1711
01:02:56,960 --> 01:03:01,760
uh target

1712
01:02:59,280 --> 01:03:04,640
i guess we would need like camera pose

1713
01:03:01,760 --> 01:03:07,680
minus camera target right

1714
01:03:04,639 --> 01:03:07,679
can't quite spell today

1715
01:03:08,559 --> 01:03:10,880
um

1716
01:03:09,679 --> 01:03:12,480
we would need like the camera position

1717
01:03:10,880 --> 01:03:14,318
minus the camera target for the expected

1718
01:03:12,480 --> 01:03:18,639
focus z value

1719
01:03:14,318 --> 01:03:21,199
and in order to uh produce that we

1720
01:03:18,639 --> 01:03:24,000
we presumably already have put we

1721
01:03:21,199 --> 01:03:26,000
presumably already computed those camera

1722
01:03:24,000 --> 01:03:28,079
uh

1723
01:03:26,000 --> 01:03:30,079
those camera values here right

1724
01:03:28,079 --> 01:03:32,318
so like for example in order to set the

1725
01:03:30,079 --> 01:03:33,839
camera transform we would need we would

1726
01:03:32,318 --> 01:03:35,440
need this information

1727
01:03:33,838 --> 01:03:36,960
right um

1728
01:03:35,440 --> 01:03:39,760
so

1729
01:03:36,960 --> 01:03:41,039
camera zero t i assume is the value that

1730
01:03:39,760 --> 01:03:41,839
we actually

1731
01:03:41,039 --> 01:03:43,440
uh

1732
01:03:41,838 --> 01:03:44,099
are looking for

1733
01:03:43,440 --> 01:03:47,179
here for

1734
01:03:44,099 --> 01:03:47,179
[Music]

1735
01:03:48,159 --> 01:03:51,279
just quick take delta from sim

1736
01:03:50,480 --> 01:03:53,199
so

1737
01:03:51,280 --> 01:03:55,440
subtract remote camera p from canvas

1738
01:03:53,199 --> 01:03:56,960
image center so yeah you can see like

1739
01:03:55,440 --> 01:04:01,119
delta from sim is where the camera

1740
01:03:56,960 --> 01:04:02,639
actually is right it's the camera p here

1741
01:04:01,119 --> 01:04:05,358
um and

1742
01:04:02,639 --> 01:04:08,879
i guess we don't at the moment i don't

1743
01:04:05,358 --> 01:04:11,838
know that we look at the target but

1744
01:04:08,880 --> 01:04:14,559
i guess we know the target is always at

1745
01:04:11,838 --> 01:04:18,719
zero anyway so we probably don't care

1746
01:04:14,559 --> 01:04:18,720
because the x and y displacement

1747
01:04:19,280 --> 01:04:23,440
well but we kind of do want to remove

1748
01:04:22,000 --> 01:04:24,960
those

1749
01:04:23,440 --> 01:04:28,798
because

1750
01:04:24,960 --> 01:04:30,798
we only want just how far away

1751
01:04:28,798 --> 01:04:32,719
uh it's going to be and

1752
01:04:30,798 --> 01:04:34,159
it could add to the appearance that it

1753
01:04:32,719 --> 01:04:36,159
is further away

1754
01:04:34,159 --> 01:04:38,078
along that axis right i mean is that

1755
01:04:36,159 --> 01:04:41,798
true or is that going to take it it's

1756
01:04:38,079 --> 01:04:41,798
going to be entirely

1757
01:04:42,159 --> 01:04:48,558
yeah so i'm not 100 sure about that

1758
01:04:45,539 --> 01:04:49,920
[Music]

1759
01:04:48,559 --> 01:04:53,359
so i think i'm just going to recompute

1760
01:04:49,920 --> 01:04:55,440
the value here just to be sure

1761
01:04:53,358 --> 01:04:58,960
because i don't i don't want this to be

1762
01:04:55,440 --> 01:05:01,358
at all wrong so i'm going to do like a

1763
01:04:58,960 --> 01:05:01,358
camera

1764
01:05:02,000 --> 01:05:04,960
target to camera

1765
01:05:03,760 --> 01:05:06,640
something like that

1766
01:05:04,960 --> 01:05:08,559
uh so that we can take a look at the

1767
01:05:06,639 --> 01:05:11,199
game camera here and say look we've got

1768
01:05:08,559 --> 01:05:12,559
a p we've got a target p

1769
01:05:11,199 --> 01:05:14,558
um

1770
01:05:12,559 --> 01:05:16,480
and

1771
01:05:14,559 --> 01:05:17,920
maybe i guess i also don't really know

1772
01:05:16,480 --> 01:05:19,838
though uh

1773
01:05:17,920 --> 01:05:21,920
to what extent this is doing sort of a

1774
01:05:19,838 --> 01:05:24,719
chase movement like if this is

1775
01:05:21,920 --> 01:05:27,519
interpolating towards here then the

1776
01:05:24,719 --> 01:05:29,519
camera p as it currently exists i guess

1777
01:05:27,519 --> 01:05:31,838
we don't really know

1778
01:05:29,519 --> 01:05:31,838
um

1779
01:05:32,719 --> 01:05:37,798
you know we don't know how far it is in

1780
01:05:34,480 --> 01:05:37,798
x and y

1781
01:05:46,159 --> 01:05:50,960
although we do kind of know

1782
01:05:48,559 --> 01:05:53,599
so i guess all of this again because we

1783
01:05:50,960 --> 01:05:55,838
know that the camera has to it's just

1784
01:05:53,599 --> 01:05:58,240
the intersection with the zero plane is

1785
01:05:55,838 --> 01:05:59,920
is where it has to go we could just ask

1786
01:05:58,239 --> 01:06:01,919
for that intersection

1787
01:05:59,920 --> 01:06:04,480
um from the

1788
01:06:01,920 --> 01:06:05,680
you know from the the p value right so i

1789
01:06:04,480 --> 01:06:09,280
suppose we

1790
01:06:05,679 --> 01:06:12,318
j just because we don't have

1791
01:06:09,280 --> 01:06:14,240
uh the target p value i suppose uh we

1792
01:06:12,318 --> 01:06:17,759
could just say

1793
01:06:14,239 --> 01:06:20,318
well if we know where the camera

1794
01:06:17,760 --> 01:06:21,760
is looking currently we know how far

1795
01:06:20,318 --> 01:06:22,880
away that it's going it's going to have

1796
01:06:21,760 --> 01:06:25,599
to be

1797
01:06:22,880 --> 01:06:27,280
uh to produce that z value so it should

1798
01:06:25,599 --> 01:06:29,039
be possible for us to

1799
01:06:27,280 --> 01:06:31,200
uh correctly set this because again we

1800
01:06:29,039 --> 01:06:32,880
know that no matter how the camera moves

1801
01:06:31,199 --> 01:06:35,439
because the camera does change its

1802
01:06:32,880 --> 01:06:36,480
position in z we're always looking back

1803
01:06:35,440 --> 01:06:36,880
towards

1804
01:06:36,480 --> 01:06:38,880
um

1805
01:06:36,880 --> 01:06:40,880
[Music]

1806
01:06:38,880 --> 01:06:42,798
the z zero value

1807
01:06:40,880 --> 01:06:45,119
so in theory right we should be able to

1808
01:06:42,798 --> 01:06:49,679
just say well the ratio between

1809
01:06:45,119 --> 01:06:49,680
the just a straight you know

1810
01:06:49,760 --> 01:06:52,559
this

1811
01:06:51,599 --> 01:06:56,559
uh

1812
01:06:52,559 --> 01:06:58,640
the ratio of movement between the z

1813
01:06:56,559 --> 01:07:02,480
vector just pure z

1814
01:06:58,639 --> 01:07:04,000
and whatever the camera's current uh

1815
01:07:02,480 --> 01:07:05,760
z

1816
01:07:04,000 --> 01:07:08,000
like the direction the camera is

1817
01:07:05,760 --> 01:07:10,880
currently looking

1818
01:07:08,000 --> 01:07:15,199
that's just going to be the camera's z's

1819
01:07:10,880 --> 01:07:16,480
z value right that's that's how slowly

1820
01:07:15,199 --> 01:07:18,239
it goes

1821
01:07:16,480 --> 01:07:21,039
forwards in z

1822
01:07:18,239 --> 01:07:24,558
so whatever the height is of the camera

1823
01:07:21,039 --> 01:07:27,119
right whatever the the um

1824
01:07:24,559 --> 01:07:30,160
i think we call that what delta from sim

1825
01:07:27,119 --> 01:07:30,960
right it was called delta from sim

1826
01:07:30,159 --> 01:07:32,159
so

1827
01:07:30,960 --> 01:07:35,039
uh

1828
01:07:32,159 --> 01:07:37,440
delta from sim

1829
01:07:35,039 --> 01:07:38,480
where was that value is right here

1830
01:07:37,440 --> 01:07:40,000
uh

1831
01:07:38,480 --> 01:07:41,760
when we compute this delta from sim

1832
01:07:40,000 --> 01:07:43,440
which just says how far is the camera

1833
01:07:41,760 --> 01:07:45,440
off of zero because we know that this is

1834
01:07:43,440 --> 01:07:47,920
always zero z right so how far is camera

1835
01:07:45,440 --> 01:07:51,280
off of zero

1836
01:07:47,920 --> 01:07:52,400
we would know just right from that

1837
01:07:51,280 --> 01:07:55,440
uh

1838
01:07:52,400 --> 01:07:57,680
we immediately already know uh

1839
01:07:55,440 --> 01:07:59,920
just by looking at that z vector what

1840
01:07:57,679 --> 01:08:01,759
the distance to the z plane would be

1841
01:07:59,920 --> 01:08:03,519
right

1842
01:08:01,760 --> 01:08:05,359
so the delta from

1843
01:08:03,519 --> 01:08:09,440
sims z value

1844
01:08:05,358 --> 01:08:11,598
that's how far in z just vertically the

1845
01:08:09,440 --> 01:08:14,480
camera is off the ground

1846
01:08:11,599 --> 01:08:15,359
um and the order of the subtraction

1847
01:08:14,480 --> 01:08:17,600
there

1848
01:08:15,358 --> 01:08:19,439
when we look at delta from sim it's

1849
01:08:17,600 --> 01:08:21,359
going from the simulation center to the

1850
01:08:19,439 --> 01:08:24,079
camera so it's a positive value right

1851
01:08:21,359 --> 01:08:26,079
because camera is higher than the zero

1852
01:08:24,079 --> 01:08:28,079
plane always

1853
01:08:26,079 --> 01:08:30,640
um

1854
01:08:28,079 --> 01:08:32,559
so when we look at that uh value we know

1855
01:08:30,640 --> 01:08:34,400
that this is a positive value we know

1856
01:08:32,560 --> 01:08:37,359
that the camera z

1857
01:08:34,399 --> 01:08:38,719
uh presumably if this orientation is a

1858
01:08:37,359 --> 01:08:39,838
you know a right-handed coordinate

1859
01:08:38,719 --> 01:08:40,719
system

1860
01:08:39,838 --> 01:08:42,479
uh

1861
01:08:40,719 --> 01:08:44,079
we're going to

1862
01:08:42,479 --> 01:08:45,678
i guess i don't really remember exactly

1863
01:08:44,079 --> 01:08:47,278
how we set it up but i believe z comes

1864
01:08:45,679 --> 01:08:50,158
out uh

1865
01:08:47,279 --> 01:08:52,480
back towards us in the screen so we're

1866
01:08:50,158 --> 01:08:55,358
also talking about a value that would be

1867
01:08:52,479 --> 01:08:57,358
going coming up away from the z plane

1868
01:08:55,359 --> 01:08:59,520
there

1869
01:08:57,359 --> 01:09:01,440
so assuming that those are both true

1870
01:08:59,520 --> 01:09:04,000
then really all we're talking about is

1871
01:09:01,439 --> 01:09:05,519
like a divide here right the amount of

1872
01:09:04,000 --> 01:09:07,920
time it will take it to take it to

1873
01:09:05,520 --> 01:09:10,480
intersect this plane right is just going

1874
01:09:07,920 --> 01:09:12,798
to be how far it has to go divided by

1875
01:09:10,479 --> 01:09:14,718
how fast effectively it goes along that

1876
01:09:12,798 --> 01:09:17,119
vector and that would be the expected

1877
01:09:14,719 --> 01:09:18,480
focus z value right

1878
01:09:17,119 --> 01:09:21,759
um

1879
01:09:18,479 --> 01:09:22,559
so i think that's pretty much it

1880
01:09:21,759 --> 01:09:24,640
uh

1881
01:09:22,560 --> 01:09:26,880
but you know i could be very wrong about

1882
01:09:24,640 --> 01:09:29,359
that um if that makes sense

1883
01:09:26,880 --> 01:09:31,199
all right so let's try and get that

1884
01:09:29,359 --> 01:09:33,600
debugged properly because i think that's

1885
01:09:31,198 --> 01:09:35,439
all we really want to do is to say like

1886
01:09:33,600 --> 01:09:37,440
look that's okay so that's going to be

1887
01:09:35,439 --> 01:09:39,599
like our focus value right so let's take

1888
01:09:37,439 --> 01:09:41,358
a look at this code and see how that

1889
01:09:39,600 --> 01:09:43,039
actually works i also don't know if this

1890
01:09:41,359 --> 01:09:44,560
is supposed to be negative meaning

1891
01:09:43,039 --> 01:09:46,158
negative motion

1892
01:09:44,560 --> 01:09:48,000
along it so if we look at get camera

1893
01:09:46,158 --> 01:09:50,238
rectangle at distance we have to kind of

1894
01:09:48,000 --> 01:09:51,439
know which which world distance from

1895
01:09:50,238 --> 01:09:53,039
camera z

1896
01:09:51,439 --> 01:09:55,519
because it's phrased that way i would

1897
01:09:53,039 --> 01:09:58,000
assume that world distance from camera z

1898
01:09:55,520 --> 01:09:59,280
uh effectively means that the value is

1899
01:09:58,000 --> 01:10:01,600
going to be positive but i didn't

1900
01:09:59,279 --> 01:10:03,198
actually know that right so

1901
01:10:01,600 --> 01:10:04,560
uh we have to go kind of verify that's

1902
01:10:03,198 --> 01:10:06,639
the case when you look at unproject for

1903
01:10:04,560 --> 01:10:08,000
example

1904
01:10:06,640 --> 01:10:10,159
uh and you look at this world distance

1905
01:10:08,000 --> 01:10:11,520
from camera z um

1906
01:10:10,158 --> 01:10:16,158
you know

1907
01:10:11,520 --> 01:10:18,320
what is that actually saying here so

1908
01:10:16,158 --> 01:10:21,920
it's it's creating a

1909
01:10:18,319 --> 01:10:24,639
from the origin of the camera basically

1910
01:10:21,920 --> 01:10:26,158
it's subtracting the distance times the

1911
01:10:24,640 --> 01:10:28,079
z

1912
01:10:26,158 --> 01:10:30,238
so yeah so i think this value is

1913
01:10:28,079 --> 01:10:31,439
positive right i think this value is

1914
01:10:30,238 --> 01:10:32,399
positive

1915
01:10:31,439 --> 01:10:34,399
um

1916
01:10:32,399 --> 01:10:36,158
that's being passed in here but i could

1917
01:10:34,399 --> 01:10:38,799
be wrong about that

1918
01:10:36,158 --> 01:10:40,719
so let's take a look uh if i switch to a

1919
01:10:38,800 --> 01:10:43,039
debug build so we can inspect these

1920
01:10:40,719 --> 01:10:44,158
values more um just

1921
01:10:43,039 --> 01:10:47,119
turn to

1922
01:10:44,158 --> 01:10:51,119
the o2 to an od here

1923
01:10:47,119 --> 01:10:53,119
i i'm going to set a breakpoint in there

1924
01:10:51,119 --> 01:10:56,119
um

1925
01:10:53,119 --> 01:10:56,119
somewhere

1926
01:10:59,359 --> 01:11:04,238
let's get a little more room here

1927
01:11:02,479 --> 01:11:06,639
uh i'm going to set a breakpoint in

1928
01:11:04,238 --> 01:11:08,639
there so i can inspect uh how that code

1929
01:11:06,640 --> 01:11:12,600
is functioning and we'll just take a

1930
01:11:08,640 --> 01:11:12,600
look at it so

1931
01:11:15,359 --> 01:11:19,839
here is us reaching the

1932
01:11:17,679 --> 01:11:22,000
the delta from sim line

1933
01:11:19,840 --> 01:11:24,960
uh let's take a look at what these

1934
01:11:22,000 --> 01:11:28,560
values work out to be so we've got delta

1935
01:11:24,960 --> 01:11:30,319
from sim and we've got camera z

1936
01:11:28,560 --> 01:11:31,679
so here are those values this is what

1937
01:11:30,319 --> 01:11:35,198
you would expect right so if you take a

1938
01:11:31,679 --> 01:11:35,199
look at what we're actually getting here

1939
01:11:35,840 --> 01:11:41,279
you would expect a camera

1940
01:11:39,279 --> 01:11:44,079
z value to not have any x component in

1941
01:11:41,279 --> 01:11:47,119
it because we're looking straight down

1942
01:11:44,079 --> 01:11:49,760
uh we're not looking there's no slant on

1943
01:11:47,119 --> 01:11:51,439
either side we're just slanted in y so

1944
01:11:49,760 --> 01:11:53,840
we're just so we expect there to be a y

1945
01:11:51,439 --> 01:11:55,519
value relatively small a z value

1946
01:11:53,840 --> 01:11:58,640
relatively large that's exactly what we

1947
01:11:55,520 --> 01:12:02,080
see so this makes perfect sense

1948
01:11:58,640 --> 01:12:02,079
let's take a look at our delta from sim

1949
01:12:04,399 --> 01:12:10,839
that is not what i would have expected

1950
01:12:13,600 --> 01:12:17,120
so that's confusing and maybe a source

1951
01:12:16,079 --> 01:12:19,920
of our

1952
01:12:17,119 --> 01:12:21,119
errors here uh maybe it takes the camera

1953
01:12:19,920 --> 01:12:22,480
a little while okay so it looks like it

1954
01:12:21,119 --> 01:12:24,960
takes the camera a little while to chase

1955
01:12:22,479 --> 01:12:29,359
where to where it should be all right so

1956
01:12:24,960 --> 01:12:33,119
now the camera is it's negative 2.8

1957
01:12:29,359 --> 01:12:36,119
back in y but its z value is zero

1958
01:12:33,119 --> 01:12:36,119
um

1959
01:12:43,119 --> 01:12:47,760
so that definitely means i screwed

1960
01:12:45,760 --> 01:12:50,400
something up there probably in my

1961
01:12:47,760 --> 01:12:53,679
overzealous setting of z's to zero

1962
01:12:50,399 --> 01:12:55,920
i must have accidentally uh eliminated

1963
01:12:53,679 --> 01:12:57,199
the camera's ability to move up off of

1964
01:12:55,920 --> 01:12:59,840
the floor

1965
01:12:57,198 --> 01:13:01,599
uh which is going to cause a huge

1966
01:12:59,840 --> 01:13:03,440
problem right

1967
01:13:01,600 --> 01:13:05,679
specifically for this

1968
01:13:03,439 --> 01:13:08,319
uh because if this is zero and the

1969
01:13:05,679 --> 01:13:11,840
camera's like flattened to the floor

1970
01:13:08,319 --> 01:13:13,840
uh we've got issues so i'm not sure

1971
01:13:11,840 --> 01:13:18,000
what maybe i'm thinking of delta from

1972
01:13:13,840 --> 01:13:20,719
sim incorrectly let's take a quick look

1973
01:13:18,000 --> 01:13:22,960
um at how that works but yeah i mean

1974
01:13:20,719 --> 01:13:25,920
looking at it

1975
01:13:22,960 --> 01:13:25,920
uh yeah

1976
01:13:27,039 --> 01:13:31,039
it's definitely not good so if we take a

1977
01:13:29,198 --> 01:13:33,359
look here at update camera for entity

1978
01:13:31,039 --> 01:13:35,198
movement um

1979
01:13:33,359 --> 01:13:36,880
just thinking about what the z offset's

1980
01:13:35,198 --> 01:13:37,678
going to be

1981
01:13:36,880 --> 01:13:39,359
um

1982
01:13:37,679 --> 01:13:41,520
let's go down and take a look at how

1983
01:13:39,359 --> 01:13:42,319
this is being computed here

1984
01:13:41,520 --> 01:13:43,440
so

1985
01:13:42,319 --> 01:13:45,519
uh

1986
01:13:43,439 --> 01:13:47,678
in terms of where the camera is going to

1987
01:13:45,520 --> 01:13:50,679
end up

1988
01:13:47,679 --> 01:13:50,679
um

1989
01:14:03,279 --> 01:14:06,800
so i

1990
01:14:04,960 --> 01:14:11,239
i guess this

1991
01:14:06,800 --> 01:14:11,239
this value here

1992
01:14:14,800 --> 01:14:20,640
is set per room about how far away

1993
01:14:18,960 --> 01:14:24,640
you want the camera to be but that's

1994
01:14:20,640 --> 01:14:26,159
okay that that should be right

1995
01:14:24,640 --> 01:14:28,719
i mean that

1996
01:14:26,158 --> 01:14:31,119
that seems correct right

1997
01:14:28,719 --> 01:14:31,119
um

1998
01:14:36,000 --> 01:14:40,880
so you know i i couldn't say i really

1999
01:14:38,960 --> 01:14:45,119
couldn't tell you

2000
01:14:40,880 --> 01:14:47,119
uh why that was coming out incorrectly

2001
01:14:45,119 --> 01:14:49,599
the only thing i could really think of

2002
01:14:47,119 --> 01:14:52,399
is if the room centers

2003
01:14:49,600 --> 01:14:55,520
are just set totally wrong

2004
01:14:52,399 --> 01:14:58,319
um so that it just so happens that it

2005
01:14:55,520 --> 01:15:01,679
comes out to a zero value

2006
01:14:58,319 --> 01:15:01,679
that seems unlikely

2007
01:15:05,359 --> 01:15:08,479
but obviously we don't really have to

2008
01:15:06,640 --> 01:15:10,000
speculate we've got a debug build here

2009
01:15:08,479 --> 01:15:12,718
so

2010
01:15:10,000 --> 01:15:12,719
i mean heck

2011
01:15:13,198 --> 01:15:17,919
i'll just take a look

2012
01:15:14,960 --> 01:15:19,119
um because that that part is like you

2013
01:15:17,920 --> 01:15:20,158
know

2014
01:15:19,119 --> 01:15:21,920
um

2015
01:15:20,158 --> 01:15:24,879
we we do have to make sure that the

2016
01:15:21,920 --> 01:15:25,679
rooms are set so that they make sense in

2017
01:15:24,880 --> 01:15:26,960
that

2018
01:15:25,679 --> 01:15:28,640
in that way

2019
01:15:26,960 --> 01:15:30,079
and we don't really know exactly what

2020
01:15:28,640 --> 01:15:32,640
they are set to

2021
01:15:30,079 --> 01:15:34,800
so let's take a look and see just so we

2022
01:15:32,640 --> 01:15:37,679
know about that piece of the puzzle

2023
01:15:34,800 --> 01:15:39,199
because right each room in the world can

2024
01:15:37,679 --> 01:15:40,960
have its own sort of like how far do you

2025
01:15:39,198 --> 01:15:43,359
want the camera

2026
01:15:40,960 --> 01:15:46,960
uh pulled back so if we step in through

2027
01:15:43,359 --> 01:15:48,000
the code here and we take a look

2028
01:15:46,960 --> 01:15:48,880
um

2029
01:15:48,000 --> 01:15:51,198
i'm gonna

2030
01:15:48,880 --> 01:15:53,199
go ahead and say we can skip to just

2031
01:15:51,198 --> 01:15:56,639
like when we find out a particular

2032
01:15:53,198 --> 01:15:58,639
in-room value here we'll see

2033
01:15:56,640 --> 01:16:01,280
okay so it looks like the problem is

2034
01:15:58,640 --> 01:16:03,199
that the room bounds are wrong in z so

2035
01:16:01,279 --> 01:16:04,000
it looks like you're not in any room at

2036
01:16:03,198 --> 01:16:06,799
all

2037
01:16:04,000 --> 01:16:08,800
right um so maybe that's just a separate

2038
01:16:06,800 --> 01:16:10,400
problem that we have to fix and maybe

2039
01:16:08,800 --> 01:16:13,440
that that was that could be our only

2040
01:16:10,399 --> 01:16:16,000
problem probably not but it could be

2041
01:16:13,439 --> 01:16:19,279
so uh when we actually create these room

2042
01:16:16,000 --> 01:16:21,198
bounds i guess i'm not sure

2043
01:16:19,279 --> 01:16:23,679
where we were doing that in the room gen

2044
01:16:21,198 --> 01:16:25,919
code uh obviously when we create this

2045
01:16:23,679 --> 01:16:27,359
stuff

2046
01:16:25,920 --> 01:16:30,480
we're sort of procedurally generating

2047
01:16:27,359 --> 01:16:31,279
these things so we don't really uh have

2048
01:16:30,479 --> 01:16:32,559
any

2049
01:16:31,279 --> 01:16:33,599
particular

2050
01:16:32,560 --> 01:16:35,760
you know

2051
01:16:33,600 --> 01:16:37,440
we never really thought very much about

2052
01:16:35,760 --> 01:16:39,280
where they would be in z because again

2053
01:16:37,439 --> 01:16:41,119
we were never thinking that it would

2054
01:16:39,279 --> 01:16:41,840
just be flat plane

2055
01:16:41,119 --> 01:16:44,640
so

2056
01:16:41,840 --> 01:16:45,520
i don't actually know yeah like how this

2057
01:16:44,640 --> 01:16:48,400
uh

2058
01:16:45,520 --> 01:16:52,480
this particular thing is set up to work

2059
01:16:48,399 --> 01:16:54,079
so uh you know one thing i might say too

2060
01:16:52,479 --> 01:16:55,198
we probably do want to adjust this but

2061
01:16:54,079 --> 01:16:58,158
the other thing we would probably want

2062
01:16:55,198 --> 01:17:01,359
to do is when we take a look at that

2063
01:16:58,158 --> 01:17:05,119
update uh camera for entity movement

2064
01:17:01,359 --> 01:17:07,839
when we're looking at the test bounds we

2065
01:17:05,119 --> 01:17:10,319
probably don't want to use z anymore

2066
01:17:07,840 --> 01:17:14,159
either for that inclusion test i mean

2067
01:17:10,319 --> 01:17:17,679
really we probably just want to

2068
01:17:14,158 --> 01:17:19,279
uh consider anything in the x y uh

2069
01:17:17,679 --> 01:17:21,440
just just use x y is the thing that

2070
01:17:19,279 --> 01:17:23,359
determines whether you're in it or not

2071
01:17:21,439 --> 01:17:25,039
right um but

2072
01:17:23,359 --> 01:17:28,238
so if we take a look at how the layout

2073
01:17:25,039 --> 01:17:29,439
code works here uh you can see us making

2074
01:17:28,238 --> 01:17:31,119
sort of these

2075
01:17:29,439 --> 01:17:32,960
you know volume

2076
01:17:31,119 --> 01:17:34,238
creation for rooms here

2077
01:17:32,960 --> 01:17:35,920
uh

2078
01:17:34,238 --> 01:17:36,959
when we actually go to set the collision

2079
01:17:35,920 --> 01:17:39,920
volume

2080
01:17:36,960 --> 01:17:41,198
uh of a room which i assume

2081
01:17:39,920 --> 01:17:44,079
may be

2082
01:17:41,198 --> 01:17:46,079
in the room gen code i'm not sure who

2083
01:17:44,079 --> 01:17:46,960
sets the actual

2084
01:17:46,079 --> 01:17:48,640
room

2085
01:17:46,960 --> 01:17:50,719
like who actually creates the room

2086
01:17:48,640 --> 01:17:52,000
collision volume itself

2087
01:17:50,719 --> 01:17:53,039
uh

2088
01:17:52,000 --> 01:17:55,439
this

2089
01:17:53,039 --> 01:17:57,600
is not it uh

2090
01:17:55,439 --> 01:17:58,059
camera room

2091
01:17:57,600 --> 01:18:01,119
so

2092
01:17:58,060 --> 01:18:01,119
[Music]

2093
01:18:04,960 --> 01:18:11,480
you can see

2094
01:18:06,800 --> 01:18:11,480
the get room volume call

2095
01:18:12,800 --> 01:18:16,719
and

2096
01:18:14,000 --> 01:18:18,000
it returns the room dim

2097
01:18:16,719 --> 01:18:21,840
here

2098
01:18:18,000 --> 01:18:25,198
uh and uses the camera room p here which

2099
01:18:21,840 --> 01:18:29,039
is getting the center of the room volume

2100
01:18:25,198 --> 01:18:32,799
so when we set this room

2101
01:18:29,039 --> 01:18:35,198
you know this this whole thing again is

2102
01:18:32,800 --> 01:18:35,199
um

2103
01:18:35,600 --> 01:18:40,239
this whole thing here is is all using

2104
01:18:38,158 --> 01:18:42,479
this rectangle three setting this room

2105
01:18:40,238 --> 01:18:45,759
dimension here

2106
01:18:42,479 --> 01:18:45,759
is probably wrong

2107
01:18:46,158 --> 01:18:50,479
yeah you can kind of see like how this

2108
01:18:48,238 --> 01:18:53,479
is getting set right

2109
01:18:50,479 --> 01:18:53,479
um

2110
01:19:03,119 --> 01:19:07,439
so

2111
01:19:04,158 --> 01:19:09,119
really the z bounds on the room dim and

2112
01:19:07,439 --> 01:19:10,960
i think you know i'm taking this really

2113
01:19:09,119 --> 01:19:12,399
slow but again i want to rip out a lot

2114
01:19:10,960 --> 01:19:14,399
of this code because it's complexity

2115
01:19:12,399 --> 01:19:17,519
that doesn't need to be there

2116
01:19:14,399 --> 01:19:19,519
um but if we take a look at how the room

2117
01:19:17,520 --> 01:19:21,199
dimension stuff is working now you can

2118
01:19:19,520 --> 01:19:24,719
kind of see that like we don't really

2119
01:19:21,198 --> 01:19:25,759
want room dims to exist in this way

2120
01:19:24,719 --> 01:19:30,640
anyway

2121
01:19:25,760 --> 01:19:31,440
right uh so like the min room p max room

2122
01:19:30,640 --> 01:19:33,840
p

2123
01:19:31,439 --> 01:19:35,759
uh stuff here where we do

2124
01:19:33,840 --> 01:19:36,960
you know where we where we adjust this

2125
01:19:35,760 --> 01:19:38,719
stuff

2126
01:19:36,960 --> 01:19:40,640
um

2127
01:19:38,719 --> 01:19:44,158
you can kind of see that the z is just

2128
01:19:40,640 --> 01:19:47,679
not what we want right um so when we

2129
01:19:44,158 --> 01:19:51,839
actually come up with the room dim here

2130
01:19:47,679 --> 01:19:54,239
this stuff is just not this is not

2131
01:19:51,840 --> 01:19:54,239
helping

2132
01:19:55,198 --> 01:19:58,719
so

2133
01:19:56,880 --> 01:20:00,239
presumably this most straightforward

2134
01:19:58,719 --> 01:20:02,719
thing to do

2135
01:20:00,238 --> 01:20:04,799
would be to

2136
01:20:02,719 --> 01:20:06,560
although you can see the add radius to

2137
01:20:04,800 --> 01:20:08,159
it's weird there's like a grid region

2138
01:20:06,560 --> 01:20:09,039
versus a grid rack this is this is a bit

2139
01:20:08,158 --> 01:20:11,279
weird

2140
01:20:09,039 --> 01:20:12,158
but you know if you imagine the room dim

2141
01:20:11,279 --> 01:20:14,158
here

2142
01:20:12,158 --> 01:20:15,920
uh

2143
01:20:14,158 --> 01:20:17,599
if we just move

2144
01:20:15,920 --> 01:20:21,279
the min room p

2145
01:20:17,600 --> 01:20:21,280
uh z or you know

2146
01:20:22,000 --> 01:20:25,359
we could probably just do this

2147
01:20:27,840 --> 01:20:32,480
so if we want to add you know a radius

2148
01:20:31,198 --> 01:20:36,879
of

2149
01:20:32,479 --> 01:20:40,319
you know a z value of like five in both

2150
01:20:36,880 --> 01:20:41,840
directions to make the room larger right

2151
01:20:40,319 --> 01:20:45,238
uh we

2152
01:20:41,840 --> 01:20:45,239
what is this

2153
01:20:46,238 --> 01:20:49,359
looks like a typo there

2154
01:20:47,840 --> 01:20:51,600
there we go

2155
01:20:49,359 --> 01:20:51,599
um

2156
01:20:51,840 --> 01:20:55,760
we should be good to go right

2157
01:20:54,238 --> 01:20:56,718
and let me take a look at this code now

2158
01:20:55,760 --> 01:20:58,480
again

2159
01:20:56,719 --> 01:21:01,520
yeah so now it does correctly find a

2160
01:20:58,479 --> 01:21:03,279
room and in theory uh we would now have

2161
01:21:01,520 --> 01:21:05,199
an actual camera position so let's just

2162
01:21:03,279 --> 01:21:07,920
take a quick look at that

2163
01:21:05,198 --> 01:21:08,879
before we go any further okay

2164
01:21:07,920 --> 01:21:11,279
so

2165
01:21:08,880 --> 01:21:12,560
now it looks like everything's square so

2166
01:21:11,279 --> 01:21:14,639
it looks like the problem that we were

2167
01:21:12,560 --> 01:21:16,400
having before was just that yeah you

2168
01:21:14,639 --> 01:21:18,719
weren't considered to really be in a

2169
01:21:16,399 --> 01:21:18,719
room

2170
01:21:19,359 --> 01:21:24,079
but now all of the bounds appear correct

2171
01:21:21,760 --> 01:21:26,560
and wow check out that frame rate this

2172
01:21:24,079 --> 01:21:28,719
is the debug build

2173
01:21:26,560 --> 01:21:30,639
talk about the lighting getting faster

2174
01:21:28,719 --> 01:21:31,920
remember how slow the debug use build

2175
01:21:30,639 --> 01:21:35,679
used to be

2176
01:21:31,920 --> 01:21:37,679
switching from 3d to 2d not in just in

2177
01:21:35,679 --> 01:21:38,639
terms of world complexity

2178
01:21:37,679 --> 01:21:40,158
pays

2179
01:21:38,639 --> 01:21:43,440
a lot of dividends

2180
01:21:40,158 --> 01:21:45,679
uh it's it's not subtle right

2181
01:21:43,439 --> 01:21:48,638
um

2182
01:21:45,679 --> 01:21:50,880
it's not subtle yeah

2183
01:21:48,639 --> 01:21:50,880
so

2184
01:21:52,880 --> 01:21:58,239
uh here's the the lighting again let me

2185
01:21:56,319 --> 01:22:01,279
let me just take a look here at

2186
01:21:58,238 --> 01:22:03,359
i'm curious now profile wise

2187
01:22:01,279 --> 01:22:06,479
yeah i mean we're like we're like locked

2188
01:22:03,359 --> 01:22:07,519
60 frames a second easily now

2189
01:22:06,479 --> 01:22:09,519
um

2190
01:22:07,520 --> 01:22:11,120
and we haven't done anything like all we

2191
01:22:09,520 --> 01:22:13,520
did was reduce

2192
01:22:11,119 --> 01:22:16,719
the the lighting computation to to

2193
01:22:13,520 --> 01:22:18,159
uh being the 2d portion and you know

2194
01:22:16,719 --> 01:22:19,198
off you go

2195
01:22:18,158 --> 01:22:20,559
um

2196
01:22:19,198 --> 01:22:22,158
so we're still

2197
01:22:20,560 --> 01:22:23,760
we still haven't done a lot of the stuff

2198
01:22:22,158 --> 01:22:24,879
we want to do here but we're getting

2199
01:22:23,760 --> 01:22:25,270
closer

2200
01:22:24,880 --> 01:22:27,199
um

2201
01:22:25,270 --> 01:22:29,440
[Music]

2202
01:22:27,198 --> 01:22:30,960
so that's good we now have to fix like

2203
01:22:29,439 --> 01:22:32,319
our fog so do you see how there's like a

2204
01:22:30,960 --> 01:22:33,840
haze

2205
01:22:32,319 --> 01:22:36,559
over the world here

2206
01:22:33,840 --> 01:22:38,480
our fog parameters are now kind of set

2207
01:22:36,560 --> 01:22:40,320
incorrectly because

2208
01:22:38,479 --> 01:22:41,198
we're not really taking any care to set

2209
01:22:40,319 --> 01:22:43,840
them

2210
01:22:41,198 --> 01:22:46,479
and you know we don't necessarily want

2211
01:22:43,840 --> 01:22:47,760
to get rid of the fog code because

2212
01:22:46,479 --> 01:22:51,279
we don't really know if we're going to

2213
01:22:47,760 --> 01:22:52,960
want you know stuff like that

2214
01:22:51,279 --> 01:22:54,800
you know just a simple way to like add

2215
01:22:52,960 --> 01:22:56,480
some fog in the game or whatever we

2216
01:22:54,800 --> 01:22:59,760
wanted to be able to do stuff like that

2217
01:22:56,479 --> 01:23:01,439
potentially um so my suspicion would be

2218
01:22:59,760 --> 01:23:02,639
that we don't really want to eliminate

2219
01:23:01,439 --> 01:23:05,039
that uh

2220
01:23:02,639 --> 01:23:06,400
you know out of out of hand so

2221
01:23:05,039 --> 01:23:10,560
next thing's next

2222
01:23:06,399 --> 01:23:12,479
uh we want to go set that fog code

2223
01:23:10,560 --> 01:23:14,800
so that we don't um

2224
01:23:12,479 --> 01:23:16,799
so that it's properly bounded to a

2225
01:23:14,800 --> 01:23:18,320
reasonable region around where we're

2226
01:23:16,800 --> 01:23:21,360
actually looking uh

2227
01:23:18,319 --> 01:23:24,880
in the world right so you can see here

2228
01:23:21,359 --> 01:23:28,559
here's our our fog value stuff and

2229
01:23:24,880 --> 01:23:31,679
my assumption would be that

2230
01:23:28,560 --> 01:23:34,719
uh since we know the expected focus z

2231
01:23:31,679 --> 01:23:37,920
presumably we can use that

2232
01:23:34,719 --> 01:23:40,000
i you know we we are computing

2233
01:23:37,920 --> 01:23:43,359
um

2234
01:23:40,000 --> 01:23:45,529
a real focus z value now right uh that

2235
01:23:43,359 --> 01:23:46,839
that we're using

2236
01:23:45,529 --> 01:23:50,479
[Music]

2237
01:23:46,840 --> 01:23:50,480
to um to

2238
01:23:52,158 --> 01:23:55,359
we are we are computing the expected

2239
01:23:53,840 --> 01:23:57,840
focus z value and we're producing we're

2240
01:23:55,359 --> 01:24:00,559
producing it correctly right

2241
01:23:57,840 --> 01:24:02,800
so up here it's it's free for us to just

2242
01:24:00,560 --> 01:24:03,840
say well we can do that right off the

2243
01:24:02,800 --> 01:24:05,840
bat

2244
01:24:03,840 --> 01:24:08,400
and then we can sort of like set the

2245
01:24:05,840 --> 01:24:08,400
fogging

2246
01:24:08,479 --> 01:24:14,479
properly based on that so again i don't

2247
01:24:11,279 --> 01:24:16,079
really know what these values want to be

2248
01:24:14,479 --> 01:24:18,238
but we can certainly set them to

2249
01:24:16,079 --> 01:24:21,279
something more sane for the immediate

2250
01:24:18,238 --> 01:24:22,718
moment uh than what we were doing before

2251
01:24:21,279 --> 01:24:25,198
right

2252
01:24:22,719 --> 01:24:26,880
now we do need the camera z value

2253
01:24:25,198 --> 01:24:28,839
uh which it looks like we don't extract

2254
01:24:26,880 --> 01:24:31,600
yet at this point

2255
01:24:28,840 --> 01:24:32,560
um so we just have to move that down

2256
01:24:31,600 --> 01:24:34,079
below

2257
01:24:32,560 --> 01:24:35,520
uh maybe

2258
01:24:34,079 --> 01:24:36,880
keep these things together like here's

2259
01:24:35,520 --> 01:24:38,480
where we extract camera values and

2260
01:24:36,880 --> 01:24:40,960
here's where we compute

2261
01:24:38,479 --> 01:24:42,000
values dependent on those

2262
01:24:40,960 --> 01:24:43,359
um

2263
01:24:42,000 --> 01:24:44,960
but yeah

2264
01:24:43,359 --> 01:24:47,119
and and maybe i'll delete this to do as

2265
01:24:44,960 --> 01:24:48,719
well because we we we don't know that

2266
01:24:47,119 --> 01:24:52,000
zoom out very like the camera does pull

2267
01:24:48,719 --> 01:24:55,679
back and and zoom in we're not going to

2268
01:24:52,000 --> 01:24:57,359
remove that uh particular value right

2269
01:24:55,679 --> 01:25:00,960
um so now we can see we don't have the

2270
01:24:57,359 --> 01:25:03,519
weird fog overlay um because you know

2271
01:25:00,960 --> 01:25:05,039
like as you can see uh we've we've

2272
01:25:03,520 --> 01:25:07,120
recomputed the value to be to more

2273
01:25:05,039 --> 01:25:09,679
correct so the fog code's still in there

2274
01:25:07,119 --> 01:25:13,359
in case you want to use it uh but now

2275
01:25:09,679 --> 01:25:16,079
it's you know it's not having the same

2276
01:25:13,359 --> 01:25:18,960
uh erroneous range computation

2277
01:25:16,079 --> 01:25:21,760
so you know we're slowly but surely

2278
01:25:18,960 --> 01:25:24,800
moving towards where we want to be um

2279
01:25:21,760 --> 01:25:27,199
and let's go ahead now and

2280
01:25:24,800 --> 01:25:28,800
yeah and keep going forwards along this

2281
01:25:27,198 --> 01:25:31,359
axis

2282
01:25:28,800 --> 01:25:33,679
so we still have a bunch of things that

2283
01:25:31,359 --> 01:25:36,559
we need to work out

2284
01:25:33,679 --> 01:25:39,279
so one of the problems that we will have

2285
01:25:36,560 --> 01:25:41,679
right now is that we don't actually have

2286
01:25:39,279 --> 01:25:43,519
any coherent theory for where the light

2287
01:25:41,679 --> 01:25:45,679
probes are placed

2288
01:25:43,520 --> 01:25:47,440
relative to

2289
01:25:45,679 --> 01:25:49,679
where the

2290
01:25:47,439 --> 01:25:51,919
actual geometry is right

2291
01:25:49,679 --> 01:25:53,760
so we're not really taking any special

2292
01:25:51,920 --> 01:25:56,079
care like right now we're not even

2293
01:25:53,760 --> 01:25:57,760
drawing where those light probes are so

2294
01:25:56,079 --> 01:26:00,479
we have no idea like where these light

2295
01:25:57,760 --> 01:26:03,039
probes are located and you know probably

2296
01:26:00,479 --> 01:26:04,959
we want them to be aligned to this grid

2297
01:26:03,039 --> 01:26:07,439
in some way or you know we want them to

2298
01:26:04,960 --> 01:26:09,119
be doing something intelligent

2299
01:26:07,439 --> 01:26:11,599
as to where they are and we don't really

2300
01:26:09,119 --> 01:26:16,238
know uh what that is at the moment and

2301
01:26:11,600 --> 01:26:16,239
with specific uh specifically

2302
01:26:16,479 --> 01:26:22,399
we want to make sure that the z height

2303
01:26:19,039 --> 01:26:24,560
like where the probes are located in z

2304
01:26:22,399 --> 01:26:27,359
is going to be pretty important because

2305
01:26:24,560 --> 01:26:29,520
we know that we're only computing two so

2306
01:26:27,359 --> 01:26:32,000
we would probably you know all things

2307
01:26:29,520 --> 01:26:35,120
being equal we would like our z probes

2308
01:26:32,000 --> 01:26:37,520
probably one at around floor height like

2309
01:26:35,119 --> 01:26:39,519
a little bit above the floor and one

2310
01:26:37,520 --> 01:26:41,920
like a little bit below the ceiling or

2311
01:26:39,520 --> 01:26:44,400
something is probably where we want them

2312
01:26:41,920 --> 01:26:46,560
because anywhere else is really just not

2313
01:26:44,399 --> 01:26:49,039
giving us very much valuable information

2314
01:26:46,560 --> 01:26:51,199
because we know that everywhere

2315
01:26:49,039 --> 01:26:55,920
that we sample these light probes is

2316
01:26:51,198 --> 01:26:55,919
going to be basically in that area right

2317
01:27:01,039 --> 01:27:05,519
so there wouldn't really be much of a

2318
01:27:02,639 --> 01:27:06,960
point to it if we place them in any

2319
01:27:05,520 --> 01:27:09,040
other way

2320
01:27:06,960 --> 01:27:10,880
so what we probably want to do is now

2321
01:27:09,039 --> 01:27:14,238
actually go make sure that that

2322
01:27:10,880 --> 01:27:17,920
placement is at least somewhat

2323
01:27:14,238 --> 01:27:19,599
uh sane right and i don't really know uh

2324
01:27:17,920 --> 01:27:22,079
to what extent we left in the code for

2325
01:27:19,600 --> 01:27:26,159
showing where those uh atlases actually

2326
01:27:22,079 --> 01:27:28,000
are uh but i think we had some

2327
01:27:26,158 --> 01:27:30,479
code in there for that

2328
01:27:28,000 --> 01:27:32,719
uh at some point but i guess i don't

2329
01:27:30,479 --> 01:27:34,718
really remember

2330
01:27:32,719 --> 01:27:37,600
so sorry about that

2331
01:27:34,719 --> 01:27:40,319
um so let's take a quick look let's see

2332
01:27:37,600 --> 01:27:42,480
do we have any code for this i don't

2333
01:27:40,319 --> 01:27:45,479
know if we do

2334
01:27:42,479 --> 01:27:45,479
um

2335
01:27:46,238 --> 01:27:52,759
it looks like draw

2336
01:27:48,238 --> 01:27:52,759
debug draw octahedral values

2337
01:27:54,639 --> 01:27:57,840
he sort of does that

2338
01:27:58,319 --> 01:28:03,279
so we could use that

2339
01:28:00,880 --> 01:28:05,600
that looks like basically what we've got

2340
01:28:03,279 --> 01:28:05,599
um

2341
01:28:11,520 --> 01:28:16,480
that looks like what we'd

2342
01:28:13,198 --> 01:28:16,479
what we'd mostly be looking at

2343
01:28:24,719 --> 01:28:31,359
so yeah i don't really

2344
01:28:26,840 --> 01:28:34,079
know uh but i think that's probably the

2345
01:28:31,359 --> 01:28:35,119
most sane one

2346
01:28:34,079 --> 01:28:37,679
so

2347
01:28:35,119 --> 01:28:40,479
yeah like maybe we call

2348
01:28:37,679 --> 01:28:42,880
maybe we try to actually just call debug

2349
01:28:40,479 --> 01:28:43,678
draw octahedral values

2350
01:28:42,880 --> 01:28:45,920
i

2351
01:28:43,679 --> 01:28:49,119
and

2352
01:28:45,920 --> 01:28:49,119
yeah i mean i don't know

2353
01:28:49,279 --> 01:28:52,319
debug draw

2354
01:28:53,279 --> 01:28:57,000
octahedral values

2355
01:28:59,760 --> 01:29:05,679
so it looks like at least we'd seem to

2356
01:29:02,238 --> 01:29:07,198
think that that's a plausible call that

2357
01:29:05,679 --> 01:29:09,199
we could make

2358
01:29:07,198 --> 01:29:11,439
um so i'll

2359
01:29:09,198 --> 01:29:14,559
you know try running it

2360
01:29:11,439 --> 01:29:14,559
and we'll see what happens

2361
01:29:16,719 --> 01:29:19,679
it looks like we don't have

2362
01:29:18,880 --> 01:29:22,079
uh

2363
01:29:19,679 --> 01:29:22,079
enough

2364
01:29:22,719 --> 01:29:26,158
so let me let me actually

2365
01:29:24,719 --> 01:29:29,158
see where that assertion actually is

2366
01:29:26,158 --> 01:29:29,158
firing

2367
01:29:41,600 --> 01:29:47,159
i like the new timer what do you guys

2368
01:29:43,039 --> 01:29:47,158
think of the new timer by the way

2369
01:29:53,119 --> 01:29:56,719
i just want to see where this is

2370
01:29:54,238 --> 01:29:56,718
complaining

2371
01:30:02,800 --> 01:30:08,159
uh so it looks like actually this is

2372
01:30:05,359 --> 01:30:10,479
just kind of messed up though

2373
01:30:08,158 --> 01:30:10,479
um

2374
01:30:10,719 --> 01:30:15,760
like the get tile unclamped is

2375
01:30:13,760 --> 01:30:17,440
maybe bogus

2376
01:30:15,760 --> 01:30:19,119
right so it's like this is actually just

2377
01:30:17,439 --> 01:30:22,158
kind of buggy what's the

2378
01:30:19,119 --> 01:30:24,158
what's the deal here well that's

2379
01:30:22,158 --> 01:30:28,039
obviously wrong

2380
01:30:24,158 --> 01:30:28,039
uh hold on a second

2381
01:30:36,319 --> 01:30:38,719
okay

2382
01:30:37,600 --> 01:30:41,120
yeah

2383
01:30:38,719 --> 01:30:41,119
um

2384
01:30:42,000 --> 01:30:44,158
uh

2385
01:30:42,960 --> 01:30:45,039
yeah no

2386
01:30:44,158 --> 01:30:47,119
so

2387
01:30:45,039 --> 01:30:50,079
let's uh let's

2388
01:30:47,119 --> 01:30:52,719
fix this code uh cause this is just

2389
01:30:50,079 --> 01:30:54,238
picking complete garbage values i'm

2390
01:30:52,719 --> 01:30:56,239
gonna go ahead and say that now that we

2391
01:30:54,238 --> 01:30:58,079
don't have stacks of these things maybe

2392
01:30:56,238 --> 01:30:59,599
we can draw them all

2393
01:30:58,079 --> 01:31:01,439
because there wouldn't be too many for

2394
01:30:59,600 --> 01:31:02,800
debugging purposes i don't know that

2395
01:31:01,439 --> 01:31:06,238
maybe too much

2396
01:31:02,800 --> 01:31:08,960
uh i'm not sure uh but if we

2397
01:31:06,238 --> 01:31:12,479
if we did say something like this for

2398
01:31:08,960 --> 01:31:16,399
starters that's an easy solution

2399
01:31:12,479 --> 01:31:18,799
to to the problem

2400
01:31:16,399 --> 01:31:18,799
um

2401
01:31:22,880 --> 01:31:25,920
because yeah that so that was just some

2402
01:31:24,079 --> 01:31:28,559
random debug code that picked arbitrary

2403
01:31:25,920 --> 01:31:31,600
placement yeah so there we can see uh in

2404
01:31:28,560 --> 01:31:34,400
theory those those uh locations

2405
01:31:31,600 --> 01:31:35,760
let's go ahead and and switch back to o2

2406
01:31:34,399 --> 01:31:36,638
so we don't really have to debug that

2407
01:31:35,760 --> 01:31:39,440
now

2408
01:31:36,639 --> 01:31:41,840
um and we can kind of see where these uh

2409
01:31:39,439 --> 01:31:44,079
voxel values are sitting so

2410
01:31:41,840 --> 01:31:45,760
you know here's the here's the lighting

2411
01:31:44,079 --> 01:31:48,158
voxel

2412
01:31:45,760 --> 01:31:49,520
uh you can see that it's

2413
01:31:48,158 --> 01:31:51,439
it's actually not

2414
01:31:49,520 --> 01:31:56,400
bad like

2415
01:31:51,439 --> 01:31:57,519
uh that's a pretty reasonable placement

2416
01:31:56,399 --> 01:32:00,238
for these

2417
01:31:57,520 --> 01:32:00,720
uh i would say actually

2418
01:32:00,238 --> 01:32:02,000
um

2419
01:32:00,720 --> 01:32:04,079
[Music]

2420
01:32:02,000 --> 01:32:05,198
it's it's not bad

2421
01:32:04,079 --> 01:32:07,600
my

2422
01:32:05,198 --> 01:32:08,559
main complaint with it

2423
01:32:07,600 --> 01:32:10,079
would be

2424
01:32:08,560 --> 01:32:10,420
that

2425
01:32:10,079 --> 01:32:11,600
the

2426
01:32:10,420 --> 01:32:13,359
[Music]

2427
01:32:11,600 --> 01:32:14,960
at least currently

2428
01:32:13,359 --> 01:32:16,158
they're too high

2429
01:32:14,960 --> 01:32:17,279
i think

2430
01:32:16,158 --> 01:32:21,839
um

2431
01:32:17,279 --> 01:32:21,840
so you know maybe they would want to be

2432
01:32:23,600 --> 01:32:28,079
i don't know are they too high maybe

2433
01:32:26,158 --> 01:32:29,679
that's that's not true also the fact

2434
01:32:28,079 --> 01:32:31,760
that there's that few of them i think

2435
01:32:29,679 --> 01:32:33,520
also we probably can just do this i i

2436
01:32:31,760 --> 01:32:34,880
don't know that we need

2437
01:32:33,520 --> 01:32:37,679
um

2438
01:32:34,880 --> 01:32:39,199
the to to clip out

2439
01:32:37,679 --> 01:32:41,359
that many of them we might just be able

2440
01:32:39,198 --> 01:32:42,479
to draw them all now

2441
01:32:41,359 --> 01:32:43,679
um

2442
01:32:42,479 --> 01:32:46,158
i lied

2443
01:32:43,679 --> 01:32:48,319
all right you know hey

2444
01:32:46,158 --> 01:32:50,879
what can i say i was i was being overly

2445
01:32:48,319 --> 01:32:50,880
optimistic

2446
01:32:51,359 --> 01:32:56,479
let's try a quarter of them

2447
01:32:54,639 --> 01:32:57,600
there we go

2448
01:32:56,479 --> 01:32:59,519
uh

2449
01:32:57,600 --> 01:33:02,000
so you know okay so you can see all the

2450
01:32:59,520 --> 01:33:03,440
light probes there they are

2451
01:33:02,000 --> 01:33:06,000
and you can see the lighting

2452
01:33:03,439 --> 01:33:06,799
computations that they've got

2453
01:33:06,000 --> 01:33:09,679
uh

2454
01:33:06,800 --> 01:33:11,600
i would note that

2455
01:33:09,679 --> 01:33:14,079
there seems to be some pretty weird

2456
01:33:11,600 --> 01:33:16,639
stuff going on so so i think we have

2457
01:33:14,079 --> 01:33:19,439
some kind of buggy behavior

2458
01:33:16,639 --> 01:33:22,639
occurring in here which you know

2459
01:33:19,439 --> 01:33:25,678
uh we'll have to investigate

2460
01:33:22,639 --> 01:33:27,600
but like if you look at some of these

2461
01:33:25,679 --> 01:33:29,520
light probes some of them don't make a

2462
01:33:27,600 --> 01:33:30,880
whole lot of sense so

2463
01:33:29,520 --> 01:33:33,440
it may be because there's hidden

2464
01:33:30,880 --> 01:33:35,520
occluders uh in the ceiling area or

2465
01:33:33,439 --> 01:33:37,519
something that that may be occurring

2466
01:33:35,520 --> 01:33:40,000
here right

2467
01:33:37,520 --> 01:33:42,000
uh so i'm not sure but like it's not

2468
01:33:40,000 --> 01:33:43,840
there isn't a lot of

2469
01:33:42,000 --> 01:33:46,319
of explanation

2470
01:33:43,840 --> 01:33:47,679
as to why that voxel is not picking up

2471
01:33:46,319 --> 01:33:48,799
any light

2472
01:33:47,679 --> 01:33:51,119
right

2473
01:33:48,800 --> 01:33:52,880
so it looks a bit

2474
01:33:51,119 --> 01:33:55,198
it looks like we've got some additional

2475
01:33:52,880 --> 01:33:56,000
buggy behavior going on in there

2476
01:33:55,198 --> 01:33:58,559
that

2477
01:33:56,000 --> 01:33:59,840
you know these things are not quite sam

2478
01:33:58,560 --> 01:34:02,400
they're not quite stepping through the

2479
01:33:59,840 --> 01:34:05,679
world correctly or something right

2480
01:34:02,399 --> 01:34:08,319
there's no there's something amiss

2481
01:34:05,679 --> 01:34:10,800
uh in in in there right

2482
01:34:08,319 --> 01:34:13,039
and one thing i can do is is draw those

2483
01:34:10,800 --> 01:34:16,239
occluders it may just be a case of like

2484
01:34:13,039 --> 01:34:18,960
uh floating point jitter but

2485
01:34:16,238 --> 01:34:20,959
let me go ahead and draw those uh

2486
01:34:18,960 --> 01:34:24,158
occluders a little bit better so that we

2487
01:34:20,960 --> 01:34:26,480
can um see them more cleanly

2488
01:34:24,158 --> 01:34:29,439
so if we were to do that

2489
01:34:26,479 --> 01:34:31,359
that would be in the collision code so

2490
01:34:29,439 --> 01:34:33,678
in the in the collision drawing code if

2491
01:34:31,359 --> 01:34:34,639
we just turned that on

2492
01:34:33,679 --> 01:34:35,520
i

2493
01:34:34,639 --> 01:34:37,520
like

2494
01:34:35,520 --> 01:34:40,520
you know

2495
01:34:37,520 --> 01:34:40,520
here

2496
01:34:47,039 --> 01:34:52,238
so this lets us kind of see

2497
01:34:49,279 --> 01:34:54,559
uh how this stuff is set up um

2498
01:34:52,238 --> 01:34:56,559
but you know

2499
01:34:54,560 --> 01:34:59,199
if you just look at this you can tell

2500
01:34:56,560 --> 01:35:00,560
immediately like that's just wrong

2501
01:34:59,198 --> 01:35:02,799
you know what i mean

2502
01:35:00,560 --> 01:35:04,239
like there's no way that's a correct

2503
01:35:02,800 --> 01:35:05,840
lighting value you know these things

2504
01:35:04,238 --> 01:35:08,238
can't all be picking up the light that's

2505
01:35:05,840 --> 01:35:10,400
right here and this this is not

2506
01:35:08,238 --> 01:35:13,118
so we've got some buggy behavior

2507
01:35:10,399 --> 01:35:15,279
happening now uh and you know again this

2508
01:35:13,118 --> 01:35:16,960
is probably as we kind of go through and

2509
01:35:15,279 --> 01:35:19,198
try to clean out

2510
01:35:16,960 --> 01:35:21,359
uh the way that this stuff is being

2511
01:35:19,198 --> 01:35:23,439
computed we're gonna have to

2512
01:35:21,359 --> 01:35:24,880
deal with the fact that these are

2513
01:35:23,439 --> 01:35:27,118
a little bit wrong now

2514
01:35:24,880 --> 01:35:30,319
one problem that we

2515
01:35:27,118 --> 01:35:31,920
be looking at here is when we

2516
01:35:30,319 --> 01:35:33,118
changed the way that the tiles were

2517
01:35:31,920 --> 01:35:33,920
being

2518
01:35:33,118 --> 01:35:35,839
uh

2519
01:35:33,920 --> 01:35:39,199
aligned we changed so that they were

2520
01:35:35,840 --> 01:35:41,199
aligned on their center points now which

2521
01:35:39,198 --> 01:35:43,759
means that like the lighting voxel is

2522
01:35:41,198 --> 01:35:45,279
shifted a half tile relative to where it

2523
01:35:43,760 --> 01:35:48,400
was they used to be in the centers of

2524
01:35:45,279 --> 01:35:51,519
tiles now they're on the corners right

2525
01:35:48,399 --> 01:35:52,960
now that may actually be desirable so i

2526
01:35:51,520 --> 01:35:54,000
don't know that i necessarily want to

2527
01:35:52,960 --> 01:35:57,439
fix that

2528
01:35:54,000 --> 01:35:58,719
because i may want to have them uh

2529
01:35:57,439 --> 01:36:00,479
exactly

2530
01:35:58,719 --> 01:36:02,880
exactly in that configuration that that

2531
01:36:00,479 --> 01:36:04,638
may actually be exactly what i want

2532
01:36:02,880 --> 01:36:06,239
so what i'd rather do is sort of work

2533
01:36:04,639 --> 01:36:08,639
through the code and just clean up some

2534
01:36:06,238 --> 01:36:08,638
of these

2535
01:36:08,880 --> 01:36:12,480
some of whatever these errors are here

2536
01:36:10,719 --> 01:36:16,239
right like i wanna

2537
01:36:12,479 --> 01:36:17,678
uh i wanna fix that so that that i

2538
01:36:16,238 --> 01:36:21,118
uh

2539
01:36:17,679 --> 01:36:24,480
i wanna find out why we're getting uh

2540
01:36:21,118 --> 01:36:26,000
no lighting samples on some of these uh

2541
01:36:24,479 --> 01:36:28,238
grid points

2542
01:36:26,000 --> 01:36:30,960
in a very like suspicious regular

2543
01:36:28,238 --> 01:36:32,079
pattern right like you know

2544
01:36:30,960 --> 01:36:34,399
you

2545
01:36:32,079 --> 01:36:36,479
don't see any lighting values coming

2546
01:36:34,399 --> 01:36:39,519
from these for some reason but i don't

2547
01:36:36,479 --> 01:36:41,279
know why uh so that's like very

2548
01:36:39,520 --> 01:36:42,320
suspicious

2549
01:36:41,279 --> 01:36:43,599
right

2550
01:36:42,319 --> 01:36:46,559
um

2551
01:36:43,600 --> 01:36:49,039
big bright ball little tiny

2552
01:36:46,560 --> 01:36:52,159
little tiny not bright

2553
01:36:49,039 --> 01:36:53,600
you know what i mean

2554
01:36:52,158 --> 01:36:55,039
um so we clearly have some debugging

2555
01:36:53,600 --> 01:36:58,320
work to do there

2556
01:36:55,039 --> 01:37:01,840
uh but otherwise i think we're

2557
01:36:58,319 --> 01:37:04,079
getting into better shape right uh

2558
01:37:01,840 --> 01:37:05,039
we're we're slowly making progress here

2559
01:37:04,079 --> 01:37:06,479
towards something a little more

2560
01:37:05,039 --> 01:37:09,039
reasonable and

2561
01:37:06,479 --> 01:37:12,718
i do really like the fact that the frame

2562
01:37:09,039 --> 01:37:15,039
rate uh already is massively better

2563
01:37:12,719 --> 01:37:17,198
uh just from that one change to two

2564
01:37:15,039 --> 01:37:18,880
layered to two layers of light probes

2565
01:37:17,198 --> 01:37:20,399
instead of like you know the full depth

2566
01:37:18,880 --> 01:37:23,039
of them

2567
01:37:20,399 --> 01:37:26,158
so again making a lot of improvements

2568
01:37:23,039 --> 01:37:28,238
just by reducing from from 3d to 2d in

2569
01:37:26,158 --> 01:37:31,198
terms of world construction without

2570
01:37:28,238 --> 01:37:32,799
actually giving up the 3d nature of

2571
01:37:31,198 --> 01:37:35,118
what's happening on the screen as

2572
01:37:32,800 --> 01:37:36,960
apparent to the player in really much of

2573
01:37:35,118 --> 01:37:39,839
any way at all so i do think it's the

2574
01:37:36,960 --> 01:37:42,480
right call bang for the buck wise uh for

2575
01:37:39,840 --> 01:37:42,480
what we've got

2576
01:37:43,118 --> 01:37:49,839
okay uh so given that

2577
01:37:46,880 --> 01:37:49,840
uh

2578
01:37:50,800 --> 01:37:55,679
we have a bunch of things we want to do

2579
01:37:54,000 --> 01:37:57,920
and

2580
01:37:55,679 --> 01:37:57,920
uh

2581
01:37:58,000 --> 01:38:00,960
unfortunately i guess i'm not sure

2582
01:37:59,359 --> 01:38:03,118
exactly where

2583
01:38:00,960 --> 01:38:06,399
to start because we want to kind of go

2584
01:38:03,118 --> 01:38:08,238
through these systems one at a time

2585
01:38:06,399 --> 01:38:11,279
and kind of clean them up and button

2586
01:38:08,238 --> 01:38:11,279
them up a little bit right

2587
01:38:12,079 --> 01:38:17,118
and so we want to start removing

2588
01:38:14,800 --> 01:38:19,039
some of this complexity and

2589
01:38:17,118 --> 01:38:20,719
you know there's so much complexity to

2590
01:38:19,039 --> 01:38:23,920
pull out now

2591
01:38:20,719 --> 01:38:26,560
uh that i'm not really sure

2592
01:38:23,920 --> 01:38:28,880
where would be the most profitable place

2593
01:38:26,560 --> 01:38:31,199
uh to start

2594
01:38:28,880 --> 01:38:33,840
i think i'm fairly comfortable with the

2595
01:38:31,198 --> 01:38:36,960
decision because just looking at how

2596
01:38:33,840 --> 01:38:39,760
much performance benefit we got back

2597
01:38:36,960 --> 01:38:44,319
from just eliminating z layer

2598
01:38:39,760 --> 01:38:47,199
uh it's kind of crazy

2599
01:38:44,319 --> 01:38:48,559
if you think about how much of a savings

2600
01:38:47,198 --> 01:38:50,238
we're going to get in terms of code

2601
01:38:48,560 --> 01:38:52,480
complexity

2602
01:38:50,238 --> 01:38:54,718
uh if you even just look at the lighting

2603
01:38:52,479 --> 01:38:56,959
code we got that performance benefit

2604
01:38:54,719 --> 01:38:58,639
without actually optimizing with that

2605
01:38:56,960 --> 01:39:00,800
knowledge because one of the things that

2606
01:38:58,639 --> 01:39:02,639
you have to remember is we actually have

2607
01:39:00,800 --> 01:39:05,279
complete

2608
01:39:02,639 --> 01:39:08,400
light stepping tables

2609
01:39:05,279 --> 01:39:11,439
that include stepping in z so like the

2610
01:39:08,399 --> 01:39:13,759
compute walk table here

2611
01:39:11,439 --> 01:39:17,198
produces uh

2612
01:39:13,760 --> 01:39:18,719
values that include the possibility of

2613
01:39:17,198 --> 01:39:21,519
z-stepping

2614
01:39:18,719 --> 01:39:23,679
even though now there is no z-stepping

2615
01:39:21,520 --> 01:39:25,360
meaning we can just bend things in one

2616
01:39:23,679 --> 01:39:29,359
bin and z everywhere

2617
01:39:25,359 --> 01:39:33,359
and remove one entire type of voxel step

2618
01:39:29,359 --> 01:39:33,359
from the entire system right

2619
01:39:34,319 --> 01:39:40,639
so there's just a tremendous amount of

2620
01:39:38,479 --> 01:39:42,000
benefit we can get here

2621
01:39:40,639 --> 01:39:45,118
and

2622
01:39:42,000 --> 01:39:45,118
i'm just not sure

2623
01:39:48,238 --> 01:39:52,158
there's so many places we can improve by

2624
01:39:50,319 --> 01:39:53,519
making this simplifying change that it's

2625
01:39:52,158 --> 01:39:55,920
just kind of scary

2626
01:39:53,520 --> 01:39:58,320
uh because you know gosh where to start

2627
01:39:55,920 --> 01:40:00,560
and what's the right order to do it in

2628
01:39:58,319 --> 01:40:00,559
right

2629
01:40:01,439 --> 01:40:05,599
so i really just don't know um

2630
01:40:05,679 --> 01:40:10,319
and my guess would actually be

2631
01:40:09,118 --> 01:40:13,439
hmm

2632
01:40:10,319 --> 01:40:13,439
what would my guess be

2633
01:40:20,560 --> 01:40:25,760
my guess would be maybe we just

2634
01:40:33,359 --> 01:40:37,839
maybe we just say something like

2635
01:40:42,960 --> 01:40:50,359
we

2636
01:40:44,319 --> 01:40:50,359
now can just do straight yeah

2637
01:40:59,359 --> 01:41:05,599
if we're just regressing to a 2d

2638
01:41:02,840 --> 01:41:08,480
grid because now we know that we just

2639
01:41:05,600 --> 01:41:10,159
have a flat 2d grid and we can just do

2640
01:41:08,479 --> 01:41:13,919
all of our

2641
01:41:10,158 --> 01:41:13,920
computations on the 2d grid

2642
01:41:14,319 --> 01:41:17,679
we could

2643
01:41:16,399 --> 01:41:20,799
also

2644
01:41:17,679 --> 01:41:22,639
just say that from now on we don't

2645
01:41:20,800 --> 01:41:25,039
actually have to store a spatial

2646
01:41:22,639 --> 01:41:28,639
partition at all

2647
01:41:25,039 --> 01:41:29,519
our 2d grid is just stores what's the

2648
01:41:28,639 --> 01:41:34,159
height

2649
01:41:29,520 --> 01:41:34,159
of the occluder in that grid

2650
01:41:42,319 --> 01:41:45,319
right

2651
01:41:49,920 --> 01:41:53,279
i mean

2652
01:41:50,960 --> 01:41:55,118
the the amount of computational

2653
01:41:53,279 --> 01:41:56,639
complexity we could reduce there seems

2654
01:41:55,118 --> 01:41:58,479
pretty vast

2655
01:41:56,639 --> 01:42:00,400
because we could just say like look

2656
01:41:58,479 --> 01:42:02,158
we're locking down to the 2d grid now

2657
01:42:00,399 --> 01:42:04,960
and that's just how it's going to go

2658
01:42:02,158 --> 01:42:07,039
and then all of the like then all of our

2659
01:42:04,960 --> 01:42:09,439
raycasting could just be directly on the

2660
01:42:07,039 --> 01:42:10,800
2d grid and doesn't have to actually do

2661
01:42:09,439 --> 01:42:13,439
a pass where it even spatially

2662
01:42:10,800 --> 01:42:15,679
partitions anything anyway

2663
01:42:13,439 --> 01:42:17,118
because it doesn't need to anymore right

2664
01:42:15,679 --> 01:42:18,319
it knows it's just going to do grid

2665
01:42:17,118 --> 01:42:19,839
stepping

2666
01:42:18,319 --> 01:42:21,920
and the grid could just be unpacked

2667
01:42:19,840 --> 01:42:24,159
directly right

2668
01:42:21,920 --> 01:42:24,158
um

2669
01:42:25,679 --> 01:42:30,079
so it's really hard i mean man just

2670
01:42:28,238 --> 01:42:32,079
thinking this through

2671
01:42:30,079 --> 01:42:33,039
it's really hard to say

2672
01:42:32,079 --> 01:42:35,039
uh

2673
01:42:33,039 --> 01:42:38,079
the the amount of simplification we

2674
01:42:35,039 --> 01:42:38,880
could do there is so so vast

2675
01:42:38,079 --> 01:42:41,118
that

2676
01:42:38,880 --> 01:42:43,440
you know like i said that there's so

2677
01:42:41,118 --> 01:42:46,158
many potential options for us it's hard

2678
01:42:43,439 --> 01:42:50,238
to decide uh which one to pursue first

2679
01:42:46,158 --> 01:42:50,238
because they all seem good um

2680
01:42:50,319 --> 01:42:53,198
they all seem good

2681
01:42:52,000 --> 01:42:53,649
and

2682
01:42:53,198 --> 01:42:55,198
so

2683
01:42:53,649 --> 01:42:57,920
[Music]

2684
01:42:55,198 --> 01:43:00,079
i'm just a little bit paralyzed by too

2685
01:42:57,920 --> 01:43:02,000
many this is this is a good problem to

2686
01:43:00,079 --> 01:43:04,960
have i guess

2687
01:43:02,000 --> 01:43:08,158
uh too many good options at once means

2688
01:43:04,960 --> 01:43:09,679
it's hard to decide where to start and

2689
01:43:08,158 --> 01:43:12,158
starting on

2690
01:43:09,679 --> 01:43:14,239
picking a good order will pay dividends

2691
01:43:12,158 --> 01:43:15,439
because it will be less work overall if

2692
01:43:14,238 --> 01:43:17,439
you do it

2693
01:43:15,439 --> 01:43:18,960
in you know sort of a

2694
01:43:17,439 --> 01:43:21,759
good order

2695
01:43:18,960 --> 01:43:21,760
to begin with

2696
01:43:23,520 --> 01:43:25,840
okay

2697
01:43:26,079 --> 01:43:30,479
i guess first things first

2698
01:43:28,479 --> 01:43:33,279
i would like to find out why we have a

2699
01:43:30,479 --> 01:43:36,399
regular pattern of errant

2700
01:43:33,279 --> 01:43:38,399
sample drawing uh like what's going on

2701
01:43:36,399 --> 01:43:39,519
with these

2702
01:43:38,399 --> 01:43:42,319
uh

2703
01:43:39,520 --> 01:43:44,320
sample spheres why

2704
01:43:42,319 --> 01:43:46,319
are we getting this

2705
01:43:44,319 --> 01:43:48,639
odd like

2706
01:43:46,319 --> 01:43:48,639
you know

2707
01:43:49,840 --> 01:43:53,039
why why is there this fake sort of

2708
01:43:51,760 --> 01:43:55,119
occlusion

2709
01:43:53,039 --> 01:43:57,600
happening here where

2710
01:43:55,118 --> 01:43:59,359
you know you can kind of see that for

2711
01:43:57,600 --> 01:44:02,560
whatever reason the

2712
01:43:59,359 --> 01:44:04,319
there was no light hitting these samples

2713
01:44:02,560 --> 01:44:07,360
even though they're clearly pointing in

2714
01:44:04,319 --> 01:44:08,639
a direction where they should have hit

2715
01:44:07,359 --> 01:44:09,599
something

2716
01:44:08,639 --> 01:44:12,319
i mean

2717
01:44:09,600 --> 01:44:13,440
remember we're using indirect lighting

2718
01:44:12,319 --> 01:44:15,359
here so

2719
01:44:13,439 --> 01:44:17,839
that means not only did they

2720
01:44:15,359 --> 01:44:20,479
not hit a light source they didn't hit

2721
01:44:17,840 --> 01:44:22,159
anything which even supposedly has any

2722
01:44:20,479 --> 01:44:24,559
light at all like like they didn't hit

2723
01:44:22,158 --> 01:44:26,879
the floor somehow

2724
01:44:24,560 --> 01:44:29,920
so that suggests to me that they are

2725
01:44:26,880 --> 01:44:32,560
somehow being maybe erroneously marked

2726
01:44:29,920 --> 01:44:34,880
as being inside like some kind of a

2727
01:44:32,560 --> 01:44:37,840
volume

2728
01:44:34,880 --> 01:44:41,199
so that they can't cast like like maybe

2729
01:44:37,840 --> 01:44:44,400
they're just having some kind of a uh

2730
01:44:41,198 --> 01:44:44,399
they're hitting some kind of in

2731
01:44:44,479 --> 01:44:49,599
i'm not sure what the word is

2732
01:44:47,279 --> 01:44:53,198
we have tests in here to say if you are

2733
01:44:49,600 --> 01:44:54,800
inside a volume or something don't cast

2734
01:44:53,198 --> 01:44:58,238
right there's basically a thing that

2735
01:44:54,800 --> 01:45:00,800
tries to prevent you from wasting time

2736
01:44:58,238 --> 01:45:02,879
casting out of a light probe that's like

2737
01:45:00,800 --> 01:45:06,159
inside something and the example would

2738
01:45:02,880 --> 01:45:07,600
be like you know this one in here uh you

2739
01:45:06,158 --> 01:45:09,839
can you know there there'd be a light

2740
01:45:07,600 --> 01:45:11,199
probe you can't see that's in here

2741
01:45:09,840 --> 01:45:12,719
i think we like detect that you're

2742
01:45:11,198 --> 01:45:15,439
inside a volume and then don't cast

2743
01:45:12,719 --> 01:45:18,079
light or something like that

2744
01:45:15,439 --> 01:45:20,638
and so uh it could be something like

2745
01:45:18,079 --> 01:45:24,399
that and and i suppose it wouldn't be

2746
01:45:20,639 --> 01:45:28,239
that hard for us to test because

2747
01:45:24,399 --> 01:45:31,198
inside full cast uh i believe

2748
01:45:28,238 --> 01:45:33,118
the

2749
01:45:31,198 --> 01:45:35,198
this

2750
01:45:33,118 --> 01:45:36,960
um

2751
01:45:35,198 --> 01:45:40,399
is inside here

2752
01:45:36,960 --> 01:45:41,760
is basically the code for that

2753
01:45:40,399 --> 01:45:42,719
so

2754
01:45:41,760 --> 01:45:45,920
you know

2755
01:45:42,719 --> 01:45:49,679
uh i think we could just say well if we

2756
01:45:45,920 --> 01:45:52,960
just said if zero

2757
01:45:49,679 --> 01:45:54,399
um and prevented that code from running

2758
01:45:52,960 --> 01:45:56,399
um that would

2759
01:45:54,399 --> 01:45:57,439
all right so that that basically tells

2760
01:45:56,399 --> 01:45:59,118
us

2761
01:45:57,439 --> 01:46:00,238
that that is what that that that's what

2762
01:45:59,118 --> 01:46:03,759
that was

2763
01:46:00,238 --> 01:46:04,799
uh apparently that that inside outside

2764
01:46:03,760 --> 01:46:07,920
check

2765
01:46:04,800 --> 01:46:11,880
uh was was totally

2766
01:46:07,920 --> 01:46:11,880
totally wrong right

2767
01:46:12,079 --> 01:46:16,079
so i think there's some kind of bug

2768
01:46:13,760 --> 01:46:18,480
going on here with the spatial partition

2769
01:46:16,079 --> 01:46:20,800
like because of the shift in cell

2770
01:46:18,479 --> 01:46:22,399
alignment or something like we're not

2771
01:46:20,800 --> 01:46:25,039
properly

2772
01:46:22,399 --> 01:46:27,759
we're not doing this correct somehow

2773
01:46:25,039 --> 01:46:29,920
uh like we're we're doing a check

2774
01:46:27,760 --> 01:46:32,719
because because the way this code works

2775
01:46:29,920 --> 01:46:35,840
is it just loops through here

2776
01:46:32,719 --> 01:46:38,719
uh looking at the leaves so of the

2777
01:46:35,840 --> 01:46:40,079
spatial partition

2778
01:46:38,719 --> 01:46:42,719
looking at the leaves of the spatial

2779
01:46:40,079 --> 01:46:45,439
partition and asking the question

2780
01:46:42,719 --> 01:46:50,239
do any of the things in the spatial

2781
01:46:45,439 --> 01:46:52,319
partition in this box uh enclose us

2782
01:46:50,238 --> 01:46:54,718
right that's what's happening

2783
01:46:52,319 --> 01:46:56,799
uh here

2784
01:46:54,719 --> 01:46:59,198
and if any of them do enclose us then we

2785
01:46:56,800 --> 01:47:01,039
just don't cast so it thinks that some

2786
01:46:59,198 --> 01:47:02,319
things in the spatial partition are in

2787
01:47:01,039 --> 01:47:04,479
closing which means that our spatial

2788
01:47:02,319 --> 01:47:06,479
partition is currently broken slightly

2789
01:47:04,479 --> 01:47:08,959
so something that we did with those z

2790
01:47:06,479 --> 01:47:12,559
changes

2791
01:47:08,960 --> 01:47:14,399
is causing our ability to do our spatial

2792
01:47:12,560 --> 01:47:16,639
partition

2793
01:47:14,399 --> 01:47:16,638
uh

2794
01:47:16,800 --> 01:47:20,960
the code that tries to do

2795
01:47:18,800 --> 01:47:22,880
the geometry for that spatial partition

2796
01:47:20,960 --> 01:47:24,800
is now like wrong

2797
01:47:22,880 --> 01:47:26,319
in some way

2798
01:47:24,800 --> 01:47:27,119
because there's no way that this should

2799
01:47:26,319 --> 01:47:30,319
be

2800
01:47:27,118 --> 01:47:32,079
that should just not be happening right

2801
01:47:30,319 --> 01:47:33,920
now in terms of being able to draw the

2802
01:47:32,079 --> 01:47:37,118
spatial partition i don't know what

2803
01:47:33,920 --> 01:47:39,039
we've got for that we probably did some

2804
01:47:37,118 --> 01:47:40,319
of that at some point right

2805
01:47:39,039 --> 01:47:43,198
because

2806
01:47:40,319 --> 01:47:45,198
we would have needed to debug what that

2807
01:47:43,198 --> 01:47:47,839
looked like over time

2808
01:47:45,198 --> 01:47:49,759
uh you know during grid

2809
01:47:47,840 --> 01:47:52,800
grid build spatial partition right like

2810
01:47:49,760 --> 01:47:54,780
we would need to debug this code

2811
01:47:52,800 --> 01:47:56,400
and

2812
01:47:54,779 --> 01:47:58,800
[Music]

2813
01:47:56,399 --> 01:47:58,799
um

2814
01:47:59,520 --> 01:48:03,520
but i don't really see anywhere where we

2815
01:48:02,238 --> 01:48:06,399
were drawing

2816
01:48:03,520 --> 01:48:09,600
the spatial partition that we could

2817
01:48:06,399 --> 01:48:09,599
re-enable right

2818
01:48:10,319 --> 01:48:12,079
so

2819
01:48:11,118 --> 01:48:14,960
uh

2820
01:48:12,079 --> 01:48:17,039
that brings me to the first decision

2821
01:48:14,960 --> 01:48:18,960
that we'd have to make here

2822
01:48:17,039 --> 01:48:21,519
which is

2823
01:48:18,960 --> 01:48:24,800
do we

2824
01:48:21,520 --> 01:48:27,199
just say well the heck with it

2825
01:48:24,800 --> 01:48:29,360
we know we can simplify the way that

2826
01:48:27,198 --> 01:48:31,439
these spatial things are working anyway

2827
01:48:29,359 --> 01:48:33,118
do we just say we're not going to bother

2828
01:48:31,439 --> 01:48:35,359
debugging that code we're just going to

2829
01:48:33,118 --> 01:48:36,639
vaporize it

2830
01:48:35,359 --> 01:48:38,079
and

2831
01:48:36,639 --> 01:48:40,800
replace it with

2832
01:48:38,079 --> 01:48:43,359
a more straightforward

2833
01:48:40,800 --> 01:48:46,360
cell walk

2834
01:48:43,359 --> 01:48:46,359
right

2835
01:48:59,920 --> 01:49:02,239
and that seems like the right thing to

2836
01:49:01,520 --> 01:49:04,719
do

2837
01:49:02,238 --> 01:49:07,439
because i don't know why we would bother

2838
01:49:04,719 --> 01:49:10,158
simplifying this code i'm sorry uh

2839
01:49:07,439 --> 01:49:11,439
debugging this code only then to replace

2840
01:49:10,158 --> 01:49:13,598
it with new code which we would then

2841
01:49:11,439 --> 01:49:16,238
have to debug as well so it would kind

2842
01:49:13,599 --> 01:49:19,360
of seem to me like the best policy would

2843
01:49:16,238 --> 01:49:21,598
be to just simplify the code first and

2844
01:49:19,359 --> 01:49:22,960
then debug the simplified code because

2845
01:49:21,599 --> 01:49:25,520
if we're going to have to debug it

2846
01:49:22,960 --> 01:49:25,520
either way

2847
01:49:25,920 --> 01:49:28,639
it

2848
01:49:27,118 --> 01:49:29,839
would seem

2849
01:49:28,639 --> 01:49:30,800
right

2850
01:49:29,840 --> 01:49:34,239
uh

2851
01:49:30,800 --> 01:49:34,750
like that would be the smart call

2852
01:49:34,238 --> 01:49:37,938
um

2853
01:49:34,750 --> 01:49:37,939
[Music]

2854
01:49:40,880 --> 01:49:44,480
so i guess we're just gonna do that

2855
01:49:42,319 --> 01:49:47,439
that's that's my call it might be a bad

2856
01:49:44,479 --> 01:49:47,439
call um

2857
01:49:47,920 --> 01:49:51,359
because sometimes it's a bad idea if you

2858
01:49:49,599 --> 01:49:53,039
don't have the current state of the code

2859
01:49:51,359 --> 01:49:55,359
working to switch to a new state but i'm

2860
01:49:53,039 --> 01:49:57,279
just thinking like well uh i'm gonna

2861
01:49:55,359 --> 01:49:58,158
have to debug both of these either way

2862
01:49:57,279 --> 01:50:00,719
so

2863
01:49:58,158 --> 01:50:02,960
yeah right

2864
01:50:00,719 --> 01:50:05,599
so if we take a look at grid build

2865
01:50:02,960 --> 01:50:07,599
spatial partition here there's two steps

2866
01:50:05,599 --> 01:50:11,199
of simplification we can make i'm gonna

2867
01:50:07,599 --> 01:50:12,079
say we should make uh the removing z1

2868
01:50:11,198 --> 01:50:13,598
first

2869
01:50:12,079 --> 01:50:15,279
and then the next one we can make is

2870
01:50:13,599 --> 01:50:17,840
just having it so the spatial partition

2871
01:50:15,279 --> 01:50:19,599
actually isn't a spatial partition so

2872
01:50:17,840 --> 01:50:22,079
much as it's just a grid

2873
01:50:19,599 --> 01:50:23,440
that records like effectively like the

2874
01:50:22,079 --> 01:50:25,519
space that

2875
01:50:23,439 --> 01:50:28,000
array can pass through or something

2876
01:50:25,520 --> 01:50:28,000
similar

2877
01:50:28,158 --> 01:50:32,638
so if we just assume that the spatial

2878
01:50:30,079 --> 01:50:33,679
partition no longer has a z coordinate

2879
01:50:32,639 --> 01:50:35,920
at all

2880
01:50:33,679 --> 01:50:39,679
uh you know what's that going to look

2881
01:50:35,920 --> 01:50:42,480
like i guess would be the first question

2882
01:50:39,679 --> 01:50:44,239
so if we were to say that the spatial

2883
01:50:42,479 --> 01:50:47,198
partition

2884
01:50:44,238 --> 01:50:47,198
as we see it here

2885
01:50:47,279 --> 01:50:51,599
and you can actually see it you can see

2886
01:50:49,439 --> 01:50:53,598
a grid leaf right

2887
01:50:51,599 --> 01:50:54,880
you've got a box min you've got a box

2888
01:50:53,599 --> 01:50:56,639
max

2889
01:50:54,880 --> 01:50:58,719
and then you've got like color and

2890
01:50:56,639 --> 01:51:00,719
emission and so on

2891
01:50:58,719 --> 01:51:04,800
um

2892
01:51:00,719 --> 01:51:08,158
if we are to simplify this down you can

2893
01:51:04,800 --> 01:51:09,920
we can still keep all of the

2894
01:51:08,158 --> 01:51:12,158
all the 3dness of those so that we can

2895
01:51:09,920 --> 01:51:14,719
have like partial occluders

2896
01:51:12,158 --> 01:51:17,519
uh in grid cells we can keep all that

2897
01:51:14,719 --> 01:51:19,439
uh and the main difference here would be

2898
01:51:17,520 --> 01:51:23,199
that the

2899
01:51:19,439 --> 01:51:26,719
the spatial grid itself

2900
01:51:23,198 --> 01:51:28,638
would just lose its z stack

2901
01:51:26,719 --> 01:51:31,198
right so like the

2902
01:51:28,639 --> 01:51:34,400
the indexing into this thing

2903
01:51:31,198 --> 01:51:35,919
would lose the z part of the index

2904
01:51:34,399 --> 01:51:36,879
you know what i mean

2905
01:51:35,920 --> 01:51:39,359
um

2906
01:51:36,880 --> 01:51:40,880
so as we're like stepping through here

2907
01:51:39,359 --> 01:51:43,279
you can see like it

2908
01:51:40,880 --> 01:51:45,440
has this sort of grid index

2909
01:51:43,279 --> 01:51:48,000
uh that's going on here and this step

2910
01:51:45,439 --> 01:51:52,799
just uses stepping from the table

2911
01:51:48,000 --> 01:51:52,800
so it just uses this this d grid right

2912
01:51:52,880 --> 01:51:59,599
so in the compute walk table function

2913
01:51:55,439 --> 01:52:02,399
you can see here where it loops over uh

2914
01:51:59,599 --> 01:52:04,800
you know it loops over the directions

2915
01:52:02,399 --> 01:52:06,319
that you might be going z

2916
01:52:04,800 --> 01:52:09,039
positive and negative y positive

2917
01:52:06,319 --> 01:52:10,399
negative x positive and negative

2918
01:52:09,039 --> 01:52:12,560
um

2919
01:52:10,399 --> 01:52:14,719
and then it it goes in and looks at what

2920
01:52:12,560 --> 01:52:17,599
the you know the table entries are for

2921
01:52:14,719 --> 01:52:20,800
that thing you know what i'm saying

2922
01:52:17,599 --> 01:52:22,960
so if we were just to take z stepping

2923
01:52:20,800 --> 01:52:24,480
out of the equation

2924
01:52:22,960 --> 01:52:28,158
um

2925
01:52:24,479 --> 01:52:28,158
i like our little debug checks here

2926
01:52:29,679 --> 01:52:33,440
uh if we were to take z stepping out of

2927
01:52:31,359 --> 01:52:36,319
the equation we would basically removing

2928
01:52:33,439 --> 01:52:38,079
these parts of the z for loop here

2929
01:52:36,319 --> 01:52:40,479
and you can see we've got this flat

2930
01:52:38,079 --> 01:52:42,559
index from function

2931
01:52:40,479 --> 01:52:43,598
which packs things down based on their z

2932
01:52:42,560 --> 01:52:46,880
index

2933
01:52:43,599 --> 01:52:49,279
so you can see like the index z is is

2934
01:52:46,880 --> 01:52:51,679
right here that would just always now be

2935
01:52:49,279 --> 01:52:51,679
zero

2936
01:52:51,920 --> 01:52:56,880
right um

2937
01:52:54,238 --> 01:53:00,799
and the grid cell count in the voxel

2938
01:52:56,880 --> 01:53:01,760
grid its z value would also always be

2939
01:53:00,800 --> 01:53:06,079
zero

2940
01:53:01,760 --> 01:53:06,079
right uh i'm sorry uh one right

2941
01:53:06,560 --> 01:53:09,599
so i guess let's just try to make this

2942
01:53:08,079 --> 01:53:12,599
change

2943
01:53:09,599 --> 01:53:12,599
so

2944
01:53:16,479 --> 01:53:22,718
so when we

2945
01:53:18,319 --> 01:53:24,799
yeah um when we in in the lighting here

2946
01:53:22,719 --> 01:53:27,198
uh this is gonna be it's gonna be a bit

2947
01:53:24,800 --> 01:53:28,800
of a nail biter but when we in the in

2948
01:53:27,198 --> 01:53:31,279
the lighting here go to set up the

2949
01:53:28,800 --> 01:53:33,520
spatial grid

2950
01:53:31,279 --> 01:53:33,519
um

2951
01:53:36,399 --> 01:53:43,279
you can see the spatial cell count

2952
01:53:40,479 --> 01:53:45,039
uh is the value that we're actually

2953
01:53:43,279 --> 01:53:47,039
asking for you can see

2954
01:53:45,039 --> 01:53:49,679
uh

2955
01:53:47,039 --> 01:53:51,279
this this happening here the atlas cell

2956
01:53:49,679 --> 01:53:52,880
count

2957
01:53:51,279 --> 01:53:55,118
which is

2958
01:53:52,880 --> 01:53:56,800
determined by

2959
01:53:55,118 --> 01:53:58,399
uh whatever the vox dimension which is

2960
01:53:56,800 --> 01:53:59,279
two right

2961
01:53:58,399 --> 01:54:00,638
um

2962
01:53:59,279 --> 01:54:02,800
this is

2963
01:54:00,639 --> 01:54:06,000
all well you know it would just produce

2964
01:54:02,800 --> 01:54:07,520
one by default in z

2965
01:54:06,000 --> 01:54:09,840
actually

2966
01:54:07,520 --> 01:54:09,840
uh

2967
01:54:10,319 --> 01:54:14,719
so that will do the right thing i think

2968
01:54:13,039 --> 01:54:15,599
let's take a look

2969
01:54:14,719 --> 01:54:17,118
but

2970
01:54:15,599 --> 01:54:19,039
to start with

2971
01:54:17,118 --> 01:54:20,799
we don't even have to clamp that value

2972
01:54:19,039 --> 01:54:22,639
down because i think it will always

2973
01:54:20,800 --> 01:54:24,400
produce one anyway if it's half the

2974
01:54:22,639 --> 01:54:27,520
resolution of the

2975
01:54:24,399 --> 01:54:30,479
spelling so although this part here

2976
01:54:27,520 --> 01:54:31,920
atlas to spatial grid index offset uh

2977
01:54:30,479 --> 01:54:33,919
that part

2978
01:54:31,920 --> 01:54:34,960
would would not

2979
01:54:33,920 --> 01:54:37,679
right

2980
01:54:34,960 --> 01:54:38,560
that part would not so let's let's yeah

2981
01:54:37,679 --> 01:54:41,199
let's

2982
01:54:38,560 --> 01:54:42,400
let's take a careful look at this

2983
01:54:41,198 --> 01:54:45,439
i'm going to go into the lighting code

2984
01:54:42,399 --> 01:54:45,439
here and set a breakpoint

2985
01:54:49,198 --> 01:54:51,839
and

2986
01:54:52,000 --> 01:54:54,479
there we go

2987
01:54:59,359 --> 01:55:02,799
is that only set once yeah

2988
01:55:01,439 --> 01:55:04,879
just wanted to make sure that it's only

2989
01:55:02,800 --> 01:55:07,199
set once which is what i said before but

2990
01:55:04,880 --> 01:55:09,039
i was like well let's be sure that this

2991
01:55:07,198 --> 01:55:11,598
only gets set once

2992
01:55:09,039 --> 01:55:14,238
so here's the voxel cell dimension

2993
01:55:11,599 --> 01:55:16,639
um which is just the fundamental unit in

2994
01:55:14,238 --> 01:55:18,399
all directions here's the spatial cell

2995
01:55:16,639 --> 01:55:19,760
count

2996
01:55:18,399 --> 01:55:21,839
which

2997
01:55:19,760 --> 01:55:24,400
is 14 by 10 by three

2998
01:55:21,840 --> 01:55:27,039
so this three here we really just want

2999
01:55:24,399 --> 01:55:29,759
to set to one right we want to kind of

3000
01:55:27,039 --> 01:55:29,760
get rid of that

3001
01:55:30,319 --> 01:55:34,559
so

3002
01:55:31,198 --> 01:55:36,799
uh i'm not sure to what extent

3003
01:55:34,560 --> 01:55:36,800
that

3004
01:55:45,520 --> 01:55:49,119
you know this this part has to make sure

3005
01:55:47,679 --> 01:55:53,199
that it would encompass all of the

3006
01:55:49,118 --> 01:55:55,598
geometry right so the spatial cell count

3007
01:55:53,198 --> 01:55:57,919
two times voxel cell dim

3008
01:55:55,599 --> 01:55:59,199
you can see the spatial grid is like

3009
01:55:57,920 --> 01:56:00,880
is

3010
01:55:59,198 --> 01:56:04,158
based off of

3011
01:56:00,880 --> 01:56:06,480
how the atlas is set up it's it's twice

3012
01:56:04,158 --> 01:56:10,479
as wide right like so

3013
01:56:06,479 --> 01:56:12,959
for every there's a there we've been

3014
01:56:10,479 --> 01:56:16,158
at basically a rate of

3015
01:56:12,960 --> 01:56:19,679
two grid squares like you know four

3016
01:56:16,158 --> 01:56:19,679
tiles two by two

3017
01:56:20,560 --> 01:56:23,679
and

3018
01:56:21,599 --> 01:56:24,719
so this hat would have to encompass all

3019
01:56:23,679 --> 01:56:28,399
of the z

3020
01:56:24,719 --> 01:56:30,399
uh direction right so when we do the

3021
01:56:28,399 --> 01:56:32,319
atlas grid here this spatial grid would

3022
01:56:30,399 --> 01:56:33,359
have to be its z would have to be set a

3023
01:56:32,319 --> 01:56:35,599
little bit differently because we want

3024
01:56:33,359 --> 01:56:37,279
it to encompass the whole thing

3025
01:56:35,599 --> 01:56:38,400
right we don't really want it to remove

3026
01:56:37,279 --> 01:56:41,439
anything

3027
01:56:38,399 --> 01:56:44,158
uh whatever we push down here it should

3028
01:56:41,439 --> 01:56:46,638
take right

3029
01:56:44,158 --> 01:56:48,479
and then the z value should be one

3030
01:56:46,639 --> 01:56:51,199
and

3031
01:56:48,479 --> 01:56:53,839
again that came from because atlas cell

3032
01:56:51,198 --> 01:56:55,678
count should be set to two here so when

3033
01:56:53,840 --> 01:56:57,599
this divide by two it will just be one

3034
01:56:55,679 --> 01:56:58,800
so it's really this atlas to spatial

3035
01:56:57,599 --> 01:57:00,800
grid index

3036
01:56:58,800 --> 01:57:04,800
that part right there

3037
01:57:00,800 --> 01:57:07,199
that offset is really the problem so

3038
01:57:04,800 --> 01:57:10,199
the atlas to spatial grid

3039
01:57:07,198 --> 01:57:10,198
offset

3040
01:57:11,520 --> 01:57:15,760
this

3041
01:57:13,439 --> 01:57:15,759
um

3042
01:57:17,439 --> 01:57:21,118
i don't really know

3043
01:57:22,399 --> 01:57:28,158
what that's even really designed to do

3044
01:57:24,960 --> 01:57:28,158
anymore right like

3045
01:57:29,279 --> 01:57:34,238
i think the basic idea there

3046
01:57:32,560 --> 01:57:35,039
is that you want

3047
01:57:34,238 --> 01:57:39,279
the

3048
01:57:35,039 --> 01:57:40,560
spatial grid to include one tile

3049
01:57:39,279 --> 01:57:41,679
outside

3050
01:57:40,560 --> 01:57:44,480
of

3051
01:57:41,679 --> 01:57:46,000
wherever you're casting

3052
01:57:44,479 --> 01:57:49,000
right

3053
01:57:46,000 --> 01:57:49,000
um

3054
01:57:52,719 --> 01:57:57,599
so i imagine

3055
01:57:54,719 --> 01:58:00,880
but don't know

3056
01:57:57,599 --> 01:58:02,400
uh i imagine that like that becomes a

3057
01:58:00,880 --> 01:58:04,639
zero so that we

3058
01:58:02,399 --> 01:58:07,279
it's always just one

3059
01:58:04,639 --> 01:58:10,960
in in that direction and then the

3060
01:58:07,279 --> 01:58:12,960
spatial grids alignment which i think we

3061
01:58:10,960 --> 01:58:15,599
really we're going to want to have we're

3062
01:58:12,960 --> 01:58:17,118
going to want to draw right

3063
01:58:15,599 --> 01:58:19,199
uh

3064
01:58:17,118 --> 01:58:21,598
the dimensions of this are going to have

3065
01:58:19,198 --> 01:58:23,919
to be set carefully to make sure they

3066
01:58:21,599 --> 01:58:25,679
include everything

3067
01:58:23,920 --> 01:58:28,319
you know what i mean

3068
01:58:25,679 --> 01:58:29,920
so i assume that there's something that

3069
01:58:28,319 --> 01:58:30,719
would go on here

3070
01:58:29,920 --> 01:58:33,440
the

3071
01:58:30,719 --> 01:58:35,359
you know that would well let's draw it

3072
01:58:33,439 --> 01:58:36,559
first and then make sure that we're

3073
01:58:35,359 --> 01:58:39,359
keeping it

3074
01:58:36,560 --> 01:58:41,199
in some kind of a saying

3075
01:58:39,359 --> 01:58:44,079
uh

3076
01:58:41,198 --> 01:58:44,079
some kind of a sane

3077
01:58:45,760 --> 01:58:48,760
location

3078
01:58:48,960 --> 01:58:53,599
so solution spatial grid

3079
01:58:52,079 --> 01:58:57,118
total bounds

3080
01:58:53,599 --> 01:59:00,840
and i'm going to draw that

3081
01:58:57,118 --> 01:59:02,719
maybe that gets drawn in green

3082
01:59:00,840 --> 01:59:05,599
um

3083
01:59:02,719 --> 01:59:05,599
and we'll just see

3084
01:59:08,880 --> 01:59:12,359
we will see

3085
01:59:17,198 --> 01:59:20,079
all right

3086
01:59:18,719 --> 01:59:22,319
um

3087
01:59:20,079 --> 01:59:22,319
so

3088
01:59:23,118 --> 01:59:28,399
i think that makes sense to me like it's

3089
01:59:26,000 --> 01:59:30,719
designed to have an apron and i think

3090
01:59:28,399 --> 01:59:32,319
that's good so really the only thing we

3091
01:59:30,719 --> 01:59:35,679
need to do is make sure that the

3092
01:59:32,319 --> 01:59:37,519
z-bounds span the correct sort of

3093
01:59:35,679 --> 01:59:38,880
distance which they don't currently

3094
01:59:37,520 --> 01:59:41,520
right

3095
01:59:38,880 --> 01:59:45,599
so if we look at how

3096
01:59:41,520 --> 01:59:48,000
the z-bounds are set up we want in here

3097
01:59:45,599 --> 01:59:49,599
where we do this dimension

3098
01:59:48,000 --> 01:59:51,439
we want to

3099
01:59:49,599 --> 01:59:52,400
include

3100
01:59:51,439 --> 01:59:55,198
uh

3101
01:59:52,399 --> 01:59:58,559
enough height so that it encompasses the

3102
01:59:55,198 --> 02:00:01,678
cell dimension like of z right

3103
01:59:58,560 --> 02:00:04,480
we need to encompass three layers of z

3104
02:00:01,679 --> 02:00:05,199
because we're not adding those in

3105
02:00:04,479 --> 02:00:07,519
so

3106
02:00:05,198 --> 02:00:10,158
we actually want something like this

3107
02:00:07,520 --> 02:00:13,119
which is like spatial

3108
02:00:10,158 --> 02:00:14,638
dim spatial cell dim

3109
02:00:13,118 --> 02:00:16,319
we want to take

3110
02:00:14,639 --> 02:00:18,960
what we would normally use as the

3111
02:00:16,319 --> 02:00:18,960
dimension

3112
02:00:20,079 --> 02:00:23,679
and we want to

3113
02:00:21,599 --> 02:00:25,360
uh

3114
02:00:23,679 --> 02:00:28,480
we want to

3115
02:00:25,359 --> 02:00:31,359
make sure that it's like three stacks

3116
02:00:28,479 --> 02:00:31,359
you know what i'm saying

3117
02:00:31,679 --> 02:00:36,239
it wants to be three three high so oops

3118
02:00:33,920 --> 02:00:38,239
that's a regular v3

3119
02:00:36,238 --> 02:00:40,399
not a v3s

3120
02:00:38,238 --> 02:00:42,879
so we want that spatial partition to be

3121
02:00:40,399 --> 02:00:44,319
three high uh and if we look at what it

3122
02:00:42,880 --> 02:00:48,319
looks like now

3123
02:00:44,319 --> 02:00:48,319
um hopefully it's more aligned

3124
02:00:48,479 --> 02:00:53,359
although okay no it's not it backed it

3125
02:00:50,960 --> 02:00:55,520
down from there all right so the

3126
02:00:53,359 --> 02:00:57,759
alignment code does something weird with

3127
02:00:55,520 --> 02:00:59,679
the z there uh

3128
02:00:57,760 --> 02:01:01,360
that i don't quite understand so let's

3129
02:00:59,679 --> 02:01:03,199
take a look at why it decided to do that

3130
02:01:01,359 --> 02:01:05,519
because i'm not sure

3131
02:01:03,198 --> 02:01:09,439
why it would align it in that way

3132
02:01:05,520 --> 02:01:12,159
um that's that's a bit weird

3133
02:01:09,439 --> 02:01:14,399
but we're looking at this code here

3134
02:01:12,158 --> 02:01:14,399
and

3135
02:01:14,479 --> 02:01:20,799
you know here's how the spatial corner

3136
02:01:16,800 --> 02:01:23,840
works it takes the min corner and it

3137
02:01:20,800 --> 02:01:24,639
it moves one cell dim off okay so i see

3138
02:01:23,840 --> 02:01:25,599
why

3139
02:01:24,639 --> 02:01:26,480
right

3140
02:01:25,599 --> 02:01:29,440
um

3141
02:01:26,479 --> 02:01:32,718
if it's going to move one cell dim off

3142
02:01:29,439 --> 02:01:34,559
then it's going to include that huge

3143
02:01:32,719 --> 02:01:37,039
uh that huge amount so we we don't

3144
02:01:34,560 --> 02:01:38,239
actually get the benefit that we wanted

3145
02:01:37,039 --> 02:01:40,639
there right

3146
02:01:38,238 --> 02:01:43,598
so we need to do something here where

3147
02:01:40,639 --> 02:01:44,319
we're going to move one cell dim off

3148
02:01:43,599 --> 02:01:46,560
in

3149
02:01:44,319 --> 02:01:49,519
but only a third of a cell dim off in

3150
02:01:46,560 --> 02:01:51,840
the other direction right so

3151
02:01:49,520 --> 02:01:51,840
um

3152
02:01:53,760 --> 02:01:56,639
again i'm not sure

3153
02:02:00,880 --> 02:02:05,840
how exactly we want to do this but it

3154
02:02:02,399 --> 02:02:05,839
would look something like this

3155
02:02:12,639 --> 02:02:18,560
right so we just effectively be saying

3156
02:02:14,800 --> 02:02:20,560
well look the z is handled differently

3157
02:02:18,560 --> 02:02:22,480
than the other two axes because it it

3158
02:02:20,560 --> 02:02:26,000
just is the whole thing

3159
02:02:22,479 --> 02:02:28,559
uh there's no tile apron

3160
02:02:26,000 --> 02:02:29,359
it's just the whole thing right

3161
02:02:28,560 --> 02:02:32,000
so

3162
02:02:29,359 --> 02:02:34,799
that is now an aligned spatial partition

3163
02:02:32,000 --> 02:02:36,479
that is now in the correct place

3164
02:02:34,800 --> 02:02:38,159
right

3165
02:02:36,479 --> 02:02:40,959
so uh

3166
02:02:38,158 --> 02:02:45,679
all right you know that's a start it's

3167
02:02:40,960 --> 02:02:47,550
not perfect but you know it's a start

3168
02:02:45,679 --> 02:02:49,679
if we take a look at the

3169
02:02:47,550 --> 02:02:52,800
[Music]

3170
02:02:49,679 --> 02:02:56,560
walk code now we need to remove the

3171
02:02:52,800 --> 02:02:57,520
concept that you can really move in z

3172
02:02:56,560 --> 02:03:02,320
um

3173
02:02:57,520 --> 02:03:04,400
so when we are looking at a

3174
02:03:02,319 --> 02:03:05,359
a sample

3175
02:03:04,399 --> 02:03:09,439
um

3176
02:03:05,359 --> 02:03:09,439
we need to just yeah like

3177
02:03:12,719 --> 02:03:16,960
the thing that i'm just not sure about

3178
02:03:14,319 --> 02:03:18,639
is whether we want to keep the notion of

3179
02:03:16,960 --> 02:03:20,800
the spatial grid and the atlas grid

3180
02:03:18,639 --> 02:03:22,319
separate anymore anyway or should they

3181
02:03:20,800 --> 02:03:26,000
just both

3182
02:03:22,319 --> 02:03:29,039
so they just be completely collapsed now

3183
02:03:26,000 --> 02:03:31,279
uh and and i really just don't know

3184
02:03:29,039 --> 02:03:31,279
but

3185
02:03:31,679 --> 02:03:36,560
um i realized i think i understand

3186
02:03:34,319 --> 02:03:38,559
basically why we're having the problem

3187
02:03:36,560 --> 02:03:40,840
too with the spatial grid versus atlas

3188
02:03:38,560 --> 02:03:43,199
grid offset

3189
02:03:40,840 --> 02:03:45,039
because i think i said something wrong

3190
02:03:43,198 --> 02:03:48,000
here so that's not these are not

3191
02:03:45,039 --> 02:03:51,198
directions these are the offsets

3192
02:03:48,000 --> 02:03:54,639
of the um

3193
02:03:51,198 --> 02:03:56,960
these are the offsets of the probe point

3194
02:03:54,639 --> 02:03:59,279
inside the spatial grid

3195
02:03:56,960 --> 02:04:01,198
that's what those actually are

3196
02:03:59,279 --> 02:04:04,238
uh and so

3197
02:04:01,198 --> 02:04:06,479
you know it's it's how you would walk

3198
02:04:04,238 --> 02:04:09,118
the spatial grid based on where you are

3199
02:04:06,479 --> 02:04:09,118
inside it

3200
02:04:09,359 --> 02:04:14,639
so there you go so z in this case

3201
02:04:12,158 --> 02:04:15,439
doesn't exist because you can't step in

3202
02:04:14,639 --> 02:04:16,319
z

3203
02:04:15,439 --> 02:04:18,078
so

3204
02:04:16,319 --> 02:04:20,319
we want to pull that out

3205
02:04:18,078 --> 02:04:20,319
um

3206
02:04:21,039 --> 02:04:25,679
as the next step when we walk through

3207
02:04:23,118 --> 02:04:28,559
here and we look at the remainder there

3208
02:04:25,679 --> 02:04:30,880
is never going to be a remainder in z

3209
02:04:28,560 --> 02:04:32,719
it simply isn't allowed you can only

3210
02:04:30,880 --> 02:04:33,520
step in x and y

3211
02:04:32,719 --> 02:04:35,840
uh

3212
02:04:33,520 --> 02:04:37,040
that's just how that works right

3213
02:04:35,840 --> 02:04:40,078
when we do

3214
02:04:37,039 --> 02:04:42,479
uh get octant four

3215
02:04:40,078 --> 02:04:42,479
um

3216
02:04:44,880 --> 02:04:48,560
it's going to have to

3217
02:04:47,198 --> 02:04:51,598
understand

3218
02:04:48,560 --> 02:04:52,560
that we are doing that so i'm not sure

3219
02:04:51,599 --> 02:04:54,880
hm

3220
02:04:52,560 --> 02:04:57,880
that one's a little confusing

3221
02:04:54,880 --> 02:04:57,880
um

3222
02:05:06,000 --> 02:05:12,039
i'm not sure exactly what that does

3223
02:05:08,560 --> 02:05:12,039
let's take a look

3224
02:05:28,639 --> 02:05:31,639
so

3225
02:05:38,238 --> 02:05:42,399
so really the octan index is just

3226
02:05:40,319 --> 02:05:44,000
something we use for packing the answers

3227
02:05:42,399 --> 02:05:46,879
in here right

3228
02:05:44,000 --> 02:05:49,840
and now octan index would just become

3229
02:05:46,880 --> 02:05:49,840
quadrant index

3230
02:05:50,238 --> 02:05:55,198
it's just a way to load the table

3231
02:05:53,439 --> 02:05:56,879
right

3232
02:05:55,198 --> 02:05:58,158
so

3233
02:05:56,880 --> 02:05:59,359
so really

3234
02:05:58,158 --> 02:06:01,839
that's all

3235
02:05:59,359 --> 02:06:05,039
that is the

3236
02:06:01,840 --> 02:06:09,520
this would be instead of get octant four

3237
02:06:05,039 --> 02:06:09,519
you know it's gonna be get quadrant four

3238
02:06:10,238 --> 02:06:14,879
and we pass the remainder in here we

3239
02:06:12,158 --> 02:06:16,879
would assert that the remainder z equals

3240
02:06:14,880 --> 02:06:18,800
zero because you're never allowed to

3241
02:06:16,880 --> 02:06:22,400
have anything else and we'd never shift

3242
02:06:18,800 --> 02:06:24,159
that one up so now whereas before

3243
02:06:22,399 --> 02:06:25,920
there could be eight answers coming out

3244
02:06:24,158 --> 02:06:28,000
of this there's only four

3245
02:06:25,920 --> 02:06:29,199
possible answers now

3246
02:06:28,000 --> 02:06:32,319
so

3247
02:06:29,198 --> 02:06:32,319
the quadrant index

3248
02:06:33,439 --> 02:06:35,678
uh

3249
02:06:35,920 --> 02:06:41,520
is how we would pack these in

3250
02:06:38,399 --> 02:06:43,759
when we go ahead and do our

3251
02:06:41,520 --> 02:06:45,679
testing for sample directions here we're

3252
02:06:43,760 --> 02:06:47,840
also going to have the problem that we

3253
02:06:45,679 --> 02:06:49,599
go through the directional indexes to

3254
02:06:47,840 --> 02:06:50,960
see which one is greater and all that

3255
02:06:49,599 --> 02:06:52,560
other nonsense

3256
02:06:50,960 --> 02:06:54,800
uh we don't want to do that anymore

3257
02:06:52,560 --> 02:06:56,560
either so like the dimension index here

3258
02:06:54,800 --> 02:06:59,920
is just going to be two

3259
02:06:56,560 --> 02:07:01,199
uh we're you know we're not gonna ever

3260
02:06:59,920 --> 02:07:04,960
uh

3261
02:07:01,198 --> 02:07:06,799
contemplate the z value

3262
02:07:04,960 --> 02:07:08,480
uh at all

3263
02:07:06,800 --> 02:07:12,079
and

3264
02:07:08,479 --> 02:07:14,238
so then i would assume

3265
02:07:12,078 --> 02:07:17,439
i'm not sure what do we do with envy ray

3266
02:07:14,238 --> 02:07:17,439
d here let's take a look

3267
02:07:23,439 --> 02:07:28,879
yeah you can see like we're

3268
02:07:25,039 --> 02:07:28,880
we're just computing those two values

3269
02:07:35,520 --> 02:07:39,760
so really if we just change the

3270
02:07:37,039 --> 02:07:42,719
dimension index here

3271
02:07:39,760 --> 02:07:43,760
to two so we never check the other ones

3272
02:07:42,719 --> 02:07:46,719
um

3273
02:07:43,760 --> 02:07:49,360
we never really need to check this

3274
02:07:46,719 --> 02:07:51,439
equals uh

3275
02:07:49,359 --> 02:07:53,839
that's just never gonna happen

3276
02:07:51,439 --> 02:07:55,359
because we know that it you know

3277
02:07:53,840 --> 02:07:57,599
wouldn't matter

3278
02:07:55,359 --> 02:07:57,598
so

3279
02:08:00,000 --> 02:08:05,679
that's basically saying if 0 and 2

3280
02:08:06,319 --> 02:08:11,279
are both the same

3281
02:08:08,479 --> 02:08:12,879
then it uses two and picks best m2 we

3282
02:08:11,279 --> 02:08:15,519
know that's never allowed anymore

3283
02:08:12,880 --> 02:08:17,920
because the best dim can never be two

3284
02:08:15,520 --> 02:08:19,520
um so we are pretty much always going to

3285
02:08:17,920 --> 02:08:21,039
do this

3286
02:08:19,520 --> 02:08:22,400
uh

3287
02:08:21,039 --> 02:08:26,000
always

3288
02:08:22,399 --> 02:08:27,118
and we're only really comparing between

3289
02:08:26,000 --> 02:08:28,719
the

3290
02:08:27,118 --> 02:08:29,598
x and y now

3291
02:08:28,719 --> 02:08:32,319
right

3292
02:08:29,599 --> 02:08:34,078
so we don't even really need to do like

3293
02:08:32,319 --> 02:08:36,799
this t best

3294
02:08:34,078 --> 02:08:39,359
at all we can just look at the

3295
02:08:36,800 --> 02:08:41,760
difference between

3296
02:08:39,359 --> 02:08:43,839
zero and the the zero index and the one

3297
02:08:41,760 --> 02:08:45,599
index so we could simplify this down

3298
02:08:43,840 --> 02:08:47,520
quite a bit we don't care about doing

3299
02:08:45,599 --> 02:08:51,800
that here obviously

3300
02:08:47,520 --> 02:08:51,800
uh but you know

3301
02:08:52,319 --> 02:08:56,238
so i feel like all this is fine

3302
02:08:54,399 --> 02:08:58,238
uh the only thing i would be a little

3303
02:08:56,238 --> 02:08:59,598
bit worried about here is that the ray

3304
02:08:58,238 --> 02:09:01,439
direction

3305
02:08:59,599 --> 02:09:04,078
when we do this divide

3306
02:09:01,439 --> 02:09:05,359
uh

3307
02:09:04,078 --> 02:09:08,399
we

3308
02:09:05,359 --> 02:09:08,399
wouldn't have really

3309
02:09:10,960 --> 02:09:13,920
conditioned it but that's okay it looks

3310
02:09:12,880 --> 02:09:16,000
like

3311
02:09:13,920 --> 02:09:16,880
so i think this is okay

3312
02:09:16,000 --> 02:09:20,238
uh

3313
02:09:16,880 --> 02:09:22,639
more or less right uh we want to make

3314
02:09:20,238 --> 02:09:24,559
sure we never take that step

3315
02:09:22,639 --> 02:09:25,679
so when we get down here i would just

3316
02:09:24,560 --> 02:09:29,599
assert

3317
02:09:25,679 --> 02:09:31,840
uh that best dim is not equal to two

3318
02:09:29,599 --> 02:09:33,119
uh like you know i could be even harder

3319
02:09:31,840 --> 02:09:34,719
and say

3320
02:09:33,118 --> 02:09:37,439
uh

3321
02:09:34,719 --> 02:09:38,960
that it has to be one or zero can't be

3322
02:09:37,439 --> 02:09:40,879
anything else

3323
02:09:38,960 --> 02:09:43,359
because it's only going to step in one

3324
02:09:40,880 --> 02:09:46,920
direction or the other

3325
02:09:43,359 --> 02:09:46,920
and then

3326
02:09:48,000 --> 02:09:51,439
the quadrant index is

3327
02:09:50,238 --> 02:09:54,799
you know

3328
02:09:51,439 --> 02:09:57,118
going to get followed through here so

3329
02:09:54,800 --> 02:09:59,440
there's our quadrant

3330
02:09:57,118 --> 02:10:02,078
index i'm just going to look and remove

3331
02:09:59,439 --> 02:10:05,439
octan index everywhere

3332
02:10:02,078 --> 02:10:07,679
so this is quadrant index

3333
02:10:05,439 --> 02:10:07,678
and

3334
02:10:11,359 --> 02:10:16,078
yeah this is just the

3335
02:10:12,840 --> 02:10:18,400
lookup into the walk table based on on

3336
02:10:16,078 --> 02:10:20,880
the quadrant index

3337
02:10:18,399 --> 02:10:23,118
so i believe that should be a fairly

3338
02:10:20,880 --> 02:10:25,520
straightforward change

3339
02:10:23,118 --> 02:10:26,559
but i don't actually know so let's take

3340
02:10:25,520 --> 02:10:28,079
a look

3341
02:10:26,560 --> 02:10:29,740
it looks like we did still have some

3342
02:10:28,078 --> 02:10:32,158
people uh passing

3343
02:10:29,739 --> 02:10:33,039
[Music]

3344
02:10:32,158 --> 02:10:35,118
a

3345
02:10:33,039 --> 02:10:36,158
remainder z call here

3346
02:10:35,118 --> 02:10:39,158
uh

3347
02:10:36,158 --> 02:10:39,158
so

3348
02:10:47,359 --> 02:10:50,880
that actually

3349
02:10:48,800 --> 02:10:52,960
makes sense though because we didn't

3350
02:10:50,880 --> 02:10:54,560
neuter this calls

3351
02:10:52,960 --> 02:10:58,319
uh

3352
02:10:54,560 --> 02:10:58,320
z test right

3353
02:10:58,880 --> 02:11:02,399
so

3354
02:10:59,260 --> 02:11:02,399
[Music]

3355
02:11:02,479 --> 02:11:06,319
when we are calling

3356
02:11:04,109 --> 02:11:08,880
[Music]

3357
02:11:06,319 --> 02:11:11,759
when we are calling this code

3358
02:11:08,880 --> 02:11:13,359
uh to get us the quadrant index that

3359
02:11:11,760 --> 02:11:15,280
actually does make

3360
02:11:13,359 --> 02:11:16,639
a fair bit of sense there

3361
02:11:15,279 --> 02:11:19,679
uh

3362
02:11:16,639 --> 02:11:20,800
because we need to remove the z

3363
02:11:19,679 --> 02:11:23,199
from

3364
02:11:20,800 --> 02:11:26,480
uh our request and get caught quadrant

3365
02:11:23,198 --> 02:11:30,719
four because we're passing

3366
02:11:26,479 --> 02:11:32,879
one here right so the remainder value

3367
02:11:30,719 --> 02:11:36,158
is producing an

3368
02:11:32,880 --> 02:11:40,078
accurate estimate of where we are in z

3369
02:11:36,158 --> 02:11:40,078
and we don't want to do that right

3370
02:11:44,639 --> 02:11:49,199
uh that's actually correct

3371
02:11:47,520 --> 02:11:52,920
like that assertion was telling us

3372
02:11:49,198 --> 02:11:52,919
something valid right

3373
02:11:54,238 --> 02:11:56,238
okay

3374
02:11:55,359 --> 02:11:58,000
um

3375
02:11:56,238 --> 02:12:00,000
so i think that should be computing the

3376
02:11:58,000 --> 02:12:02,078
quadrant table properly

3377
02:12:00,000 --> 02:12:04,078
uh but i also don't know where we

3378
02:12:02,078 --> 02:12:05,198
allocate those tables

3379
02:12:04,078 --> 02:12:07,439
um

3380
02:12:05,198 --> 02:12:10,319
if it actually

3381
02:12:07,439 --> 02:12:11,279
needs to be doing uh

3382
02:12:10,319 --> 02:12:13,599
like

3383
02:12:11,279 --> 02:12:15,439
where we are when we're doing this max

3384
02:12:13,599 --> 02:12:17,760
desk count here

3385
02:12:15,439 --> 02:12:17,759
um

3386
02:12:19,279 --> 02:12:25,519
the max cost per ray

3387
02:12:23,520 --> 02:12:27,280
is

3388
02:12:25,520 --> 02:12:29,119
so you know what it's already factored

3389
02:12:27,279 --> 02:12:32,319
in so we're already not going to push

3390
02:12:29,118 --> 02:12:34,319
more space on because we have the y and

3391
02:12:32,319 --> 02:12:36,639
the x are now the only two things that

3392
02:12:34,319 --> 02:12:39,198
we iterate over to produce the table so

3393
02:12:36,639 --> 02:12:42,480
it won't ever allocate ones for z

3394
02:12:39,198 --> 02:12:45,198
so this stepping is now i think

3395
02:12:42,479 --> 02:12:48,799
computed correctly in that sense right

3396
02:12:45,198 --> 02:12:50,879
like it it's now

3397
02:12:48,800 --> 02:12:52,800
that's now okay like i think that's

3398
02:12:50,880 --> 02:12:53,599
actually fine

3399
02:12:52,800 --> 02:12:55,279
so

3400
02:12:53,599 --> 02:12:58,078
when we go to do grid build spatial

3401
02:12:55,279 --> 02:12:58,078
partition here

3402
02:12:59,039 --> 02:13:02,719
this part we have to take a look at as

3403
02:13:01,039 --> 02:13:05,039
well because the

3404
02:13:02,719 --> 02:13:06,480
i i hope now that all of the things are

3405
02:13:05,039 --> 02:13:08,960
still getting inserted in this page but

3406
02:13:06,479 --> 02:13:11,359
i guess we don't actually know

3407
02:13:08,960 --> 02:13:12,639
uh whether that's true or not

3408
02:13:11,359 --> 02:13:15,759
so

3409
02:13:12,639 --> 02:13:17,679
hard to say uh but

3410
02:13:15,760 --> 02:13:19,920
i think

3411
02:13:17,679 --> 02:13:20,719
we are now properly walking through

3412
02:13:19,920 --> 02:13:24,078
uh

3413
02:13:20,719 --> 02:13:26,880
only 2d and we're properly aligning

3414
02:13:24,078 --> 02:13:30,479
um if that green box is correct

3415
02:13:26,880 --> 02:13:31,760
uh the spatial partition so i think

3416
02:13:30,479 --> 02:13:34,000
i think

3417
02:13:31,760 --> 02:13:36,480
we're probably okay

3418
02:13:34,000 --> 02:13:39,279
that said

3419
02:13:36,479 --> 02:13:41,279
the initial lookup

3420
02:13:39,279 --> 02:13:45,479
in to where we would be in the spatial

3421
02:13:41,279 --> 02:13:45,479
prediction is probably

3422
02:13:46,158 --> 02:13:50,638
well i don't know it might be wrong

3423
02:13:49,039 --> 02:13:53,519
this code right here where we do initial

3424
02:13:50,639 --> 02:13:55,760
grid index and we get a flat index from

3425
02:13:53,520 --> 02:13:58,400
the half atlas index plus the spatial

3426
02:13:55,760 --> 02:14:00,639
grid index offset because that atlas to

3427
02:13:58,399 --> 02:14:04,078
spatial grid index offset now has a zero

3428
02:14:00,639 --> 02:14:07,118
z value in theory we should always be

3429
02:14:04,078 --> 02:14:08,799
addressing with a zero z value

3430
02:14:07,118 --> 02:14:10,559
into

3431
02:14:08,800 --> 02:14:12,480
um

3432
02:14:10,560 --> 02:14:14,639
the spatial partition but i would like

3433
02:14:12,479 --> 02:14:16,238
to take a quick moment to see

3434
02:14:14,639 --> 02:14:17,118
if i'm right about that

3435
02:14:16,238 --> 02:14:19,279
um

3436
02:14:17,118 --> 02:14:20,399
because again like it's important that

3437
02:14:19,279 --> 02:14:22,158
we never

3438
02:14:20,399 --> 02:14:23,118
now ever use

3439
02:14:22,158 --> 02:14:24,719
uh

3440
02:14:23,118 --> 02:14:27,359
z in that way

3441
02:14:24,719 --> 02:14:30,560
so if we look at the atlas to spatial

3442
02:14:27,359 --> 02:14:34,158
uh you can see the z value is zero there

3443
02:14:30,560 --> 02:14:34,159
the half atlas index

3444
02:14:36,399 --> 02:14:40,719
is all zero so the z value that we would

3445
02:14:38,399 --> 02:14:44,960
be looking at would also be zero so is

3446
02:14:40,719 --> 02:14:44,960
that true like most of the time

3447
02:14:47,439 --> 02:14:50,439
hopefully

3448
02:14:54,800 --> 02:15:00,880
i'm just taking a look at what this

3449
02:14:57,439 --> 02:15:02,879
half atlas index z value is

3450
02:15:00,880 --> 02:15:04,639
right

3451
02:15:02,880 --> 02:15:06,840
um

3452
02:15:04,639 --> 02:15:09,520
but it looks

3453
02:15:06,840 --> 02:15:11,840
like there you know it's always pegged

3454
02:15:09,520 --> 02:15:16,040
to zero

3455
02:15:11,840 --> 02:15:16,039
for all intents and purposes right

3456
02:15:29,359 --> 02:15:33,000
all right um

3457
02:16:01,520 --> 02:16:04,520
so

3458
02:16:05,599 --> 02:16:10,078
i guess now that we're probably only

3459
02:16:07,599 --> 02:16:11,840
stepping in two dimensions

3460
02:16:10,078 --> 02:16:12,960
uh now would probably be a good time to

3461
02:16:11,840 --> 02:16:15,520
debug

3462
02:16:12,960 --> 02:16:17,039
some of the lighting stuff that we are

3463
02:16:15,520 --> 02:16:21,679
seeing

3464
02:16:17,039 --> 02:16:22,100
so uh let's try to do

3465
02:16:21,679 --> 02:16:25,189
um

3466
02:16:22,100 --> 02:16:25,189
[Music]

3467
02:16:28,479 --> 02:16:34,000
let's try to do an inspection of the

3468
02:16:31,359 --> 02:16:36,000
spatial partition

3469
02:16:34,000 --> 02:16:37,439
somehow

3470
02:16:36,000 --> 02:16:39,280
uh

3471
02:16:37,439 --> 02:16:40,880
maybe we just insert some new code to

3472
02:16:39,280 --> 02:16:43,519
draw it since it doesn't look like we

3473
02:16:40,879 --> 02:16:45,358
really had much code to draw it

3474
02:16:43,519 --> 02:16:47,760
so maybe we

3475
02:16:45,359 --> 02:16:48,639
uh the octahedral

3476
02:16:47,760 --> 02:16:50,079
um

3477
02:16:48,638 --> 02:16:51,679
because we're in a failure state right

3478
02:16:50,079 --> 02:16:55,200
now where there's no lighting being

3479
02:16:51,679 --> 02:16:58,558
generated so i should be able to safely

3480
02:16:55,200 --> 02:17:00,000
turn off the directional drawing

3481
02:16:58,558 --> 02:17:01,279
because we don't need to know that like

3482
02:17:00,000 --> 02:17:02,879
we can see that the lighting is being

3483
02:17:01,280 --> 02:17:04,639
computed incorrectly just by the fact

3484
02:17:02,879 --> 02:17:09,279
that there's no lighting

3485
02:17:04,638 --> 02:17:09,279
so i can turn off the probe directions

3486
02:17:09,439 --> 02:17:14,398
uh in the octahedral the debug draw

3487
02:17:12,079 --> 02:17:16,398
octahedral values

3488
02:17:14,398 --> 02:17:18,718
so we'll start there

3489
02:17:16,398 --> 02:17:23,439
and we'll say yeah don't

3490
02:17:18,718 --> 02:17:26,839
you know uh don't draw those directional

3491
02:17:23,439 --> 02:17:29,679
uh values the debug draw color this this

3492
02:17:26,840 --> 02:17:32,239
thing um let's just not we just aren't

3493
02:17:29,679 --> 02:17:32,239
gonna do that

3494
02:17:32,959 --> 02:17:37,438
so now we'll we'll only be drawing

3495
02:17:36,398 --> 02:17:40,000
um

3496
02:17:37,439 --> 02:17:43,439
just the boxes because i would like to

3497
02:17:40,000 --> 02:17:45,359
see where they are right so i would like

3498
02:17:43,439 --> 02:17:48,800
that

3499
02:17:45,359 --> 02:17:52,719
maybe because there's less i can also

3500
02:17:48,799 --> 02:17:52,718
draw the actual atlas

3501
02:17:55,359 --> 02:17:58,800
because it's not drawing the little

3502
02:17:56,799 --> 02:18:01,039
lines anymore

3503
02:17:58,799 --> 02:18:04,558
uh so now we can see like that's the

3504
02:18:01,040 --> 02:18:06,800
complete set of light probe locations

3505
02:18:04,558 --> 02:18:10,558
so that's good

3506
02:18:06,799 --> 02:18:12,318
uh i will turn off the colliders for now

3507
02:18:10,558 --> 02:18:15,679
because we don't really need them

3508
02:18:12,318 --> 02:18:17,519
they're just adding visual noise

3509
02:18:15,679 --> 02:18:19,120
uh because we know that they are roughly

3510
02:18:17,519 --> 02:18:20,559
exactly where the things we see on the

3511
02:18:19,120 --> 02:18:22,559
screen are and they just extend up

3512
02:18:20,558 --> 02:18:23,759
higher if they are walls

3513
02:18:22,558 --> 02:18:25,920
that's about

3514
02:18:23,760 --> 02:18:29,359
it right

3515
02:18:25,920 --> 02:18:31,519
um so you know here's here's just the

3516
02:18:29,359 --> 02:18:34,479
the general thing we're looking at

3517
02:18:31,519 --> 02:18:38,239
and now let's try if we can to

3518
02:18:34,478 --> 02:18:40,959
draw the spatial partition in some way

3519
02:18:38,239 --> 02:18:43,840
so if i go ahead and do

3520
02:18:40,959 --> 02:18:43,839
something like

3521
02:18:47,040 --> 02:18:53,280
debug draw

3522
02:18:49,638 --> 02:18:55,358
spatial grid or something like that

3523
02:18:53,280 --> 02:18:58,000
uh we wouldn't be taking any atlases

3524
02:18:55,359 --> 02:19:01,760
because these are just this is its own

3525
02:18:58,000 --> 02:19:04,159
like david s pumpkins it's its own thing

3526
02:19:01,760 --> 02:19:05,280
uh so we should be able to go ahead and

3527
02:19:04,159 --> 02:19:07,439
take

3528
02:19:05,280 --> 02:19:08,319
the spatial grid

3529
02:19:07,439 --> 02:19:09,599
and

3530
02:19:08,318 --> 02:19:11,679
step over

3531
02:19:09,599 --> 02:19:13,200
the actual

3532
02:19:11,679 --> 02:19:16,318
voxel

3533
02:19:13,200 --> 02:19:19,200
so we know we're gonna have you know

3534
02:19:16,318 --> 02:19:20,638
just x and y here for the

3535
02:19:19,200 --> 02:19:21,840
the spatial grid right we're basically

3536
02:19:20,638 --> 02:19:24,159
going to have something that looks like

3537
02:19:21,840 --> 02:19:24,159
this

3538
02:19:26,799 --> 02:19:30,959
and the

3539
02:19:28,638 --> 02:19:34,679
voxel grid itself i can kind of pull out

3540
02:19:30,959 --> 02:19:34,678
as spatial grid

3541
02:19:36,638 --> 02:19:40,799
like so and

3542
02:19:38,398 --> 02:19:42,478
we can loop over the actual

3543
02:19:40,799 --> 02:19:46,599
uh

3544
02:19:42,478 --> 02:19:46,599
dimensions of the spatial grid

3545
02:19:48,000 --> 02:19:52,000
uh here so we've got the cell count

3546
02:19:52,639 --> 02:19:59,279
x and y uh and we can also assert

3547
02:19:56,879 --> 02:20:00,879
that the spatial grid cell count z

3548
02:19:59,280 --> 02:20:02,560
equals one

3549
02:20:00,879 --> 02:20:04,318
right

3550
02:20:02,559 --> 02:20:07,519
now in here i mean the first thing we

3551
02:20:04,318 --> 02:20:09,039
can do is just see what the actual grid

3552
02:20:07,520 --> 02:20:11,280
locations are

3553
02:20:09,040 --> 02:20:13,840
uh because we should be able to do that

3554
02:20:11,280 --> 02:20:15,040
by just calling get cell bounds

3555
02:20:13,840 --> 02:20:17,600
right

3556
02:20:15,040 --> 02:20:21,200
so if i want to i can say like look just

3557
02:20:17,600 --> 02:20:22,479
where is this thing like like where is

3558
02:20:21,200 --> 02:20:25,120
the spatial

3559
02:20:22,478 --> 02:20:28,318
grid of this thing we'll start there

3560
02:20:25,120 --> 02:20:32,560
so if i said get cell bounds and i said

3561
02:20:28,318 --> 02:20:34,000
uh it's you know x y zero

3562
02:20:32,559 --> 02:20:36,159
what would be

3563
02:20:34,000 --> 02:20:38,159
what would you claim that that looks

3564
02:20:36,159 --> 02:20:40,239
like right and i and i'm gonna have to

3565
02:20:38,159 --> 02:20:42,799
put a color in here

3566
02:20:40,239 --> 02:20:45,039
uh so since we're using green it's it's

3567
02:20:42,799 --> 02:20:46,799
maybe it's it's green

3568
02:20:45,040 --> 02:20:50,319
for now

3569
02:20:46,799 --> 02:20:50,318
and if i call this

3570
02:20:54,000 --> 02:20:59,359
uh right after the octahedral values i

3571
02:20:56,079 --> 02:21:00,959
should be able to yeah figure out

3572
02:20:59,359 --> 02:21:03,280
what that looks like

3573
02:21:00,959 --> 02:21:03,279
um

3574
02:21:03,520 --> 02:21:07,120
little

3575
02:21:04,398 --> 02:21:11,199
parentheses nonsense there

3576
02:21:07,120 --> 02:21:12,640
so push debug box gets cell bounds

3577
02:21:11,200 --> 02:21:15,600
and

3578
02:21:12,639 --> 02:21:19,439
then the color value is a v3 not to be

3579
02:21:15,600 --> 02:21:19,439
oops a v3 not a v3s

3580
02:21:20,799 --> 02:21:24,799
what is debug pushbox complaining about

3581
02:21:23,040 --> 02:21:26,399
uh solution

3582
02:21:24,799 --> 02:21:28,079
get cell bounds that's a rectangle three

3583
02:21:26,398 --> 02:21:30,478
which is what we want oh it's a v4 i'm

3584
02:21:28,079 --> 02:21:32,639
sorry takes alpha as well oh isn't that

3585
02:21:30,478 --> 02:21:34,159
fancy

3586
02:21:32,639 --> 02:21:35,439
okay

3587
02:21:34,159 --> 02:21:38,318
um

3588
02:21:35,439 --> 02:21:41,840
recalling the code now

3589
02:21:38,318 --> 02:21:44,398
we should see the actual voxel

3590
02:21:41,840 --> 02:21:46,159
right uh which in this case is is you

3591
02:21:44,398 --> 02:21:48,879
know just tall

3592
02:21:46,159 --> 02:21:51,119
thin boxes uh that's exactly

3593
02:21:48,879 --> 02:21:52,719
what i would expect there should be no

3594
02:21:51,120 --> 02:21:55,120
vertical dividers

3595
02:21:52,719 --> 02:21:58,000
right because there's only one

3596
02:21:55,120 --> 02:21:59,439
layer so there's our you know

3597
02:21:58,000 --> 02:22:01,120
our voxel

3598
02:21:59,439 --> 02:22:03,040
now i'm gonna do

3599
02:22:01,120 --> 02:22:04,160
a little bit of like a color variation

3600
02:22:03,040 --> 02:22:08,760
here

3601
02:22:04,159 --> 02:22:08,760
um now because i don't care about

3602
02:22:08,959 --> 02:22:14,398
well actually you know what though let

3603
02:22:10,879 --> 02:22:16,159
me ask one quick question

3604
02:22:14,398 --> 02:22:17,920
were there four

3605
02:22:16,159 --> 02:22:18,799
well eight i guess

3606
02:22:17,920 --> 02:22:19,600
light

3607
02:22:18,799 --> 02:22:23,239
uh

3608
02:22:19,600 --> 02:22:23,239
locations here

3609
02:22:34,318 --> 02:22:38,079
it does look like it

3610
02:22:35,920 --> 02:22:41,040
so i do think it's correct in that there

3611
02:22:38,079 --> 02:22:43,280
are eight per cell which i think is the

3612
02:22:41,040 --> 02:22:45,439
correct number right

3613
02:22:43,280 --> 02:22:48,720
so

3614
02:22:45,439 --> 02:22:50,720
so that looks like it aligns

3615
02:22:48,719 --> 02:22:53,599
the way i would expect

3616
02:22:50,719 --> 02:22:54,149
that that looks fine

3617
02:22:53,600 --> 02:22:56,960
um

3618
02:22:54,149 --> 02:22:59,520
[Music]

3619
02:22:56,959 --> 02:23:00,639
i think that's fine

3620
02:22:59,520 --> 02:23:02,720
right

3621
02:23:00,639 --> 02:23:04,398
i think that's okay

3622
02:23:02,719 --> 02:23:05,199
uh but you know we'll we'll look a

3623
02:23:04,398 --> 02:23:07,039
little

3624
02:23:05,200 --> 02:23:08,880
closer later all right

3625
02:23:07,040 --> 02:23:10,080
um so i'm gonna

3626
02:23:08,879 --> 02:23:12,719
why is the

3627
02:23:10,079 --> 02:23:14,959
why is the compilation there we go

3628
02:23:12,719 --> 02:23:14,959
um

3629
02:23:15,680 --> 02:23:19,920
i'm gonna do one

3630
02:23:17,439 --> 02:23:21,840
other thing here with the coloring just

3631
02:23:19,920 --> 02:23:23,040
so we can see it a little bit better i'm

3632
02:23:21,840 --> 02:23:25,120
going to

3633
02:23:23,040 --> 02:23:27,840
maybe like alternate between two

3634
02:23:25,120 --> 02:23:30,160
different colors so so like maybe

3635
02:23:27,840 --> 02:23:30,960
we do something like

3636
02:23:30,159 --> 02:23:33,680
uh

3637
02:23:30,959 --> 02:23:35,919
i don't know x

3638
02:23:33,680 --> 02:23:35,920
uh

3639
02:23:36,318 --> 02:23:38,559
this is just

3640
02:23:37,439 --> 02:23:39,359
who knows

3641
02:23:38,559 --> 02:23:41,680
right

3642
02:23:39,359 --> 02:23:41,680
um

3643
02:23:42,159 --> 02:23:47,600
something like this nonsense so i'm just

3644
02:23:44,318 --> 02:23:50,318
gonna make like some kind of a

3645
02:23:47,600 --> 02:23:52,479
way of making neighboring cells use like

3646
02:23:50,318 --> 02:23:54,000
a different color

3647
02:23:52,478 --> 02:23:57,599
you know what i mean

3648
02:23:54,000 --> 02:23:58,398
uh so maybe like some cells are

3649
02:23:57,600 --> 02:24:01,439
uh

3650
02:23:58,398 --> 02:24:03,199
yellow in some cells or magenta or some

3651
02:24:01,439 --> 02:24:05,439
cells cyan i don't know something like

3652
02:24:03,200 --> 02:24:05,439
that

3653
02:24:05,680 --> 02:24:09,840
maybe cyan and magenta let's let's do

3654
02:24:08,079 --> 02:24:12,000
cyan magenta

3655
02:24:09,840 --> 02:24:13,600
um so that we can sort of

3656
02:24:12,000 --> 02:24:16,639
alternate between

3657
02:24:13,600 --> 02:24:17,439
them in some way that you know allows us

3658
02:24:16,639 --> 02:24:20,719
to

3659
02:24:17,439 --> 02:24:22,479
see the different cells more clear

3660
02:24:20,719 --> 02:24:23,519
cleanly

3661
02:24:22,478 --> 02:24:25,760
now the problem is they're going to kind

3662
02:24:23,520 --> 02:24:27,200
of overwrite each other because they

3663
02:24:25,760 --> 02:24:30,559
abut

3664
02:24:27,200 --> 02:24:31,760
um but you can kind of see you know

3665
02:24:30,559 --> 02:24:33,920
that there's like now there's like a

3666
02:24:31,760 --> 02:24:35,680
checkerboard pattern

3667
02:24:33,920 --> 02:24:36,879
you know right

3668
02:24:35,680 --> 02:24:38,639
um

3669
02:24:36,879 --> 02:24:41,119
of these things and so if i shrink them

3670
02:24:38,639 --> 02:24:42,719
slightly

3671
02:24:41,120 --> 02:24:45,600
so let's say we do a

3672
02:24:42,719 --> 02:24:48,159
bounce here where we say

3673
02:24:45,600 --> 02:24:48,159
shrink this

3674
02:24:49,120 --> 02:24:52,160
ever so slightly

3675
02:24:53,520 --> 02:24:55,520
so

3676
02:24:54,639 --> 02:24:57,439
um

3677
02:24:55,520 --> 02:25:00,399
you know

3678
02:24:57,439 --> 02:25:02,479
just just a little bit

3679
02:25:00,398 --> 02:25:03,959
so that i can see these uh just so i can

3680
02:25:02,478 --> 02:25:08,039
make sure that my checkerboard is

3681
02:25:03,959 --> 02:25:08,039
correct um

3682
02:25:10,000 --> 02:25:12,959
what is the complaint

3683
02:25:20,719 --> 02:25:25,760
that's the complaint

3684
02:25:23,439 --> 02:25:29,680
probably safe to start using auto now

3685
02:25:25,760 --> 02:25:29,680
these days right can we do this now

3686
02:25:30,879 --> 02:25:33,599
yeah

3687
02:25:31,840 --> 02:25:35,600
so you know we could start using auto

3688
02:25:33,600 --> 02:25:38,159
sometime on handmade hero if we wanted

3689
02:25:35,600 --> 02:25:41,600
to i don't know if we want to it's

3690
02:25:38,159 --> 02:25:44,478
really not that necessary but you know

3691
02:25:41,600 --> 02:25:46,800
saves you a little time

3692
02:25:44,478 --> 02:25:46,799
all right

3693
02:25:47,600 --> 02:25:52,800
um so in theory

3694
02:25:50,239 --> 02:25:55,520
now if we look uh we should be able to

3695
02:25:52,799 --> 02:25:57,279
see sort of a checkerboard pattern there

3696
02:25:55,520 --> 02:25:59,280
right and you can kind of see it

3697
02:25:57,280 --> 02:26:01,840
uh there's like a checkerboard pattern

3698
02:25:59,280 --> 02:26:02,800
of magenta and cyan

3699
02:26:01,840 --> 02:26:04,719
and

3700
02:26:02,799 --> 02:26:09,199
you know the only reason i'm doing that

3701
02:26:04,719 --> 02:26:10,318
is because if we get rid now of the uh

3702
02:26:09,200 --> 02:26:12,159
let me

3703
02:26:10,318 --> 02:26:14,639
when i said shrink i meant shrink for

3704
02:26:12,159 --> 02:26:16,799
some reason i instead of shrinking

3705
02:26:14,639 --> 02:26:18,639
i enlarged

3706
02:26:16,799 --> 02:26:20,159
oops

3707
02:26:18,639 --> 02:26:22,318
don't you hate it when you enlarge

3708
02:26:20,159 --> 02:26:26,239
instead of shrink

3709
02:26:22,318 --> 02:26:27,939
um with this one weird trick anyway uh

3710
02:26:26,239 --> 02:26:29,359
you can look and see

3711
02:26:27,940 --> 02:26:31,680
[Music]

3712
02:26:29,359 --> 02:26:34,720
the checkerboard pattern which i just

3713
02:26:31,680 --> 02:26:36,559
wanted now so that if i go draw

3714
02:26:34,719 --> 02:26:38,559
the things that are supposedly in these

3715
02:26:36,559 --> 02:26:40,239
spatial partitions

3716
02:26:38,559 --> 02:26:41,840
i would be able to see sort of like

3717
02:26:40,239 --> 02:26:43,039
which space partition they were in by

3718
02:26:41,840 --> 02:26:45,840
their color

3719
02:26:43,040 --> 02:26:45,840
at least a little bit

3720
02:26:47,200 --> 02:26:53,359
so let's go ahead and take a look at how

3721
02:26:51,680 --> 02:26:56,000
we pull things out of the spatial grid

3722
02:26:53,359 --> 02:26:57,760
now so if you look at the

3723
02:26:56,000 --> 02:26:59,439
um

3724
02:26:57,760 --> 02:27:02,960
lighting code here you can see that

3725
02:26:59,439 --> 02:27:05,040
we've got these like

3726
02:27:02,959 --> 02:27:07,358
nodes and leaves

3727
02:27:05,040 --> 02:27:07,359
um

3728
02:27:09,680 --> 02:27:14,840
you know i think the nodes literally

3729
02:27:11,680 --> 02:27:16,639
just say how many leaves there are right

3730
02:27:14,840 --> 02:27:18,239
um

3731
02:27:16,639 --> 02:27:20,559
that's it

3732
02:27:18,239 --> 02:27:20,559
uh

3733
02:27:24,000 --> 02:27:28,040
and i do think that like

3734
02:27:30,799 --> 02:27:34,398
you know in the future we can probably

3735
02:27:32,478 --> 02:27:36,000
get rid of that in direction entirely

3736
02:27:34,398 --> 02:27:38,159
because we know that the geometry is

3737
02:27:36,000 --> 02:27:39,200
relatively simple we could probably just

3738
02:27:38,159 --> 02:27:41,760
say

3739
02:27:39,200 --> 02:27:44,640
that there's four boxes or eight boxes

3740
02:27:41,760 --> 02:27:46,239
per cell and that's the end of it

3741
02:27:44,639 --> 02:27:48,318
and that would also simplify the code

3742
02:27:46,239 --> 02:27:51,318
quite a bit

3743
02:27:48,318 --> 02:27:51,318
um

3744
02:28:02,559 --> 02:28:04,959
so yeah

3745
02:28:09,920 --> 02:28:12,920
anyway

3746
02:28:15,359 --> 02:28:21,040
so if we look at this code uh

3747
02:28:18,879 --> 02:28:23,519
if we get out the spatial

3748
02:28:21,040 --> 02:28:26,560
node from i'm assuming that we can

3749
02:28:23,520 --> 02:28:29,200
simply make a call to get that right

3750
02:28:26,559 --> 02:28:29,199
where we can

3751
02:28:29,439 --> 02:28:33,200
ask for the flat index

3752
02:28:31,600 --> 02:28:34,880
uh and

3753
02:28:33,200 --> 02:28:37,280
grab out the

3754
02:28:34,879 --> 02:28:39,599
the node directly from there right so

3755
02:28:37,280 --> 02:28:41,920
you know this kind of thing

3756
02:28:39,600 --> 02:28:43,200
so in theory we should be able to say

3757
02:28:41,920 --> 02:28:47,200
like hey

3758
02:28:43,200 --> 02:28:48,560
uh get us whatever the flat index

3759
02:28:47,200 --> 02:28:50,720
uh is

3760
02:28:48,559 --> 02:28:52,478
for the particular node that we're

3761
02:28:50,719 --> 02:28:56,000
talking about

3762
02:28:52,478 --> 02:28:56,000
which in this case uh

3763
02:28:56,879 --> 02:29:00,559
we already have it's this

3764
02:29:02,719 --> 02:29:06,398
so if we want to do a flat index from

3765
02:29:04,559 --> 02:29:08,079
the node index here

3766
02:29:06,398 --> 02:29:09,199
in theory we just passed the spatial

3767
02:29:08,079 --> 02:29:11,600
grid

3768
02:29:09,200 --> 02:29:12,960
and it should just do it

3769
02:29:11,600 --> 02:29:13,840
right

3770
02:29:12,959 --> 02:29:16,959
um

3771
02:29:13,840 --> 02:29:17,920
so that should pull the node out

3772
02:29:16,959 --> 02:29:20,639
and

3773
02:29:17,920 --> 02:29:21,680
after we have the node we should be able

3774
02:29:20,639 --> 02:29:24,799
to do

3775
02:29:21,680 --> 02:29:28,239
just the simple leaf loop here

3776
02:29:24,799 --> 02:29:31,519
which gets us all of the leaves

3777
02:29:28,239 --> 02:29:36,478
and so then really all we have to do is

3778
02:29:31,520 --> 02:29:37,439
look at the leaf and and draw it right

3779
02:29:36,478 --> 02:29:39,519
so

3780
02:29:37,439 --> 02:29:42,720
if we look at one of these

3781
02:29:39,520 --> 02:29:44,479
one of these grid leaf structures

3782
02:29:42,719 --> 02:29:46,959
you can see we've got a boxman and a box

3783
02:29:44,478 --> 02:29:49,358
max we can just

3784
02:29:46,959 --> 02:29:52,559
pull out all four of them

3785
02:29:49,359 --> 02:29:54,800
and draw them one at a time

3786
02:29:52,559 --> 02:29:56,719
uh

3787
02:29:54,799 --> 02:29:59,438
i don't actually remember what we

3788
02:29:56,719 --> 02:30:01,358
defined our v3 so it's it just looks

3789
02:29:59,439 --> 02:30:03,439
like this right so we can literally just

3790
02:30:01,359 --> 02:30:05,200
like go through

3791
02:30:03,439 --> 02:30:06,398
all four of them like with a foreign

3792
02:30:05,200 --> 02:30:09,280
loop

3793
02:30:06,398 --> 02:30:11,599
right you can just say

3794
02:30:09,280 --> 02:30:11,600
um

3795
02:30:12,478 --> 02:30:14,719
hey

3796
02:30:14,879 --> 02:30:18,639
let's

3797
02:30:15,680 --> 02:30:21,280
let's loop over those in fact we could

3798
02:30:18,639 --> 02:30:21,279
even do this

3799
02:30:24,879 --> 02:30:28,569
loop over the

3800
02:30:26,559 --> 02:30:31,920
boxman

3801
02:30:28,569 --> 02:30:31,920
[Music]

3802
02:30:33,200 --> 02:30:37,520
maybe like this x

3803
02:30:36,159 --> 02:30:39,840
dot e

3804
02:30:37,520 --> 02:30:41,520
right so however many there are

3805
02:30:39,840 --> 02:30:42,478
uh that's how many we're going to loop

3806
02:30:41,520 --> 02:30:45,040
over

3807
02:30:42,478 --> 02:30:48,639
uh and then we can literally draw what

3808
02:30:45,040 --> 02:30:49,520
the boxes are supposedly in this thing

3809
02:30:48,639 --> 02:30:50,959
so

3810
02:30:49,520 --> 02:30:55,600
we would know

3811
02:30:50,959 --> 02:30:55,599
that the box is like you know

3812
02:30:56,159 --> 02:31:00,799
the bounds for this thing

3813
02:30:58,159 --> 02:31:04,318
are erect min max that's going to come

3814
02:31:00,799 --> 02:31:06,159
from slicing off of this you know

3815
02:31:04,318 --> 02:31:09,279
v3

3816
02:31:06,159 --> 02:31:11,439
uh this this sort of cmd wide

3817
02:31:09,280 --> 02:31:13,600
v3 value

3818
02:31:11,439 --> 02:31:15,359
i wish that the cats have definitely

3819
02:31:13,600 --> 02:31:16,479
decided that they don't love my

3820
02:31:15,359 --> 02:31:19,040
microphone

3821
02:31:16,478 --> 02:31:20,959
they're not fans of it

3822
02:31:19,040 --> 02:31:22,479
um so they keep knocking the cord down

3823
02:31:20,959 --> 02:31:24,959
which is always good

3824
02:31:22,478 --> 02:31:28,318
let's put that back up

3825
02:31:24,959 --> 02:31:30,478
uh so we just need to grab out the you

3826
02:31:28,318 --> 02:31:31,680
know the x y and the z of a particular

3827
02:31:30,478 --> 02:31:33,920
slice

3828
02:31:31,680 --> 02:31:36,800
which is pretty easy to do

3829
02:31:33,920 --> 02:31:40,799
um i don't we may actually have

3830
02:31:36,799 --> 02:31:42,398
extraction values extraction uh routines

3831
02:31:40,799 --> 02:31:43,920
for that

3832
02:31:42,398 --> 02:31:46,159
i don't actually remember but i'll take

3833
02:31:43,920 --> 02:31:48,559
a quick look because we may we may have

3834
02:31:46,159 --> 02:31:50,000
a way of you just grabbing out a slice

3835
02:31:48,559 --> 02:31:52,000
uh because it's something you want to do

3836
02:31:50,000 --> 02:31:53,439
when you're debugging yeah you can see

3837
02:31:52,000 --> 02:31:54,639
it right here so

3838
02:31:53,439 --> 02:31:58,159
we can just

3839
02:31:54,639 --> 02:31:58,159
use get component to do it

3840
02:31:59,760 --> 02:32:02,960
and that should be pretty

3841
02:32:01,120 --> 02:32:04,240
straightforward so

3842
02:32:02,959 --> 02:32:07,519
um

3843
02:32:04,239 --> 02:32:09,520
we want to take the boxman

3844
02:32:07,520 --> 02:32:12,159
and the box max

3845
02:32:09,520 --> 02:32:12,880
and again we're just slicing this array

3846
02:32:12,159 --> 02:32:15,359
to

3847
02:32:12,879 --> 02:32:17,279
grab out the cmd portion you know into

3848
02:32:15,359 --> 02:32:19,920
it into a scalar portion to use debug

3849
02:32:17,280 --> 02:32:21,040
routines on it that's it

3850
02:32:19,920 --> 02:32:23,200
i

3851
02:32:21,040 --> 02:32:26,000
i guess i'll do

3852
02:32:23,200 --> 02:32:27,760
box bounds here just to disambiguate it

3853
02:32:26,000 --> 02:32:29,760
so that it doesn't use the same value as

3854
02:32:27,760 --> 02:32:31,600
this this is the cell bounds so we'll

3855
02:32:29,760 --> 02:32:33,760
call it cell bounds

3856
02:32:31,600 --> 02:32:36,479
and box bounds so that we're clear on

3857
02:32:33,760 --> 02:32:39,040
which bounds are which

3858
02:32:36,478 --> 02:32:41,599
and now i just want to look and see like

3859
02:32:39,040 --> 02:32:44,560
what are we looking at like

3860
02:32:41,600 --> 02:32:45,920
what's in the spatial partition right

3861
02:32:44,559 --> 02:32:47,920
and so

3862
02:32:45,920 --> 02:32:49,680
uh i'm gonna start by turning off the

3863
02:32:47,920 --> 02:32:52,159
cell boundaries

3864
02:32:49,680 --> 02:32:54,880
so that i just i'm only looking at at

3865
02:32:52,159 --> 02:32:54,879
leaves here

3866
02:32:55,040 --> 02:32:58,960
and then we're going to see we're going

3867
02:32:56,478 --> 02:33:00,239
to just debug the spatial building code

3868
02:32:58,959 --> 02:33:01,839
till we see

3869
02:33:00,239 --> 02:33:02,879
correct stuff

3870
02:33:01,840 --> 02:33:04,478
right

3871
02:33:02,879 --> 02:33:06,559
so right off the bat you can kind of see

3872
02:33:04,478 --> 02:33:08,799
the problem

3873
02:33:06,559 --> 02:33:08,799
uh

3874
02:33:09,200 --> 02:33:14,960
some debug system nonsense there

3875
02:33:12,478 --> 02:33:17,599
uh it looks like we're really not

3876
02:33:14,959 --> 02:33:19,039
putting anything in here

3877
02:33:17,600 --> 02:33:21,040
you know what i'm saying

3878
02:33:19,040 --> 02:33:23,920
so it looks like we're getting an early

3879
02:33:21,040 --> 02:33:26,160
failure uh when we're trying to build

3880
02:33:23,920 --> 02:33:28,799
the spatial partition

3881
02:33:26,159 --> 02:33:31,359
uh we've got some error probably with

3882
02:33:28,799 --> 02:33:32,398
our the way that we're handling our z

3883
02:33:31,359 --> 02:33:35,200
right

3884
02:33:32,398 --> 02:33:37,358
uh where we're thinking that nothing is

3885
02:33:35,200 --> 02:33:39,760
actually included in the

3886
02:33:37,359 --> 02:33:42,760
uh in the region

3887
02:33:39,760 --> 02:33:42,760
so

3888
02:33:48,000 --> 02:33:50,719
would assume

3889
02:33:53,280 --> 02:33:56,720
i would assume that this is a simple

3890
02:33:54,879 --> 02:33:58,879
case of again just not like treating

3891
02:33:56,719 --> 02:34:00,959
these values like because we we didn't

3892
02:33:58,879 --> 02:34:03,039
quite uh produce the values to be

3893
02:34:00,959 --> 02:34:05,839
completely correct here

3894
02:34:03,040 --> 02:34:07,680
so uh when we did the zeroing out the z

3895
02:34:05,840 --> 02:34:09,120
so if we take a look at the grid uh

3896
02:34:07,680 --> 02:34:11,280
build oops

3897
02:34:09,120 --> 02:34:12,640
grid build there it is

3898
02:34:11,280 --> 02:34:14,640
so we take a look at grid build spatial

3899
02:34:12,639 --> 02:34:17,840
partition here and we look at what we're

3900
02:34:14,639 --> 02:34:17,840
passing in

3901
02:34:19,600 --> 02:34:23,840
we start by talking about a thing called

3902
02:34:22,159 --> 02:34:27,200
a clipping region which starts with the

3903
02:34:23,840 --> 02:34:31,439
total bounds which is what we'd expect

3904
02:34:27,200 --> 02:34:33,840
we then reduce the total bounds by one

3905
02:34:31,439 --> 02:34:37,359
cell and there's your answer right there

3906
02:34:33,840 --> 02:34:38,239
so that would completely eliminate our z

3907
02:34:37,359 --> 02:34:39,200
uh

3908
02:34:38,239 --> 02:34:41,439
so

3909
02:34:39,200 --> 02:34:43,200
so we don't want to do that

3910
02:34:41,439 --> 02:34:45,680
right uh

3911
02:34:43,200 --> 02:34:49,200
so

3912
02:34:45,680 --> 02:34:52,479
we want to do a clip shrink here

3913
02:34:49,200 --> 02:34:56,840
uh that looks like that and

3914
02:34:52,478 --> 02:34:56,840
we want to get rid of the z

3915
02:34:59,120 --> 02:35:04,319
so this way we're keeping the full range

3916
02:35:01,840 --> 02:35:06,559
uh that obviously was a huge issue so

3917
02:35:04,318 --> 02:35:08,959
that's you know we had to fix that but

3918
02:35:06,559 --> 02:35:11,359
we're probably not quite done yet

3919
02:35:08,959 --> 02:35:13,919
um so for starters we need to prevent

3920
02:35:11,359 --> 02:35:16,800
that shrinking of the clipping volume

3921
02:35:13,920 --> 02:35:20,639
and uh looks like somehow that didn't

3922
02:35:16,799 --> 02:35:23,599
change anything which is odd but oh well

3923
02:35:20,639 --> 02:35:25,439
um and then when we go through here

3924
02:35:23,600 --> 02:35:27,920
and we walk through all the boxes that

3925
02:35:25,439 --> 02:35:28,960
are in the lighting solution

3926
02:35:27,920 --> 02:35:32,318
you can

3927
02:35:28,959 --> 02:35:34,639
uh see us sort of looking at we

3928
02:35:32,318 --> 02:35:36,398
we're getting indexes for those mins and

3929
02:35:34,639 --> 02:35:38,398
maxes

3930
02:35:36,398 --> 02:35:40,478
um in the spatial grid right and then

3931
02:35:38,398 --> 02:35:44,079
we're looping over them

3932
02:35:40,478 --> 02:35:46,478
uh and figuring out like where they will

3933
02:35:44,079 --> 02:35:48,719
reside

3934
02:35:46,478 --> 02:35:48,719
so

3935
02:35:51,760 --> 02:35:54,880
that looks fine like i will have to step

3936
02:35:53,680 --> 02:35:57,439
through it and see if i may be missing

3937
02:35:54,879 --> 02:35:58,239
something but that looks fine

3938
02:35:57,439 --> 02:36:01,760
uh

3939
02:35:58,239 --> 02:36:04,719
then we go through here we do clipping

3940
02:36:01,760 --> 02:36:06,559
uh to the clipping region

3941
02:36:04,719 --> 02:36:08,398
which which should should not really be

3942
02:36:06,559 --> 02:36:10,719
a problem

3943
02:36:08,398 --> 02:36:10,719
um

3944
02:36:14,478 --> 02:36:20,079
this should all just be zero let me

3945
02:36:16,879 --> 02:36:21,199
assert that z equals zero here

3946
02:36:20,079 --> 02:36:22,799
um

3947
02:36:21,200 --> 02:36:23,680
because

3948
02:36:22,799 --> 02:36:26,799
like

3949
02:36:23,680 --> 02:36:28,398
we never really want

3950
02:36:26,799 --> 02:36:31,279
anything else

3951
02:36:28,398 --> 02:36:31,279
uh but yeah

3952
02:36:31,359 --> 02:36:36,000
the cell bounds that come out of this we

3953
02:36:33,680 --> 02:36:38,079
viewed those and they were right so that

3954
02:36:36,000 --> 02:36:40,398
should be okay

3955
02:36:38,079 --> 02:36:40,398
um

3956
02:36:40,959 --> 02:36:44,079
so so yeah i'm not

3957
02:36:45,600 --> 02:36:51,359
i'm not really seeing

3958
02:36:49,359 --> 02:36:54,399
what's screwed up about this routine but

3959
02:36:51,359 --> 02:36:54,829
obviously something pretty basic is

3960
02:36:54,398 --> 02:36:55,920
um

3961
02:36:54,829 --> 02:36:58,920
[Music]

3962
02:36:55,920 --> 02:36:58,920
so

3963
02:37:04,639 --> 02:37:06,639
ah

3964
02:37:05,840 --> 02:37:09,680
uh

3965
02:37:06,639 --> 02:37:09,680
this is our problem

3966
02:37:10,879 --> 02:37:13,149
right

3967
02:37:12,879 --> 02:37:16,269
so

3968
02:37:13,149 --> 02:37:16,270
[Music]

3969
02:37:16,639 --> 02:37:21,519
so we set the apron on z and we never

3970
02:37:19,840 --> 02:37:23,200
want that right

3971
02:37:21,520 --> 02:37:25,600
so the apron

3972
02:37:23,200 --> 02:37:26,640
for terminating the grid walk

3973
02:37:25,600 --> 02:37:29,359
must

3974
02:37:26,639 --> 02:37:32,799
we never ever want that to

3975
02:37:29,359 --> 02:37:34,720
count z as part of the apron so

3976
02:37:32,799 --> 02:37:36,719
i don't know if that really has much to

3977
02:37:34,719 --> 02:37:38,079
do with it here but that was certainly a

3978
02:37:36,719 --> 02:37:41,519
problem so that would have cleared out

3979
02:37:38,079 --> 02:37:41,520
anything in the spatial partition

3980
02:37:41,840 --> 02:37:44,318
at that point

3981
02:37:43,439 --> 02:37:45,120
so

3982
02:37:44,318 --> 02:37:47,920
uh

3983
02:37:45,120 --> 02:37:50,079
let's take a quick look here we got a

3984
02:37:47,920 --> 02:37:53,520
um we're pushing a few too many things

3985
02:37:50,079 --> 02:37:57,959
down uh so let's let's take a quick look

3986
02:37:53,520 --> 02:37:57,960
um at

3987
02:38:00,398 --> 02:38:04,239
turning this off we need more

3988
02:38:02,398 --> 02:38:06,000
we need better debug diagramming sport i

3989
02:38:04,239 --> 02:38:07,600
think we added reasonable new ones but

3990
02:38:06,000 --> 02:38:09,840
this lighting system uses its own which

3991
02:38:07,600 --> 02:38:12,318
is kind of stupid uh unifying those

3992
02:38:09,840 --> 02:38:14,478
would would be nice right

3993
02:38:12,318 --> 02:38:17,439
all right so here's our

3994
02:38:14,478 --> 02:38:19,760
you know supposed

3995
02:38:17,439 --> 02:38:22,079
here's our supposed

3996
02:38:19,760 --> 02:38:22,079
um

3997
02:38:22,879 --> 02:38:26,478
you know

3998
02:38:24,639 --> 02:38:29,119
spatial elements

3999
02:38:26,478 --> 02:38:31,760
for lack of a better term

4000
02:38:29,120 --> 02:38:33,840
and i'll be honest they don't

4001
02:38:31,760 --> 02:38:35,600
look convincing

4002
02:38:33,840 --> 02:38:38,000
to me

4003
02:38:35,600 --> 02:38:38,000
um

4004
02:38:38,559 --> 02:38:43,600
there's a lot of

4005
02:38:41,040 --> 02:38:45,359
kind of gunk in there and i'm not sure i

4006
02:38:43,600 --> 02:38:47,680
totally understand

4007
02:38:45,359 --> 02:38:47,680
why

4008
02:38:49,840 --> 02:38:53,600
you know what i'm saying to you

4009
02:38:52,159 --> 02:38:57,200
so

4010
02:38:53,600 --> 02:38:59,359
what's what's going on

4011
02:38:57,200 --> 02:39:01,760
amusingly the lighting now works again

4012
02:38:59,359 --> 02:39:03,600
so it was that term the fact that the it

4013
02:39:01,760 --> 02:39:06,559
was setting the entire grid to the

4014
02:39:03,600 --> 02:39:07,920
terminator the termination apron

4015
02:39:06,559 --> 02:39:09,600
um

4016
02:39:07,920 --> 02:39:11,600
because it happened to be on the edge in

4017
02:39:09,600 --> 02:39:13,200
z which was true we just don't ever

4018
02:39:11,600 --> 02:39:15,200
allow you to go off the edge and z

4019
02:39:13,200 --> 02:39:16,479
anymore so that's not an issue

4020
02:39:15,200 --> 02:39:19,920
um

4021
02:39:16,478 --> 02:39:21,519
there's something weird about

4022
02:39:19,920 --> 02:39:25,200
the

4023
02:39:21,520 --> 02:39:27,040
about these boxes right like like i

4024
02:39:25,200 --> 02:39:28,880
don't

4025
02:39:27,040 --> 02:39:30,080
i don't really understand what i'm

4026
02:39:28,879 --> 02:39:31,119
seeing

4027
02:39:30,079 --> 02:39:33,600
they're

4028
02:39:31,120 --> 02:39:36,240
really kind of incoherent

4029
02:39:33,600 --> 02:39:39,920
uh with respect like they're very sort

4030
02:39:36,239 --> 02:39:42,398
of like oddly aligned in in weird ways

4031
02:39:39,920 --> 02:39:44,079
so it feels a little off like like

4032
02:39:42,398 --> 02:39:45,439
either i'm drawing them wrong or

4033
02:39:44,079 --> 02:39:47,520
something

4034
02:39:45,439 --> 02:39:49,760
uh at the same time

4035
02:39:47,520 --> 02:39:52,239
they you know they do seem

4036
02:39:49,760 --> 02:39:54,960
accurately placed

4037
02:39:52,239 --> 02:39:55,920
like around like say the heroes

4038
02:39:54,959 --> 02:39:58,000
uh

4039
02:39:55,920 --> 02:39:59,600
there's the light i believe that is the

4040
02:39:58,000 --> 02:40:00,639
light that's hanging above the hero's

4041
02:39:59,600 --> 02:40:02,239
head

4042
02:40:00,639 --> 02:40:03,680
or something or the hero's collision

4043
02:40:02,239 --> 02:40:04,719
volume or whatever

4044
02:40:03,680 --> 02:40:06,398
um

4045
02:40:04,719 --> 02:40:08,398
it's not actually that inaccurate it's

4046
02:40:06,398 --> 02:40:10,239
following the hero correctly and stuff

4047
02:40:08,398 --> 02:40:12,799
so you know it's a little it's a little

4048
02:40:10,239 --> 02:40:14,478
confusing to me because it it doesn't

4049
02:40:12,799 --> 02:40:16,239
look that off

4050
02:40:14,478 --> 02:40:17,438
so i am having a little bit of a hard

4051
02:40:16,239 --> 02:40:19,119
time pricing what i'm seeing because

4052
02:40:17,439 --> 02:40:21,359
it's a little confusing

4053
02:40:19,120 --> 02:40:24,000
um but you know at the same time like

4054
02:40:21,359 --> 02:40:26,239
like what the heck is that

4055
02:40:24,000 --> 02:40:26,239
right

4056
02:40:27,200 --> 02:40:30,960
and amusingly

4057
02:40:28,719 --> 02:40:30,959
uh

4058
02:40:31,279 --> 02:40:34,640
those

4059
02:40:32,159 --> 02:40:36,559
boxes there which seem to coincide with

4060
02:40:34,639 --> 02:40:39,039
light sources like that's where the

4061
02:40:36,559 --> 02:40:40,559
light sources are as well

4062
02:40:39,040 --> 02:40:42,240
um

4063
02:40:40,559 --> 02:40:44,000
those

4064
02:40:42,239 --> 02:40:46,840
seem to be the places where we were

4065
02:40:44,000 --> 02:40:50,239
getting the weird

4066
02:40:46,840 --> 02:40:52,079
uh non-lit

4067
02:40:50,239 --> 02:40:54,478
uh probes as well

4068
02:40:52,079 --> 02:40:56,478
so i feel like there's just some basic

4069
02:40:54,478 --> 02:40:59,199
stupidity going on here

4070
02:40:56,478 --> 02:41:01,119
uh in a couple different ways

4071
02:40:59,200 --> 02:41:03,040
so we kind of need you know we can see

4072
02:41:01,120 --> 02:41:04,720
like that's a light

4073
02:41:03,040 --> 02:41:06,479
where where the lights are we get these

4074
02:41:04,719 --> 02:41:08,719
extra overlays

4075
02:41:06,478 --> 02:41:11,679
and

4076
02:41:08,719 --> 02:41:13,199
we probably need to fix that in fact

4077
02:41:11,680 --> 02:41:14,639
this may have been a bug that's been in

4078
02:41:13,200 --> 02:41:16,079
here for a while

4079
02:41:14,639 --> 02:41:18,000
the thing that says whether you're

4080
02:41:16,079 --> 02:41:21,039
inside something or not may have

4081
02:41:18,000 --> 02:41:23,439
incorrectly said don't be a don't probe

4082
02:41:21,040 --> 02:41:25,439
if you're inside a light

4083
02:41:23,439 --> 02:41:27,760
which is wrong

4084
02:41:25,439 --> 02:41:27,760
um

4085
02:41:28,398 --> 02:41:31,920
because lights are not supposed to be

4086
02:41:30,159 --> 02:41:34,159
occluders

4087
02:41:31,920 --> 02:41:35,520
you know what i'm saying

4088
02:41:34,159 --> 02:41:39,359
so

4089
02:41:35,520 --> 02:41:39,359
so that's a tough one uh

4090
02:41:40,559 --> 02:41:44,559
that's a tough one how we're supposed to

4091
02:41:42,318 --> 02:41:46,879
handle that i'm not sure

4092
02:41:44,559 --> 02:41:46,879
uh

4093
02:41:48,318 --> 02:41:53,199
maybe the way you handle that is like

4094
02:41:51,279 --> 02:41:54,800
so

4095
02:41:53,200 --> 02:41:56,720
when you hit

4096
02:41:54,799 --> 02:42:00,159
something you gather from the light

4097
02:41:56,719 --> 02:42:03,920
probe in that area right and

4098
02:42:00,159 --> 02:42:03,920
so the way that the actual

4099
02:42:04,159 --> 02:42:08,239
lighting function works where you

4100
02:42:06,559 --> 02:42:10,840
you do the casting right you do the grid

4101
02:42:08,239 --> 02:42:14,639
raycast this

4102
02:42:10,840 --> 02:42:15,680
thing um the transmission level

4103
02:42:14,639 --> 02:42:18,719
is

4104
02:42:15,680 --> 02:42:18,720
gathered from

4105
02:42:21,520 --> 02:42:24,600
a second

4106
02:42:29,439 --> 02:42:32,880
emission there we go

4107
02:42:33,920 --> 02:42:36,879
hit emission

4108
02:42:35,920 --> 02:42:40,719
so

4109
02:42:36,879 --> 02:42:42,639
you can see this like izzy mission

4110
02:42:40,719 --> 02:42:44,959
um

4111
02:42:42,639 --> 02:42:46,159
value here that allows light sources to

4112
02:42:44,959 --> 02:42:48,398
inject light

4113
02:42:46,159 --> 02:42:49,600
into the system

4114
02:42:48,398 --> 02:42:53,199
and so

4115
02:42:49,600 --> 02:42:55,840
really this like any true

4116
02:42:53,200 --> 02:42:55,840
this thing

4117
02:42:56,719 --> 02:43:01,438
really what should probably happen there

4118
02:42:58,959 --> 02:43:03,919
is we should have written out the

4119
02:43:01,439 --> 02:43:05,680
emission value if you're inside a light

4120
02:43:03,920 --> 02:43:06,840
source then your emission should be the

4121
02:43:05,680 --> 02:43:10,239
light source

4122
02:43:06,840 --> 02:43:10,239
value right

4123
02:43:10,559 --> 02:43:14,719
uh so that's confusing

4124
02:43:18,000 --> 02:43:22,760
so so i don't really know like

4125
02:43:46,398 --> 02:43:51,519
so really i think that's not uh it's not

4126
02:43:49,600 --> 02:43:54,800
appropriate like that doesn't make a lot

4127
02:43:51,520 --> 02:43:57,600
of sense you presumably want this thing

4128
02:43:54,799 --> 02:43:59,519
to properly set the emission value here

4129
02:43:57,600 --> 02:44:02,239
or something right like that's just kind

4130
02:43:59,520 --> 02:44:07,760
of it's obviously garbage so we probably

4131
02:44:02,239 --> 02:44:07,760
want that to be uh fixed right

4132
02:44:08,079 --> 02:44:12,959
all right so um

4133
02:44:10,879 --> 02:44:14,478
so that's busted

4134
02:44:12,959 --> 02:44:17,278
but that's not really the problem that

4135
02:44:14,478 --> 02:44:19,840
concerns me at the immediate moment

4136
02:44:17,279 --> 02:44:19,840
right

4137
02:44:26,639 --> 02:44:29,680
problem that concerns me at the

4138
02:44:27,520 --> 02:44:33,840
immediate moment is why this looks like

4139
02:44:29,680 --> 02:44:36,000
such a tangled mess um

4140
02:44:33,840 --> 02:44:37,840
i guess part of it is that there are

4141
02:44:36,000 --> 02:44:39,439
ceilings

4142
02:44:37,840 --> 02:44:42,159
right like

4143
02:44:39,439 --> 02:44:43,439
like there is a ceiling here

4144
02:44:42,159 --> 02:44:44,719
these things

4145
02:44:43,439 --> 02:44:45,680
um

4146
02:44:44,719 --> 02:44:48,559
so

4147
02:44:45,680 --> 02:44:52,159
there is that and then i don't know

4148
02:44:48,559 --> 02:44:52,159
about some of these side

4149
02:44:52,478 --> 02:44:54,809
uh

4150
02:44:53,840 --> 02:44:57,279
things here

4151
02:44:54,809 --> 02:45:00,318
[Music]

4152
02:44:57,279 --> 02:45:02,640
it's a little hard to say

4153
02:45:00,318 --> 02:45:02,639
um

4154
02:45:03,359 --> 02:45:07,760
what we're actually looking at

4155
02:45:05,200 --> 02:45:09,680
one thing i do think is really weird is

4156
02:45:07,760 --> 02:45:10,960
i don't understand why these lights are

4157
02:45:09,680 --> 02:45:12,800
so big

4158
02:45:10,959 --> 02:45:15,278
i guess one reason the lights are big is

4159
02:45:12,799 --> 02:45:17,119
to make them easier to hit

4160
02:45:15,279 --> 02:45:20,399
or something

4161
02:45:17,120 --> 02:45:21,840
but it's a bit odd right it is it is a

4162
02:45:20,398 --> 02:45:24,639
bit odd

4163
02:45:21,840 --> 02:45:27,200
uh but you know looking at it i don't

4164
02:45:24,639 --> 02:45:29,519
know it's it's at least we did figure

4165
02:45:27,200 --> 02:45:31,120
out what the primary bug was there i

4166
02:45:29,520 --> 02:45:33,439
think which is the fact that it was

4167
02:45:31,120 --> 02:45:36,000
setting the terminating apron

4168
02:45:33,439 --> 02:45:38,239
uh to the wrong thing so that's a start

4169
02:45:36,000 --> 02:45:39,840
but we're still a little bit

4170
02:45:38,239 --> 02:45:42,398
far from

4171
02:45:39,840 --> 02:45:45,840
from good here so let me take a quick

4172
02:45:42,398 --> 02:45:45,840
look let's uh

4173
02:45:50,398 --> 02:45:56,079
let's get rid of debug draw spatial grid

4174
02:45:53,359 --> 02:45:58,239
uh the call here and let's just look

4175
02:45:56,079 --> 02:46:00,559
again at what we're actually looking at

4176
02:45:58,239 --> 02:46:04,439
now in terms of you know

4177
02:46:00,559 --> 02:46:04,439
the look of the world

4178
02:46:13,920 --> 02:46:19,520
so it's like not fabulous but it's it's

4179
02:46:17,520 --> 02:46:21,840
like it's just off it's like you know

4180
02:46:19,520 --> 02:46:22,800
you can tell that's it's still a bit

4181
02:46:21,840 --> 02:46:24,799
buggy

4182
02:46:22,799 --> 02:46:28,318
but we've eliminated the really

4183
02:46:24,799 --> 02:46:28,318
egregious error right

4184
02:46:32,959 --> 02:46:36,559
um

4185
02:46:33,760 --> 02:46:39,520
and frame rate wise

4186
02:46:36,559 --> 02:46:41,920
were excellent uh if we look at our

4187
02:46:39,520 --> 02:46:43,040
frame rate here we're

4188
02:46:41,920 --> 02:46:46,719
totally

4189
02:46:43,040 --> 02:46:48,160
rocking 60 frames a second just fine now

4190
02:46:46,719 --> 02:46:49,599
um

4191
02:46:48,159 --> 02:46:51,520
and i think we could crank up the

4192
02:46:49,600 --> 02:46:54,079
lighting quite a bit now

4193
02:46:51,520 --> 02:46:56,960
so yeah i think we're okay

4194
02:46:54,079 --> 02:46:59,439
so really we're now looking more at

4195
02:46:56,959 --> 02:47:01,199
figuring out what's going on with the

4196
02:46:59,439 --> 02:47:03,279
light transport

4197
02:47:01,200 --> 02:47:05,680
the shift to off-center has clearly kind

4198
02:47:03,279 --> 02:47:07,200
of made it screwed up a bit and so

4199
02:47:05,680 --> 02:47:09,439
figuring out what's going on there i

4200
02:47:07,200 --> 02:47:10,479
think is our next goal

4201
02:47:09,439 --> 02:47:13,279
um

4202
02:47:10,478 --> 02:47:15,039
increasing the light shading rate

4203
02:47:13,279 --> 02:47:18,560
would be good too

4204
02:47:15,040 --> 02:47:21,439
and that's kind of a separate issue so

4205
02:47:18,559 --> 02:47:23,519
let's look at that light shading rate

4206
02:47:21,439 --> 02:47:26,479
issue uh so the light shading rate issue

4207
02:47:23,520 --> 02:47:28,640
is we would like this to look more like

4208
02:47:26,478 --> 02:47:30,639
say that

4209
02:47:28,639 --> 02:47:32,639
um

4210
02:47:30,639 --> 02:47:34,000
which is probably a bit aggressive so

4211
02:47:32,639 --> 02:47:35,358
you may probably won't be able to get it

4212
02:47:34,000 --> 02:47:36,398
that good but if you take a look at what

4213
02:47:35,359 --> 02:47:39,760
happens

4214
02:47:36,398 --> 02:47:43,039
um when we increase the shade uh the

4215
02:47:39,760 --> 02:47:44,318
response rate you can see how noisy how

4216
02:47:43,040 --> 02:47:46,000
much error there is because there's just

4217
02:47:44,318 --> 02:47:47,519
very little smoothing

4218
02:47:46,000 --> 02:47:49,680
going on

4219
02:47:47,520 --> 02:47:51,359
um and again that's just because it's a

4220
02:47:49,680 --> 02:47:52,800
stochastically sampled thing and we're

4221
02:47:51,359 --> 02:47:54,640
also not sampling it particularly

4222
02:47:52,799 --> 02:47:56,559
brilliantly like we don't necessarily

4223
02:47:54,639 --> 02:47:58,799
we're not horrible with our sampling

4224
02:47:56,559 --> 02:48:00,478
lighting but we're not great

4225
02:47:58,799 --> 02:48:02,079
um and so you can see it's better or

4226
02:48:00,478 --> 02:48:03,599
worse at certain times like you know

4227
02:48:02,079 --> 02:48:05,600
it's it's actually not that bad there

4228
02:48:03,600 --> 02:48:08,479
there's only a little bit of flicker

4229
02:48:05,600 --> 02:48:10,318
but in order to improve the quality of

4230
02:48:08,478 --> 02:48:11,599
this what we want to do is cast like

4231
02:48:10,318 --> 02:48:13,920
more rays

4232
02:48:11,600 --> 02:48:15,040
so that we can reduce the the degree of

4233
02:48:13,920 --> 02:48:19,920
lag so

4234
02:48:15,040 --> 02:48:19,920
if we go down to basically like um

4235
02:48:20,318 --> 02:48:25,359
if we're going at 60 frames a second

4236
02:48:22,478 --> 02:48:26,959
and we use a quarter right so it'd be

4237
02:48:25,359 --> 02:48:29,120
it'd be uh

4238
02:48:26,959 --> 02:48:30,639
it'd be four of those sixtieths of a

4239
02:48:29,120 --> 02:48:32,160
second right

4240
02:48:30,639 --> 02:48:34,719
um that would be a pretty reasonable

4241
02:48:32,159 --> 02:48:37,359
response rate and we'd only have to

4242
02:48:34,719 --> 02:48:39,199
cast uh about

4243
02:48:37,359 --> 02:48:40,960
you know i don't know what the threshold

4244
02:48:39,200 --> 02:48:44,240
would be here so

4245
02:48:40,959 --> 02:48:46,159
maybe seven times more raise maybe

4246
02:48:44,239 --> 02:48:47,439
four times more rays let's suppose let's

4247
02:48:46,159 --> 02:48:50,559
look at 4

4248
02:48:47,439 --> 02:48:55,000
over 60 here or 5 over 60. how bad is 5

4249
02:48:50,559 --> 02:48:55,000
over 60 i don't really know

4250
02:49:05,439 --> 02:49:10,840
um

4251
02:49:06,318 --> 02:49:10,840
so response rate wise

4252
02:49:14,559 --> 02:49:20,079
so the quality of 5 over 60 isn't

4253
02:49:17,120 --> 02:49:23,680
perfect but it's pretty good

4254
02:49:20,079 --> 02:49:26,879
so i would kind of say like at 5 over 60

4255
02:49:23,680 --> 02:49:29,359
i think we'd be okay um

4256
02:49:26,879 --> 02:49:32,079
quality wise so that's four times as

4257
02:49:29,359 --> 02:49:35,520
many arrays which i think we can do

4258
02:49:32,079 --> 02:49:37,359
like i think that's plausible right

4259
02:49:35,520 --> 02:49:38,880
what is going on here by the way why is

4260
02:49:37,359 --> 02:49:40,960
our apron code

4261
02:49:38,879 --> 02:49:42,398
like somehow

4262
02:49:40,959 --> 02:49:43,358
missing

4263
02:49:42,398 --> 02:49:45,519
uh

4264
02:49:43,359 --> 02:49:48,079
we changed the z and like our apron code

4265
02:49:45,520 --> 02:49:50,479
doesn't generate an apron on the right

4266
02:49:48,079 --> 02:49:50,478
border

4267
02:49:50,879 --> 02:49:54,959
on the positive border side for some

4268
02:49:53,040 --> 02:49:57,120
reason right

4269
02:49:54,959 --> 02:49:58,239
more more stuff as we go simplify we'll

4270
02:49:57,120 --> 02:50:00,479
have to like

4271
02:49:58,239 --> 02:50:02,799
you know

4272
02:50:00,478 --> 02:50:05,358
make that work a lot better

4273
02:50:02,799 --> 02:50:08,358
uh anyways so

4274
02:50:05,359 --> 02:50:08,359
yeah

4275
02:50:09,120 --> 02:50:14,240
i wonder if that's a good place to call

4276
02:50:11,120 --> 02:50:16,160
it for today uh

4277
02:50:14,239 --> 02:50:18,000
but yeah looking at the at the

4278
02:50:16,159 --> 02:50:20,398
difference here you know

4279
02:50:18,000 --> 02:50:22,478
a difference between

4280
02:50:20,398 --> 02:50:26,159
of casting maybe four times as many rays

4281
02:50:22,478 --> 02:50:28,159
isn't like that bad right uh and and if

4282
02:50:26,159 --> 02:50:30,639
we cast four many four times as many

4283
02:50:28,159 --> 02:50:34,239
rays we would have that quality

4284
02:50:30,639 --> 02:50:37,680
while still being um as responsive as a

4285
02:50:34,239 --> 02:50:39,840
20 over 60 which is pretty responsive

4286
02:50:37,680 --> 02:50:42,639
like that's pretty fast right so we'd

4287
02:50:39,840 --> 02:50:44,559
have reasonable quality at fairly high

4288
02:50:42,639 --> 02:50:46,959
responsive that's that's pretty darn

4289
02:50:44,559 --> 02:50:48,639
close i don't think anyone would notice

4290
02:50:46,959 --> 02:50:51,839
like uh

4291
02:50:48,639 --> 02:50:54,559
would notice that as being laggy

4292
02:50:51,840 --> 02:50:56,159
um so i think we can get to roughly this

4293
02:50:54,559 --> 02:50:58,079
speed uh

4294
02:50:56,159 --> 02:50:59,520
which would be great and that's

4295
02:50:58,079 --> 02:51:01,760
because and and we might even be able to

4296
02:50:59,520 --> 02:51:03,760
do better than that because like because

4297
02:51:01,760 --> 02:51:05,520
things will be much simpler now we can

4298
02:51:03,760 --> 02:51:07,520
optimize that rate casting routine more

4299
02:51:05,520 --> 02:51:10,079
than we did before

4300
02:51:07,520 --> 02:51:12,079
uh because we might be able to do things

4301
02:51:10,079 --> 02:51:14,159
to like you know we might be able to

4302
02:51:12,079 --> 02:51:16,239
make some clever optimizations now

4303
02:51:14,159 --> 02:51:19,840
knowing that z is is off the table which

4304
02:51:16,239 --> 02:51:19,840
we previously couldn't really do

4305
02:51:20,639 --> 02:51:25,760
so yeah uh so i think that's all right

4306
02:51:22,799 --> 02:51:25,759
uh but again

4307
02:51:25,920 --> 02:51:29,840
gonna have to do uh some work to get

4308
02:51:27,840 --> 02:51:32,000
there so one of the ways that this thing

4309
02:51:29,840 --> 02:51:36,719
currently works

4310
02:51:32,000 --> 02:51:40,079
if you look at how the grid raycast goes

4311
02:51:36,719 --> 02:51:42,879
so here's the grid raycaster right

4312
02:51:40,079 --> 02:51:44,559
the way this works is it takes a ray

4313
02:51:42,879 --> 02:51:48,239
origin

4314
02:51:44,559 --> 02:51:50,478
and it does a cast of that ray through

4315
02:51:48,239 --> 02:51:53,279
the environment using

4316
02:51:50,478 --> 02:51:54,959
you know it's it's a wide cast in the

4317
02:51:53,279 --> 02:51:57,520
sense that it it compares against

4318
02:51:54,959 --> 02:52:00,559
multiple things in the environment

4319
02:51:57,520 --> 02:52:02,159
the rays themselves are not wide it

4320
02:52:00,559 --> 02:52:06,559
casts a single ray

4321
02:52:02,159 --> 02:52:06,559
uh for the for this walk right

4322
02:52:07,200 --> 02:52:12,040
um

4323
02:52:08,000 --> 02:52:12,040
and then when it's done

4324
02:52:19,920 --> 02:52:23,398
doing the walk

4325
02:52:34,000 --> 02:52:37,279
it does the sample

4326
02:52:37,439 --> 02:52:42,880
to pull out of the voxel right

4327
02:52:40,239 --> 02:52:45,760
what the lighting is there

4328
02:52:42,879 --> 02:52:47,278
uh and then it writes that into the

4329
02:52:45,760 --> 02:52:50,840
spectacle

4330
02:52:47,279 --> 02:52:50,840
at that location

4331
02:52:56,478 --> 02:52:59,478
right

4332
02:53:12,639 --> 02:53:19,680
now to be honest i don't really remember

4333
02:53:16,398 --> 02:53:22,398
why this is as wide as it is

4334
02:53:19,680 --> 02:53:24,720
so if you look at what it's doing here

4335
02:53:22,398 --> 02:53:26,959
uh it's blending

4336
02:53:24,719 --> 02:53:26,959
with

4337
02:53:34,559 --> 02:53:41,600
it's blending with five times four oh

4338
02:53:37,760 --> 02:53:44,239
sorry six times four so 24

4339
02:53:41,600 --> 02:53:47,439
uh 24 floats

4340
02:53:44,239 --> 02:53:47,439
which is all eight

4341
02:53:48,079 --> 02:53:54,079
uh

4342
02:53:50,200 --> 02:53:56,720
octahedral locations

4343
02:53:54,079 --> 02:54:03,639
but i don't

4344
02:53:56,719 --> 02:54:03,639
quite know why that would be happening

4345
02:54:07,600 --> 02:54:10,600
uh

4346
02:54:21,200 --> 02:54:24,960
i see

4347
02:54:22,239 --> 02:54:26,239
so in a single step of this routine we

4348
02:54:24,959 --> 02:54:29,199
actually do

4349
02:54:26,239 --> 02:54:30,318
eight raycasts one out of each

4350
02:54:29,200 --> 02:54:33,120
direction

4351
02:54:30,318 --> 02:54:36,318
of the octahedral so then now i do okay

4352
02:54:33,120 --> 02:54:39,279
so we just write we cast eight rays at

4353
02:54:36,318 --> 02:54:41,359
a time not wide just we do a loop over

4354
02:54:39,279 --> 02:54:44,800
eight rays and then we blend them back

4355
02:54:41,359 --> 02:54:47,040
in one step which makes good sense

4356
02:54:44,799 --> 02:54:47,039
um

4357
02:54:47,760 --> 02:54:50,478
i mean sure

4358
02:54:53,600 --> 02:54:58,439
so that all seems fine um

4359
02:55:06,959 --> 02:55:13,199
and it seems to me like we could run the

4360
02:55:09,600 --> 02:55:15,120
grid raycast more times

4361
02:55:13,200 --> 02:55:17,920
so you would think that that would mean

4362
02:55:15,120 --> 02:55:21,040
that basically like this routine

4363
02:55:17,920 --> 02:55:23,120
we could just run it multiple times

4364
02:55:21,040 --> 02:55:26,120
right

4365
02:55:23,120 --> 02:55:26,120
so

4366
02:55:30,318 --> 02:55:34,879
and and to be honest uh

4367
02:55:32,719 --> 02:55:36,959
probably you'd get more efficiency by

4368
02:55:34,879 --> 02:55:38,799
welding that into grid raycast where

4369
02:55:36,959 --> 02:55:40,318
grid raycast itself actually did it

4370
02:55:38,799 --> 02:55:41,039
because then you wouldn't

4371
02:55:40,318 --> 02:55:43,119
do

4372
02:55:41,040 --> 02:55:45,520
the load modify right

4373
02:55:43,120 --> 02:55:47,840
multiple times for no reason

4374
02:55:45,520 --> 02:55:50,159
so it'd be more efficient if grid

4375
02:55:47,840 --> 02:55:53,840
raycast could have built into it the

4376
02:55:50,159 --> 02:55:53,840
idea that the sample direction

4377
02:55:54,239 --> 02:55:59,279
could be updated inside that loop so it

4378
02:55:56,639 --> 02:56:00,639
would just do that loop like a few times

4379
02:55:59,279 --> 02:56:02,880
right

4380
02:56:00,639 --> 02:56:02,879
um

4381
02:56:06,000 --> 02:56:08,639
so i do think this is a little

4382
02:56:07,200 --> 02:56:10,399
inefficient

4383
02:56:08,639 --> 02:56:12,719
if we updated it the way that i'm

4384
02:56:10,398 --> 02:56:13,840
suggesting

4385
02:56:12,719 --> 02:56:17,599
i

4386
02:56:13,840 --> 02:56:18,960
but that said so if we look here at the

4387
02:56:17,600 --> 02:56:20,640
way that the

4388
02:56:18,959 --> 02:56:23,278
light sampling is going you can see here

4389
02:56:20,639 --> 02:56:25,840
that's like entropy index

4390
02:56:23,279 --> 02:56:28,800
uh and it's you know

4391
02:56:25,840 --> 02:56:28,799
it's got sort of a

4392
02:56:29,840 --> 02:56:33,040
it's got sort of a way of looping

4393
02:56:31,840 --> 02:56:36,079
through

4394
02:56:33,040 --> 02:56:40,439
to pull out which directions the rays

4395
02:56:36,079 --> 02:56:40,439
are getting sampled in right

4396
02:56:40,639 --> 02:56:44,939
and

4397
02:56:41,920 --> 02:56:46,239
presumably we base that off of uh

4398
02:56:44,940 --> 02:56:48,560
[Music]

4399
02:56:46,239 --> 02:56:48,559
you know

4400
02:56:50,879 --> 02:56:55,599
presumably we base that off of some kind

4401
02:56:53,279 --> 02:56:57,279
of what is entropy frame count used for

4402
02:56:55,600 --> 02:57:00,079
by the way

4403
02:56:57,279 --> 02:57:00,079
absolutely nothing

4404
02:57:04,478 --> 02:57:08,760
all right

4405
02:57:05,760 --> 02:57:08,760
um

4406
02:57:10,159 --> 02:57:14,639
so like the sample point entropy and the

4407
02:57:12,559 --> 02:57:16,719
light point entropy

4408
02:57:14,639 --> 02:57:18,879
are the two things that are updated i

4409
02:57:16,719 --> 02:57:22,438
believe let's take a look

4410
02:57:18,879 --> 02:57:22,438
light point entropy

4411
02:57:26,159 --> 02:57:29,279
is this ever used

4412
02:57:34,879 --> 02:57:40,719
so light point entropy is not used

4413
02:57:37,600 --> 02:57:42,640
because uh we don't sample light sources

4414
02:57:40,719 --> 02:57:44,478
specifically anymore

4415
02:57:42,639 --> 02:57:46,719
right

4416
02:57:44,478 --> 02:57:46,719
um

4417
02:57:49,680 --> 02:57:52,239
all right

4418
02:57:51,200 --> 02:57:55,840
so

4419
02:57:52,239 --> 02:57:55,840
really it's just sample point entropy

4420
02:57:56,799 --> 02:58:02,719
that gets

4421
02:57:58,719 --> 02:58:07,438
sort of walked randomly as it goes

4422
02:58:02,719 --> 02:58:07,438
uh and the entropy index here

4423
02:58:09,840 --> 02:58:17,239
gets added every time after the full

4424
02:58:13,279 --> 02:58:17,239
cast gets called

4425
02:58:27,840 --> 02:58:31,079
i mean

4426
02:58:34,318 --> 02:58:39,019
these are all precomputed lookups into a

4427
02:58:36,398 --> 02:58:42,148
table anyway so i'm not quite sure

4428
02:58:39,020 --> 02:58:42,149
[Music]

4429
02:58:42,239 --> 02:58:47,840
that this makes a ton of sense how we're

4430
02:58:44,799 --> 02:58:47,840
doing this here

4431
02:58:54,000 --> 02:58:56,239
like

4432
02:58:56,559 --> 02:59:01,840
do we actually care

4433
02:58:59,359 --> 02:59:04,000
about entropy

4434
02:59:01,840 --> 02:59:07,279
in that way

4435
02:59:04,000 --> 02:59:08,318
i i can't imagine we actually do

4436
02:59:07,279 --> 02:59:10,720
um

4437
02:59:08,318 --> 02:59:12,639
like i would be surprised if we saw a

4438
02:59:10,719 --> 02:59:15,519
huge difference

4439
02:59:12,639 --> 02:59:16,799
uh in in the way that stuff works right

4440
02:59:15,520 --> 02:59:18,640
it seems

4441
02:59:16,799 --> 02:59:21,679
unlikely

4442
02:59:18,639 --> 02:59:23,358
so i don't really know about that i also

4443
02:59:21,680 --> 02:59:25,040
think that the way that this is set up

4444
02:59:23,359 --> 02:59:26,880
here doesn't make a whole lot of sense

4445
02:59:25,040 --> 02:59:29,359
either also this doesn't need a loop

4446
02:59:26,879 --> 02:59:30,959
over z because z can't ever be anything

4447
02:59:29,359 --> 02:59:32,079
anyway so it's only ever going to be a

4448
02:59:30,959 --> 02:59:33,599
loop

4449
02:59:32,079 --> 02:59:35,520
over x

4450
02:59:33,600 --> 02:59:37,520
because the atlas

4451
02:59:35,520 --> 02:59:39,120
uh can only do two well that's not true

4452
02:59:37,520 --> 02:59:41,279
i guess we have to do two layers of it

4453
02:59:39,120 --> 02:59:43,840
so that's not entirely true

4454
02:59:41,279 --> 02:59:43,840
um

4455
02:59:44,639 --> 02:59:49,760
so i would say this entropy index value

4456
02:59:47,359 --> 02:59:52,318
probably doesn't want to be updated here

4457
02:59:49,760 --> 02:59:55,120
that seems unlikely probably what wants

4458
02:59:52,318 --> 02:59:57,680
to happen is something like this

4459
02:59:55,120 --> 02:59:59,439
so inside full cast it can update the

4460
02:59:57,680 --> 03:00:02,159
entropy based on how many times it does

4461
02:59:59,439 --> 03:00:03,439
this so maybe this is a you know a

4462
03:00:02,159 --> 03:00:04,478
pointer

4463
03:00:03,439 --> 03:00:07,200
um

4464
03:00:04,478 --> 03:00:08,559
and so in here it would be more like

4465
03:00:07,200 --> 03:00:13,359
okay

4466
03:00:08,559 --> 03:00:14,239
you know uh star entropy index

4467
03:00:13,359 --> 03:00:15,200
uh

4468
03:00:14,239 --> 03:00:17,359
and

4469
03:00:15,200 --> 03:00:19,040
that's how the entropy index comes out

4470
03:00:17,359 --> 03:00:20,000
of this thing

4471
03:00:19,040 --> 03:00:22,399
uh

4472
03:00:20,000 --> 03:00:25,520
and then we do an entropy index plus

4473
03:00:22,398 --> 03:00:27,519
plus in here or something right

4474
03:00:25,520 --> 03:00:28,800
um i don't think this is great like i

4475
03:00:27,520 --> 03:00:30,479
think we'll probably want to change this

4476
03:00:28,799 --> 03:00:33,039
thing but i'm just kind of see what

4477
03:00:30,478 --> 03:00:35,438
happens if we hack this in

4478
03:00:33,040 --> 03:00:37,359
so uh that should be the same now as it

4479
03:00:35,439 --> 03:00:40,318
was yeah

4480
03:00:37,359 --> 03:00:41,359
um but we should now in theory be able

4481
03:00:40,318 --> 03:00:43,359
to like

4482
03:00:41,359 --> 03:00:45,840
loop this

4483
03:00:43,359 --> 03:00:46,640
so in other words if we want to

4484
03:00:45,840 --> 03:00:49,040
uh

4485
03:00:46,639 --> 03:00:53,000
in this piece of code here we should be

4486
03:00:49,040 --> 03:00:53,000
able to do something like

4487
03:00:53,840 --> 03:00:58,318
uh

4488
03:00:55,520 --> 03:01:01,120
do multiple samples so you know there's

4489
03:00:58,318 --> 03:01:02,639
like a sample batch and we just say all

4490
03:01:01,120 --> 03:01:05,040
right there's going to be like eight

4491
03:01:02,639 --> 03:01:06,799
sample batches run every frame

4492
03:01:05,040 --> 03:01:08,880
or something like this which should

4493
03:01:06,799 --> 03:01:12,559
which will slow things down a lot

4494
03:01:08,879 --> 03:01:12,559
but i just want to see if it works

4495
03:01:16,639 --> 03:01:20,159
yeah

4496
03:01:18,079 --> 03:01:20,959
um

4497
03:01:20,159 --> 03:01:23,119
so

4498
03:01:20,959 --> 03:01:25,278
oddly enough the smoothing is not as

4499
03:01:23,120 --> 03:01:27,920
much as it should be really there so i

4500
03:01:25,279 --> 03:01:30,920
think this is still a little bit

4501
03:01:27,920 --> 03:01:30,920
busted

4502
03:01:44,478 --> 03:01:49,079
so i'm just gonna play with this value

4503
03:01:45,680 --> 03:01:49,079
and see what happens

4504
03:02:02,239 --> 03:02:05,680
yeah so i think i'm like thinking of

4505
03:02:03,600 --> 03:02:07,760
this wrong or something because that

4506
03:02:05,680 --> 03:02:10,239
weirdly doesn't seem to change what's

4507
03:02:07,760 --> 03:02:11,600
happening and weirder still like it it

4508
03:02:10,239 --> 03:02:12,959
doesn't have as much of an effect on the

4509
03:02:11,600 --> 03:02:14,479
frame rate as it should i guess it kind

4510
03:02:12,959 --> 03:02:16,879
of does i mean that's significantly more

4511
03:02:14,478 --> 03:02:18,639
than it was but this is 16 times the

4512
03:02:16,879 --> 03:02:19,920
amount of raise so

4513
03:02:18,639 --> 03:02:21,278
that's a lot

4514
03:02:19,920 --> 03:02:24,079
so in theory

4515
03:02:21,279 --> 03:02:27,279
it should have been able to produce

4516
03:02:24,079 --> 03:02:29,359
sort of an equivalent

4517
03:02:27,279 --> 03:02:30,720
so i guess maybe part of the problem is

4518
03:02:29,359 --> 03:02:32,479
because the

4519
03:02:30,719 --> 03:02:34,879
it does it doesn't

4520
03:02:32,478 --> 03:02:37,039
it's just taking more samples

4521
03:02:34,879 --> 03:02:38,478
of the same world state it doesn't

4522
03:02:37,040 --> 03:02:40,240
diffuse

4523
03:02:38,478 --> 03:02:41,599
as many times as it should

4524
03:02:40,239 --> 03:02:44,600
meaning this

4525
03:02:41,600 --> 03:02:44,600
um

4526
03:02:44,799 --> 03:02:49,438
this atlas

4527
03:02:46,318 --> 03:02:51,439
like update doesn't run

4528
03:02:49,439 --> 03:02:52,559
so it could be that that

4529
03:02:51,439 --> 03:02:56,079
kind of has

4530
03:02:52,559 --> 03:02:56,079
a lot to do with it right like the

4531
03:02:56,639 --> 03:02:59,920
the casting the more raised doesn't

4532
03:02:58,318 --> 03:03:02,478
really help if those

4533
03:02:59,920 --> 03:03:04,960
casts aren't then fed back through the

4534
03:03:02,478 --> 03:03:04,959
system

4535
03:03:05,520 --> 03:03:08,000
maybe

4536
03:03:08,079 --> 03:03:10,959
i'm not really sure

4537
03:03:09,840 --> 03:03:13,600
uh

4538
03:03:10,959 --> 03:03:15,679
so that's a tough i don't know

4539
03:03:13,600 --> 03:03:18,479
that's very strange makes me think maybe

4540
03:03:15,680 --> 03:03:20,960
we've got some buggy

4541
03:03:18,478 --> 03:03:22,318
assumptions somewhere else maybe that's

4542
03:03:20,959 --> 03:03:24,159
making the lighting flicker more than it

4543
03:03:22,318 --> 03:03:27,159
should right

4544
03:03:24,159 --> 03:03:27,159
um

4545
03:03:29,760 --> 03:03:35,439
that's that's kind of my hunch there

4546
03:03:32,398 --> 03:03:35,439
right uh

4547
03:03:39,120 --> 03:03:46,120
so i don't know about that that's that's

4548
03:03:41,359 --> 03:03:46,120
a little yeah i'm hmm

4549
03:03:59,680 --> 03:04:03,520
because the lighting values that are

4550
03:04:01,520 --> 03:04:06,399
actually getting interpolated would in

4551
03:04:03,520 --> 03:04:08,239
theory be a lot more stable now however

4552
03:04:06,398 --> 03:04:09,760
it is true that if they don't write back

4553
03:04:08,239 --> 03:04:13,039
to the diffuse

4554
03:04:09,760 --> 03:04:13,040
texture then

4555
03:04:14,318 --> 03:04:19,039
maybe that lack of convecting the value

4556
03:04:17,279 --> 03:04:20,000
around does make a difference i don't

4557
03:04:19,040 --> 03:04:23,120
know

4558
03:04:20,000 --> 03:04:24,799
that's a tough one

4559
03:04:23,120 --> 03:04:27,120
that is a tough one

4560
03:04:24,799 --> 03:04:27,119
um

4561
03:04:34,318 --> 03:04:37,760
so

4562
03:04:35,279 --> 03:04:40,479
i guess i would say well

4563
03:04:37,760 --> 03:04:42,559
uh what happens if you run this thing

4564
03:04:40,478 --> 03:04:44,398
multiple times which would be much more

4565
03:04:42,559 --> 03:04:47,439
expensive so this will slow down the

4566
03:04:44,398 --> 03:04:48,478
frame rate like pretty viciously right

4567
03:04:47,439 --> 03:04:51,840
um

4568
03:04:48,478 --> 03:04:52,719
but i'm just curious to see if that is

4569
03:04:51,840 --> 03:04:54,559
what

4570
03:04:52,719 --> 03:04:58,478
would happen then

4571
03:04:54,559 --> 03:05:00,000
so if we did a

4572
03:04:58,478 --> 03:05:02,559
four

4573
03:05:00,000 --> 03:05:05,439
sample batch here

4574
03:05:02,559 --> 03:05:08,799
right

4575
03:05:05,439 --> 03:05:08,800
and we just ran this thing

4576
03:05:09,920 --> 03:05:14,600
multiple times then what happens

4577
03:05:23,040 --> 03:05:26,560
so something seems up because that

4578
03:05:25,120 --> 03:05:29,200
should then

4579
03:05:26,559 --> 03:05:30,239
spread the values out

4580
03:05:29,200 --> 03:05:31,920
multiple

4581
03:05:30,239 --> 03:05:34,000
times it should be the exact same

4582
03:05:31,920 --> 03:05:35,120
lighting as the one that we were doing

4583
03:05:34,000 --> 03:05:36,879
before

4584
03:05:35,120 --> 03:05:39,120
right

4585
03:05:36,879 --> 03:05:39,119
so

4586
03:05:39,600 --> 03:05:44,800
i guess well i do i have to change the

4587
03:05:42,559 --> 03:05:46,799
the blend rate though i mean maybe i

4588
03:05:44,799 --> 03:05:49,840
have to change the blend rate that's i

4589
03:05:46,799 --> 03:05:49,840
guess another question

4590
03:05:50,398 --> 03:05:58,318
right so the update rate maybe has to be

4591
03:05:55,040 --> 03:06:00,640
set down again to something small

4592
03:05:58,318 --> 03:06:00,639
right

4593
03:06:16,478 --> 03:06:19,840
so yeah i'm not really sure what to make

4594
03:06:18,159 --> 03:06:22,318
of that i think we probably want to just

4595
03:06:19,840 --> 03:06:24,239
go hunting for bugs i think we just

4596
03:06:22,318 --> 03:06:27,439
we're really seeing like other things

4597
03:06:24,239 --> 03:06:30,398
now but man the amount of performance we

4598
03:06:27,439 --> 03:06:33,840
get back is kind of sick because like

4599
03:06:30,398 --> 03:06:36,879
i'm just throwing in times 16 to the

4600
03:06:33,840 --> 03:06:38,960
left times 32 and the thing still runs

4601
03:06:36,879 --> 03:06:41,119
at like 30 frames a second

4602
03:06:38,959 --> 03:06:42,639
so yeah i guess i guess the answer

4603
03:06:41,120 --> 03:06:44,000
really is

4604
03:06:42,639 --> 03:06:46,719
don't throw out the lighting code

4605
03:06:44,000 --> 03:06:48,398
because it looks like we can rescue this

4606
03:06:46,719 --> 03:06:52,079
uh

4607
03:06:48,398 --> 03:06:53,920
it looks pretty good um so yeah i think

4608
03:06:52,079 --> 03:06:55,359
it just needs a little bit of meticulous

4609
03:06:53,920 --> 03:06:59,439
care here

4610
03:06:55,359 --> 03:06:59,439
uh to re-clean it up but you know

4611
03:06:59,680 --> 03:07:03,600
yeah i mean there's some weird stuff

4612
03:07:01,920 --> 03:07:06,318
going on that i think we can fix but

4613
03:07:03,600 --> 03:07:08,399
there's it updating basically like

4614
03:07:06,318 --> 03:07:09,439
locked like it's very

4615
03:07:08,398 --> 03:07:12,478
very

4616
03:07:09,439 --> 03:07:13,920
like almost no procedural no perceivable

4617
03:07:12,478 --> 03:07:16,079
lag

4618
03:07:13,920 --> 03:07:17,680
and it's perfectly smooth

4619
03:07:16,079 --> 03:07:19,520
so really there's just this weird like

4620
03:07:17,680 --> 03:07:22,000
there's some weird stuff happening where

4621
03:07:19,520 --> 03:07:24,479
that when the voxels shift

4622
03:07:22,000 --> 03:07:27,680
that like as we move so i think there's

4623
03:07:24,478 --> 03:07:29,920
just other bugs here so if we just go

4624
03:07:27,680 --> 03:07:32,079
actually take care of this

4625
03:07:29,920 --> 03:07:35,279
um

4626
03:07:32,079 --> 03:07:35,279
i think we're in good shape

4627
03:07:35,359 --> 03:07:40,079
uh i think we're gonna get our fully

4628
03:07:37,439 --> 03:07:43,920
dynamic global illumination

4629
03:07:40,079 --> 03:07:46,478
and just have our cake and eat it too

4630
03:07:43,920 --> 03:07:48,318
um so maybe i'll i'll stop for today

4631
03:07:46,478 --> 03:07:50,239
it's been about three and a half hours

4632
03:07:48,318 --> 03:07:53,318
that's a pretty long time to go without

4633
03:07:50,239 --> 03:07:53,318
a break

4634
03:08:00,000 --> 03:08:07,318
um

4635
03:08:02,239 --> 03:08:07,318
so i guess uh yeah i mean

4636
03:08:09,040 --> 03:08:14,000
i'm i am relatively optimistic about

4637
03:08:11,760 --> 03:08:14,000
that

4638
03:08:16,318 --> 03:08:20,639
like that just seems pretty promising so

4639
03:08:18,398 --> 03:08:22,159
i think we we might just be able to just

4640
03:08:20,639 --> 03:08:25,199
have this thing work and it's going to

4641
03:08:22,159 --> 03:08:26,559
be okay which is kind of nuts

4642
03:08:25,200 --> 03:08:28,960
um

4643
03:08:26,559 --> 03:08:30,639
but but i think that might be okay so i

4644
03:08:28,959 --> 03:08:33,839
think we just have to go through now and

4645
03:08:30,639 --> 03:08:36,159
be a little bit more meticulous about

4646
03:08:33,840 --> 03:08:37,680
removing z

4647
03:08:36,159 --> 03:08:40,000
you know what i'm saying

4648
03:08:37,680 --> 03:08:40,000
um

4649
03:08:40,398 --> 03:08:43,439
because it's pretty clear that our space

4650
03:08:41,760 --> 03:08:44,639
partition is messed up

4651
03:08:43,439 --> 03:08:46,079
and

4652
03:08:44,639 --> 03:08:48,079
because we were

4653
03:08:46,079 --> 03:08:51,279
we they the way that the lighting system

4654
03:08:48,079 --> 03:08:52,639
works is it's very uh specific as well

4655
03:08:51,279 --> 03:08:54,479
about

4656
03:08:52,639 --> 03:08:56,079
making sure

4657
03:08:54,478 --> 03:08:57,439
that it

4658
03:08:56,079 --> 03:08:59,039
aligns the

4659
03:08:57,440 --> 03:09:02,640
[Music]

4660
03:08:59,040 --> 03:09:05,200
atlases and the spatial grid together

4661
03:09:02,639 --> 03:09:06,559
and i don't actually know if that's like

4662
03:09:05,200 --> 03:09:08,560
currently

4663
03:09:06,559 --> 03:09:10,639
still working properly either with the

4664
03:09:08,559 --> 03:09:13,039
way that the walk table is computed you

4665
03:09:10,639 --> 03:09:14,840
know what i'm saying

4666
03:09:13,040 --> 03:09:17,120
like you can see here the starting

4667
03:09:14,840 --> 03:09:18,960
location uh

4668
03:09:17,120 --> 03:09:20,180
having

4669
03:09:18,959 --> 03:09:22,318
being based on some

4670
03:09:20,180 --> 03:09:22,940
[Music]

4671
03:09:22,318 --> 03:09:25,439
some

4672
03:09:22,940 --> 03:09:28,479
[Music]

4673
03:09:25,439 --> 03:09:30,398
ideas about where stuff is in the world

4674
03:09:28,478 --> 03:09:33,278
relative like this starting location

4675
03:09:30,398 --> 03:09:36,159
bakes in knowledge of how the atlas

4676
03:09:33,279 --> 03:09:37,120
is centered relative to the spatial

4677
03:09:36,159 --> 03:09:38,398
uh

4678
03:09:37,120 --> 03:09:40,079
grid

4679
03:09:38,398 --> 03:09:43,079
you know

4680
03:09:40,079 --> 03:09:43,079
and

4681
03:09:45,439 --> 03:09:48,318
so

4682
03:09:46,639 --> 03:09:51,119
i'm not sure whether that stuff's

4683
03:09:48,318 --> 03:09:52,879
correct either i think it looks like it

4684
03:09:51,120 --> 03:09:55,120
roughly is because they did look like

4685
03:09:52,879 --> 03:09:57,599
they were aligned in exactly this way

4686
03:09:55,120 --> 03:09:59,840
and we now don't care about the z value

4687
03:09:57,600 --> 03:09:59,840
right

4688
03:10:00,719 --> 03:10:05,959
because the z value doesn't matter

4689
03:10:02,959 --> 03:10:05,959
so

4690
03:10:13,920 --> 03:10:18,159
so i do think we're roughly correct but

4691
03:10:16,398 --> 03:10:19,519
again you could see that there was just

4692
03:10:18,159 --> 03:10:21,439
you know there were definitely some bugs

4693
03:10:19,520 --> 03:10:23,279
in there so my assumption now is just

4694
03:10:21,439 --> 03:10:25,200
that like yeah i'm going to have to kind

4695
03:10:23,279 --> 03:10:27,680
of fine tooth comb it

4696
03:10:25,200 --> 03:10:29,359
but i think we can use this i think it's

4697
03:10:27,680 --> 03:10:30,880
actually pretty good

4698
03:10:29,359 --> 03:10:33,680
uh so

4699
03:10:30,879 --> 03:10:35,278
maybe we're just kind of done with

4700
03:10:33,680 --> 03:10:36,800
lighting it rather than having to

4701
03:10:35,279 --> 03:10:38,960
simplify it

4702
03:10:36,799 --> 03:10:41,679
what we have may just be good enough and

4703
03:10:38,959 --> 03:10:44,478
so let's just debug the 2d eyes version

4704
03:10:41,680 --> 03:10:46,159
of it and and then we can just have it

4705
03:10:44,478 --> 03:10:49,199
and that'll be nice

4706
03:10:46,159 --> 03:10:52,398
um because that just takes a huge thing

4707
03:10:49,200 --> 03:10:52,399
off the table for us

4708
03:10:53,439 --> 03:10:56,398
so that's pretty good uh that's pretty

4709
03:10:55,520 --> 03:10:58,800
good

4710
03:10:56,398 --> 03:11:02,478
uh i would say like

4711
03:10:58,799 --> 03:11:04,879
also 32 oops 166 is surely not going to

4712
03:11:02,478 --> 03:11:04,879
be good

4713
03:11:04,959 --> 03:11:08,959
uh 16

4714
03:11:06,719 --> 03:11:10,398
might be more aware what we can afford

4715
03:11:08,959 --> 03:11:12,639
uh i mean obviously we might get some

4716
03:11:10,398 --> 03:11:15,039
more optimizations out of this but

4717
03:11:12,639 --> 03:11:18,719
um in terms of like looking at what's

4718
03:11:15,040 --> 03:11:20,479
feasible to do uh at 16 frames uh 16

4719
03:11:18,719 --> 03:11:23,358
milliseconds of frame

4720
03:11:20,478 --> 03:11:25,119
this is closer to it so i think i would

4721
03:11:23,359 --> 03:11:28,238
be more comfortable saying this can hit

4722
03:11:25,120 --> 03:11:29,760
60 uh than 32 so i think we might try to

4723
03:11:28,238 --> 03:11:32,079
see like can we make sure the lighting

4724
03:11:29,760 --> 03:11:33,520
is stable at 16

4725
03:11:32,079 --> 03:11:37,840
um

4726
03:11:33,520 --> 03:11:37,840
and and go from there right

4727
03:11:39,120 --> 03:11:43,359
so we'll see

4728
03:11:40,959 --> 03:11:43,358
we'll see

4729
03:11:43,600 --> 03:11:49,680
all right uh maybe that's good enough

4730
03:11:46,079 --> 03:11:52,398
for today i and next time what we'll do

4731
03:11:49,680 --> 03:11:54,559
is we'll try to pick up where we left

4732
03:11:52,398 --> 03:11:56,318
off here

4733
03:11:54,559 --> 03:11:59,119
and take a look at

4734
03:11:56,318 --> 03:12:01,920
what can we reasonably do to

4735
03:11:59,120 --> 03:12:03,600
clean up the spatial partition

4736
03:12:01,920 --> 03:12:06,398
make sure we're actually intersecting

4737
03:12:03,600 --> 03:12:07,680
rays properly probably put the debug we

4738
03:12:06,398 --> 03:12:09,599
have debug code that draws ray

4739
03:12:07,680 --> 03:12:12,398
intersections look at those more

4740
03:12:09,600 --> 03:12:13,200
carefully make sure they look plausible

4741
03:12:12,398 --> 03:12:14,559
um

4742
03:12:13,200 --> 03:12:18,319
so we

4743
03:12:14,559 --> 03:12:20,238
can kind of get rid of obvious errors uh

4744
03:12:18,318 --> 03:12:21,039
in the system there

4745
03:12:20,238 --> 03:12:25,520
so

4746
03:12:21,040 --> 03:12:27,200
that's probably all we really need to do

4747
03:12:25,520 --> 03:12:28,238
um

4748
03:12:27,200 --> 03:12:30,239
yeah

4749
03:12:28,238 --> 03:12:32,398
so i think that's all good

4750
03:12:30,238 --> 03:12:33,920
i think that's all good

4751
03:12:32,398 --> 03:12:36,000
all right folks

4752
03:12:33,920 --> 03:12:38,079
so i think i'm gonna wrap it up i'm

4753
03:12:36,000 --> 03:12:41,520
gonna wrap that up for today

4754
03:12:38,079 --> 03:12:45,359
thanks everyone for for joining me

4755
03:12:41,520 --> 03:12:46,720
uh and we will do another stream soon

4756
03:12:45,359 --> 03:12:48,000
where we

4757
03:12:46,719 --> 03:12:49,519
take a look at

4758
03:12:48,000 --> 03:12:51,680
the

4759
03:12:49,520 --> 03:12:54,399
just debugging that spatial partition

4760
03:12:51,680 --> 03:12:56,479
and trying to get that walk

4761
03:12:54,398 --> 03:12:58,959
straightened out

4762
03:12:56,478 --> 03:13:01,199
so thanks everybody

4763
03:12:58,959 --> 03:13:03,278
and uh

4764
03:13:01,200 --> 03:13:05,279
soon before next sunday uh possibly yeah

4765
03:13:03,279 --> 03:13:07,520
i might i might stream more frequently

4766
03:13:05,279 --> 03:13:09,439
yeah

4767
03:13:07,520 --> 03:13:11,760
um so thanks everybody

4768
03:13:09,439 --> 03:13:14,639
and i will be back uh to take a look at

4769
03:13:11,760 --> 03:13:17,639
that code uh sometime soon take it easy

4770
03:13:14,639 --> 03:13:17,639
everybody

