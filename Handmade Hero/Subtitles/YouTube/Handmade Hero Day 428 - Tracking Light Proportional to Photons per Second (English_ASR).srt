1
00:00:00,589 --> 00:00:04,169
hello everybody and welcome handmade

2
00:00:02,819 --> 00:00:08,220
here I'll show recode a complete game

3
00:00:04,169 --> 00:00:11,129
live on stream we have to improve our

4
00:00:08,220 --> 00:00:14,519
lighting quality today we actually I

5
00:00:11,130 --> 00:00:16,230
think we debugged most of the weirdness

6
00:00:14,519 --> 00:00:20,009
that was going on yesterday with the

7
00:00:16,230 --> 00:00:22,289
lighting flicker and today we have to

8
00:00:20,010 --> 00:00:24,300
start dealing with the fact that we

9
00:00:22,289 --> 00:00:28,289
would like to produce good lighting

10
00:00:24,300 --> 00:00:31,528
results without introducing flicker from

11
00:00:28,289 --> 00:00:33,390
our sampling and there's a lot of ways

12
00:00:31,528 --> 00:00:37,460
we can do this there's a lot of things

13
00:00:33,390 --> 00:00:39,600
that we kind of need to start looking at

14
00:00:37,460 --> 00:00:40,799
the primary thing I want to start with

15
00:00:39,600 --> 00:00:43,350
because what we were having trouble with

16
00:00:40,799 --> 00:00:45,328
at the end of yesterday is I want to

17
00:00:43,350 --> 00:00:48,870
start trying to get to a place where we

18
00:00:45,329 --> 00:00:53,520
can have good balanced lighting so

19
00:00:48,869 --> 00:00:57,229
basically like I want to start to be at

20
00:00:53,520 --> 00:00:57,230
least slightly more rigorous in

21
00:00:57,890 --> 00:01:03,000
understanding how light is put into the

22
00:01:00,329 --> 00:01:06,239
system and how it drains out of the

23
00:01:03,000 --> 00:01:10,890
system and right now we don't really

24
00:01:06,239 --> 00:01:14,129
have a very coherent way of looking at

25
00:01:10,890 --> 00:01:16,799
that and it's a fairly confusing problem

26
00:01:14,129 --> 00:01:19,709
because you're trying to come up with an

27
00:01:16,799 --> 00:01:21,479
approximation for something and your

28
00:01:19,709 --> 00:01:24,329
approximation is gonna be nothing like

29
00:01:21,478 --> 00:01:25,859
what the real thing is doing because

30
00:01:24,329 --> 00:01:29,039
again I've said this before when we

31
00:01:25,859 --> 00:01:31,560
started with lighting you're talking

32
00:01:29,040 --> 00:01:33,270
about a process that the real world uses

33
00:01:31,560 --> 00:01:38,159
you know billions or trillions of

34
00:01:33,269 --> 00:01:40,618
particles to evaluate and we are talking

35
00:01:38,159 --> 00:01:43,310
about thousands or tens of tens of

36
00:01:40,618 --> 00:01:46,618
thousands of particle equivalents that

37
00:01:43,310 --> 00:01:50,189
we have to use to evaluate and so

38
00:01:46,618 --> 00:01:52,618
basically the fundamental way in which

39
00:01:50,188 --> 00:01:54,839
we look at the problem has to differ

40
00:01:52,618 --> 00:01:57,688
from how nature does it very

41
00:01:54,840 --> 00:02:01,228
dramatically because we need to carry so

42
00:01:57,688 --> 00:02:04,429
much more information for every one of

43
00:02:01,228 --> 00:02:09,659
those particles than nature test right

44
00:02:04,430 --> 00:02:14,030
so we need to kind of be very aware of

45
00:02:09,659 --> 00:02:17,729
all of the ways that we can try to

46
00:02:14,030 --> 00:02:21,770
sacrifice some of the accuracy without

47
00:02:17,729 --> 00:02:24,959
sacrificing apparent visual quality as

48
00:02:21,770 --> 00:02:28,830
we change over the nature of the

49
00:02:24,960 --> 00:02:31,409
computation from what we know to be

50
00:02:28,830 --> 00:02:34,500
correct to something that is incorrect

51
00:02:31,409 --> 00:02:36,180
but still pleasing and that's very

52
00:02:34,500 --> 00:02:38,310
difficult thing to do because you just

53
00:02:36,180 --> 00:02:40,710
don't have nature as your guide right

54
00:02:38,310 --> 00:02:43,050
when you're simulating something and you

55
00:02:40,710 --> 00:02:45,360
can afford to do a good simulation of it

56
00:02:43,050 --> 00:02:47,040
you're actually although you know the

57
00:02:45,360 --> 00:02:49,560
cost to you may be high in terms of

58
00:02:47,039 --> 00:02:52,919
learning and math and understanding of

59
00:02:49,560 --> 00:02:55,800
the problem you kind of do have a nice

60
00:02:52,919 --> 00:02:57,269
benefit which is that you are looking to

61
00:02:55,800 --> 00:02:59,790
nature the thing that you actually

62
00:02:57,270 --> 00:03:02,480
wanted to replicate you are looking to

63
00:02:59,789 --> 00:03:05,879
it as a guide and it can guide you in

64
00:03:02,479 --> 00:03:07,649
our case we really can't do that we are

65
00:03:05,879 --> 00:03:10,710
looking to create a sort of parallel

66
00:03:07,650 --> 00:03:12,330
process that is very different from the

67
00:03:10,710 --> 00:03:14,969
way that it actually would be computed

68
00:03:12,330 --> 00:03:18,600
and that's why it's a very challenging

69
00:03:14,969 --> 00:03:20,430
sort of approximation to develop because

70
00:03:18,599 --> 00:03:24,780
it is so far afield from what's actually

71
00:03:20,430 --> 00:03:27,629
happening so anyway so I see there as

72
00:03:24,780 --> 00:03:30,030
being a couple important things that we

73
00:03:27,629 --> 00:03:32,370
need to focus on now as we've tried to

74
00:03:30,030 --> 00:03:34,709
improve the quality of how we're doing

75
00:03:32,370 --> 00:03:44,009
our letting transport given the low

76
00:03:34,709 --> 00:03:47,789
number of samples we get to take so what

77
00:03:44,009 --> 00:03:52,049
we effectively want to compute is you

78
00:03:47,789 --> 00:03:53,909
know a very simple you know going back

79
00:03:52,050 --> 00:03:56,100
to the original problem it's actually

80
00:03:53,909 --> 00:03:58,620
fairly simple right it's just sort of a

81
00:03:56,099 --> 00:04:00,180
series of these bounces you know if I've

82
00:03:58,620 --> 00:04:02,069
got a surface here and I'm trying to

83
00:04:00,180 --> 00:04:04,349
complete compute the lighting at this

84
00:04:02,069 --> 00:04:08,759
point so this is my you know this is my

85
00:04:04,349 --> 00:04:10,259
sample point for the lighting and no

86
00:04:08,759 --> 00:04:11,909
matter how we structure it even if we

87
00:04:10,259 --> 00:04:14,879
drastically change the way that we're

88
00:04:11,909 --> 00:04:16,680
doing our sample points how they're

89
00:04:14,879 --> 00:04:18,719
distributed what they mean whatever

90
00:04:16,680 --> 00:04:20,310
we're still always going to come back to

91
00:04:18,720 --> 00:04:22,109
this exact fundamental problem which is

92
00:04:20,310 --> 00:04:23,970
that at the sample point we

93
00:04:22,108 --> 00:04:26,490
fundamentally want to have a ton of

94
00:04:23,970 --> 00:04:27,250
different information about how things

95
00:04:26,490 --> 00:04:28,780
bounce off the

96
00:04:27,250 --> 00:04:31,060
surface and then bounce off other

97
00:04:28,779 --> 00:04:34,419
surfaces in the world and so on and so

98
00:04:31,060 --> 00:04:37,329
forth right and the problem that we have

99
00:04:34,420 --> 00:04:39,939
is that normally what we care about is

100
00:04:37,329 --> 00:04:43,329
we care about a continuous process of

101
00:04:39,939 --> 00:04:45,459
light being emitted from an emitter so

102
00:04:43,329 --> 00:04:49,680
something that generates light which is

103
00:04:45,459 --> 00:04:52,089
photons right coming out continuously

104
00:04:49,680 --> 00:04:54,129
these photons are going to bounce around

105
00:04:52,089 --> 00:04:59,589
and then eventually get collected by a

106
00:04:54,129 --> 00:05:01,870
sink which is our eye right so there's a

107
00:04:59,589 --> 00:05:04,000
photon generator and a photon

108
00:05:01,870 --> 00:05:08,050
you know Eliminator essentially and the

109
00:05:04,000 --> 00:05:13,509
total flow of photons through the sink

110
00:05:08,050 --> 00:05:17,230
is what we are measuring now the reason

111
00:05:13,509 --> 00:05:19,240
that this doesn't help us that much in

112
00:05:17,230 --> 00:05:21,790
terms of a fundamental structure is

113
00:05:19,240 --> 00:05:25,120
because although it lets us know one

114
00:05:21,790 --> 00:05:27,700
crucial thing about the problem which is

115
00:05:25,120 --> 00:05:31,000
that for the surfaces in the world the

116
00:05:27,699 --> 00:05:32,769
path along which you go to get from the

117
00:05:31,000 --> 00:05:35,319
emitter to the sink is what's important

118
00:05:32,769 --> 00:05:39,759
and that is true that's true for ours

119
00:05:35,319 --> 00:05:42,459
that's true for here immediately

120
00:05:39,759 --> 00:05:45,550
subsequent to that everything about the

121
00:05:42,459 --> 00:05:47,918
problems looks different and here's why

122
00:05:45,550 --> 00:05:50,680
first of all like I already said the

123
00:05:47,918 --> 00:05:53,529
number of photons emitted by an emitter

124
00:05:50,680 --> 00:05:55,600
and received by the sink are drastically

125
00:05:53,529 --> 00:05:58,750
higher in the real world than we will

126
00:05:55,600 --> 00:06:02,650
ever get to with the hardware we're

127
00:05:58,750 --> 00:06:05,050
talking about right they're talking

128
00:06:02,649 --> 00:06:09,399
about trillions we're talking about you

129
00:06:05,050 --> 00:06:12,009
know ten thousand so that scale alone is

130
00:06:09,399 --> 00:06:14,709
a problem but beyond that we have a

131
00:06:12,009 --> 00:06:17,099
second problem that really changes the

132
00:06:14,709 --> 00:06:20,199
nature of the solution and that is

133
00:06:17,100 --> 00:06:23,140
because we know we cannot do a good

134
00:06:20,199 --> 00:06:25,240
enough sampling of this process we know

135
00:06:23,139 --> 00:06:29,409
we're going to do much lower level

136
00:06:25,240 --> 00:06:32,620
sampling of it much lower quality we

137
00:06:29,410 --> 00:06:35,410
need to be able to deal with it across

138
00:06:32,620 --> 00:06:38,259
frames and in order to deal with it

139
00:06:35,410 --> 00:06:41,460
across frames it means we have to store

140
00:06:38,259 --> 00:06:44,839
the information about what

141
00:06:41,459 --> 00:06:51,629
surfaces lighting characteristics were

142
00:06:44,839 --> 00:06:55,739
on the surface or at least ample points

143
00:06:51,629 --> 00:06:59,339
right and that's crucial because now we

144
00:06:55,740 --> 00:07:02,400
have to have a way of recording what

145
00:06:59,339 --> 00:07:06,149
sort of lighting is occurring at a point

146
00:07:02,399 --> 00:07:10,620
and that is not something we ever had to

147
00:07:06,149 --> 00:07:13,079
deal with in the previous formulation

148
00:07:10,620 --> 00:07:15,899
the previous formulation just says I

149
00:07:13,079 --> 00:07:18,448
have a path through the world therefore

150
00:07:15,899 --> 00:07:21,000
I know that a photon would have gone

151
00:07:18,449 --> 00:07:23,340
this route and I can evaluate what each

152
00:07:21,000 --> 00:07:27,149
bounce would have done to this photon

153
00:07:23,339 --> 00:07:29,159
probabilistically done right did this

154
00:07:27,149 --> 00:07:33,299
photon reach the eye or not and what

155
00:07:29,160 --> 00:07:35,220
wavelength was it that's all right but

156
00:07:33,300 --> 00:07:38,280
now we're introducing this additional

157
00:07:35,220 --> 00:07:40,110
concept which is like light stored let

158
00:07:38,279 --> 00:07:43,158
you know some information about the

159
00:07:40,110 --> 00:07:45,060
lighting stored at the sample points and

160
00:07:43,158 --> 00:07:46,860
one of the problems that we're running

161
00:07:45,060 --> 00:07:50,129
into right now in our lighting algorithm

162
00:07:46,860 --> 00:07:52,439
is we have no formal way of talking

163
00:07:50,129 --> 00:07:56,759
about that at all we have not developed

164
00:07:52,439 --> 00:08:00,168
any sort of rigor to that measurement

165
00:07:56,759 --> 00:08:03,300
it's just a completely made-up

166
00:08:00,168 --> 00:08:06,948
floating-point number called emit C zero

167
00:08:03,300 --> 00:08:12,900
right and we have no idea what it means

168
00:08:06,949 --> 00:08:17,728
no idea at all right so I think that's

169
00:08:12,899 --> 00:08:22,158
the first thing we have to tackle is we

170
00:08:17,728 --> 00:08:22,158
need a formulation for stored light

171
00:08:26,369 --> 00:08:35,560
that means something and even if that

172
00:08:33,549 --> 00:08:39,069
thing is basically identical to what

173
00:08:35,559 --> 00:08:40,989
we're already doing just understanding

174
00:08:39,070 --> 00:08:43,539
it a little more deeply about what that

175
00:08:40,990 --> 00:08:45,519
number is supposed to represent I think

176
00:08:43,538 --> 00:08:47,679
will help us as we try to improve our

177
00:08:45,519 --> 00:08:49,568
algorithm because then at least we know

178
00:08:47,679 --> 00:08:50,769
what we're talking about and we're not

179
00:08:49,568 --> 00:08:53,318
just fiddling with floating-point

180
00:08:50,769 --> 00:08:56,318
numbers hoping that something goes our

181
00:08:53,318 --> 00:08:58,019
way right which is a valid way to find

182
00:08:56,318 --> 00:09:00,818
an algorithm if you really don't know

183
00:08:58,019 --> 00:09:03,278
you know random search is totally fine

184
00:09:00,818 --> 00:09:05,318
but obviously if we can get better than

185
00:09:03,278 --> 00:09:07,328
random search we would like to you know

186
00:09:05,318 --> 00:09:09,189
there's no sense being random in your

187
00:09:07,328 --> 00:09:12,278
search for your algorithm if you can

188
00:09:09,190 --> 00:09:15,339
find some way of doing some math or

189
00:09:12,278 --> 00:09:17,649
doing some thinking to get you to carve

190
00:09:15,339 --> 00:09:20,019
off the space of possibilities into some

191
00:09:17,649 --> 00:09:21,549
narrower space so that that search can

192
00:09:20,019 --> 00:09:24,970
be more constrained and more successful

193
00:09:21,549 --> 00:09:29,528
more quickly right so pretty basic I do

194
00:09:24,970 --> 00:09:31,810
there so we need a formulation for

195
00:09:29,528 --> 00:09:35,549
stored light that means something and

196
00:09:31,809 --> 00:09:45,099
then the second thing we need is a

197
00:09:35,549 --> 00:09:49,809
understanding of emission and I don't

198
00:09:45,100 --> 00:09:52,860
know what we want to call the sink side

199
00:09:49,809 --> 00:09:56,369
of things emission and I guess

200
00:09:52,860 --> 00:09:56,370
nullification extinguishing

201
00:09:59,850 --> 00:10:08,769
so basically in our system currently we

202
00:10:04,119 --> 00:10:11,528
don't distinguish between the light that

203
00:10:08,769 --> 00:10:14,619
the game told us was getting emitted on

204
00:10:11,528 --> 00:10:16,539
a frame right that's the emission values

205
00:10:14,619 --> 00:10:19,480
that are actually specified like we've

206
00:10:16,539 --> 00:10:21,428
got those little hopper snake dudes who

207
00:10:19,480 --> 00:10:23,548
are hopping around and they've got a

208
00:10:21,428 --> 00:10:27,639
little lights attached to them right

209
00:10:23,548 --> 00:10:29,108
we've got our white cube that we well

210
00:10:27,639 --> 00:10:33,068
it's not oh the cube it's more like a

211
00:10:29,109 --> 00:10:35,918
prism our white box that we move around

212
00:10:33,068 --> 00:10:37,568
and that emits light and we've got the

213
00:10:35,918 --> 00:10:41,438
skylight which we can turn on which

214
00:10:37,568 --> 00:10:44,248
emits light as a dome so those are three

215
00:10:41,438 --> 00:10:47,318
things that are emitting light right now

216
00:10:44,249 --> 00:10:49,959
but all they do is just right into the

217
00:10:47,318 --> 00:10:53,108
emit c0 array which is the same place

218
00:10:49,958 --> 00:10:55,268
that all of the surface stored light

219
00:10:53,109 --> 00:10:57,339
from previous frames that's bounced

220
00:10:55,269 --> 00:11:01,720
around that's the same place that that

221
00:10:57,339 --> 00:11:04,239
goes so right now we don't even do any

222
00:11:01,720 --> 00:11:06,100
thinking about what it means to mix

223
00:11:04,239 --> 00:11:10,829
something that's emitting light

224
00:11:06,100 --> 00:11:13,569
continuously as a generator of light and

225
00:11:10,828 --> 00:11:15,748
something that's just storing the result

226
00:11:13,568 --> 00:11:18,969
of light that has bounced around and

227
00:11:15,749 --> 00:11:20,739
again that may be fine meaning it may be

228
00:11:18,970 --> 00:11:23,499
fine to have those in the same array

229
00:11:20,739 --> 00:11:26,110
working the same way but we need to

230
00:11:23,499 --> 00:11:28,360
understand that what does that mean

231
00:11:26,110 --> 00:11:31,178
because one is measuring one quantity

232
00:11:28,360 --> 00:11:33,548
one type of thing in nature and one is

233
00:11:31,178 --> 00:11:36,428
measuring something different in one

234
00:11:33,548 --> 00:11:38,708
case with the actual emitters we're

235
00:11:36,428 --> 00:11:43,178
measuring something that radiates

236
00:11:38,708 --> 00:11:45,479
photons itself right a lamp the Sun

237
00:11:43,178 --> 00:11:48,668
whatever it's something that has a

238
00:11:45,480 --> 00:11:51,668
actual physical reaction occurring

239
00:11:48,668 --> 00:11:54,278
inside it that is generating new photons

240
00:11:51,668 --> 00:11:57,038
so photons do not to come from anywhere

241
00:11:54,278 --> 00:12:01,409
they are coming out of this thing with

242
00:11:57,038 --> 00:12:04,778
no need for anybody to do anything right

243
00:12:01,409 --> 00:12:06,850
the other elements all the rest of the

244
00:12:04,778 --> 00:12:09,038
elements in emits e zero besides those

245
00:12:06,850 --> 00:12:12,759
ones that got set by actual emitters in

246
00:12:09,038 --> 00:12:16,689
the render push call all the rest of

247
00:12:12,759 --> 00:12:19,750
those values are all talking about light

248
00:12:16,690 --> 00:12:22,420
that is transient right it's light that

249
00:12:19,750 --> 00:12:26,379
came from an emitter at some point in

250
00:12:22,419 --> 00:12:31,719
the past and is now sitting on this

251
00:12:26,379 --> 00:12:34,120
surface and can be bounced away all

252
00:12:31,720 --> 00:12:35,649
right now there's a final thing that I'd

253
00:12:34,120 --> 00:12:38,049
like to include in this analysis one

254
00:12:35,649 --> 00:12:42,269
more thing so this is let's call this

255
00:12:38,049 --> 00:12:42,269
number one we'll call this number two

256
00:12:42,389 --> 00:12:56,940
there's one more thing and that is the

257
00:12:46,629 --> 00:13:03,009
difference between the render color and

258
00:12:56,940 --> 00:13:06,850
the emission so one more thing that we

259
00:13:03,009 --> 00:13:10,419
don't really address is when we have

260
00:13:06,850 --> 00:13:13,480
light that's inbound on a surface we are

261
00:13:10,419 --> 00:13:15,519
using a single value that will then be

262
00:13:13,480 --> 00:13:20,199
pushed to the renderer that colors that

263
00:13:15,519 --> 00:13:22,778
surface right so the surface itself has

264
00:13:20,198 --> 00:13:25,539
a reflection color there's an inbound

265
00:13:22,778 --> 00:13:28,509
light color and that inbound light color

266
00:13:25,539 --> 00:13:34,110
times the surface color is what we use

267
00:13:28,509 --> 00:13:37,328
to render the surface now that result is

268
00:13:34,110 --> 00:13:41,680
the same result that we use to bounce

269
00:13:37,328 --> 00:13:44,379
the light around so on any given frame

270
00:13:41,679 --> 00:13:47,169
the thing that we draw on the screen is

271
00:13:44,379 --> 00:13:51,159
the same thing as what we're saying will

272
00:13:47,169 --> 00:13:53,979
be emitting light on the next frame that

273
00:13:51,159 --> 00:13:56,469
seems reasonable right because that's

274
00:13:53,980 --> 00:13:58,089
how light works what we when we look at

275
00:13:56,470 --> 00:14:00,009
a surface what we see is the light

276
00:13:58,089 --> 00:14:01,750
that's coming towards us from the

277
00:14:00,009 --> 00:14:04,120
surface it's light that has been bounced

278
00:14:01,750 --> 00:14:06,339
off the surface so the render color that

279
00:14:04,120 --> 00:14:08,318
the eye sees and the thing that other

280
00:14:06,339 --> 00:14:10,389
elements see when they go to take light

281
00:14:08,318 --> 00:14:13,629
from a surface it makes sense that those

282
00:14:10,389 --> 00:14:14,579
would be the same right so that's not

283
00:14:13,629 --> 00:14:19,659
weird

284
00:14:14,578 --> 00:14:22,179
you know that's reasonable but we have

285
00:14:19,659 --> 00:14:24,730
no rigor about that either right we

286
00:14:22,179 --> 00:14:26,498
don't even say what that value is stored

287
00:14:24,730 --> 00:14:28,719
as is that suppose

288
00:14:26,499 --> 00:14:31,658
to be flux is supposed to be the number

289
00:14:28,719 --> 00:14:33,729
of photons passing that are inbound on

290
00:14:31,658 --> 00:14:35,349
this site as far as we know is it

291
00:14:33,729 --> 00:14:39,249
supposed to be the number of photons

292
00:14:35,349 --> 00:14:41,408
that we expect to leave the site and so

293
00:14:39,249 --> 00:14:43,178
on and so forth right now it's I believe

294
00:14:41,408 --> 00:14:45,369
the number technically what we're doing

295
00:14:43,178 --> 00:14:47,318
is is you know the amount of photons

296
00:14:45,369 --> 00:14:49,178
inbound on the site because we haven't

297
00:14:47,318 --> 00:14:51,368
multiplied it by the reflection color of

298
00:14:49,178 --> 00:14:54,548
the surface yet we're just storing the

299
00:14:51,369 --> 00:14:57,999
inbound light so I think that's the the

300
00:14:54,548 --> 00:15:00,278
in radiance at that point is what we're

301
00:14:57,999 --> 00:15:03,399
actually storing in no particular units

302
00:15:00,278 --> 00:15:06,788
right but just some a value that's

303
00:15:03,399 --> 00:15:09,038
quantifying that right and so when we

304
00:15:06,788 --> 00:15:11,408
push that down you know it seems

305
00:15:09,038 --> 00:15:13,178
reasonable right but we need to again

306
00:15:11,408 --> 00:15:16,058
understand make sure all of that

307
00:15:13,178 --> 00:15:17,738
understanding is clear and that there

308
00:15:16,058 --> 00:15:20,578
isn't a difference that we need to

309
00:15:17,739 --> 00:15:25,959
respect there that has you know

310
00:15:20,578 --> 00:15:27,548
ramifications for the for the way the

311
00:15:25,958 --> 00:15:31,178
lighting is transmitted or anything else

312
00:15:27,548 --> 00:15:33,038
like that right so we just want all of

313
00:15:31,178 --> 00:15:35,408
those in there and I think out of these

314
00:15:33,038 --> 00:15:37,479
you know these are the two that need to

315
00:15:35,408 --> 00:15:39,009
kind of get really worked on this like I

316
00:15:37,479 --> 00:15:41,709
said I think we want to kind of just

317
00:15:39,009 --> 00:15:45,729
nail down but it seems like we sort of

318
00:15:41,708 --> 00:15:48,038
addressed that early on and haven't we

319
00:15:45,729 --> 00:15:50,589
have not been to fast and loose with

320
00:15:48,038 --> 00:15:52,269
that like we did actually correctly

321
00:15:50,589 --> 00:15:53,739
remember like okay here's the light

322
00:15:52,269 --> 00:15:55,328
inbound the surface and then when we go

323
00:15:53,739 --> 00:15:56,798
to transmit that light or render that

324
00:15:55,328 --> 00:16:00,818
light we multiply the real active color

325
00:15:56,798 --> 00:16:05,098
that seems you know plausible to a

326
00:16:00,818 --> 00:16:05,098
certain extent right okay

327
00:16:07,639 --> 00:16:16,709
all right but okay so one let me just

328
00:16:15,839 --> 00:16:19,470
point one thing out

329
00:16:16,708 --> 00:16:22,528
there's thought of on point three the

330
00:16:19,470 --> 00:16:25,350
reason I think it's worth considering is

331
00:16:22,528 --> 00:16:27,360
because for example one of the things

332
00:16:25,350 --> 00:16:29,759
that we're having right now is we have a

333
00:16:27,360 --> 00:16:32,419
little bit too much we have trouble

334
00:16:29,759 --> 00:16:34,470
keeping our light balance correct and

335
00:16:32,419 --> 00:16:36,179
one of the things about number three is

336
00:16:34,470 --> 00:16:38,449
that for example when we are

337
00:16:36,179 --> 00:16:41,549
transmitting light between surfaces and

338
00:16:38,448 --> 00:16:43,740
we're taking the inbound light on one

339
00:16:41,549 --> 00:16:46,588
surface and we're translating it into

340
00:16:43,740 --> 00:16:49,009
inbound light on another surface I don't

341
00:16:46,589 --> 00:16:52,889
know for example if we are correctly

342
00:16:49,009 --> 00:16:56,159
representing the power drain necessary

343
00:16:52,889 --> 00:16:58,350
on the outbound surface as compared to

344
00:16:56,159 --> 00:17:00,809
the inbound surface we may be for

345
00:16:58,350 --> 00:17:02,790
example subtracting away the light

346
00:17:00,809 --> 00:17:08,519
multiplied by the reflection color which

347
00:17:02,789 --> 00:17:10,318
would be wrong you know there's there's

348
00:17:08,519 --> 00:17:11,970
a couple things like that right so it's

349
00:17:10,318 --> 00:17:14,789
it's just worth noting that like again

350
00:17:11,970 --> 00:17:16,318
although we are sort of this is more

351
00:17:14,789 --> 00:17:18,629
rigorous in the system than the other

352
00:17:16,318 --> 00:17:20,909
two it's more it was more thought

353
00:17:18,630 --> 00:17:22,799
through a little bit it's still not

354
00:17:20,910 --> 00:17:24,449
thought through all the way and it's

355
00:17:22,798 --> 00:17:26,699
probably not at the point where it needs

356
00:17:24,449 --> 00:17:29,730
to be in terms of our understanding even

357
00:17:26,699 --> 00:17:31,169
if the code is right we need to again

358
00:17:29,730 --> 00:17:33,690
make sure that we're actually thinking

359
00:17:31,169 --> 00:17:39,140
about that everywhere that we need to be

360
00:17:33,690 --> 00:17:43,130
thinking about that okay so that's

361
00:17:39,140 --> 00:17:46,320
that's how I want to think about that

362
00:17:43,130 --> 00:17:48,540
okay so let's talk a little bit about

363
00:17:46,319 --> 00:17:51,119
what we need what we're trying to

364
00:17:48,539 --> 00:17:56,759
accomplish here in light of these three

365
00:17:51,119 --> 00:17:58,759
things so we have situations now where

366
00:17:56,759 --> 00:18:04,710
we've got this sort of thing occurring

367
00:17:58,759 --> 00:18:08,279
we've got you know p0 and p1 and the

368
00:18:04,710 --> 00:18:09,720
first thing is that really we can use

369
00:18:08,279 --> 00:18:17,190
right now what we're using is

370
00:18:09,720 --> 00:18:20,339
uni-directional transport right so what

371
00:18:17,190 --> 00:18:21,100
happens is we find from a sample point

372
00:18:20,339 --> 00:18:23,349
in the world

373
00:18:21,099 --> 00:18:26,230
we find another sample point in the

374
00:18:23,349 --> 00:18:28,178
world and right now we actually use more

375
00:18:26,230 --> 00:18:29,620
than one so right now we're actually

376
00:18:28,179 --> 00:18:32,769
blending so you know if we've got

377
00:18:29,619 --> 00:18:34,750
another p2 here and we happen to land

378
00:18:32,769 --> 00:18:40,419
you know more in between the two will

379
00:18:34,750 --> 00:18:42,730
average right so we're using a blend but

380
00:18:40,419 --> 00:18:48,639
the important part is when we do this

381
00:18:42,730 --> 00:18:51,579
hit we only move light from here to here

382
00:18:48,638 --> 00:18:53,099
so it's unidirectional because it only

383
00:18:51,579 --> 00:18:56,319
goes this way

384
00:18:53,099 --> 00:18:58,778
now we could stick with you in a

385
00:18:56,319 --> 00:19:01,119
directional transport and we may want to

386
00:18:58,778 --> 00:19:04,000
the reason that we might want to stick

387
00:19:01,119 --> 00:19:06,729
with unidirectional transport is because

388
00:19:04,000 --> 00:19:09,750
it may end up being that if we need to

389
00:19:06,730 --> 00:19:12,250
do a decoupled version of this algorithm

390
00:19:09,750 --> 00:19:15,369
it may be that unidirectional transport

391
00:19:12,250 --> 00:19:17,500
is easier to decouple into something

392
00:19:15,369 --> 00:19:21,189
that can be multi-threaded or you know

393
00:19:17,500 --> 00:19:24,490
GPU or whatever it's possible I don't

394
00:19:21,190 --> 00:19:26,590
know we haven't looked at it yet but if

395
00:19:24,490 --> 00:19:30,339
we assume temporarily that there isn't

396
00:19:26,589 --> 00:19:32,470
some ancillary performance benefit to

397
00:19:30,339 --> 00:19:34,898
unidirectional transport that we don't

398
00:19:32,470 --> 00:19:36,399
know about yet because it only exists in

399
00:19:34,898 --> 00:19:39,548
a structure of the routine that we

400
00:19:36,398 --> 00:19:40,508
haven't addressed if we're just talking

401
00:19:39,548 --> 00:19:48,038
about the structure of our current

402
00:19:40,509 --> 00:19:49,778
routine bi-directional transport would

403
00:19:48,038 --> 00:19:52,028
be much more efficient here why because

404
00:19:49,778 --> 00:19:54,099
what is the expensive part of our

405
00:19:52,028 --> 00:19:58,148
equation well the expensive part of our

406
00:19:54,099 --> 00:20:00,250
equation is finding the path right we

407
00:19:58,148 --> 00:20:02,829
don't the problem is not the few

408
00:20:00,250 --> 00:20:05,378
calculations that we have to do to do

409
00:20:02,829 --> 00:20:07,418
the light transport the hard part is the

410
00:20:05,378 --> 00:20:09,308
fact that when we go to figure out what

411
00:20:07,419 --> 00:20:11,169
we hit we have to look through like

412
00:20:09,308 --> 00:20:14,918
hundreds even with the spatial hierarchy

413
00:20:11,169 --> 00:20:17,740
hundreds of things to find out what that

414
00:20:14,919 --> 00:20:20,259
path actually was and so finding the

415
00:20:17,740 --> 00:20:22,240
path is expensive and rather than only

416
00:20:20,259 --> 00:20:24,579
using the path to transport light one

417
00:20:22,240 --> 00:20:27,669
way what we really would rather do is

418
00:20:24,579 --> 00:20:31,538
use it to transfer transport light both

419
00:20:27,669 --> 00:20:33,580
ways right because if we do a

420
00:20:31,538 --> 00:20:34,869
bi-directional transport where we

421
00:20:33,579 --> 00:20:37,750
basically say oh when we

422
00:20:34,869 --> 00:20:39,909
transfer information let's take light

423
00:20:37,750 --> 00:20:42,220
from these and give it to this one let's

424
00:20:39,910 --> 00:20:48,190
also take light from this one and give

425
00:20:42,220 --> 00:20:52,350
it to these and that way we can look at

426
00:20:48,190 --> 00:20:55,150
light equalization between two things

427
00:20:52,349 --> 00:20:59,558
which again very common in radiosity

428
00:20:55,150 --> 00:21:01,210
it's not an unusual thing so since we

429
00:20:59,558 --> 00:21:02,859
are basically a radiosity scheme at this

430
00:21:01,210 --> 00:21:06,370
point seems like a reasonable thing to

431
00:21:02,859 --> 00:21:09,519
try because that gets us twice the

432
00:21:06,369 --> 00:21:12,308
efficacy from our pathfinding because

433
00:21:09,519 --> 00:21:15,819
now instead of having to wait for p1 to

434
00:21:12,308 --> 00:21:18,308
find the path back to p0 we can just use

435
00:21:15,819 --> 00:21:21,399
the fact that p0 found a path to p1 and

436
00:21:18,308 --> 00:21:24,369
know that p one could have seen p 0 if p

437
00:21:21,400 --> 00:21:26,230
0 can see p1 p1 can see p 0 there's no

438
00:21:24,369 --> 00:21:26,739
difference in the sidedness of these

439
00:21:26,230 --> 00:21:28,240
paths

440
00:21:26,740 --> 00:21:30,130
it's just whether a line connects them

441
00:21:28,240 --> 00:21:31,329
so as soon as we find a path from one to

442
00:21:30,130 --> 00:21:35,650
the other we also have paths from the

443
00:21:31,329 --> 00:21:37,899
other to the one that's just a given in

444
00:21:35,650 --> 00:21:39,460
how ray-tracing is structured right

445
00:21:37,900 --> 00:21:42,160
either there was an obstacle Block in

446
00:21:39,460 --> 00:21:43,840
the liner there wasn't so if we change

447
00:21:42,160 --> 00:21:46,330
using bi-directional transport I also

448
00:21:43,839 --> 00:21:48,220
think we would be able to get more

449
00:21:46,329 --> 00:21:50,589
leverage out of the same number of path

450
00:21:48,220 --> 00:21:53,829
lines twice as much information there

451
00:21:50,589 --> 00:21:55,990
which is great so what I'd like to do is

452
00:21:53,829 --> 00:21:58,659
certainly explore that as a separate

453
00:21:55,990 --> 00:22:00,579
option which is just to say we can start

454
00:21:58,660 --> 00:22:04,529
looking this as a bi-directional problem

455
00:22:00,579 --> 00:22:11,250
I think we'll get more efficacy there ok

456
00:22:04,529 --> 00:22:11,250
so let's start talking about this a

457
00:22:11,579 --> 00:22:15,928
formulation for stored light to mean

458
00:22:13,480 --> 00:22:15,929
something

459
00:22:20,150 --> 00:22:27,600
so let's say I've got something that's

460
00:22:22,589 --> 00:22:32,959
emitting photons here I've got a

461
00:22:27,599 --> 00:22:36,599
reflector and I've got a collector here

462
00:22:32,960 --> 00:22:38,759
and by the way this is not me trying to

463
00:22:36,599 --> 00:22:40,319
teach you something this is me literally

464
00:22:38,759 --> 00:22:42,690
trying to figure this out so I'm not

465
00:22:40,319 --> 00:22:43,139
suggesting that I already know the

466
00:22:42,690 --> 00:22:47,640
answer

467
00:22:43,140 --> 00:22:54,059
I'm just pontificating about it just

468
00:22:47,640 --> 00:22:57,538
completely open-ended so if this is

469
00:22:54,058 --> 00:23:01,339
something that's emitting I guess I

470
00:22:57,538 --> 00:23:03,658
should say collecting I said a meeting

471
00:23:01,339 --> 00:23:05,639
so I have something that sending photons

472
00:23:03,659 --> 00:23:07,110
this way and I have something thats

473
00:23:05,640 --> 00:23:11,070
collecting photons over here and I'm

474
00:23:07,109 --> 00:23:14,038
bouncing them out then the thing that I

475
00:23:11,069 --> 00:23:18,450
need to know for a particular surface

476
00:23:14,038 --> 00:23:22,140
here right is if I was going to take a

477
00:23:18,450 --> 00:23:29,850
frozen moment in time right so if I want

478
00:23:22,140 --> 00:23:32,400
to look at like an instant in time what

479
00:23:29,849 --> 00:23:35,339
I could say is I could say something

480
00:23:32,400 --> 00:23:39,720
like I want to know the photons per

481
00:23:35,339 --> 00:23:43,349
second right that are passing through

482
00:23:39,720 --> 00:23:47,370
this reflector because even though this

483
00:23:43,349 --> 00:23:51,928
reflector like even though there is no

484
00:23:47,369 --> 00:23:53,908
color right technically at this

485
00:23:51,929 --> 00:23:57,210
reflector because color is something

486
00:23:53,909 --> 00:23:58,950
that only happens when we perceive it we

487
00:23:57,210 --> 00:24:02,400
can still store the quantity that we

488
00:23:58,950 --> 00:24:05,548
care about for reconstructing this seam

489
00:24:02,400 --> 00:24:08,009
so let's say we wanted to remember a

490
00:24:05,548 --> 00:24:10,408
single value that would list get rid of

491
00:24:08,009 --> 00:24:12,779
this emitter and just remember the

492
00:24:10,409 --> 00:24:14,900
reflector and then properly calculate

493
00:24:12,779 --> 00:24:17,730
what happened at the collector right

494
00:24:14,900 --> 00:24:20,640
well photons per second is the thing

495
00:24:17,730 --> 00:24:22,919
that we could keep right if we know the

496
00:24:20,640 --> 00:24:25,288
photons per second that we're inbound

497
00:24:22,919 --> 00:24:27,960
here and coming out this way right that

498
00:24:25,288 --> 00:24:31,220
were that were transiting this bounce

499
00:24:27,960 --> 00:24:33,610
just this one bounce

500
00:24:31,220 --> 00:24:37,009
the photons per second for that bounce

501
00:24:33,609 --> 00:24:38,719
would tell us exactly what we needed to

502
00:24:37,009 --> 00:24:40,009
know to figure out how many photons per

503
00:24:38,720 --> 00:24:49,339
second are getting collected at this

504
00:24:40,009 --> 00:24:52,789
collector right now this ignores the

505
00:24:49,339 --> 00:24:55,339
color like I said but you could imagine

506
00:24:52,789 --> 00:24:59,629
extending this pretty trivially to three

507
00:24:55,339 --> 00:25:02,409
colors right red green blue by just

508
00:24:59,630 --> 00:25:05,570
throwing the photons per second for each

509
00:25:02,410 --> 00:25:07,509
so that's not that complicated we can

510
00:25:05,569 --> 00:25:10,009
kind of just think of this as monochrome

511
00:25:07,509 --> 00:25:12,440
so if we think of each of our reflectors

512
00:25:10,009 --> 00:25:20,420
as having a photons per second that's

513
00:25:12,440 --> 00:25:23,750
inbound and outbound right that is a

514
00:25:20,420 --> 00:25:27,170
sort of different understanding of it

515
00:25:23,750 --> 00:25:29,960
than what we're using now what we're

516
00:25:27,170 --> 00:25:34,789
using right now is more like actual

517
00:25:29,960 --> 00:25:38,450
number of photons in a sense in that we

518
00:25:34,789 --> 00:25:42,859
keep them on the surface and then send

519
00:25:38,450 --> 00:25:45,080
them away so we don't really have the

520
00:25:42,859 --> 00:25:48,109
notion of the photons per second that

521
00:25:45,079 --> 00:25:49,970
are transiting through we sort of just

522
00:25:48,109 --> 00:25:54,069
have a notion of the number of photons

523
00:25:49,970 --> 00:26:00,230
that are sitting on this surface right

524
00:25:54,069 --> 00:26:01,429
and that's kind of confusing the

525
00:26:00,230 --> 00:26:04,870
difference between those two things is

526
00:26:01,430 --> 00:26:06,860
subtle but it could make a difference so

527
00:26:04,869 --> 00:26:08,509
it's worth noting that the thing we

528
00:26:06,859 --> 00:26:11,329
actually care about the value we

529
00:26:08,509 --> 00:26:13,309
actually care about is an idea of how

530
00:26:11,329 --> 00:26:16,129
many photons per second are transiting

531
00:26:13,309 --> 00:26:17,899
through this particular surface and we

532
00:26:16,130 --> 00:26:20,000
don't really have that in the current

533
00:26:17,900 --> 00:26:22,220
system but we could imagine that it's

534
00:26:20,000 --> 00:26:23,900
probably related to the number of

535
00:26:22,220 --> 00:26:26,210
photons that ended up stuck on this

536
00:26:23,900 --> 00:26:31,990
surface but maybe it doesn't really you

537
00:26:26,210 --> 00:26:33,990
know who knows all right so

538
00:26:31,990 --> 00:26:33,990
uhh

539
00:26:37,410 --> 00:26:45,590
for example suppose we were going to

540
00:26:47,329 --> 00:26:50,960
suppose we were going to change the way

541
00:26:49,619 --> 00:26:53,428
we looked at this problem a little bit

542
00:26:50,960 --> 00:26:56,490
here is a way that photons per second

543
00:26:53,429 --> 00:26:58,350
versus photons would be important like I

544
00:26:56,490 --> 00:27:02,069
said we are sampling you know we're a

545
00:26:58,349 --> 00:27:05,038
shooting based radiosity because we

546
00:27:02,069 --> 00:27:06,418
can't afford to do anything else which

547
00:27:05,038 --> 00:27:08,429
means we're just taking Monte Carlo

548
00:27:06,419 --> 00:27:11,038
samples right actually very much like

549
00:27:08,429 --> 00:27:12,960
the paper that was referenced yesterday

550
00:27:11,038 --> 00:27:15,329
we're just taking Monte Carlo samples

551
00:27:12,960 --> 00:27:16,860
and then trying to reconstruct what the

552
00:27:15,329 --> 00:27:18,509
radiosity is out there we're not doing a

553
00:27:16,859 --> 00:27:21,779
large linear system solve which is one

554
00:27:18,509 --> 00:27:25,470
way you can do radiosity we're not doing

555
00:27:21,779 --> 00:27:27,569
anything that would be considered

556
00:27:25,470 --> 00:27:29,100
considered a simultaneous solve it's an

557
00:27:27,569 --> 00:27:32,700
iterative shooting scheme right the most

558
00:27:29,099 --> 00:27:34,230
sort of basic kind you can do because

559
00:27:32,700 --> 00:27:37,319
that's what we can afford to do at 60

560
00:27:34,230 --> 00:27:39,240
frames a second overtime and we're

561
00:27:37,319 --> 00:27:40,500
trying to make that converge to

562
00:27:39,240 --> 00:27:43,380
something that would be a stable

563
00:27:40,500 --> 00:27:44,970
solution right and of course converge to

564
00:27:43,380 --> 00:27:46,409
a stable solution is not even really

565
00:27:44,970 --> 00:27:47,850
what we want because lights are moving

566
00:27:46,409 --> 00:27:49,169
every frame and stuff like that so we're

567
00:27:47,849 --> 00:27:50,969
just want it to be something that

568
00:27:49,169 --> 00:27:54,840
becomes consistent over time if

569
00:27:50,970 --> 00:27:57,569
everything was stationary right okay so

570
00:27:54,839 --> 00:28:00,658
for example let's suppose we have

571
00:27:57,569 --> 00:28:03,928
photons per second as an estimate on a

572
00:28:00,659 --> 00:28:05,730
particular reflector and now we want to

573
00:28:03,929 --> 00:28:11,309
update the world well you could imagine

574
00:28:05,730 --> 00:28:14,009
a shooting photons right not photons per

575
00:28:11,308 --> 00:28:16,769
second but actual photons from an

576
00:28:14,009 --> 00:28:19,558
emitter looking at how many hit the

577
00:28:16,769 --> 00:28:22,609
surface and bounce out and update our

578
00:28:19,558 --> 00:28:25,829
photons per second based on that number

579
00:28:22,609 --> 00:28:27,839
right so we have a quantity that sort of

580
00:28:25,829 --> 00:28:29,548
saying how much generally bounces

581
00:28:27,839 --> 00:28:31,470
through the surface well how much

582
00:28:29,548 --> 00:28:34,918
bounced through the surface this frame

583
00:28:31,470 --> 00:28:36,900
right how many went in here so every

584
00:28:34,919 --> 00:28:40,530
time something hits a surface we send it

585
00:28:36,900 --> 00:28:42,659
out we send out all of it right we do

586
00:28:40,529 --> 00:28:45,329
full we just bounce photons around like

587
00:28:42,659 --> 00:28:47,790
a photon tracer would but then like a

588
00:28:45,329 --> 00:28:49,379
radiosity solver would we then say okay

589
00:28:47,789 --> 00:28:51,619
let's try and figure out what that means

590
00:28:49,380 --> 00:28:57,480
for our stable photons

591
00:28:51,619 --> 00:28:58,349
right so again you can imagine sort of

592
00:28:57,480 --> 00:28:58,950
thinking about this in two different

593
00:28:58,349 --> 00:29:00,839
ways

594
00:28:58,950 --> 00:29:02,819
they're sort of the concept that we have

595
00:29:00,839 --> 00:29:04,559
a certain number of paths that are that

596
00:29:02,819 --> 00:29:06,599
we're evaluating and then we're trying

597
00:29:04,559 --> 00:29:10,079
to update a value which is photons per

598
00:29:06,599 --> 00:29:12,629
second which can be only loosely related

599
00:29:10,079 --> 00:29:15,059
to what the path says right the path is

600
00:29:12,630 --> 00:29:16,920
just one sample that gives us a hint

601
00:29:15,059 --> 00:29:24,109
about how the photons per second is

602
00:29:16,920 --> 00:29:24,110
probably changing so

603
00:29:32,000 --> 00:29:39,240
so given that let's talk about what

604
00:29:35,819 --> 00:29:44,879
happens when we want to evaluate two

605
00:29:39,240 --> 00:29:47,099
surfaces let's okay yeah so let's expand

606
00:29:44,880 --> 00:29:48,540
on this concept so let's suppose we were

607
00:29:47,099 --> 00:29:50,548
talking about photons per second

608
00:29:48,539 --> 00:29:53,159
everywhere so an emitter also has a

609
00:29:50,548 --> 00:29:56,369
photons per second and that photons per

610
00:29:53,160 --> 00:29:59,040
second value is constant right so we

611
00:29:56,369 --> 00:30:00,959
know that this emitter you can't modify

612
00:29:59,039 --> 00:30:04,558
the number of photons per second it's

613
00:30:00,960 --> 00:30:05,910
putting out because it will always put

614
00:30:04,558 --> 00:30:07,980
out the same number of photons per

615
00:30:05,910 --> 00:30:11,669
second that's what makes it an emitter

616
00:30:07,980 --> 00:30:13,319
right so unlike the other elements in

617
00:30:11,669 --> 00:30:14,549
the system and this is kind of an

618
00:30:13,319 --> 00:30:15,629
important piece of understanding like I

619
00:30:14,548 --> 00:30:16,950
said we're trying to get to this

620
00:30:15,630 --> 00:30:20,299
understanding by thinking through the

621
00:30:16,950 --> 00:30:22,470
problem about what we know about light

622
00:30:20,298 --> 00:30:24,058
so if an emitter is putting out a

623
00:30:22,470 --> 00:30:26,548
certain number of photons per second

624
00:30:24,058 --> 00:30:29,009
then it should never be modified meaning

625
00:30:26,548 --> 00:30:33,509
that value that's in its emission

626
00:30:29,009 --> 00:30:36,119
quantity doesn't go down it can't write

627
00:30:33,509 --> 00:30:38,490
because an emitter outputs light all the

628
00:30:36,119 --> 00:30:41,579
time it's not something that can be

629
00:30:38,490 --> 00:30:45,029
diminished it's always gonna have the

630
00:30:41,579 --> 00:30:47,250
same photons per second right so rather

631
00:30:45,029 --> 00:30:49,558
than thinking and I think this is good I

632
00:30:47,250 --> 00:30:51,720
like where this is going rather than

633
00:30:49,558 --> 00:30:54,480
thinking about the system as an array of

634
00:30:51,720 --> 00:30:56,669
values and we put some quantity in one

635
00:30:54,480 --> 00:31:00,200
place and we let it flow to another and

636
00:30:56,669 --> 00:31:03,090
it goes out of there almost like water I

637
00:31:00,200 --> 00:31:04,890
don't like that as much as thinking

638
00:31:03,089 --> 00:31:07,678
about it in terms of photons per second

639
00:31:04,890 --> 00:31:10,500
so the emitters are basically a separate

640
00:31:07,679 --> 00:31:12,179
array that's saying here's where light

641
00:31:10,500 --> 00:31:15,179
is always coming from these are

642
00:31:12,179 --> 00:31:19,440
constants and then we have a secondary

643
00:31:15,179 --> 00:31:21,269
array right which is thresholded on that

644
00:31:19,440 --> 00:31:22,798
so we're basically saying it the

645
00:31:21,269 --> 00:31:24,298
secondary array which actually computes

646
00:31:22,798 --> 00:31:27,808
the photons per second for everybody

647
00:31:24,298 --> 00:31:29,819
those get cold copied in and hard set

648
00:31:27,808 --> 00:31:33,240
always to the same photons per second

649
00:31:29,819 --> 00:31:36,298
right and everybody else's photons per

650
00:31:33,240 --> 00:31:39,630
second are equalizing out and can be can

651
00:31:36,298 --> 00:31:41,668
be mushed around right that's a more

652
00:31:39,630 --> 00:31:44,010
coherent way to think about it for me

653
00:31:41,669 --> 00:31:45,630
because it goes back to values we can

654
00:31:44,009 --> 00:31:51,390
actually put our finger on

655
00:31:45,630 --> 00:31:53,610
right flooding photons into a value in

656
00:31:51,390 --> 00:31:55,049
letting them drain out creates this

657
00:31:53,609 --> 00:31:58,139
weird thing about what should that

658
00:31:55,048 --> 00:32:00,029
quanta be and how should we normalize it

659
00:31:58,140 --> 00:32:01,950
whereas photons per second is something

660
00:32:00,029 --> 00:32:04,019
I can put my finger on and say it's

661
00:32:01,950 --> 00:32:07,140
constant for emitters everybody else it

662
00:32:04,019 --> 00:32:14,000
equalizes out based on our samples right

663
00:32:07,140 --> 00:32:18,120
what we guessed that it should be okay

664
00:32:14,000 --> 00:32:21,230
so now we come to sort of the the crux

665
00:32:18,119 --> 00:32:24,418
of this understanding that we need to

666
00:32:21,230 --> 00:32:27,169
determine and that is suppose we're not

667
00:32:24,419 --> 00:32:30,450
talking about emitters we just have

668
00:32:27,169 --> 00:32:34,919
photons per second so all of these are

669
00:32:30,450 --> 00:32:40,519
photons per second and now we've got a

670
00:32:34,919 --> 00:32:44,970
situation where we've traced a path

671
00:32:40,519 --> 00:32:47,788
between two of them so we know that for

672
00:32:44,970 --> 00:32:54,120
example if this is you know sample zero

673
00:32:47,788 --> 00:32:57,169
actually let's just use a and B so if we

674
00:32:54,119 --> 00:33:00,779
knew we have a point a and point B right

675
00:32:57,169 --> 00:33:04,559
and B has a certain you know we'll call

676
00:33:00,779 --> 00:33:07,230
this F B we'll call this f of a we know

677
00:33:04,558 --> 00:33:09,928
that there are certain amounts of

678
00:33:07,230 --> 00:33:12,679
photons per second passing through these

679
00:33:09,929 --> 00:33:14,820
points based on our previous estimate

680
00:33:12,679 --> 00:33:17,759
now we don't know how to make that

681
00:33:14,819 --> 00:33:18,928
estimate but we know this is an

682
00:33:17,759 --> 00:33:20,730
iterative algorithm so we're just going

683
00:33:18,929 --> 00:33:23,788
to assume for the purposes of

684
00:33:20,730 --> 00:33:25,440
determining how we do our updates we're

685
00:33:23,788 --> 00:33:27,390
gonna assume that we have determined

686
00:33:25,440 --> 00:33:28,710
some number of photons per second that

687
00:33:27,390 --> 00:33:31,620
are passing through these points but

688
00:33:28,710 --> 00:33:36,569
that's all we know now in one case

689
00:33:31,619 --> 00:33:39,269
because it's in a in a sense this is

690
00:33:36,569 --> 00:33:41,490
inductive right it's saying we know you

691
00:33:39,269 --> 00:33:44,609
know we know what the first thing is we

692
00:33:41,490 --> 00:33:46,200
know what F 0 was we don't know what F 1

693
00:33:44,609 --> 00:33:49,678
is so we're trying to get the thing that

694
00:33:46,200 --> 00:33:51,720
takes us from F 0 to F 1 and we do know

695
00:33:49,679 --> 00:33:53,759
a start-up case which is an emitter we

696
00:33:51,720 --> 00:33:55,259
know the sample the protons per second

697
00:33:53,759 --> 00:33:57,808
at the emitter because we're specifying

698
00:33:55,259 --> 00:33:59,129
its what makes it at emitter so we do

699
00:33:57,808 --> 00:34:03,119
know how we're gonna get our

700
00:33:59,130 --> 00:34:05,250
first set of photons per second so now

701
00:34:03,119 --> 00:34:06,899
the question is if we assume that some

702
00:34:05,250 --> 00:34:07,940
people have photons per second-- we just

703
00:34:06,900 --> 00:34:11,429
don't know who they are

704
00:34:07,940 --> 00:34:18,389
how do we update other people based on

705
00:34:11,429 --> 00:34:21,059
that information so if we know right

706
00:34:18,389 --> 00:34:23,010
that this has a certain amount of

707
00:34:21,059 --> 00:34:26,250
photons per second passing through it

708
00:34:23,010 --> 00:34:27,870
and we know that this has a certain

709
00:34:26,250 --> 00:34:31,500
number of photons for a second passing

710
00:34:27,869 --> 00:34:34,289
through it and we know that they are

711
00:34:31,500 --> 00:34:39,659
connected so they can send photons to

712
00:34:34,289 --> 00:34:42,239
each other how can we update the photons

713
00:34:39,659 --> 00:34:51,570
per second in a way that starts to

714
00:34:42,239 --> 00:34:55,439
properly equalize our light so I think

715
00:34:51,570 --> 00:34:58,620
the first thing we want to recognize is

716
00:34:55,440 --> 00:35:03,389
that the photons per second is not a

717
00:34:58,619 --> 00:35:05,339
value that comes and goes and I think

718
00:35:03,389 --> 00:35:10,289
this is where I was where we're sort of

719
00:35:05,340 --> 00:35:12,720
my basic idea before of how to compute

720
00:35:10,289 --> 00:35:14,610
the radiosity was just kind of wrong was

721
00:35:12,719 --> 00:35:17,069
that I was doing it more based on quanta

722
00:35:14,610 --> 00:35:19,410
which is just not a useful way of doing

723
00:35:17,070 --> 00:35:23,090
it again photons per second I think I

724
00:35:19,409 --> 00:35:23,089
think this makes a much clearer picture

725
00:35:23,539 --> 00:35:27,509
photons per second is not something that

726
00:35:25,800 --> 00:35:29,460
comes and goes photons per second is

727
00:35:27,510 --> 00:35:33,810
something that we need to use an

728
00:35:29,460 --> 00:35:35,789
estimate of what we think the photons

729
00:35:33,809 --> 00:35:40,860
per second should be based on what we've

730
00:35:35,789 --> 00:35:45,869
seen and what we were so I think what

731
00:35:40,860 --> 00:35:50,880
we'd rather do is for every person that

732
00:35:45,869 --> 00:35:54,539
we're summing we want to take every you

733
00:35:50,880 --> 00:36:01,349
know photon per second path that we

734
00:35:54,539 --> 00:36:04,019
found right and averaged so if we found

735
00:36:01,349 --> 00:36:06,179
a number of these paths for B for the

736
00:36:04,019 --> 00:36:08,969
you know on the next frame the

737
00:36:06,179 --> 00:36:10,739
subsequent one is for every photon

738
00:36:08,969 --> 00:36:12,599
splitting passed we found we average

739
00:36:10,739 --> 00:36:16,709
those photons per second together

740
00:36:12,599 --> 00:36:21,170
right so we basically say well if I saw

741
00:36:16,710 --> 00:36:24,780
this guy right let's say this is f of C

742
00:36:21,170 --> 00:36:26,909
if I saw this guy and this was a certain

743
00:36:24,780 --> 00:36:28,470
photons per second and I saw this guy

744
00:36:26,909 --> 00:36:30,960
and this was a certain photons per

745
00:36:28,469 --> 00:36:34,230
second then obviously and my say average

746
00:36:30,960 --> 00:36:35,579
I mean using the cosine influx right so

747
00:36:34,230 --> 00:36:42,210
we're gonna wait based on angle

748
00:36:35,579 --> 00:36:44,159
certainly using the averaging those

749
00:36:42,210 --> 00:36:48,300
together should give us the photons per

750
00:36:44,159 --> 00:36:53,279
second inbound at this point right it's

751
00:36:48,300 --> 00:36:55,530
not addition it's an average why because

752
00:36:53,280 --> 00:36:58,140
we want to know the average photons per

753
00:36:55,530 --> 00:37:00,330
second passing through this point it

754
00:36:58,139 --> 00:37:02,879
doesn't add them up as if they were

755
00:37:00,329 --> 00:37:05,549
quantities that shot at us individually

756
00:37:02,880 --> 00:37:07,890
it's just an average of what's the light

757
00:37:05,550 --> 00:37:09,960
I can see well the light I can see is an

758
00:37:07,889 --> 00:37:11,940
average of all of the photons per second

759
00:37:09,960 --> 00:37:16,800
of all the surfaces that I can look out

760
00:37:11,940 --> 00:37:18,059
and and proceed right and if we want to

761
00:37:16,800 --> 00:37:20,190
take that a step further in the future

762
00:37:18,059 --> 00:37:22,500
we can have different surface Quantic

763
00:37:20,190 --> 00:37:24,809
qualities that actually react

764
00:37:22,500 --> 00:37:27,210
differently to different angles as well

765
00:37:24,809 --> 00:37:28,739
but I don't know that we you know in

766
00:37:27,210 --> 00:37:30,539
other words not just cosine fall off but

767
00:37:28,739 --> 00:37:31,979
actually have lobes of reflectance I

768
00:37:30,539 --> 00:37:33,480
don't think we want to do that because I

769
00:37:31,980 --> 00:37:36,900
don't think we're shooting enough raised

770
00:37:33,480 --> 00:37:39,030
to really do much surface approximation

771
00:37:36,900 --> 00:37:40,530
in that way but you know you could see

772
00:37:39,030 --> 00:37:45,690
how you would extend this technique in

773
00:37:40,530 --> 00:37:49,230
that way so I think we want to do for

774
00:37:45,690 --> 00:37:51,300
every path we find we averaged the

775
00:37:49,230 --> 00:37:56,579
photos per second module of the cosine

776
00:37:51,300 --> 00:37:58,380
term and then we assume that our photons

777
00:37:56,579 --> 00:38:00,750
per second can only change at a

778
00:37:58,380 --> 00:38:06,000
particular rate and this is to avoid the

779
00:38:00,750 --> 00:38:09,150
flicker right so again we assume now in

780
00:38:06,000 --> 00:38:11,809
addition that you know we blend with the

781
00:38:09,150 --> 00:38:11,809
previous frame

782
00:38:14,750 --> 00:38:28,929
based on a maximum change rate so again

783
00:38:27,349 --> 00:38:31,400
I think we're really close

784
00:38:28,929 --> 00:38:32,929
algorithmically to what we want but we

785
00:38:31,400 --> 00:38:34,400
just need to change our thinking about

786
00:38:32,929 --> 00:38:36,649
it a little bit and change what our

787
00:38:34,400 --> 00:38:37,970
quantities mean and I think once we

788
00:38:36,650 --> 00:38:41,539
change what our quantities mean to

789
00:38:37,969 --> 00:38:44,889
something a little more amenable to what

790
00:38:41,539 --> 00:38:47,449
we're doing I think we're gonna be okay

791
00:38:44,889 --> 00:38:51,170
so mainly just changing to an average

792
00:38:47,449 --> 00:39:02,899
and then retaining that concept of a

793
00:38:51,170 --> 00:39:06,440
blend at the end okay so that all makes

794
00:39:02,900 --> 00:39:07,730
really good sense sense to me why does

795
00:39:06,440 --> 00:39:10,130
that make a sense to me because that

796
00:39:07,730 --> 00:39:12,440
solves number two as well now we don't

797
00:39:10,130 --> 00:39:15,289
have to think about photons coming from

798
00:39:12,440 --> 00:39:17,179
and going to somewhere because all we're

799
00:39:15,289 --> 00:39:18,980
doing is thinking about the flux we're

800
00:39:17,179 --> 00:39:21,440
just thinking about the amount of light

801
00:39:18,980 --> 00:39:23,840
passing through a surface we are no

802
00:39:21,440 --> 00:39:26,150
longer thinking about an individual

803
00:39:23,840 --> 00:39:28,100
piece of light that goes now we are

804
00:39:26,150 --> 00:39:30,800
thinking about that in terms of the path

805
00:39:28,099 --> 00:39:33,170
tracing but we're just using those

806
00:39:30,800 --> 00:39:35,539
particles as tracers to figure out how

807
00:39:33,170 --> 00:39:37,909
to update the photons per second we're

808
00:39:35,539 --> 00:39:40,309
not using them as if they were actual

809
00:39:37,909 --> 00:39:45,049
quanta of light that we're pushing

810
00:39:40,309 --> 00:39:46,159
around right it's very subtle smallest

811
00:39:45,050 --> 00:39:48,710
little difference but sometimes the

812
00:39:46,159 --> 00:39:53,299
smallest difference can make all the

813
00:39:48,710 --> 00:39:54,829
difference right and then finally this

814
00:39:53,300 --> 00:39:56,480
for number three I think we get the

815
00:39:54,829 --> 00:39:58,219
answer out of that as well which is that

816
00:39:56,480 --> 00:40:01,309
once we know the photons per second and

817
00:39:58,219 --> 00:40:02,989
again we can keep through our path

818
00:40:01,309 --> 00:40:05,000
tracing an average light direction

819
00:40:02,989 --> 00:40:06,469
that's all we need to hand to the

820
00:40:05,000 --> 00:40:08,239
renderer the average light Direction

821
00:40:06,469 --> 00:40:10,339
plus the photons per second of red green

822
00:40:08,239 --> 00:40:13,219
and blue channels that should be enough

823
00:40:10,340 --> 00:40:17,890
for it to do the lighting computation

824
00:40:13,219 --> 00:40:17,889
that it needs to do at that point right

825
00:40:19,500 --> 00:40:26,349
so I think that's a fairly sane way of

826
00:40:22,630 --> 00:40:29,650
looking at the problem and again photons

827
00:40:26,349 --> 00:40:31,539
per second is an abstract idea we don't

828
00:40:29,650 --> 00:40:34,809
have to actually measure photons per

829
00:40:31,539 --> 00:40:36,880
second because photons per second would

830
00:40:34,809 --> 00:40:38,949
be an astronomically high number so

831
00:40:36,880 --> 00:40:41,079
we're talking about some scaled quantity

832
00:40:38,949 --> 00:40:44,349
that just relates to the photons per

833
00:40:41,079 --> 00:40:46,000
second so say 1.0 is a million or a

834
00:40:44,349 --> 00:40:48,610
billion photons per second or something

835
00:40:46,000 --> 00:40:50,679
right we don't have to actually tie this

836
00:40:48,610 --> 00:40:53,800
quantity back to something physical in

837
00:40:50,679 --> 00:40:55,029
terms of its actual value we're just

838
00:40:53,800 --> 00:40:57,640
trying to tie to something physical in

839
00:40:55,030 --> 00:40:59,200
terms of its meaning and that's crucial

840
00:40:57,639 --> 00:41:02,230
because that's the part that will allow

841
00:40:59,199 --> 00:41:05,049
us to do a good solution right the

842
00:41:02,230 --> 00:41:08,079
unit's are irrelevant in terms of their

843
00:41:05,050 --> 00:41:10,810
scale they're not irrelevant in terms of

844
00:41:08,079 --> 00:41:12,369
their semantic quality so understanding

845
00:41:10,809 --> 00:41:14,199
that this is a linear quality relating

846
00:41:12,369 --> 00:41:16,690
to photons per second that's the

847
00:41:14,199 --> 00:41:18,129
important part and some part that we

848
00:41:16,690 --> 00:41:21,579
weren't really talking about or thinking

849
00:41:18,130 --> 00:41:24,250
about before where as the what whether

850
00:41:21,579 --> 00:41:26,799
it's actually photons per second or some

851
00:41:24,250 --> 00:41:29,170
other like billion photons for a second

852
00:41:26,800 --> 00:41:31,900
or something that part is not relevant

853
00:41:29,170 --> 00:41:34,059
because the scale is tunable by us based

854
00:41:31,900 --> 00:41:35,590
on the exposure value we want for the

855
00:41:34,059 --> 00:41:38,650
brightness of the scene what we want our

856
00:41:35,590 --> 00:41:40,840
light values to mean so that's just a

857
00:41:38,650 --> 00:41:43,059
separate part of the equation we can

858
00:41:40,840 --> 00:41:45,130
look at later it doesn't matter for

859
00:41:43,059 --> 00:41:47,320
purposes of the lighting because the

860
00:41:45,130 --> 00:41:49,780
lighting is going to produce the same

861
00:41:47,320 --> 00:41:53,500
solutions regardless of what the scale

862
00:41:49,780 --> 00:41:55,510
of those values actually is it's just

863
00:41:53,500 --> 00:41:58,059
the renderers brightness that will

864
00:41:55,510 --> 00:41:59,500
change so we need to you know be aware

865
00:41:58,059 --> 00:42:03,610
of that in the second half of things

866
00:41:59,500 --> 00:42:10,119
essentially so I'm pretty happy with

867
00:42:03,610 --> 00:42:11,620
that I'm pretty happy with that let's

868
00:42:10,119 --> 00:42:13,299
take a look at how this routine is gonna

869
00:42:11,619 --> 00:42:15,369
change cuz not gonna change that much

870
00:42:13,300 --> 00:42:17,740
and then I also want to go ahead today

871
00:42:15,369 --> 00:42:19,449
if we have time in addition to this

872
00:42:17,739 --> 00:42:21,329
change well I haven't even opened my

873
00:42:19,449 --> 00:42:24,639
command console yet there we go

874
00:42:21,329 --> 00:42:28,650
in addition to this change I would like

875
00:42:24,639 --> 00:42:31,569
to go ahead and make the bi-directional

876
00:42:28,650 --> 00:42:32,889
version if we have time today because I

877
00:42:31,570 --> 00:42:35,260
I'm pretty sure that is just

878
00:42:32,889 --> 00:42:37,029
a smarter way to do it because finding

879
00:42:35,260 --> 00:42:39,910
those halves is expensive and so I think

880
00:42:37,030 --> 00:42:42,100
we want to as much as possible unless

881
00:42:39,909 --> 00:42:44,889
there ends up being a really strong

882
00:42:42,099 --> 00:42:46,750
reason why we are unable to do so I

883
00:42:44,889 --> 00:42:53,079
would like to make it so that we can

884
00:42:46,750 --> 00:42:54,969
reuse each path that we find ok so let's

885
00:42:53,079 --> 00:42:58,269
take a look at how we're doing this here

886
00:42:54,969 --> 00:43:03,129
so inside went in when we open up our

887
00:42:58,269 --> 00:43:07,929
lighting test here what we've got is

888
00:43:03,130 --> 00:43:11,710
we've got our emit C 0 and our emit C 1

889
00:43:07,929 --> 00:43:14,710
values and what I'd like to do is now

890
00:43:11,710 --> 00:43:16,659
make these values mean something a

891
00:43:14,710 --> 00:43:19,570
little bit different perhaps than they

892
00:43:16,659 --> 00:43:20,859
were before so what I'm going to do here

893
00:43:19,570 --> 00:43:22,539
is go just gonna play around with it a

894
00:43:20,860 --> 00:43:23,860
little bit just to see if I can set up a

895
00:43:22,539 --> 00:43:25,449
situation that makes a little bit more

896
00:43:23,860 --> 00:43:27,789
sense to me in terms of how to structure

897
00:43:25,449 --> 00:43:30,759
the routine and we'll go through it step

898
00:43:27,789 --> 00:43:34,719
by step so we know we've got two things

899
00:43:30,760 --> 00:43:40,660
here we know we've got emit C 0 and we

900
00:43:34,719 --> 00:43:42,699
know we've got to MIT C 1 so what I'd

901
00:43:40,659 --> 00:43:46,750
like to do here is I'd like to move to

902
00:43:42,699 --> 00:43:50,259
considering the emit C 0 as the actual

903
00:43:46,750 --> 00:43:54,880
stated emission values of the light at a

904
00:43:50,260 --> 00:43:56,980
particular time and emit C want well

905
00:43:54,880 --> 00:43:58,240
okay you know I may be getting ahead of

906
00:43:56,980 --> 00:44:05,920
myself here let me not say that quite

907
00:43:58,239 --> 00:44:07,979
yet so we know that the emitters are

908
00:44:05,920 --> 00:44:11,289
never gonna change their emission values

909
00:44:07,980 --> 00:44:14,920
right so they're always going to be

910
00:44:11,289 --> 00:44:18,460
exactly what you know whatever they were

911
00:44:14,920 --> 00:44:20,889
we know that it's only the the average

912
00:44:18,460 --> 00:44:21,990
value that's going the the the new value

913
00:44:20,889 --> 00:44:24,879
for the next time that's going to be

914
00:44:21,989 --> 00:44:27,759
changed so I think what we want to do

915
00:44:24,880 --> 00:44:30,490
here is we want to rather than do this

916
00:44:27,760 --> 00:44:35,080
as a plus what we want to do is see

917
00:44:30,489 --> 00:44:39,339
whether this is an emitter or not and

918
00:44:35,079 --> 00:44:41,769
update it that way right because if it's

919
00:44:39,340 --> 00:44:44,620
an emitter it's gonna cold set the

920
00:44:41,769 --> 00:44:46,250
photon value and if it's not that it's

921
00:44:44,619 --> 00:44:47,929
not now there's

922
00:44:46,250 --> 00:44:49,519
ways we can look at this one is that we

923
00:44:47,929 --> 00:44:52,789
can support things that are both

924
00:44:49,519 --> 00:44:58,070
emitters and reflectors I don't know

925
00:44:52,789 --> 00:45:00,920
whether we want to do that or not we may

926
00:44:58,070 --> 00:45:02,960
want to and if we want to then we need a

927
00:45:00,920 --> 00:45:06,829
good way of understanding that that's

928
00:45:02,960 --> 00:45:09,619
what's going on which means we're going

929
00:45:06,829 --> 00:45:13,750
to need the you know we almost need like

930
00:45:09,619 --> 00:45:13,750
a third array for that I think

931
00:45:20,380 --> 00:45:34,280
because I don't really see a lot of ways

932
00:45:23,329 --> 00:45:36,489
around it let me explain what I mean by

933
00:45:34,280 --> 00:45:36,490
this

934
00:45:39,130 --> 00:45:48,230
okay so let's suppose I have a surface

935
00:45:43,719 --> 00:45:50,389
that's an emitter but it's also

936
00:45:48,230 --> 00:45:52,610
reflector so we want to be able to

937
00:45:50,389 --> 00:45:54,980
commute compute both at what's an

938
00:45:52,610 --> 00:45:58,430
example well let's suppose this thing is

939
00:45:54,980 --> 00:46:02,750
emitting red light but it's actually a

940
00:45:58,429 --> 00:46:05,659
gray surface otherwise right so if green

941
00:46:02,750 --> 00:46:08,090
light came in we would expect green

942
00:46:05,659 --> 00:46:09,949
light to come out proportional to how

943
00:46:08,090 --> 00:46:11,990
much went through that would be an

944
00:46:09,949 --> 00:46:13,730
emitter reflector now why do we care

945
00:46:11,989 --> 00:46:15,169
about this it may seem like a thing to

946
00:46:13,730 --> 00:46:17,360
not really care about well let's suppose

947
00:46:15,170 --> 00:46:20,360
we want things in the world that are not

948
00:46:17,360 --> 00:46:23,360
lit that become lit and we want that

949
00:46:20,360 --> 00:46:25,460
light to fade in well if they're not lit

950
00:46:23,360 --> 00:46:26,539
originally they need to be reflectors in

951
00:46:25,460 --> 00:46:30,650
order for you to see them at all they

952
00:46:26,539 --> 00:46:32,779
might they just be black right but now

953
00:46:30,650 --> 00:46:34,760
what's gonna happen is as the light

954
00:46:32,780 --> 00:46:36,440
starts to fade in the instant you get

955
00:46:34,760 --> 00:46:38,420
any emission there at all if you could

956
00:46:36,440 --> 00:46:40,480
only be an emitter or a reflector it

957
00:46:38,420 --> 00:46:43,460
will suddenly snap to black then

958
00:46:40,480 --> 00:46:44,929
gradually become bright in red and lose

959
00:46:43,460 --> 00:46:47,179
all of its previous color that will be a

960
00:46:44,929 --> 00:46:49,069
nasty visual artifact so if we want to

961
00:46:47,179 --> 00:46:51,859
be able to transition between an emitter

962
00:46:49,070 --> 00:46:53,120
and a reflector nice and smooth even if

963
00:46:51,860 --> 00:46:55,460
we don't care about anything else just

964
00:46:53,119 --> 00:46:57,349
that effect I think we want to do both

965
00:46:55,460 --> 00:46:59,179
so the thing that I'm concerned about

966
00:46:57,349 --> 00:47:02,269
here is that if you look at what happens

967
00:46:59,179 --> 00:47:06,469
with emission reflection on the

968
00:47:02,269 --> 00:47:12,650
subsequent frames I need to be able to

969
00:47:06,469 --> 00:47:14,359
know that I'm not adding in like this

970
00:47:12,650 --> 00:47:17,539
additional emission that's coming from

971
00:47:14,360 --> 00:47:21,019
the user I'm just saying that this is

972
00:47:17,539 --> 00:47:24,409
how much has to be emitted at a minimum

973
00:47:21,019 --> 00:47:26,509
right so I need to know the difference

974
00:47:24,409 --> 00:47:29,029
between the emitted light and the

975
00:47:26,510 --> 00:47:31,550
reflected light because if I don't keep

976
00:47:29,030 --> 00:47:33,769
those quantities separate I don't know

977
00:47:31,550 --> 00:47:36,380
on the subsequent frame how do

978
00:47:33,769 --> 00:47:39,170
the emission value coming from the user

979
00:47:36,380 --> 00:47:41,570
because I don't know how much light I

980
00:47:39,170 --> 00:47:47,389
was trying to say I was taking above and

981
00:47:41,570 --> 00:47:49,670
beyond that previous emission value so I

982
00:47:47,389 --> 00:47:53,059
realized that's a little confusing

983
00:47:49,670 --> 00:47:54,470
I just don't know another way to deal

984
00:47:53,059 --> 00:47:58,759
with it at the moment

985
00:47:54,469 --> 00:48:01,309
right so what I'd like to do is is maybe

986
00:47:58,760 --> 00:48:04,390
just expand this a little bit and we can

987
00:48:01,309 --> 00:48:08,960
collapse it down later you know we can

988
00:48:04,389 --> 00:48:14,629
in the future try to do something where

989
00:48:08,960 --> 00:48:16,579
we you know try to do something where we

990
00:48:14,630 --> 00:48:18,289
handle this in a way that doesn't

991
00:48:16,579 --> 00:48:21,289
require extra storage or something as we

992
00:48:18,289 --> 00:48:23,389
optimize but just right now I'm just not

993
00:48:21,289 --> 00:48:25,940
sure how to do it any other way so I

994
00:48:23,389 --> 00:48:27,349
want to I want to be explicit while we

995
00:48:25,940 --> 00:48:29,480
get this routine working the way we want

996
00:48:27,349 --> 00:48:31,579
and then later I can optimize it if I

997
00:48:29,480 --> 00:48:35,659
think I understand a good way to do that

998
00:48:31,579 --> 00:48:38,000
right so I'm not going to call these

999
00:48:35,659 --> 00:48:41,179
emit c0 and it's c1 or anything like

1000
00:48:38,000 --> 00:48:43,190
that I'm gonna actually start to be sort

1001
00:48:41,179 --> 00:48:45,529
of more explicit about this this is the

1002
00:48:43,190 --> 00:48:52,099
emission array so that's how much light

1003
00:48:45,530 --> 00:48:54,050
something is giving out let's say well

1004
00:48:52,099 --> 00:48:59,630
okay let me start with things I know so

1005
00:48:54,050 --> 00:49:03,340
this is my photons per second right like

1006
00:48:59,630 --> 00:49:12,309
we just talked about and so this will be

1007
00:49:03,340 --> 00:49:15,309
the starting or this is like accumulated

1008
00:49:12,309 --> 00:49:15,309
PPS

1009
00:49:19,309 --> 00:49:23,578
so we know we need an initial photons

1010
00:49:22,050 --> 00:49:27,930
per second and an accumulated photons

1011
00:49:23,579 --> 00:49:29,880
per second and we also then need some

1012
00:49:27,929 --> 00:49:31,769
emission photons per second which we

1013
00:49:29,880 --> 00:49:34,800
will add into the accumulated photons

1014
00:49:31,769 --> 00:49:38,880
per second to produce the final value

1015
00:49:34,800 --> 00:49:46,950
right I think that's essentially what we

1016
00:49:38,880 --> 00:49:49,440
want to talk about here I think not

1017
00:49:46,949 --> 00:49:50,879
entirely sure but you know what we may

1018
00:49:49,440 --> 00:49:51,960
not not need to track that though I

1019
00:49:50,880 --> 00:49:53,990
think we may only need to track these

1020
00:49:51,960 --> 00:49:59,220
two and then we can just add in the end

1021
00:49:53,989 --> 00:50:00,539
by doing this a second time I'm gonna

1022
00:49:59,219 --> 00:50:04,068
keep it as a separate array for now but

1023
00:50:00,539 --> 00:50:04,068
I think we can maybe get away without it

1024
00:50:06,650 --> 00:50:21,760
okay yeah okay all right so

1025
00:50:19,900 --> 00:50:27,180
let's go ahead and move forward with

1026
00:50:21,760 --> 00:50:27,180
this so let's suppose that we have the

1027
00:50:33,570 --> 00:50:40,510
let's suppose that we have these values

1028
00:50:38,019 --> 00:50:42,250
initialized the way we were doing it

1029
00:50:40,510 --> 00:50:51,160
before so we have the initial photons

1030
00:50:42,250 --> 00:51:01,780
per second and we want the initial

1031
00:50:51,159 --> 00:51:03,369
photons per second to be the old value

1032
00:51:01,780 --> 00:51:07,120
plus any emission that was going to come

1033
00:51:03,369 --> 00:51:08,529
through right and again these are we

1034
00:51:07,119 --> 00:51:09,639
don't have a specific unit for this so

1035
00:51:08,530 --> 00:51:11,830
we're just going to use whatever the old

1036
00:51:09,639 --> 00:51:12,969
units were and that's fine right we're

1037
00:51:11,829 --> 00:51:13,779
gonna stuff the initial photons for a

1038
00:51:12,969 --> 00:51:17,230
second this way

1039
00:51:13,780 --> 00:51:19,570
and the average direction to light is a

1040
00:51:17,230 --> 00:51:23,170
value that we're summing up and

1041
00:51:19,570 --> 00:51:26,350
averaging so this was actually this may

1042
00:51:23,170 --> 00:51:29,170
have been a big source of our flicker

1043
00:51:26,349 --> 00:51:30,610
actually I didn't for some reason

1044
00:51:29,170 --> 00:51:32,139
address this I didn't think about it

1045
00:51:30,610 --> 00:51:34,900
when we fixed the fact that we were

1046
00:51:32,139 --> 00:51:39,069
erroneously computing it before and that

1047
00:51:34,900 --> 00:51:41,050
was a source of flicker you know another

1048
00:51:39,070 --> 00:51:43,570
source of flicker is just the fact that

1049
00:51:41,050 --> 00:51:47,890
we are not waiting the average of these

1050
00:51:43,570 --> 00:51:51,309
two things to force the direction to

1051
00:51:47,889 --> 00:51:52,659
bend slowly over time so the other thing

1052
00:51:51,309 --> 00:51:55,750
that we want to do is we want to have a

1053
00:51:52,659 --> 00:51:57,699
stable update coefficient here right so

1054
00:51:55,750 --> 00:52:01,380
we want to have something that

1055
00:51:57,699 --> 00:52:01,379
effectively says all right

1056
00:52:02,139 --> 00:52:10,539
what is our sort of update per frame or

1057
00:52:05,409 --> 00:52:15,940
what is what is our update rate right so

1058
00:52:10,539 --> 00:52:17,949
our update sort of blend coefficient

1059
00:52:15,940 --> 00:52:19,990
here let's suppose that it's going to be

1060
00:52:17,949 --> 00:52:22,449
something like point 2f so it takes you

1061
00:52:19,989 --> 00:52:24,189
know five frames before we update our

1062
00:52:22,449 --> 00:52:27,009
lighting or something like that right

1063
00:52:24,190 --> 00:52:28,389
well if that's in you know maybe that's

1064
00:52:27,010 --> 00:52:30,580
too high I don't know you know this is a

1065
00:52:28,389 --> 00:52:31,699
tunable coefficient we have no idea also

1066
00:52:30,579 --> 00:52:35,509
we are doing this now

1067
00:52:31,699 --> 00:52:37,338
so let's get rid of that comment so if

1068
00:52:35,510 --> 00:52:42,170
that's the case then what that means is

1069
00:52:37,338 --> 00:52:44,539
that the the direction here actually

1070
00:52:42,170 --> 00:52:48,079
wants to be multiplied by that inverse

1071
00:52:44,539 --> 00:52:50,659
right so what we want to do is say 1.0

1072
00:52:48,079 --> 00:52:52,609
over the T update is what we want to

1073
00:52:50,659 --> 00:52:55,460
multiply this direction by so that it's

1074
00:52:52,608 --> 00:52:57,230
weighted much more strongly than the

1075
00:52:55,460 --> 00:53:01,630
average direction to light that we're

1076
00:52:57,230 --> 00:53:04,519
taking from everybody else right

1077
00:53:01,630 --> 00:53:08,180
that way when we add in all of the other

1078
00:53:04,519 --> 00:53:11,420
light samples that we get we can

1079
00:53:08,179 --> 00:53:13,699
minimize them that way now it's probably

1080
00:53:11,420 --> 00:53:15,530
the case that we would rather since we

1081
00:53:13,699 --> 00:53:17,750
don't know how many past samples were

1082
00:53:15,530 --> 00:53:19,640
going to take it's probably the case

1083
00:53:17,750 --> 00:53:22,579
that we would like to normalize those

1084
00:53:19,639 --> 00:53:24,379
separately and then blend in so another

1085
00:53:22,579 --> 00:53:27,800
way to look at this might be that we

1086
00:53:24,380 --> 00:53:30,920
really should clear this value and then

1087
00:53:27,800 --> 00:53:33,220
blend it afterwards right so it could be

1088
00:53:30,920 --> 00:53:36,130
that this should just be set this way

1089
00:53:33,219 --> 00:53:38,779
and then in the end when we go through

1090
00:53:36,130 --> 00:53:43,550
we do actually want to do that update

1091
00:53:38,780 --> 00:53:45,990
and now this stuff were this stuff where

1092
00:53:43,550 --> 00:53:49,070
we do that the blending

1093
00:53:45,989 --> 00:53:49,069
[Music]

1094
00:53:52,380 --> 00:53:59,039
I think we should be fine to just always

1095
00:53:55,289 --> 00:54:00,750
blend it will mean that at first things

1096
00:53:59,039 --> 00:54:05,089
get a little slow yeah maybe we want to

1097
00:54:00,750 --> 00:54:05,088
just use it right out of the gate

1098
00:54:14,650 --> 00:54:22,059
so I guess this is fine I guess the way

1099
00:54:19,210 --> 00:54:27,220
we're doing this here is fine

1100
00:54:22,059 --> 00:54:29,528
so this T Update value here is what

1101
00:54:27,219 --> 00:54:32,980
we're going to use so when we come

1102
00:54:29,528 --> 00:54:35,380
through here and we do our update we do

1103
00:54:32,980 --> 00:54:37,568
want to do exactly this meaning we want

1104
00:54:35,380 --> 00:54:40,240
to average our light direction with the

1105
00:54:37,568 --> 00:54:41,739
previous direction that's an important

1106
00:54:40,239 --> 00:54:45,778
step and I think we were getting flicker

1107
00:54:41,739 --> 00:54:45,778
from that before unfortunately

1108
00:54:46,409 --> 00:54:50,649
so we probably should have taken care of

1109
00:54:48,998 --> 00:54:55,028
that previously but unfortunately we

1110
00:54:50,650 --> 00:54:57,880
just didn't so now we've got that that

1111
00:54:55,028 --> 00:55:03,039
part and what we need to do now is we

1112
00:54:57,880 --> 00:55:04,539
need to take a look at our take a look

1113
00:55:03,039 --> 00:55:08,200
at our other values here and write those

1114
00:55:04,539 --> 00:55:10,390
back properly now I would like it if we

1115
00:55:08,199 --> 00:55:12,460
could do this a little bit more sanely

1116
00:55:10,389 --> 00:55:17,048
here it would be nice if we if these

1117
00:55:12,460 --> 00:55:19,449
were always if these values always kind

1118
00:55:17,048 --> 00:55:21,759
of could just be done in one loop I mean

1119
00:55:19,449 --> 00:55:24,248
I wish we can always do this and we just

1120
00:55:21,759 --> 00:55:25,778
stuff the values the problem is since

1121
00:55:24,248 --> 00:55:30,159
we're doing them over a set of points

1122
00:55:25,778 --> 00:55:32,018
like this I'm not sure how valid that

1123
00:55:30,159 --> 00:55:33,368
actually is but you know since we don't

1124
00:55:32,018 --> 00:55:35,979
care about the speed of this loop yet

1125
00:55:33,369 --> 00:55:38,829
it's not it's not part of our slowness

1126
00:55:35,980 --> 00:55:41,710
really what I could do here is actually

1127
00:55:38,829 --> 00:55:49,568
do the if inside so I could actually do

1128
00:55:41,710 --> 00:55:54,519
an if valid here and deal with that and

1129
00:55:49,568 --> 00:55:57,028
make it so that we actually can simplify

1130
00:55:54,518 --> 00:55:57,028
this down

1131
00:56:00,980 --> 00:56:08,730
all right so what I mean by this is

1132
00:56:03,739 --> 00:56:12,209
inside here where we're we're we're

1133
00:56:08,730 --> 00:56:14,929
doing our update per point instead of

1134
00:56:12,210 --> 00:56:24,179
going directly with the box storage

1135
00:56:14,929 --> 00:56:27,629
value we're gonna grab those out that

1136
00:56:24,179 --> 00:56:31,519
way they can be set to default values in

1137
00:56:27,630 --> 00:56:36,320
another in any other circumstance right

1138
00:56:31,519 --> 00:56:40,500
okay so we know we have an accumulated

1139
00:56:36,320 --> 00:56:42,180
PPS and an emission PPS and what we want

1140
00:56:40,500 --> 00:56:44,130
to do is we want to add those two

1141
00:56:42,179 --> 00:56:49,109
together for the final value that gets

1142
00:56:44,130 --> 00:56:51,869
written back right I'm sorry that's not

1143
00:56:49,110 --> 00:56:54,090
true what we want to do is only write

1144
00:56:51,869 --> 00:56:55,500
back the accumulated PPS because that's

1145
00:56:54,090 --> 00:56:56,700
the part that we're actually in a store

1146
00:56:55,500 --> 00:57:00,150
from last time

1147
00:56:56,699 --> 00:57:02,189
yeah when we output the lighting to the

1148
00:57:00,150 --> 00:57:04,230
actual lighting system then we use

1149
00:57:02,190 --> 00:57:06,619
accumulated plus emission PPS which is

1150
00:57:04,230 --> 00:57:12,719
what happens in output lighting points

1151
00:57:06,619 --> 00:57:14,789
sorry about that okay so what we want to

1152
00:57:12,719 --> 00:57:22,319
store here is we want to store our

1153
00:57:14,789 --> 00:57:26,579
accumulated PPS or our last PPS right in

1154
00:57:22,320 --> 00:57:29,670
last direction so these two values are

1155
00:57:26,579 --> 00:57:32,730
going to be equal to the ones we're

1156
00:57:29,670 --> 00:57:38,570
actually going to use so this is going

1157
00:57:32,730 --> 00:57:38,570
to be here we've got our accumulated PPS

1158
00:57:43,369 --> 00:57:51,019
in our direction and what we're gonna do

1159
00:57:48,199 --> 00:57:52,699
is we're gonna assume that those equal

1160
00:57:51,019 --> 00:57:55,789
whatever the ones we're going to blend

1161
00:57:52,699 --> 00:57:57,949
to are and then when we come in here to

1162
00:57:55,789 --> 00:58:01,699
actually store these values what we're

1163
00:57:57,949 --> 00:58:03,500
gonna do is we're going to do the blend

1164
00:58:01,699 --> 00:58:04,879
regardless in all circumstances but

1165
00:58:03,500 --> 00:58:06,409
we're just going to blend it with itself

1166
00:58:04,880 --> 00:58:08,300
in the case where the the thing wasn't

1167
00:58:06,409 --> 00:58:09,259
valid and that's just me simplifying

1168
00:58:08,300 --> 00:58:11,480
this routine because I didn't like

1169
00:58:09,260 --> 00:58:12,710
having to pass there again that's

1170
00:58:11,480 --> 00:58:14,630
something we might do when we're looking

1171
00:58:12,710 --> 00:58:16,340
at performance but right now we know

1172
00:58:14,630 --> 00:58:17,660
this isn't a slow part of the routine so

1173
00:58:16,340 --> 00:58:18,860
we can afford to just do it in a way

1174
00:58:17,659 --> 00:58:23,000
that's cleaner and easier for us to

1175
00:58:18,860 --> 00:58:24,190
debug okay shouldn't say cleaner it's

1176
00:58:23,000 --> 00:58:30,079
not really about cleanliness it's about

1177
00:58:24,190 --> 00:58:32,349
simplicity so if we come through here

1178
00:58:30,079 --> 00:58:37,579
and we're going to set the box storage

1179
00:58:32,349 --> 00:58:40,579
local index dot emit that's essentially

1180
00:58:37,579 --> 00:58:43,159
the last PPS value here so that's going

1181
00:58:40,579 --> 00:58:48,409
to it I don't think we need to actually

1182
00:58:43,159 --> 00:58:57,799
update emit c0 in this way necessarily

1183
00:58:48,409 --> 00:58:59,449
here because this value is not we're

1184
00:58:57,800 --> 00:59:00,530
right well okay so we do want it because

1185
00:58:59,449 --> 00:59:03,049
we need it to be picked up from

1186
00:59:00,530 --> 00:59:06,350
somewhere so I guess that's fine so we

1187
00:59:03,050 --> 00:59:08,450
know that this is this accumulated PPS

1188
00:59:06,349 --> 00:59:09,889
and in fact I suppose we can sort of

1189
00:59:08,449 --> 00:59:12,199
make this a pointer as well if you want

1190
00:59:09,889 --> 00:59:17,539
to but let's go ahead and just a little

1191
00:59:12,199 --> 00:59:23,210
bit more explicitly here so if I grab

1192
00:59:17,539 --> 00:59:24,529
out my accumulated PPS here and my

1193
00:59:23,210 --> 00:59:27,260
average vector to light those are the

1194
00:59:24,530 --> 00:59:28,580
ones that we computed on this frame and

1195
00:59:27,260 --> 00:59:30,350
what I'm gonna do is I'm gonna update

1196
00:59:28,579 --> 00:59:32,690
them here the way they should be so we

1197
00:59:30,349 --> 00:59:34,400
know this one should be normalized at

1198
00:59:32,690 --> 00:59:38,110
the direction because it was an average

1199
00:59:34,400 --> 00:59:41,300
here we know this one needs to be

1200
00:59:38,110 --> 00:59:44,599
averaged over the number of samples that

1201
00:59:41,300 --> 00:59:47,510
were taken and right now we don't know

1202
00:59:44,599 --> 00:59:48,980
how many samples were taken so that's an

1203
00:59:47,510 --> 00:59:54,580
additional piece of information we're

1204
00:59:48,980 --> 00:59:54,579
gonna have to take

1205
00:59:59,000 --> 01:00:11,150
right so what we want to do here is take

1206
01:00:02,969 --> 01:00:13,409
the accumulated weight and multiply it

1207
01:00:11,150 --> 01:00:14,730
now that accumulated weight value might

1208
01:00:13,409 --> 01:00:15,960
be zero in the case we have enough

1209
01:00:14,730 --> 01:00:17,610
samples and that's fine that just means

1210
01:00:15,960 --> 01:00:18,809
that we didn't accumulate any photons

1211
01:00:17,610 --> 01:00:21,720
per second pass at this point that's

1212
01:00:18,809 --> 01:00:23,519
going to happen for services in the

1213
01:00:21,719 --> 01:00:24,779
world and that's fine and then we're

1214
01:00:23,519 --> 01:00:25,679
gonna normalize our direction to the

1215
01:00:24,780 --> 01:00:27,060
light because we know that we just

1216
01:00:25,679 --> 01:00:29,099
shoved a bunch of things in there and we

1217
01:00:27,059 --> 01:00:30,509
want the average we don't care what the

1218
01:00:29,099 --> 01:00:35,639
weight was because we have to normalize

1219
01:00:30,510 --> 01:00:37,680
it to a unit direction anyway right now

1220
01:00:35,639 --> 01:00:41,368
it may be that in the future we want to

1221
01:00:37,679 --> 01:00:46,529
not do that we want to use the weighting

1222
01:00:41,369 --> 01:00:48,360
of it to to and persist that forward so

1223
01:00:46,530 --> 01:00:51,570
that we know that when we take more

1224
01:00:48,360 --> 01:00:56,400
samples on a frame that we want to use

1225
01:00:51,570 --> 01:00:59,130
more of it and so on mmm yeah I'm gonna

1226
01:00:56,400 --> 01:01:00,450
go ahead and say let's not do that yet

1227
01:00:59,130 --> 01:01:02,430
because that gets into a little bit more

1228
01:01:00,449 --> 01:01:03,929
complicated like trying to see what we

1229
01:01:02,429 --> 01:01:11,699
should do sampling why serum and that's

1230
01:01:03,929 --> 01:01:15,118
a little bit much okay so if we have

1231
01:01:11,699 --> 01:01:17,429
last PPS here and last direction then

1232
01:01:15,119 --> 01:01:19,140
initialize to these two values we will

1233
01:01:17,429 --> 01:01:24,599
grab them out in the case where we know

1234
01:01:19,139 --> 01:01:27,089
that the previous values were okay and

1235
01:01:24,599 --> 01:01:30,960
then what we want to do is we want to do

1236
01:01:27,090 --> 01:01:34,970
a write back here that will produce the

1237
01:01:30,960 --> 01:01:34,970
final values that we need right

1238
01:01:43,449 --> 01:01:50,719
so we don't need to remember the average

1239
01:01:47,239 --> 01:01:52,159
direction to what we do again this is

1240
01:01:50,719 --> 01:01:54,169
just for the output routine if we did

1241
01:01:52,159 --> 01:01:56,329
output lighting points at the same time

1242
01:01:54,170 --> 01:01:57,889
not output let me point sorry if we did

1243
01:01:56,329 --> 01:02:03,440
output lighting textures at the same

1244
01:01:57,889 --> 01:02:04,969
time we wouldn't have to do that kind of

1245
01:02:03,440 --> 01:02:07,240
makes me think that that should be in

1246
01:02:04,969 --> 01:02:07,239
here

1247
01:02:07,510 --> 01:02:11,330
but again we'll just we'll deal with it

1248
01:02:10,309 --> 01:02:14,690
for now just it's not really that

1249
01:02:11,329 --> 01:02:18,679
important okay so the average direction

1250
01:02:14,690 --> 01:02:21,710
to light and the local index direction

1251
01:02:18,679 --> 01:02:24,230
that we're writing back those are going

1252
01:02:21,710 --> 01:02:30,409
to be this one's going to normalize just

1253
01:02:24,230 --> 01:02:39,469
the lerp between the old direction and

1254
01:02:30,409 --> 01:02:42,500
the new direction and that T update

1255
01:02:39,469 --> 01:02:45,379
there again is low because we we want to

1256
01:02:42,500 --> 01:02:47,690
take at least ten frames we're saying to

1257
01:02:45,380 --> 01:02:50,269
shift lighting over so because we just

1258
01:02:47,690 --> 01:02:52,400
don't think our our Sam place would be

1259
01:02:50,269 --> 01:02:57,380
good enough to update it any faster than

1260
01:02:52,400 --> 01:02:59,930
that without too much flicker so here's

1261
01:02:57,380 --> 01:03:02,260
that direction a projection to light

1262
01:02:59,929 --> 01:03:07,099
update this will update both of those

1263
01:03:02,260 --> 01:03:13,850
right and then finally we've got our box

1264
01:03:07,099 --> 01:03:15,230
storage last PPS value and again that's

1265
01:03:13,849 --> 01:03:17,269
going to look exactly the same so that's

1266
01:03:15,230 --> 01:03:25,699
just going to be alert between the

1267
01:03:17,269 --> 01:03:28,610
previous value and the new value so that

1268
01:03:25,699 --> 01:03:30,409
will just slowly move our expected

1269
01:03:28,610 --> 01:03:32,269
photons per second through the surface

1270
01:03:30,409 --> 01:03:36,769
and our expected direction to the light

1271
01:03:32,269 --> 01:03:40,400
source slowly over time towards what we

1272
01:03:36,769 --> 01:03:47,780
are seeing as the current accumulated

1273
01:03:40,400 --> 01:03:50,059
value and off we go right now

1274
01:03:47,780 --> 01:03:53,060
again I'm not sure this is really the

1275
01:03:50,059 --> 01:03:56,509
best way to sum these things because if

1276
01:03:53,059 --> 01:03:57,199
you imagine what's happening here it's

1277
01:03:56,510 --> 01:04:00,290
not

1278
01:03:57,199 --> 01:04:01,598
well you know yeah and I'm not gonna go

1279
01:04:00,289 --> 01:04:04,338
too much into it

1280
01:04:01,599 --> 01:04:05,838
point being we have a set of samples we

1281
01:04:04,338 --> 01:04:07,608
have samples from last frame samples

1282
01:04:05,838 --> 01:04:10,308
from this frame samples from next frame

1283
01:04:07,608 --> 01:04:12,769
whatever I'm not sure here that we're

1284
01:04:10,309 --> 01:04:17,059
waiting all of those samples as well as

1285
01:04:12,769 --> 01:04:18,769
we could be for our results here so take

1286
01:04:17,059 --> 01:04:23,420
that with a grain of salt I guess is

1287
01:04:18,769 --> 01:04:30,559
what I would say because it's it is a

1288
01:04:23,420 --> 01:04:32,680
little confusing to really know what's

1289
01:04:30,559 --> 01:04:34,490
supposed to be happening there right so

1290
01:04:32,679 --> 01:04:36,348
the other thing that I'm going to do

1291
01:04:34,489 --> 01:04:45,169
here is again I'm gonna set up the

1292
01:04:36,349 --> 01:04:50,750
emission values to be something that's

1293
01:04:45,170 --> 01:05:01,670
more understandable here so the emission

1294
01:04:50,750 --> 01:05:07,900
PPS I'm going to set for this light

1295
01:05:01,670 --> 01:05:07,900
index s so

1296
01:05:17,039 --> 01:05:20,979
and as you can see here so what I'm

1297
01:05:19,358 --> 01:05:22,929
trying to do is say all right I want to

1298
01:05:20,978 --> 01:05:26,678
remember what the emission value was for

1299
01:05:22,929 --> 01:05:28,689
this because I know that my initial PPS

1300
01:05:26,679 --> 01:05:30,939
and my accumulated PPS are not

1301
01:05:28,688 --> 01:05:33,639
representative of that the initial PPS

1302
01:05:30,938 --> 01:05:34,958
stores whatever amount of emission

1303
01:05:33,639 --> 01:05:37,179
particles per second we're supposed to

1304
01:05:34,958 --> 01:05:40,389
happen plus whatever the emitted ones

1305
01:05:37,179 --> 01:05:42,369
were and I know my accumulated is going

1306
01:05:40,389 --> 01:05:45,489
to be something that's based on all of

1307
01:05:42,369 --> 01:05:47,709
the averaging that's happening and so

1308
01:05:45,489 --> 01:05:50,619
what I want to do here is remember that

1309
01:05:47,708 --> 01:05:53,379
so that later when we come through here

1310
01:05:50,619 --> 01:05:55,749
to output the actual value I want the

1311
01:05:53,380 --> 01:05:58,449
color of the surface to be the

1312
01:05:55,748 --> 01:06:01,088
accumulated point photons per second

1313
01:05:58,449 --> 01:06:03,369
plus the emission photons per second

1314
01:06:01,088 --> 01:06:05,288
because that is actually coming at the

1315
01:06:03,369 --> 01:06:07,419
eye as well right

1316
01:06:05,289 --> 01:06:09,099
those emission emitters are coming

1317
01:06:07,418 --> 01:06:13,288
directly out of the surface in addition

1318
01:06:09,099 --> 01:06:13,289
to anything that bounced off the surface

1319
01:06:17,579 --> 01:06:28,869
so then if we say that we have that

1320
01:06:25,059 --> 01:06:34,150
information output I think we're good

1321
01:06:28,869 --> 01:06:44,048
here this same value is going to be used

1322
01:06:34,150 --> 01:06:49,979
up here like so and I think that's all

1323
01:06:44,048 --> 01:06:49,978
we really care about there all right

1324
01:06:50,989 --> 01:06:54,409
so again the only reason for storing it

1325
01:06:52,909 --> 01:06:56,389
there is because we don't want to

1326
01:06:54,409 --> 01:07:00,399
recreate it but we can recreate it so we

1327
01:06:56,389 --> 01:07:00,400
don't really need this you know this is

1328
01:07:08,318 --> 01:07:12,588
so we're just doing that to try and make

1329
01:07:11,210 --> 01:07:13,760
sure that there's less bugs look I don't

1330
01:07:12,588 --> 01:07:15,288
want to compute the letting in two

1331
01:07:13,760 --> 01:07:16,609
different places if we don't have to if

1332
01:07:15,289 --> 01:07:20,000
we can just store an array then it's

1333
01:07:16,608 --> 01:07:21,679
fine and so on and so forth right so

1334
01:07:20,000 --> 01:07:23,510
okay so then we go to compute light

1335
01:07:21,679 --> 01:07:25,879
propagation now we've got an update this

1336
01:07:23,510 --> 01:07:28,180
routine to be more reasonable now the

1337
01:07:25,880 --> 01:07:31,880
nice part here is that the blend amount

1338
01:07:28,179 --> 01:07:34,338
and the rate count and the power and all

1339
01:07:31,880 --> 01:07:36,108
this stuff I think goes away now I think

1340
01:07:34,338 --> 01:07:39,679
we just don't care about any of that it

1341
01:07:36,108 --> 01:07:42,018
doesn't matter so it can just be deleted

1342
01:07:39,679 --> 01:07:44,028
all we need to know is how many samples

1343
01:07:42,018 --> 01:07:46,969
we want to take which is the rate count

1344
01:07:44,028 --> 01:07:59,389
and that should be sufficient for our

1345
01:07:46,969 --> 01:08:06,739
purposes these values are all actually

1346
01:07:59,389 --> 01:08:08,659
VIII's here and we don't need total

1347
01:08:06,739 --> 01:08:10,669
added and removed we don't need a

1348
01:08:08,659 --> 01:08:14,889
complete sample to return anything to us

1349
01:08:10,670 --> 01:08:14,889
because it's not about that anymore and

1350
01:08:17,560 --> 01:08:21,980
we certainly don't need any of this

1351
01:08:19,548 --> 01:08:23,448
either so let's go through this now and

1352
01:08:21,979 --> 01:08:25,519
update it to do the thing that we wanted

1353
01:08:23,448 --> 01:08:27,169
to do this is there's no source omit Ord

1354
01:08:25,520 --> 01:08:30,799
estimate any more of those aren't things

1355
01:08:27,170 --> 01:08:32,480
neither is this so what we're gonna do

1356
01:08:30,798 --> 01:08:35,649
now I'm gonna stick with unidirectional

1357
01:08:32,479 --> 01:08:35,649
for now but again

1358
01:08:40,130 --> 01:08:43,279
I'm going to say that we want this

1359
01:08:41,929 --> 01:08:50,329
transfer to be bi-directional in the

1360
01:08:43,279 --> 01:08:52,279
future so off we go we come through here

1361
01:08:50,329 --> 01:08:54,679
we sample the hemisphere we find a path

1362
01:08:52,279 --> 01:08:56,779
that says that these two points can see

1363
01:08:54,679 --> 01:09:00,109
each other and then what we want to do

1364
01:08:56,779 --> 01:09:03,529
is we want to go ahead and record

1365
01:09:00,109 --> 01:09:10,639
samples for these points that tell us

1366
01:09:03,529 --> 01:09:13,159
how much is that tell us how the photons

1367
01:09:10,639 --> 01:09:19,190
per second should be perceived here

1368
01:09:13,158 --> 01:09:22,219
okay so accumulate sample is still I

1369
01:09:19,189 --> 01:09:25,729
think our friend the angular fall-off

1370
01:09:22,219 --> 01:09:29,448
still wants to be there the light power

1371
01:09:25,729 --> 01:09:33,559
is not relevant anymore

1372
01:09:29,448 --> 01:09:35,838
so that goes away I believe so it is

1373
01:09:33,560 --> 01:09:39,170
strictly the angular fall-off in

1374
01:09:35,838 --> 01:09:47,619
question the weight is just the angular

1375
01:09:39,170 --> 01:09:47,619
fall-off times that light color and I

1376
01:09:52,389 --> 01:09:56,560
think this is what we're talking about

1377
01:09:54,229 --> 01:09:56,559
here

1378
01:10:03,010 --> 01:10:10,130
right so we want to sum up the value

1379
01:10:07,250 --> 01:10:12,979
here we want to sum up these two values

1380
01:10:10,130 --> 01:10:15,170
and so actually when we're looking at

1381
01:10:12,979 --> 01:10:16,849
what we're summing into all of this I

1382
01:10:15,170 --> 01:10:24,550
think we should just pass the sample

1383
01:10:16,850 --> 01:10:32,840
index right because this is going to be

1384
01:10:24,550 --> 01:10:37,760
the surface normal is going to be just

1385
01:10:32,840 --> 01:10:42,739
the points normal right so I think we

1386
01:10:37,760 --> 01:10:46,550
can kind of not do it quite so I think

1387
01:10:42,738 --> 01:10:50,329
we can make this much more concise I

1388
01:10:46,550 --> 01:10:52,880
guess is what I'll say so the surface

1389
01:10:50,329 --> 01:10:57,979
normal if we just pass instead the

1390
01:10:52,880 --> 01:11:00,529
lighting solution here then what we can

1391
01:10:57,979 --> 01:11:03,649
say is the solution points for the

1392
01:11:00,529 --> 01:11:08,420
sample index is the surface normal that

1393
01:11:03,649 --> 01:11:10,369
we're talking about here the angular

1394
01:11:08,420 --> 01:11:14,469
fall-off is going to be the surface

1395
01:11:10,369 --> 01:11:16,340
normal on the normal to light right and

1396
01:11:14,469 --> 01:11:19,789
the normal to light will still get

1397
01:11:16,340 --> 01:11:23,500
passed in the weight is the length of

1398
01:11:19,789 --> 01:11:29,689
that light color there and that's good

1399
01:11:23,500 --> 01:11:31,850
and then all of these are are going to

1400
01:11:29,689 --> 01:11:36,259
be pulled off with a solution right so

1401
01:11:31,850 --> 01:11:39,500
the solution accumulated weight is going

1402
01:11:36,260 --> 01:11:43,969
to be plus equal something the solution

1403
01:11:39,500 --> 01:11:49,969
accumulated EPS is going to be plus

1404
01:11:43,969 --> 01:11:52,960
equal this and the solution cumulate our

1405
01:11:49,969 --> 01:11:52,960
average directional light

1406
01:12:00,050 --> 01:12:04,099
it's gonna come through there as well so

1407
01:12:14,448 --> 01:12:22,169
so this is really gonna be computed here

1408
01:12:19,500 --> 01:12:26,539
we can just use that since that

1409
01:12:22,170 --> 01:12:31,889
distributes those are the same answer

1410
01:12:26,539 --> 01:12:33,238
right so the wait times the neural looks

1411
01:12:31,889 --> 01:12:34,710
the light you can just get from lengthen

1412
01:12:33,238 --> 01:12:39,359
the color sample they're the accumulated

1413
01:12:34,710 --> 01:12:40,948
per second is just a sample color and so

1414
01:12:39,359 --> 01:12:43,198
that's the sample that we're taking for

1415
01:12:40,948 --> 01:12:45,689
particle four sorry for photons per

1416
01:12:43,198 --> 01:12:48,210
second and so now the question is just

1417
01:12:45,689 --> 01:12:49,589
what is the accumulated weight well if

1418
01:12:48,210 --> 01:12:52,198
we just want to average all of our

1419
01:12:49,590 --> 01:12:56,069
samples together it would just be one if

1420
01:12:52,198 --> 01:12:58,198
we want to use the angular fall-off to

1421
01:12:56,069 --> 01:13:01,769
say that some samples are more important

1422
01:12:58,198 --> 01:13:03,899
than others or something like this then

1423
01:13:01,770 --> 01:13:07,010
we would set it something else I'm going

1424
01:13:03,899 --> 01:13:07,009
to set it to one for now

1425
01:13:16,488 --> 01:13:24,918
and we can wait those differently if we

1426
01:13:19,399 --> 01:13:37,760
want to in the future okay so we don't

1427
01:13:24,918 --> 01:13:44,748
need this just need that so we just past

1428
01:13:37,760 --> 01:13:46,610
the destination sample index we pull all

1429
01:13:44,748 --> 01:13:48,708
the values off of that and then we just

1430
01:13:46,609 --> 01:13:52,248
need to pass the service not the service

1431
01:13:48,708 --> 01:13:59,378
in just the light color and the normal

1432
01:13:52,248 --> 01:13:59,378
to light and that's our cumulate sample

1433
01:14:01,748 --> 01:14:09,978
so that's how we would do that I'm not

1434
01:14:08,779 --> 01:14:11,268
sure if we want to pass an additional

1435
01:14:09,979 --> 01:14:14,719
scaler here because it could be

1436
01:14:11,269 --> 01:14:19,399
optimized potentially that way we'll see

1437
01:14:14,719 --> 01:14:20,840
in a second but looks pretty good so

1438
01:14:19,399 --> 01:14:23,300
let's go ahead and move accumulate

1439
01:14:20,840 --> 01:14:31,819
sample down here yeah into what we're

1440
01:14:23,300 --> 01:14:33,529
actually doing so we now know the the

1441
01:14:31,819 --> 01:14:37,478
right the sample that we're accumulating

1442
01:14:33,529 --> 01:14:37,478
is is this one

1443
01:14:43,460 --> 01:14:49,020
and so we want to pass the solution of

1444
01:14:47,520 --> 01:14:53,040
the death sample index and then we want

1445
01:14:49,020 --> 01:14:55,619
the light color which is you know this

1446
01:14:53,039 --> 01:14:59,359
mythical omit C value and I'm going to

1447
01:14:55,618 --> 01:15:02,519
change that to basically the transfer

1448
01:14:59,359 --> 01:15:05,519
PPS that's like how much we're trying to

1449
01:15:02,520 --> 01:15:08,280
give it and then the normal to the light

1450
01:15:05,520 --> 01:15:12,540
is going to be the sample direction that

1451
01:15:08,279 --> 01:15:17,039
when we know exactly so that's how we

1452
01:15:12,539 --> 01:15:20,698
will accumulate our sample this is not a

1453
01:15:17,039 --> 01:15:22,889
thing at the moment although we may want

1454
01:15:20,698 --> 01:15:27,229
to do that as a measure in the future I

1455
01:15:22,889 --> 01:15:29,909
suppose of what the total light is but

1456
01:15:27,229 --> 01:15:38,638
let's see what's going on here source

1457
01:15:29,908 --> 01:15:42,689
some test some I think all we really

1458
01:15:38,639 --> 01:15:45,569
have to do is some clearing here so

1459
01:15:42,689 --> 01:15:52,979
before we start the the sample stuff has

1460
01:15:45,569 --> 01:15:57,889
to get cleared so emission initial so in

1461
01:15:52,979 --> 01:15:57,888
here we need solution accumulated PPS

1462
01:15:59,060 --> 01:16:03,270
needs to be set to nothing and in

1463
01:16:01,469 --> 01:16:07,139
addition to accumulated PPS to be set to

1464
01:16:03,270 --> 01:16:11,000
nothing accumulated weight needs to be

1465
01:16:07,139 --> 01:16:11,000
set as well

1466
01:16:13,649 --> 01:16:21,479
all right so let's go ahead and update

1467
01:16:18,899 --> 01:16:30,529
this routine here when we do this this

1468
01:16:21,479 --> 01:16:39,359
is gonna be our transfer PPS here I

1469
01:16:30,529 --> 01:16:40,920
guess we call this C we want to change

1470
01:16:39,359 --> 01:16:42,420
this to be bi-directional eventually so

1471
01:16:40,920 --> 01:16:44,609
it shouldn't really be transferred PPS

1472
01:16:42,420 --> 01:16:46,109
but we'll call it that temporarily so

1473
01:16:44,609 --> 01:16:48,389
when we come through here right we're

1474
01:16:46,109 --> 01:16:50,609
gonna sum up the total weight that

1475
01:16:48,390 --> 01:16:52,260
doesn't change cuz doesn't it's just

1476
01:16:50,609 --> 01:16:54,000
crude producing a weighting value for

1477
01:16:52,260 --> 01:16:55,650
each of these points and then when we

1478
01:16:54,000 --> 01:16:57,960
come through here and we loop through

1479
01:16:55,649 --> 01:17:04,460
these we're basically gonna say this is

1480
01:16:57,960 --> 01:17:07,140
how the the the source emits e right is

1481
01:17:04,460 --> 01:17:11,270
what we're grabbing from that's now

1482
01:17:07,140 --> 01:17:14,010
gonna be our solution not accumulated

1483
01:17:11,270 --> 01:17:18,150
initial PPS so that's the previous

1484
01:17:14,010 --> 01:17:21,119
frames photons per second plus the

1485
01:17:18,149 --> 01:17:24,960
emission so that initial PPS that comes

1486
01:17:21,119 --> 01:17:26,039
in that's how much this doesn't happen

1487
01:17:24,960 --> 01:17:28,399
anymore

1488
01:17:26,039 --> 01:17:32,579
that's how much we're talking about here

1489
01:17:28,399 --> 01:17:36,509
and so the transfer PPS is either the

1490
01:17:32,579 --> 01:17:41,130
moon color or I think it's this contribs

1491
01:17:36,510 --> 01:17:44,460
ear right that weighted contribution of

1492
01:17:41,130 --> 01:17:47,159
how much of that has you know it's been

1493
01:17:44,460 --> 01:17:49,399
equaled out now the other thing we can

1494
01:17:47,159 --> 01:17:49,399
do here

1495
01:18:11,149 --> 01:18:20,399
so actually I guess now that I think

1496
01:18:15,059 --> 01:18:21,838
about it I'm looking at this to do that

1497
01:18:20,399 --> 01:18:24,329
says is there any way we can get rid of

1498
01:18:21,838 --> 01:18:31,288
the second loop and the answer is isn't

1499
01:18:24,328 --> 01:18:33,148
there it seems like there is because if

1500
01:18:31,288 --> 01:18:35,698
we look at what's happening here we're

1501
01:18:33,149 --> 01:18:37,349
summing up a total weight value and that

1502
01:18:35,698 --> 01:18:41,488
weight value is going to divide our

1503
01:18:37,349 --> 01:18:44,510
contribution right but we could instead

1504
01:18:41,488 --> 01:18:49,368
just multiply by the raw weight value

1505
01:18:44,510 --> 01:18:52,949
whatever this value is here right and

1506
01:18:49,368 --> 01:18:54,688
then multiply the entire thing by the

1507
01:18:52,948 --> 01:18:58,348
inverse total weight later because it's

1508
01:18:54,689 --> 01:19:02,929
a constant so what we should be able to

1509
01:18:58,349 --> 01:19:02,929
do here is say that the transfer of PBS

1510
01:19:04,908 --> 01:19:15,348
gets some directly right I mean I don't

1511
01:19:12,809 --> 01:19:15,349
see why not

1512
01:19:20,489 --> 01:19:26,309
if I just take the the weight value here

1513
01:19:30,539 --> 01:19:37,750
and I say sum the values multiplied by

1514
01:19:35,710 --> 01:19:40,539
the weighting value and some of the

1515
01:19:37,750 --> 01:19:44,380
weight when I'm done I will have the

1516
01:19:40,539 --> 01:19:46,449
inverse right and I can just take the

1517
01:19:44,380 --> 01:19:57,750
transfer PPS and multiply it by the

1518
01:19:46,449 --> 01:19:57,750
inverse total weight and I'm done right

1519
01:19:59,569 --> 01:20:06,679
I mean I don't see any reason why I

1520
01:20:02,359 --> 01:20:09,409
can't do that maybe I'm missing

1521
01:20:06,680 --> 01:20:10,730
something but so it does seem like I

1522
01:20:09,409 --> 01:20:12,019
don't know why I thought I needed two

1523
01:20:10,729 --> 01:20:13,489
loops I guess I was just kind of out to

1524
01:20:12,020 --> 01:20:17,270
lunch or maybe I'm missing something

1525
01:20:13,489 --> 01:20:20,119
there but that certainly seems fine I

1526
01:20:17,270 --> 01:20:22,630
don't know that we need that at all

1527
01:20:20,119 --> 01:20:22,630
anymore

1528
01:20:24,909 --> 01:20:34,550
and this is mr. fantasies all right so

1529
01:20:32,420 --> 01:20:37,130
now we've got a bunch of debugging to do

1530
01:20:34,550 --> 01:20:38,840
and like you know validating kind of

1531
01:20:37,130 --> 01:20:41,029
what I just did because it's sort of

1532
01:20:38,840 --> 01:20:43,369
we've made a bunch of changes and we

1533
01:20:41,029 --> 01:20:46,609
need to now like step through them and

1534
01:20:43,369 --> 01:20:48,710
get them you know I put in what we said

1535
01:20:46,609 --> 01:20:51,589
on the blackboard just my first pass at

1536
01:20:48,710 --> 01:20:57,319
how to make that work but it's not gonna

1537
01:20:51,590 --> 01:21:00,800
be correct right as you can see so we

1538
01:20:57,319 --> 01:21:02,779
have to now like actually go make this

1539
01:21:00,800 --> 01:21:05,539
you know a debug it make sure we don't

1540
01:21:02,779 --> 01:21:07,849
have any weird bugs in here which we

1541
01:21:05,539 --> 01:21:10,760
probably do and then B we need to like

1542
01:21:07,850 --> 01:21:14,650
turn the dial and make sure that we've

1543
01:21:10,760 --> 01:21:16,850
got all the weird stuff out of it right

1544
01:21:14,649 --> 01:21:20,539
good news is obviously there's no

1545
01:21:16,850 --> 01:21:23,870
framerate issues here so you know we're

1546
01:21:20,539 --> 01:21:25,729
pretty much okay in terms of Perth I

1547
01:21:23,869 --> 01:21:29,989
think so it's really just going ahead

1548
01:21:25,729 --> 01:21:31,750
and getting this to be computing the

1549
01:21:29,989 --> 01:21:33,679
thing that I wanted to compute all right

1550
01:21:31,750 --> 01:21:35,180
so I'm going to go ahead and turn off

1551
01:21:33,680 --> 01:21:37,010
optimization and we're gonna step

1552
01:21:35,180 --> 01:21:38,800
through this and start to make you know

1553
01:21:37,010 --> 01:21:42,010
try to make sure that everything is is

1554
01:21:38,800 --> 01:21:42,010
working correctly

1555
01:21:55,979 --> 01:22:06,000
there we go all right so I'm gonna come

1556
01:22:00,149 --> 01:22:07,979
through here and first thing I just want

1557
01:22:06,000 --> 01:22:16,289
to look at is what's happening to my

1558
01:22:07,979 --> 01:22:18,389
solution buffer so this is where all of

1559
01:22:16,289 --> 01:22:19,649
the operations take place so obviously I

1560
01:22:18,390 --> 01:22:23,310
want to make sure that these things are

1561
01:22:19,649 --> 01:22:26,460
all set to something reasonable right so

1562
01:22:23,310 --> 01:22:27,810
here we have set p1 and so we don't

1563
01:22:26,460 --> 01:22:30,480
expect it to be any change there the

1564
01:22:27,810 --> 01:22:32,010
points are what the points are but all

1565
01:22:30,479 --> 01:22:33,779
this stuff is different so let's see

1566
01:22:32,010 --> 01:22:35,760
what our initial PPS is this should all

1567
01:22:33,779 --> 01:22:38,130
be 0 basically there's none from

1568
01:22:35,760 --> 01:22:39,630
previous frames and that so only just a

1569
01:22:38,130 --> 01:22:41,310
few places where there's emitters should

1570
01:22:39,630 --> 01:22:42,989
we see anything same is true with

1571
01:22:41,310 --> 01:22:46,710
accumulated weight that should all be 0

1572
01:22:42,988 --> 01:22:48,539
and it is same with accumulated PPS that

1573
01:22:46,710 --> 01:22:50,340
should be 0 right and that is getting

1574
01:22:48,539 --> 01:22:52,560
set there which is good and the same

1575
01:22:50,340 --> 01:22:54,329
with emission PPS that should be set to

1576
01:22:52,560 --> 01:22:59,280
0 everywhere other than where the

1577
01:22:54,329 --> 01:23:01,409
emission is occurring right um so I

1578
01:22:59,279 --> 01:23:03,869
think that should be pretty good you

1579
01:23:01,409 --> 01:23:05,789
know I I imagine that if we look at this

1580
01:23:03,869 --> 01:23:07,470
right if we look at a mission there

1581
01:23:05,789 --> 01:23:09,060
should just be like some little place

1582
01:23:07,470 --> 01:23:14,400
where the emission is set to something

1583
01:23:09,060 --> 01:23:15,900
of course it's hard to find here should

1584
01:23:14,399 --> 01:23:17,909
probably be setting this to the smaller

1585
01:23:15,899 --> 01:23:20,339
number so we can have a better chance of

1586
01:23:17,909 --> 01:23:22,729
actually finding the people who are

1587
01:23:20,340 --> 01:23:22,730
emitting

1588
01:23:34,889 --> 01:23:45,550
I'm gonna go ahead and just make one and

1589
01:23:43,599 --> 01:23:52,569
then I'm gonna look at the emission

1590
01:23:45,550 --> 01:23:58,239
array I don't know how many points we

1591
01:23:52,569 --> 01:24:01,418
have 1849 so there we go so here's a

1592
01:23:58,238 --> 01:24:03,879
bunch of 1.5 emitters I don't know how

1593
01:24:01,418 --> 01:24:05,139
we got emission values is 1.5 that's not

1594
01:24:03,880 --> 01:24:07,510
supposed to be it's supposed to be 0 to

1595
01:24:05,139 --> 01:24:12,729
1 great work guys

1596
01:24:07,510 --> 01:24:14,939
you crushed it I'm gonna go you know

1597
01:24:12,729 --> 01:24:14,939
what

1598
01:24:36,039 --> 01:24:40,729
I'm gonna go ahead and say that that's

1599
01:24:38,630 --> 01:24:45,230
just not allowed and we're gonna fix

1600
01:24:40,729 --> 01:24:49,719
everywhere that is doing that because I

1601
01:24:45,229 --> 01:24:49,719
don't know how oh no no no

1602
01:24:50,770 --> 01:24:56,140
false alarm

1603
01:24:52,300 --> 01:25:01,010
that's post multiply so we're all fine

1604
01:24:56,140 --> 01:25:04,820
totally fine everyone relax all right so

1605
01:25:01,010 --> 01:25:06,949
we knew our emitter is set here if we

1606
01:25:04,819 --> 01:25:11,500
look at how many of these are set to 1.5

1607
01:25:06,949 --> 01:25:11,500
I'm assuming that's for a snake right

1608
01:25:13,270 --> 01:25:20,710
should be one more at the end for our

1609
01:25:15,529 --> 01:25:20,710
box and all the rest should be zeros

1610
01:25:26,789 --> 01:25:35,079
there we go all right so that's exactly

1611
01:25:30,909 --> 01:25:36,670
what we would should expect that's good

1612
01:25:35,079 --> 01:25:40,350
average direction to light should all be

1613
01:25:36,670 --> 01:25:42,550
zeros and days and so off we go now

1614
01:25:40,350 --> 01:25:44,800
we're going to do our compute light

1615
01:25:42,550 --> 01:25:45,909
propagation function we're going to come

1616
01:25:44,800 --> 01:25:47,289
through here and let's just take a look

1617
01:25:45,909 --> 01:25:50,470
brief look at how this is working as

1618
01:25:47,289 --> 01:25:55,269
well and we also got to check the output

1619
01:25:50,470 --> 01:25:58,180
part so we've read out a point and we

1620
01:25:55,270 --> 01:26:01,090
try to find someone to transfer with in

1621
01:25:58,180 --> 01:26:02,890
this case we did we come through here

1622
01:26:01,090 --> 01:26:06,730
and we compute a total waiting value

1623
01:26:02,890 --> 01:26:17,170
which is based on the you know I should

1624
01:26:06,729 --> 01:26:19,419
also the same time and probably since

1625
01:26:17,170 --> 01:26:20,980
this is our first frame probably

1626
01:26:19,420 --> 01:26:23,050
whatever it hit has no light on it

1627
01:26:20,979 --> 01:26:27,009
anyway so I'm guessing transfer but yet

1628
01:26:23,050 --> 01:26:28,480
it is a zero so the total weight is this

1629
01:26:27,010 --> 01:26:29,949
is the total weight it's going to divide

1630
01:26:28,479 --> 01:26:31,359
out something that was already zero so

1631
01:26:29,949 --> 01:26:35,319
we'll just get zero and no one cares

1632
01:26:31,359 --> 01:26:37,929
well then go into the sample

1633
01:26:35,319 --> 01:26:39,519
accumulation so we need the sample

1634
01:26:37,930 --> 01:26:40,659
direction you know that's where we're

1635
01:26:39,520 --> 01:26:42,430
going to get the light we have the

1636
01:26:40,659 --> 01:26:44,889
transfer value which is nothing get the

1637
01:26:42,430 --> 01:26:46,030
sample point index in the solution we

1638
01:26:44,890 --> 01:26:48,940
come through here and we say all right

1639
01:26:46,029 --> 01:26:50,529
the surface normal it's gonna be

1640
01:26:48,939 --> 01:26:52,179
whatever the destination samples index

1641
01:26:50,529 --> 01:26:55,119
normal was and that's exactly what we

1642
01:26:52,180 --> 01:26:56,829
expect right totally fine we've got the

1643
01:26:55,119 --> 01:26:58,119
angular fall-off which is the normal to

1644
01:26:56,829 --> 01:27:00,640
the light source and so there's our

1645
01:26:58,119 --> 01:27:02,800
fall-off factor we've got our sample

1646
01:27:00,640 --> 01:27:05,289
color now which is that's how much we're

1647
01:27:02,800 --> 01:27:07,150
actually going to add in here for the

1648
01:27:05,289 --> 01:27:10,840
particle seconds that are being added

1649
01:27:07,149 --> 01:27:13,119
flux wise again it's nothing the weight

1650
01:27:10,840 --> 01:27:14,230
is also nothing for changing the average

1651
01:27:13,119 --> 01:27:15,909
direction to lights the average

1652
01:27:14,229 --> 01:27:18,819
direction to light will not change based

1653
01:27:15,909 --> 01:27:20,710
on this value we have the accumulated

1654
01:27:18,819 --> 01:27:25,590
weight which again is just going to go

1655
01:27:20,710 --> 01:27:25,590
up by one so it should just be one

1656
01:27:28,439 --> 01:27:34,529
and off we go now the accumulated weight

1657
01:27:31,469 --> 01:27:36,658
value in this case I guess accumulated

1658
01:27:34,529 --> 01:27:39,840
weight will always be the Ray count at

1659
01:27:36,658 --> 01:27:42,359
the moment so in theory because we

1660
01:27:39,840 --> 01:27:45,328
always count like the moonlight as the

1661
01:27:42,359 --> 01:27:46,500
thing you hit you can't hit nothing we

1662
01:27:45,328 --> 01:27:49,380
can't actually get rid of that

1663
01:27:46,500 --> 01:27:50,760
accumulate accumulate weight value in

1664
01:27:49,380 --> 01:27:53,219
the future we can make accumulated

1665
01:27:50,760 --> 01:27:55,710
weight just be a constant right it

1666
01:27:53,219 --> 01:27:57,420
doesn't need to be it can just be the

1667
01:27:55,710 --> 01:28:00,059
number of samples that we take per point

1668
01:27:57,420 --> 01:28:02,099
unless we adjust that value in an

1669
01:28:00,059 --> 01:28:04,320
unpredictable way we could just get rid

1670
01:28:02,099 --> 01:28:05,550
of it because we know it's just rate

1671
01:28:04,319 --> 01:28:09,479
count and rate count could just be a

1672
01:28:05,550 --> 01:28:10,889
constant so again we come through here's

1673
01:28:09,479 --> 01:28:13,069
another example where we have the moon

1674
01:28:10,889 --> 01:28:17,550
color coming in so the moon color now

1675
01:28:13,069 --> 01:28:18,599
has a very specific transfer value we're

1676
01:28:17,550 --> 01:28:21,150
gonna come in here look at the angular

1677
01:28:18,599 --> 01:28:22,920
fall-off the angular fall is actually

1678
01:28:21,149 --> 01:28:26,339
pretty high in this case why is it high

1679
01:28:22,920 --> 01:28:28,679
well the normal to light is very it's

1680
01:28:26,340 --> 01:28:31,319
very pointy compared to the normal right

1681
01:28:28,679 --> 01:28:33,809
so the normal is pointing direct

1682
01:28:31,319 --> 01:28:37,408
directly to the left

1683
01:28:33,809 --> 01:28:41,788
perfectly left but the light value is

1684
01:28:37,408 --> 01:28:46,408
more upward than that so we're going to

1685
01:28:41,788 --> 01:28:53,359
go ahead and get some transfer but it's

1686
01:28:46,408 --> 01:28:55,888
not going to be a lot of transfer okay

1687
01:28:53,359 --> 01:28:57,089
so that looks fine right that's

1688
01:28:55,889 --> 01:28:58,699
basically what we wanted to know there's

1689
01:28:57,090 --> 01:29:01,019
some things in cure that we want to do

1690
01:28:58,698 --> 01:29:02,250
and in fact I'll add one more comment

1691
01:29:01,019 --> 01:29:04,519
the thing that I want to do just so I

1692
01:29:02,250 --> 01:29:04,519
don't forget

1693
01:29:16,010 --> 01:29:20,489
probably something to make our sampling

1694
01:29:18,420 --> 01:29:22,529
more uniform than it is right now would

1695
01:29:20,489 --> 01:29:24,269
help us so we probably want a stratified

1696
01:29:22,529 --> 01:29:26,009
sampling scheme we'll talk about that is

1697
01:29:24,270 --> 01:29:29,310
later but it's just something that makes

1698
01:29:26,010 --> 01:29:32,190
sure that we don't sample in a very

1699
01:29:29,310 --> 01:29:34,160
biased way due to randomness on a

1700
01:29:32,189 --> 01:29:36,659
particular frame it's a way of sort of

1701
01:29:34,159 --> 01:29:42,420
making your num random numbers less

1702
01:29:36,659 --> 01:29:45,329
random to improve things anyway so when

1703
01:29:42,420 --> 01:29:53,750
we do all those accumulations that seems

1704
01:29:45,329 --> 01:29:53,750
for you Oh oops

1705
01:29:55,770 --> 01:30:02,850
so at the end then we need to go look at

1706
01:29:58,500 --> 01:30:05,609
the output step the up it phase so let's

1707
01:30:02,850 --> 01:30:07,289
go ahead and do that so we assume that

1708
01:30:05,609 --> 01:30:14,759
we did our light propagation now and now

1709
01:30:07,289 --> 01:30:24,239
we're gonna grab the there we go look

1710
01:30:14,760 --> 01:30:29,789
count 24 so now we oh that's just a typo

1711
01:30:24,239 --> 01:30:31,800
well that's very bad no wonder we

1712
01:30:29,789 --> 01:30:35,689
weren't getting anything sensible at

1713
01:30:31,800 --> 01:30:44,850
first that's a pretty big initial bug

1714
01:30:35,689 --> 01:30:46,739
that's not supposed to be there valid is

1715
01:30:44,850 --> 01:30:54,570
only there to see whether or not the

1716
01:30:46,739 --> 01:30:55,559
read original values were useable so I

1717
01:30:54,569 --> 01:30:58,670
don't know what's going on there yeah

1718
01:30:55,560 --> 01:30:58,670
that was just that was just dumb

1719
01:31:04,639 --> 01:31:08,569
yeah that was just straight-up down

1720
01:31:06,289 --> 01:31:12,469
furthermore this valid really should be

1721
01:31:08,569 --> 01:31:13,488
done per per time at this point and I

1722
01:31:12,469 --> 01:31:15,139
think we should just go ahead and do

1723
01:31:13,488 --> 01:31:16,609
that because again we're gonna have to

1724
01:31:15,139 --> 01:31:19,039
figure out how we want to do that valid

1725
01:31:16,609 --> 01:31:28,609
bit a little bit real later but I'm just

1726
01:31:19,039 --> 01:31:30,649
going to go ahead and do it here all

1727
01:31:28,609 --> 01:31:32,149
right let's take a look at what the

1728
01:31:30,649 --> 01:31:40,309
results are now that we've got rid of

1729
01:31:32,149 --> 01:31:44,388
that stupidity they're so kind of

1730
01:31:40,310 --> 01:31:49,880
ridiculous actually so still kind of a

1731
01:31:44,389 --> 01:31:52,010
little bit nuts so let's go ahead and

1732
01:31:49,880 --> 01:31:54,368
step through this and see what's going

1733
01:31:52,010 --> 01:31:54,369
on here

1734
01:32:06,460 --> 01:32:11,300
so these also need to get clamped which

1735
01:32:09,289 --> 01:32:13,130
I didn't do so we should probably also

1736
01:32:11,300 --> 01:32:13,579
do that but I'm gonna skip that for the

1737
01:32:13,130 --> 01:32:16,279
moment

1738
01:32:13,579 --> 01:32:16,729
oh but you know what no I'm not gonna do

1739
01:32:16,279 --> 01:32:28,340
that right now

1740
01:32:16,729 --> 01:32:30,229
so I don't forget uh you know what no

1741
01:32:28,340 --> 01:32:34,640
I'm not I lied because they get clamped

1742
01:32:30,229 --> 01:32:46,279
in the shader I believe am I wrong about

1743
01:32:34,640 --> 01:32:51,710
that so here in the Z bias program and

1744
01:32:46,279 --> 01:33:00,079
would expect to see the light that is

1745
01:32:51,710 --> 01:33:06,439
getting clamped know so they don't they

1746
01:33:00,079 --> 01:33:09,109
don't get clamped so they probably

1747
01:33:06,439 --> 01:33:11,829
should get clamped in the shader rather

1748
01:33:09,109 --> 01:33:11,829
than not

1749
01:33:21,149 --> 01:33:24,729
so I think I'm just going to go ahead

1750
01:33:23,260 --> 01:33:28,210
and say that they'll get they're gonna

1751
01:33:24,729 --> 01:33:30,609
get clamped in the shader so in here

1752
01:33:28,210 --> 01:33:33,069
whenever stuff happens and we end up

1753
01:33:30,609 --> 01:33:35,439
taking whatever the surface reflectance

1754
01:33:33,069 --> 01:33:52,599
is I'm then gonna go ahead and clamp

1755
01:33:35,439 --> 01:33:56,049
that so I'm just gonna make sure that

1756
01:33:52,600 --> 01:33:57,940
that value can exceed 1 and it won't

1757
01:33:56,050 --> 01:34:01,150
cause weird color overflow artifacts

1758
01:33:57,939 --> 01:34:02,619
right which may have been why the whole

1759
01:34:01,149 --> 01:34:07,210
thing turned black before I'm not sure

1760
01:34:02,619 --> 01:34:09,939
no it's not muscle just overflowed and

1761
01:34:07,210 --> 01:34:11,289
some other weird way all right so I'm

1762
01:34:09,939 --> 01:34:12,789
just gonna leave that in there because I

1763
01:34:11,289 --> 01:34:16,680
want to make sure that that's something

1764
01:34:12,789 --> 01:34:20,739
that ya can can overflow if it wants to

1765
01:34:16,680 --> 01:34:23,079
alright so let's go ahead and and check

1766
01:34:20,739 --> 01:34:24,849
this out now that it's actually gonna

1767
01:34:23,079 --> 01:34:27,519
enter the part of the loop that we care

1768
01:34:24,850 --> 01:34:30,490
about there so we're gonna go ahead and

1769
01:34:27,520 --> 01:34:33,490
take for any particular point here we're

1770
01:34:30,489 --> 01:34:35,019
gonna use the accumulated PPS value

1771
01:34:33,489 --> 01:34:41,439
there's how much light it thought it

1772
01:34:35,020 --> 01:34:45,400
received here's the direction it thought

1773
01:34:41,439 --> 01:34:47,939
it was coming from and it's gonna go

1774
01:34:45,399 --> 01:34:47,939
ahead and

1775
01:34:58,300 --> 01:35:07,520
so on the first frame Oh

1776
01:35:01,220 --> 01:35:12,230
that's garbage as well not doing great

1777
01:35:07,520 --> 01:35:16,400
on the on the mind slips today so I want

1778
01:35:12,229 --> 01:35:22,699
last I want to use the last direction

1779
01:35:16,399 --> 01:35:41,989
here to do the valid check right so this

1780
01:35:22,699 --> 01:35:48,939
actually should be something more like

1781
01:35:41,989 --> 01:35:48,939
that um so yeah

1782
01:35:57,050 --> 01:36:02,010
that looks more reasonable to me and I

1783
01:36:00,810 --> 01:36:04,440
also think there's another thing we

1784
01:36:02,010 --> 01:36:08,130
could do here which is if we don't get a

1785
01:36:04,439 --> 01:36:10,109
valid normal we could set that normal to

1786
01:36:08,130 --> 01:36:15,000
something else as well I'm gonna ignore

1787
01:36:10,109 --> 01:36:17,429
that for now all right so that's a

1788
01:36:15,000 --> 01:36:21,420
little bit better right okay so now

1789
01:36:17,430 --> 01:36:24,539
let's step through here and look at

1790
01:36:21,420 --> 01:36:26,069
what's going on so when we check the

1791
01:36:24,539 --> 01:36:28,649
valid value it should be false on the

1792
01:36:26,069 --> 01:36:30,960
first frame and is so now it's going to

1793
01:36:28,649 --> 01:36:32,609
set the omit value which is the stored

1794
01:36:30,960 --> 01:36:36,210
value from the previous frame that we

1795
01:36:32,609 --> 01:36:38,489
use it's going to set that equal to the

1796
01:36:36,210 --> 01:36:44,579
accumulated particles accumulated

1797
01:36:38,489 --> 01:36:45,300
photons per second oh and this is also

1798
01:36:44,579 --> 01:36:47,220
backwards

1799
01:36:45,300 --> 01:36:50,270
Wow there's just a lot of bugs today a

1800
01:36:47,220 --> 01:36:50,270
lot of stupid bugs

1801
01:37:04,859 --> 01:37:09,969
so ya don't know what was going on there

1802
01:37:08,288 --> 01:37:11,408
but obviously when you want to normalize

1803
01:37:09,969 --> 01:37:12,639
something you don't multiply by the

1804
01:37:11,408 --> 01:37:13,779
weight you multiply with the inverse of

1805
01:37:12,639 --> 01:37:15,309
the weight so that was multiplying by

1806
01:37:13,779 --> 01:37:19,118
four every time no wonder everything was

1807
01:37:15,309 --> 01:37:20,920
instantly perfectly bright so I'm gonna

1808
01:37:19,118 --> 01:37:25,078
go ahead and say that the inverse weight

1809
01:37:20,920 --> 01:37:36,219
is zero and then I'm gonna say if the

1810
01:37:25,078 --> 01:37:37,149
accumulated weight and again we don't

1811
01:37:36,219 --> 01:37:38,559
really need to do this because the

1812
01:37:37,149 --> 01:37:40,179
inverse weights gonna be constant in the

1813
01:37:38,559 --> 01:37:44,769
future I think if everybody gets the

1814
01:37:40,179 --> 01:37:46,420
same number of Ray's cast but if we do

1815
01:37:44,769 --> 01:37:48,070
if we switch the bi-directional that

1816
01:37:46,420 --> 01:37:50,229
won't be true anymore so I'm just gonna

1817
01:37:48,069 --> 01:37:52,748
keep it this way we won't need to do

1818
01:37:50,229 --> 01:37:55,300
this if zero Chuck because there's no

1819
01:37:52,748 --> 01:37:57,368
way you'll ever get zero samples but you

1820
01:37:55,300 --> 01:38:00,519
could get more than the average number

1821
01:37:57,368 --> 01:38:05,228
of samples as well so I'm just gonna do

1822
01:38:00,519 --> 01:38:10,630
the full thing for now but in the future

1823
01:38:05,229 --> 01:38:13,920
we will simplify this a little bit so

1824
01:38:10,630 --> 01:38:13,920
now I think about it yeah this is

1825
01:38:32,750 --> 01:38:39,350
so at that point we should be okay the

1826
01:38:36,510 --> 01:38:39,350
accumulated weights

1827
01:38:52,800 --> 01:38:56,369
the accumulated weight is greater than

1828
01:38:54,329 --> 01:38:59,130
zero then we do the divided assuming

1829
01:38:56,369 --> 01:39:00,840
that's the case we then multiply out the

1830
01:38:59,130 --> 01:39:04,409
inverse weight that gets us the

1831
01:39:00,840 --> 01:39:06,090
accumulated PPS that we want let's step

1832
01:39:04,409 --> 01:39:08,279
back in here because I've made so many

1833
01:39:06,090 --> 01:39:10,350
mistakes in here now I want to really

1834
01:39:08,279 --> 01:39:14,639
check it out that's the correct weight

1835
01:39:10,350 --> 01:39:17,250
1/4 right so now we get an accumulated

1836
01:39:14,640 --> 01:39:20,700
PPS and a direction value out of it's

1837
01:39:17,250 --> 01:39:22,229
the last PPS and last Direction values

1838
01:39:20,699 --> 01:39:23,639
are going to be set to those we're going

1839
01:39:22,229 --> 01:39:26,339
to have a not a valid so we're going to

1840
01:39:23,640 --> 01:39:29,310
blend between them and that's what we

1841
01:39:26,340 --> 01:39:31,079
get here the T update looks right last

1842
01:39:29,310 --> 01:39:33,990
direction and direction should be the

1843
01:39:31,079 --> 01:39:35,909
same and last PBS and PPS should also be

1844
01:39:33,989 --> 01:39:45,840
the same I don't know why it's not hover

1845
01:39:35,909 --> 01:39:54,649
Valentino's okay so I think that's about

1846
01:39:45,840 --> 01:39:54,650
right in this case here

1847
01:40:00,060 --> 01:40:04,710
I will say that I think our moonlight

1848
01:40:02,250 --> 01:40:10,229
needs to be significantly less bright as

1849
01:40:04,710 --> 01:40:11,640
compared to our our individual spotlight

1850
01:40:10,229 --> 01:40:13,409
if we want to see anything I'm gonna go

1851
01:40:11,640 --> 01:40:19,680
ahead and change the moonlight value

1852
01:40:13,409 --> 01:40:30,680
there should just generally do these as

1853
01:40:19,680 --> 01:40:30,680
v3 so I can multiply them yeah

1854
01:40:41,750 --> 01:40:47,719
so how great is that debug light as well

1855
01:40:59,899 --> 01:41:10,139
uh that's 1.0 f so that should be so

1856
01:41:07,859 --> 01:41:13,848
something's a little off here because

1857
01:41:10,139 --> 01:41:16,349
that should be significantly brighter I

1858
01:41:13,849 --> 01:41:19,729
guess it's because it's very unlikely

1859
01:41:16,349 --> 01:41:21,538
that you'll hit it is the problem

1860
01:41:19,729 --> 01:41:22,590
because that should have been

1861
01:41:21,538 --> 01:41:24,268
significantly brighter than the

1862
01:41:22,590 --> 01:41:27,479
moonlight already and the fact that it's

1863
01:41:24,269 --> 01:41:30,918
not is a little concerning so we

1864
01:41:27,479 --> 01:41:30,918
probably still have more work to do here

1865
01:41:31,788 --> 01:41:39,118
also I think that flicker is way too

1866
01:41:35,158 --> 01:41:42,089
fast right now so I think we're also our

1867
01:41:39,118 --> 01:41:45,648
smoothing is not correct so I think we

1868
01:41:42,090 --> 01:41:45,649
got some some work to do here

1869
01:41:58,659 --> 01:42:04,088
right

1870
01:42:01,020 --> 01:42:04,089
[Music]

1871
01:42:22,850 --> 01:42:24,910
you

1872
01:42:33,210 --> 01:42:38,380
all right so let's think about this a

1873
01:42:35,500 --> 01:42:42,640
little bit more let's try to let me try

1874
01:42:38,380 --> 01:42:45,340
to just let me do a few things here so I

1875
01:42:42,640 --> 01:42:47,980
want to test a few things now the first

1876
01:42:45,340 --> 01:42:49,480
thing I want to do is I want to do the

1877
01:42:47,979 --> 01:42:51,789
standard test we were doing before where

1878
01:42:49,479 --> 01:42:55,419
we don't update the average direction to

1879
01:42:51,789 --> 01:42:57,460
light so I want to set here D is always

1880
01:42:55,420 --> 01:43:02,949
going to be equal to solution points

1881
01:42:57,460 --> 01:43:05,739
point index service normal so I don't

1882
01:43:02,949 --> 01:43:06,970
want to see anything that has to do with

1883
01:43:05,739 --> 01:43:12,189
the average direction to the light

1884
01:43:06,970 --> 01:43:13,840
that's just gonna get set so we can just

1885
01:43:12,189 --> 01:43:16,659
see the difference in emission value

1886
01:43:13,840 --> 01:43:17,829
right and so what you can see here if

1887
01:43:16,659 --> 01:43:22,029
we're looking at the difference in

1888
01:43:17,829 --> 01:43:23,920
emission value also that's not an

1889
01:43:22,029 --> 01:43:27,479
optimized mode well okay I guess when

1890
01:43:23,920 --> 01:43:27,480
you use a small scene it's very fast

1891
01:43:27,630 --> 01:43:32,710
yeah that's like 60 frames second when

1892
01:43:30,279 --> 01:43:35,069
you use a small scene just kind of cool

1893
01:43:32,710 --> 01:43:35,069
I guess

1894
01:43:47,970 --> 01:43:50,970
interesting

1895
01:43:54,158 --> 01:43:58,359
so again I think we've got bugs here I

1896
01:43:56,829 --> 01:44:02,289
don't know for sure but I'm just trying

1897
01:43:58,359 --> 01:44:09,339
to now isolate them out so my suspicion

1898
01:44:02,289 --> 01:44:13,810
here is that this this looks like too

1899
01:44:09,340 --> 01:44:15,610
much variance but I'm not sure okay so

1900
01:44:13,810 --> 01:44:20,850
if I smooth it out considerably more

1901
01:44:15,609 --> 01:44:20,849
than that it does dampen it quite a bit

1902
01:44:22,439 --> 01:44:26,799
but it's still flicker is quite a bit

1903
01:44:24,969 --> 01:44:29,469
more than I think it should that's a

1904
01:44:26,800 --> 01:44:31,239
hundred frame smoothing I really should

1905
01:44:29,469 --> 01:44:42,399
not be able to be seeing that like this

1906
01:44:31,238 --> 01:44:46,109
I don't think so that to me seems like

1907
01:44:42,399 --> 01:44:46,109
we've still got

1908
01:44:56,350 --> 01:45:01,520
that to me seems like this lerp is not

1909
01:44:59,448 --> 01:45:03,349
working properly for whatever reason

1910
01:45:01,520 --> 01:45:08,360
again because that means it should take

1911
01:45:03,350 --> 01:45:11,120
a hundred frames to change the light

1912
01:45:08,359 --> 01:45:15,259
from one value to another right to

1913
01:45:11,119 --> 01:45:17,659
between two different ones and so they

1914
01:45:15,260 --> 01:45:20,030
can only move by like a very small

1915
01:45:17,659 --> 01:45:21,529
amount per frame I would think now maybe

1916
01:45:20,029 --> 01:45:24,579
we really do have that much noise in the

1917
01:45:21,529 --> 01:45:28,130
system but it seems a little unlikely

1918
01:45:24,579 --> 01:45:36,738
hard to say but so if we take a look at

1919
01:45:28,130 --> 01:45:40,329
what's happening here just want to make

1920
01:45:36,738 --> 01:45:40,329
sure we're really doing it

1921
01:45:47,460 --> 01:45:55,448
so the accumulated photons per second

1922
01:45:51,219 --> 01:45:57,310
value that we're putting in there he's

1923
01:45:55,448 --> 01:46:03,729
alert between whatever the last one was

1924
01:45:57,310 --> 01:46:09,340
and this one however if the valid value

1925
01:46:03,729 --> 01:46:13,828
I guess so I guess it could be if that

1926
01:46:09,340 --> 01:46:13,828
valid value was was turning on and off

1927
01:46:14,368 --> 01:46:19,509
that would do it so I guess the other

1928
01:46:17,859 --> 01:46:21,519
thing we can do is force that valid

1929
01:46:19,510 --> 01:46:23,710
value to always be true again and just

1930
01:46:21,520 --> 01:46:35,380
see if that is an additional source of

1931
01:46:23,710 --> 01:46:39,099
noise there does not appear to be so

1932
01:46:35,380 --> 01:46:42,130
even at at such a small blend rate that

1933
01:46:39,099 --> 01:46:44,730
flicker persists let's see if we drop it

1934
01:46:42,130 --> 01:46:44,730
even lower

1935
01:46:54,760 --> 01:47:03,560
so I guess the fact that I can drop it

1936
01:46:57,469 --> 01:47:05,060
low enough - I can't eventually drop it

1937
01:47:03,560 --> 01:47:06,710
low enough to the point where you don't

1938
01:47:05,060 --> 01:47:10,550
see the flicker suggest that the

1939
01:47:06,710 --> 01:47:11,920
blending is working okay so maybe that's

1940
01:47:10,550 --> 01:47:14,659
all right

1941
01:47:11,920 --> 01:47:21,380
maybe that's all right so let's set it

1942
01:47:14,658 --> 01:47:42,259
to something reasonably low and I'm

1943
01:47:21,380 --> 01:47:43,250
gonna put a note in here go and so the

1944
01:47:42,260 --> 01:47:47,960
next thing I'm gonna do is I'm going to

1945
01:47:43,250 --> 01:47:51,069
try casting a few more rays as well so

1946
01:47:47,960 --> 01:47:51,069
our weight counts pretty low right now

1947
01:48:19,640 --> 01:48:24,470
and so the fact that more raise also

1948
01:48:22,520 --> 01:48:27,950
seems to reduce it does suggest that it

1949
01:48:24,470 --> 01:48:33,980
is just variance in our in our sampling

1950
01:48:27,949 --> 01:48:36,050
as well so that also seems good so I

1951
01:48:33,979 --> 01:48:38,059
guess now my main concern is I'd like to

1952
01:48:36,050 --> 01:48:40,550
address the brightness level because the

1953
01:48:38,060 --> 01:48:40,910
brightness levels seem a little odd to

1954
01:48:40,550 --> 01:48:47,420
me

1955
01:48:40,909 --> 01:48:50,180
at the moment and I'm not sure why that

1956
01:48:47,420 --> 01:48:53,239
is so I'd like to get a better handle on

1957
01:48:50,180 --> 01:48:56,210
that going forward supposing we set the

1958
01:48:53,239 --> 01:48:59,779
max light emission to something high so

1959
01:48:56,210 --> 01:49:04,369
let's say it was 50 we should get a much

1960
01:48:59,779 --> 01:49:11,469
brighter scene right and we do so let's

1961
01:49:04,369 --> 01:49:11,470
set it to 25 there we go

1962
01:49:20,720 --> 01:49:27,690
so I'm okay with that so far so I'm

1963
01:49:26,069 --> 01:49:31,979
going to set this down to something more

1964
01:49:27,689 --> 01:49:34,949
reasonable and I think now we're

1965
01:49:31,979 --> 01:49:37,289
starting to get I'm starting to get into

1966
01:49:34,949 --> 01:49:39,210
a position where I feel like we can we

1967
01:49:37,289 --> 01:49:41,010
can converge here I think now what we

1968
01:49:39,210 --> 01:49:44,069
have to do is try to get our samples

1969
01:49:41,010 --> 01:49:47,909
more stable but I'm feeling pretty good

1970
01:49:44,069 --> 01:49:51,420
about this right our lighting values

1971
01:49:47,909 --> 01:49:53,819
seem to converge much nicer now and they

1972
01:49:51,420 --> 01:49:56,039
don't go off the charts or do weird

1973
01:49:53,819 --> 01:49:58,259
things anymore and if we change this to

1974
01:49:56,039 --> 01:50:01,199
bi-directional that'll get us twice the

1975
01:49:58,260 --> 01:50:03,930
samples sort of for free which would be

1976
01:50:01,199 --> 01:50:05,550
great right it means that you know for

1977
01:50:03,930 --> 01:50:10,440
16 samples we're really getting 32

1978
01:50:05,550 --> 01:50:19,730
samples and that's nice so I think this

1979
01:50:10,439 --> 01:50:19,729
is good I'm pretty happy with that

1980
01:50:20,149 --> 01:50:26,369
because we just now we just got to get

1981
01:50:22,350 --> 01:50:28,530
our noise down a little bit and I think

1982
01:50:26,369 --> 01:50:33,869
also you know putting in a real I I

1983
01:50:28,529 --> 01:50:38,340
don't know what our what our current

1984
01:50:33,869 --> 01:50:40,050
like we don't even have a real random

1985
01:50:38,340 --> 01:50:41,579
number generator in there right so we

1986
01:50:40,050 --> 01:50:44,489
should probably also take a look at that

1987
01:50:41,579 --> 01:50:47,930
and and do sampling that makes more

1988
01:50:44,489 --> 01:50:47,929
sense right

1989
01:50:56,460 --> 01:51:00,409
okay let's go ahead and go to the Q&amp;A

1990
01:51:41,439 --> 01:51:47,050
yeah I'm pretty happy with how that is

1991
01:51:43,149 --> 01:51:49,299
actually I don't even know if we just

1992
01:51:47,050 --> 01:51:56,019
we're doing this multi-threaded we'd get

1993
01:51:49,300 --> 01:51:56,619
a lot more rays and we might just be

1994
01:51:56,019 --> 01:51:58,510
fine

1995
01:51:56,618 --> 01:52:00,458
like we may actually be at the point

1996
01:51:58,510 --> 01:52:03,309
where this is just gonna work without

1997
01:52:00,458 --> 01:52:09,029
reducing the noise much at all to be

1998
01:52:03,309 --> 01:52:11,050
honest you know I'm saying to you

1999
01:52:09,029 --> 01:52:12,880
because if you imagine this we're

2000
01:52:11,050 --> 01:52:14,708
running at 60 frames a second which we

2001
01:52:12,880 --> 01:52:17,260
easily could do this many if we just

2002
01:52:14,708 --> 01:52:21,688
multi-threaded it even on the CPU forget

2003
01:52:17,260 --> 01:52:23,889
GPU I think we'd be in reasonable shape

2004
01:52:21,689 --> 01:52:27,809
we should improve our spatial hierarchy

2005
01:52:23,889 --> 01:52:27,809
level as well as a separate issue

2006
01:52:39,069 --> 01:52:42,380
so the risk oh is that color banding I

2007
01:52:41,328 --> 01:52:44,599
see hope that's just ramping on stream

2008
01:52:42,380 --> 01:52:46,670
no I think that's probably actual color

2009
01:52:44,599 --> 01:52:49,159
banding you see we have not turned on

2010
01:52:46,670 --> 01:52:55,849
like any differing I don't think on the

2011
01:52:49,158 --> 01:52:57,710
GPU so and and we may need well okay I

2012
01:52:55,849 --> 01:52:59,779
don't see the color banding yes I do

2013
01:52:57,710 --> 01:53:03,050
so right in there you can see some color

2014
01:52:59,779 --> 01:53:08,359
banding and I assume that that is just

2015
01:53:03,050 --> 01:53:12,050
from the fact that we are not that we're

2016
01:53:08,359 --> 01:53:13,460
not getting like good differing we need

2017
01:53:12,050 --> 01:53:16,190
to like set up some things on the GPU

2018
01:53:13,460 --> 01:53:18,288
better to get differing in there because

2019
01:53:16,189 --> 01:53:20,928
I can definitely see it in here right

2020
01:53:18,288 --> 01:53:22,819
and and I don't think there's any

2021
01:53:20,929 --> 01:53:30,130
different going on in there I'm at can

2022
01:53:22,819 --> 01:53:33,529
actually check for you so if I open up

2023
01:53:30,130 --> 01:53:38,000
like paint or something for

2024
01:53:33,529 --> 01:53:41,750
if on here yeah okay that's didn't

2025
01:53:38,000 --> 01:53:49,309
want to do that so I guess I don't have

2026
01:53:41,750 --> 01:53:51,618
on here who knows so if we take a

2027
01:53:49,309 --> 01:53:54,949
look at you know somewhere where there

2028
01:53:51,618 --> 01:53:59,469
was more banding it's kind of hard to

2029
01:53:54,948 --> 01:53:59,469
see when the image isn't moving but

2030
01:54:02,238 --> 01:54:09,889
so there's no diff there there's there's

2031
01:54:05,750 --> 01:54:12,979
definitely no differ so what we probably

2032
01:54:09,890 --> 01:54:15,469
need to do is we probably need to set up

2033
01:54:12,979 --> 01:54:18,019
differ in the hardware to get rid of the

2034
01:54:15,469 --> 01:54:19,819
color banding that's not just a stream

2035
01:54:18,020 --> 01:54:23,300
artifact it may look worse because of

2036
01:54:19,819 --> 01:54:29,269
the stream but I can see it it is there

2037
01:54:23,300 --> 01:54:30,739
so that's just a question of that's just

2038
01:54:29,270 --> 01:54:33,550
a question if we've got to get it we've

2039
01:54:30,738 --> 01:54:33,549
got to get different output

2040
01:54:40,250 --> 01:54:44,060
check zero what do you think of game to

2041
01:54:42,409 --> 01:54:45,800
them at frameworks like unity do you

2042
01:54:44,060 --> 01:54:49,070
think in triple-a game can be made using

2043
01:54:45,800 --> 01:54:51,500
it it depends what you mean by triple-a

2044
01:54:49,069 --> 01:54:53,750
like obviously like if you don't

2045
01:54:51,500 --> 01:54:56,029
consider unity but you said you know the

2046
01:54:53,750 --> 01:54:58,939
Unreal Engine obviously that you know

2047
01:54:56,029 --> 01:55:02,269
was because Gears of War right is a

2048
01:54:58,939 --> 01:55:09,679
triple-a game and that's and that's made

2049
01:55:02,270 --> 01:55:12,020
in the Unreal Engine so you know I I

2050
01:55:09,680 --> 01:55:13,940
think unity may be a bit of a stretch

2051
01:55:12,020 --> 01:55:15,590
these days I don't really know if unity

2052
01:55:13,939 --> 01:55:17,089
is quite there yet in terms of really

2053
01:55:15,590 --> 01:55:18,260
triple if you want to make assassin's

2054
01:55:17,090 --> 01:55:21,230
creed or something I don't know that

2055
01:55:18,260 --> 01:55:22,550
it's gonna happen in unity but the

2056
01:55:21,229 --> 01:55:24,019
Unreal Engine has definitely been used

2057
01:55:22,550 --> 01:55:27,140
to make to ship triple-a games before

2058
01:55:24,020 --> 01:55:29,060
and that is a available framework you

2059
01:55:27,140 --> 01:55:30,890
probably can't ship something that's too

2060
01:55:29,060 --> 01:55:33,080
different from Gears of War right

2061
01:55:30,890 --> 01:55:34,640
because it's the engine is set up to do

2062
01:55:33,079 --> 01:55:39,680
a particular thing and so you need to be

2063
01:55:34,640 --> 01:55:43,100
doing that sort of that thing but you

2064
01:55:39,680 --> 01:55:45,079
know at least one of the engines out

2065
01:55:43,100 --> 01:55:46,760
there has been used to make a triple-a

2066
01:55:45,079 --> 01:55:48,229
game and so you know that that it is

2067
01:55:46,760 --> 01:55:50,050
possible to make at least a certain type

2068
01:55:48,229 --> 01:55:53,899
of triple-a game with it

2069
01:55:50,050 --> 01:55:55,489
unity I've never seen a triple-a game

2070
01:55:53,899 --> 01:55:58,420
made in unity maybe there is one but I

2071
01:55:55,489 --> 01:55:58,420
don't know what it is

2072
01:56:02,050 --> 01:56:05,350
why sampling rates can't be evenly

2073
01:56:03,970 --> 01:56:08,289
distributed to eliminate the flickering

2074
01:56:05,350 --> 01:56:11,680
wouldn't be fast the phrase um the

2075
01:56:08,289 --> 01:56:12,939
problem is that yes first of all I think

2076
01:56:11,680 --> 01:56:15,340
we will be able to do much better than

2077
01:56:12,939 --> 01:56:16,899
we're doing right now the problem with

2078
01:56:15,340 --> 01:56:18,909
it is that you don't know what evenly

2079
01:56:16,899 --> 01:56:21,279
distributed means so let's suppose

2080
01:56:18,909 --> 01:56:23,079
you've got a situation like this where

2081
01:56:21,279 --> 01:56:25,750
here is a bright light here and there's

2082
01:56:23,079 --> 01:56:27,640
no light here right or more to the point

2083
01:56:25,750 --> 01:56:29,109
let's suppose you've got a bright light

2084
01:56:27,640 --> 01:56:31,960
here but there's something in the way

2085
01:56:29,109 --> 01:56:34,269
and then we've got a situation here well

2086
01:56:31,960 --> 01:56:36,869
what you need to know is you need to

2087
01:56:34,270 --> 01:56:40,420
know how much of the light source is

2088
01:56:36,869 --> 01:56:43,420
occluded by this blocker and the only

2089
01:56:40,420 --> 01:56:47,289
way to know that is to find where these

2090
01:56:43,420 --> 01:56:48,609
points are right and so the way that we

2091
01:56:47,289 --> 01:56:50,529
do that because this is such a

2092
01:56:48,609 --> 01:56:52,029
complicated problem when you have a full

2093
01:56:50,529 --> 01:56:54,250
3d world geometry you're trying to

2094
01:56:52,029 --> 01:56:56,500
analyze is to just shoot a bunch of

2095
01:56:54,250 --> 01:56:59,199
these rays and look at the percentage

2096
01:56:56,500 --> 01:57:02,920
that hit the light source well that's

2097
01:56:59,199 --> 01:57:06,250
always going to be wrong always right

2098
01:57:02,920 --> 01:57:09,069
and how wrong it is just depends on how

2099
01:57:06,250 --> 01:57:11,380
many rays you shoot so when you're

2100
01:57:09,069 --> 01:57:13,539
talking about shooting so few rays like

2101
01:57:11,380 --> 01:57:17,079
if we can only afford to do 16 or 32

2102
01:57:13,539 --> 01:57:19,329
rays or something right per sample point

2103
01:57:17,079 --> 01:57:21,039
you're just not covering enough of the

2104
01:57:19,329 --> 01:57:22,539
hemisphere to really get accurate

2105
01:57:21,039 --> 01:57:24,460
percentages and that's where your noise

2106
01:57:22,539 --> 01:57:26,010
comes from because every other every

2107
01:57:24,460 --> 01:57:29,250
different frame you're getting different

2108
01:57:26,010 --> 01:57:29,250
percentages back

2109
01:57:31,939 --> 01:57:35,719
I'm watching a favorite of the backlog

2110
01:57:33,800 --> 01:57:37,640
you seem to return values and fungus by

2111
01:57:35,719 --> 01:57:39,529
parameter pointers even when you're not

2112
01:57:37,640 --> 01:57:42,110
returning anything else

2113
01:57:39,529 --> 01:57:44,300
ie void funk in our in star return

2114
01:57:42,109 --> 01:57:45,500
instead of in funk in art is there any

2115
01:57:44,300 --> 01:57:48,469
particular reason behind this I can't

2116
01:57:45,500 --> 01:57:49,880
imagine it maybe stops a pitch can you

2117
01:57:48,469 --> 01:57:52,609
give an example because it's not really

2118
01:57:49,880 --> 01:57:58,579
most of the time we do return the value

2119
01:57:52,609 --> 01:58:01,309
if we can return the value right pretty

2120
01:57:58,579 --> 01:58:03,079
much everywhere that's how we do it so

2121
01:58:01,310 --> 01:58:04,910
the times when we have to take an input

2122
01:58:03,079 --> 01:58:08,569
it's when it's gonna be something that's

2123
01:58:04,909 --> 01:58:10,670
expensive to return and we don't want to

2124
01:58:08,569 --> 01:58:14,389
do that or when we needed multiple

2125
01:58:10,670 --> 01:58:18,489
things right so most of the time we just

2126
01:58:14,390 --> 01:58:18,489
take inputs and return the output right

2127
01:58:19,840 --> 01:58:28,119
so I don't think that's an accurate

2128
01:58:21,829 --> 01:58:28,119
statement actually this is what I'd say

2129
01:58:29,289 --> 01:58:33,229
long billion are there any light effects

2130
01:58:31,698 --> 01:58:34,669
that you can think of we're assuming by

2131
01:58:33,229 --> 01:58:35,629
directional ray sampling would give

2132
01:58:34,670 --> 01:58:38,619
janky results

2133
01:58:35,630 --> 01:58:40,880
maybe subsurface scattering no so

2134
01:58:38,619 --> 01:58:42,469
bi-directional is always correct no

2135
01:58:40,880 --> 01:58:44,810
matter what the case is you can always

2136
01:58:42,469 --> 01:58:46,460
do it correctly the question is just

2137
01:58:44,810 --> 01:58:49,820
what are you actually going to do with

2138
01:58:46,460 --> 01:58:53,948
the bi-directional evaluation photons

2139
01:58:49,819 --> 01:58:57,710
can always travel like the reverse right

2140
01:58:53,948 --> 01:59:02,119
so I don't think there's any case where

2141
01:58:57,710 --> 01:59:03,800
they couldn't but I don't know there may

2142
01:59:02,119 --> 01:59:05,689
be something in particle physics that

2143
01:59:03,800 --> 01:59:08,900
says that some certain case cannot be

2144
01:59:05,689 --> 01:59:10,039
reversible but I you know I don't even

2145
01:59:08,899 --> 01:59:12,170
know about that because I've definitely

2146
01:59:10,039 --> 01:59:14,269
heard things from quantum people that's

2147
01:59:12,170 --> 01:59:16,069
like well we don't yet know whether time

2148
01:59:14,270 --> 01:59:20,030
always goes forwards right or stuff like

2149
01:59:16,069 --> 01:59:21,769
that meaning like you could imagine a

2150
01:59:20,029 --> 01:59:25,069
photon doing the exact opposite of what

2151
01:59:21,770 --> 01:59:27,620
it did so as far as I know at least in

2152
01:59:25,069 --> 01:59:29,420
lighting that we know about in terms of

2153
01:59:27,619 --> 01:59:33,710
computer graphics I don't think there is

2154
01:59:29,420 --> 01:59:36,649
such a thing as a forward path a photon

2155
01:59:33,710 --> 01:59:41,050
can take that a photon going the reverse

2156
01:59:36,649 --> 01:59:43,250
couldn't also take now remember the

2157
01:59:41,050 --> 01:59:45,889
probabilities are drastically different

2158
01:59:43,250 --> 01:59:49,488
and you that's why I say you know

2159
01:59:45,889 --> 01:59:51,439
a different computation so the chance

2160
01:59:49,488 --> 01:59:52,848
that a photon will take the reverse path

2161
01:59:51,439 --> 01:59:54,760
and the chance that the phone took the

2162
01:59:52,849 --> 01:59:58,519
forward path are completely different

2163
01:59:54,760 --> 02:00:00,979
that is true but the fact that they

2164
01:59:58,519 --> 02:00:02,989
could have taken the path I think is

2165
02:00:00,979 --> 02:00:05,989
always the case it's just a different

2166
02:00:02,988 --> 02:00:07,458
probability but you're accounting for

2167
02:00:05,988 --> 02:00:16,549
that when you do your summation usually

2168
02:00:07,458 --> 02:00:17,748
you know Big Mo fo one says but if

2169
02:00:16,550 --> 02:00:19,070
they're rays are the same across frames

2170
02:00:17,748 --> 02:00:20,898
the flickering would only happen around

2171
02:00:19,069 --> 02:00:23,509
moving objects would that be less

2172
02:00:20,899 --> 02:00:25,309
offensive during gameplay so if the Rays

2173
02:00:23,510 --> 02:00:28,550
are the same then yet what you do is you

2174
02:00:25,309 --> 02:00:30,320
get really really bad flicker a rat in

2175
02:00:28,550 --> 02:00:32,179
certain places and no flicker in other

2176
02:00:30,319 --> 02:00:36,799
places and that's not really a good

2177
02:00:32,179 --> 02:00:38,269
trade-off right you don't want some of

2178
02:00:36,800 --> 02:00:40,369
your lighting to be very accurate and

2179
02:00:38,269 --> 02:00:42,289
some to be incredibly inaccurate that's

2180
02:00:40,368 --> 02:00:43,969
not so good so what you want to do is

2181
02:00:42,288 --> 02:00:45,319
something that minimizes the inaccuracy

2182
02:00:43,969 --> 02:00:48,439
everywhere so you get a consistent

2183
02:00:45,319 --> 02:00:50,599
amount of flicker if you will and then

2184
02:00:48,439 --> 02:00:53,860
you try to reduce that amount it's the

2185
02:00:50,599 --> 02:00:53,860
best way I could say it I think

2186
02:01:10,310 --> 02:01:19,190
oh and one thing I should say though is

2187
02:01:13,100 --> 02:01:19,880
along those lines you will notice this I

2188
02:01:19,189 --> 02:01:21,889
put in here

2189
02:01:19,880 --> 02:01:23,840
I did say talk about removing some

2190
02:01:21,890 --> 02:01:26,420
randomness I do intend to remove some

2191
02:01:23,840 --> 02:01:28,069
randomest but only some so what the

2192
02:01:26,420 --> 02:01:30,680
stratified sampling stuff is about is

2193
02:01:28,069 --> 02:01:32,539
saying well okay let's suppose we want

2194
02:01:30,680 --> 02:01:36,409
to take an integral along this

2195
02:01:32,539 --> 02:01:39,079
Hemisphere right and I know I've got to

2196
02:01:36,409 --> 02:01:42,109
do random shots well what I want to do

2197
02:01:39,079 --> 02:01:44,659
is I want to partition it up into some

2198
02:01:42,109 --> 02:01:47,269
parts and treat them as sub integrals

2199
02:01:44,659 --> 02:01:49,970
right so I'm gonna shoot rays randomly

2200
02:01:47,270 --> 02:01:52,640
in here in here and here and here and

2201
02:01:49,970 --> 02:01:55,520
here and here and here and only average

2202
02:01:52,640 --> 02:01:57,470
along those right and so the way you do

2203
02:01:55,520 --> 02:02:00,590
that is you just say okay every frame

2204
02:01:57,470 --> 02:02:03,800
I'm gonna shoot you know one two three

2205
02:02:00,590 --> 02:02:06,619
four five six seven rays and I'm gonna

2206
02:02:03,800 --> 02:02:10,369
constrain each ray to be random within

2207
02:02:06,619 --> 02:02:12,109
its sub region that's called stratified

2208
02:02:10,369 --> 02:02:15,279
sampling and that's a way of reducing

2209
02:02:12,109 --> 02:02:18,109
the variance by saying alright look we

2210
02:02:15,279 --> 02:02:20,090
do know that we need to be random to try

2211
02:02:18,109 --> 02:02:21,769
and pick up what's going on but we want

2212
02:02:20,090 --> 02:02:24,440
to try and reduce the randomness by

2213
02:02:21,770 --> 02:02:25,880
keeping it within certain buckets so we

2214
02:02:24,439 --> 02:02:27,529
know we aren't for example on some

2215
02:02:25,880 --> 02:02:29,329
frames just always sampling everything

2216
02:02:27,529 --> 02:02:30,649
here and nothing out here which would be

2217
02:02:29,329 --> 02:02:34,430
a perfectly reasonable thing to happen

2218
02:02:30,649 --> 02:02:36,469
with pure random rays and so this is

2219
02:02:34,430 --> 02:02:38,360
basically like going more towards the

2220
02:02:36,470 --> 02:02:40,310
the blue neue style sampling it's

2221
02:02:38,359 --> 02:02:47,569
supposed to white noise style sampling

2222
02:02:40,310 --> 02:02:49,070
for example matter of fact would it be

2223
02:02:47,569 --> 02:02:52,699
possible to cast cones instead of rays

2224
02:02:49,069 --> 02:02:56,799
not into our geometry there are ways you

2225
02:02:52,699 --> 02:03:00,710
can do cone tracing into geometry that's

2226
02:02:56,800 --> 02:03:02,390
better than ours you know we might be

2227
02:03:00,710 --> 02:03:04,449
able to do something like Cohen tracing

2228
02:03:02,390 --> 02:03:06,650
in the future with our spatial hierarchy

2229
02:03:04,449 --> 02:03:09,489
and that might be an interesting way to

2230
02:03:06,649 --> 02:03:12,170
go but we haven't quite gotten there yet

2231
02:03:09,489 --> 02:03:13,699
in order to cast cones and have it be

2232
02:03:12,170 --> 02:03:15,140
any more efficient than casting rays you

2233
02:03:13,699 --> 02:03:16,729
need geometry that allows you to

2234
02:03:15,140 --> 02:03:19,340
intersect a cone with it and return a

2235
02:03:16,729 --> 02:03:20,869
color and that's very difficult to do if

2236
02:03:19,340 --> 02:03:22,610
you just have a bunch of sample points

2237
02:03:20,869 --> 02:03:24,198
so what we need to be able to aggregate

2238
02:03:22,609 --> 02:03:26,658
those sample points up in

2239
02:03:24,198 --> 02:03:28,009
to larger areas so that when a cone hits

2240
02:03:26,658 --> 02:03:29,658
them you can just return just that one

2241
02:03:28,010 --> 02:03:31,909
value and we just haven't done quite

2242
02:03:29,658 --> 02:03:36,109
that yet so it may be possible in the

2243
02:03:31,908 --> 02:03:40,189
future to cast they may not be not cones

2244
02:03:36,109 --> 02:03:42,708
per se but they are like cones in that

2245
02:03:40,189 --> 02:03:44,689
they are using coarser geometry as it

2246
02:03:42,708 --> 02:03:48,618
gets further away to reduce variance and

2247
02:03:44,689 --> 02:03:51,488
yes we may be able to do that with the

2248
02:03:48,618 --> 02:03:51,488
spatial hierarchy yeah

2249
02:04:00,708 --> 02:04:05,788
do you currently do any form of ambient

2250
02:04:03,359 --> 02:04:07,380
occlusion yea the lighting itself is

2251
02:04:05,788 --> 02:04:11,550
actually solving for the ambient

2252
02:04:07,380 --> 02:04:14,849
occlusion we are not doing a special

2253
02:04:11,550 --> 02:04:17,369
ambient occlusion pass to do we're not

2254
02:04:14,849 --> 02:04:18,989
we have no hack in there for ambient

2255
02:04:17,368 --> 02:04:20,819
occlusion at the moment right so we're

2256
02:04:18,988 --> 02:04:25,649
actually solving for real ambulant

2257
02:04:20,819 --> 02:04:27,118
ambient occlusion no hacking so so just

2258
02:04:25,649 --> 02:04:28,708
to be clear because sometimes people

2259
02:04:27,118 --> 02:04:31,498
have a special hack for ambient

2260
02:04:28,708 --> 02:04:34,649
occlusion exactly right it it's a like a

2261
02:04:31,498 --> 02:04:36,118
screen space pre pass that just you know

2262
02:04:34,649 --> 02:04:38,158
guesses at what the ambient occlusion

2263
02:04:36,118 --> 02:04:41,009
might be in that area we're not doing

2264
02:04:38,158 --> 02:04:43,319
that but we do get ambient occlusion as

2265
02:04:41,010 --> 02:04:50,119
part of the Ray casting so it is solving

2266
02:04:43,319 --> 02:04:50,118
for that right that makes sense

2267
02:04:55,500 --> 02:04:59,529
Kirito so you could use a blue noise

2268
02:04:57,729 --> 02:05:00,729
like source to select possible cones and

2269
02:04:59,529 --> 02:05:04,179
shoot random rates inside each of these

2270
02:05:00,729 --> 02:05:05,679
cones exactly or you don't even need to

2271
02:05:04,180 --> 02:05:08,230
blue noise the cones you can just use

2272
02:05:05,680 --> 02:05:10,119
fixed cones that has some consequences

2273
02:05:08,229 --> 02:05:11,559
as well you will see it a little bit so

2274
02:05:10,119 --> 02:05:16,859
I don't know exactly how we're gonna do

2275
02:05:11,560 --> 02:05:16,860
it but yes I mean if effectively that

2276
02:05:21,989 --> 02:05:25,599
what do you think about buying an IP

2277
02:05:24,159 --> 02:05:27,069
that is practically abandoned by the

2278
02:05:25,600 --> 02:05:28,600
publisher developer for a game that has

2279
02:05:27,069 --> 02:05:30,519
about a hundred players online at

2280
02:05:28,600 --> 02:05:32,620
maximum this is an online game I've no

2281
02:05:30,520 --> 02:05:35,410
idea I'm a game engine developer I don't

2282
02:05:32,619 --> 02:05:37,300
know anything about that pilot poop

2283
02:05:35,409 --> 02:05:39,579
how much does each new light in the

2284
02:05:37,300 --> 02:05:41,020
scene reduce performance there is no

2285
02:05:39,579 --> 02:05:47,289
reduction in performance for lights in

2286
02:05:41,020 --> 02:05:48,580
the scene it's flat rate so you can have

2287
02:05:47,289 --> 02:05:51,729
as many lights as you want there's no

2288
02:05:48,579 --> 02:05:55,439
performance change it's purely based on

2289
02:05:51,729 --> 02:05:55,439
the amount of geometry that there is

2290
02:06:00,659 --> 02:06:03,329
off topic do you feel like you still

2291
02:06:02,159 --> 02:06:04,889
have the same passion for this product

2292
02:06:03,329 --> 02:06:06,300
as you did back when you first began or

2293
02:06:04,890 --> 02:06:17,070
do somebody's feeling more like it's a

2294
02:06:06,300 --> 02:06:20,940
chore um I guess I don't know I feel

2295
02:06:17,069 --> 02:06:22,439
like that's a pretty broad question if

2296
02:06:20,939 --> 02:06:25,079
that makes sense for the actual

2297
02:06:22,439 --> 02:06:30,529
programming no I still like it

2298
02:06:25,079 --> 02:06:30,529
I guess is what I would say

2299
02:06:40,569 --> 02:06:45,210
right that's like about the end of the

2300
02:06:42,369 --> 02:06:45,210
questions

2301
02:07:13,248 --> 02:07:17,309
so it's good I'm sure it's best for

2302
02:07:15,510 --> 02:07:19,439
maybe to some extent like reflections

2303
02:07:17,309 --> 02:07:21,288
Triple A games this but our rate caster

2304
02:07:19,439 --> 02:07:24,300
tracer is really such a performance hit

2305
02:07:21,288 --> 02:07:26,399
that they aren't used on our complex set

2306
02:07:24,300 --> 02:07:31,529
of geometry it's like Call of Duty or

2307
02:07:26,399 --> 02:07:34,708
just in games without geometry so yeah

2308
02:07:31,529 --> 02:07:37,198
ray casters and Ray tracers just aren't

2309
02:07:34,708 --> 02:07:39,389
really used because of the amount of

2310
02:07:37,198 --> 02:07:46,918
geometry in most games they're they're

2311
02:07:39,389 --> 02:07:51,569
not common what is common is using Ray

2312
02:07:46,918 --> 02:07:54,359
casting in situations ticket to figure

2313
02:07:51,569 --> 02:07:56,880
out something about light transport by

2314
02:07:54,359 --> 02:07:58,768
doing the ray tracing on something else

2315
02:07:56,880 --> 02:08:05,130
that's not the actual geometry in the

2316
02:07:58,769 --> 02:08:08,429
game so for example there's screen space

2317
02:08:05,130 --> 02:08:10,918
ray casting and that gets used a lot

2318
02:08:08,429 --> 02:08:13,439
like you said reflections and Triple A

2319
02:08:10,918 --> 02:08:17,130
games will do stuff like screen space

2320
02:08:13,439 --> 02:08:19,019
ray tracing and that's basically a way

2321
02:08:17,130 --> 02:08:21,150
of saying well it's just too expensive

2322
02:08:19,019 --> 02:08:23,189
to retrace our geometry but it's not

2323
02:08:21,149 --> 02:08:26,549
necessarily too expensive to retrace the

2324
02:08:23,189 --> 02:08:29,550
pixels that we have because there's a

2325
02:08:26,550 --> 02:08:31,309
fixed number of those and we can sub

2326
02:08:29,550 --> 02:08:38,849
sample them predictably and so forth

2327
02:08:31,309 --> 02:08:41,369
right so you know that can happen

2328
02:08:38,849 --> 02:08:47,998
there's also stuff like pseudo radiosity

2329
02:08:41,368 --> 02:08:49,918
stuff like enlighten or whatever it's

2330
02:08:47,998 --> 02:08:53,599
called I don't know that's a tech that

2331
02:08:49,918 --> 02:08:58,168
got licensed by like frostbite and stuff

2332
02:08:53,599 --> 02:09:00,389
and so you know there's there's that as

2333
02:08:58,168 --> 02:09:01,679
well for real-time radiosity sort of

2334
02:09:00,389 --> 02:09:07,618
stuff that happens in a number of

2335
02:09:01,679 --> 02:09:11,458
engines games that can oftentimes will

2336
02:09:07,618 --> 02:09:15,408
bake lighting but baked lighting is sort

2337
02:09:11,458 --> 02:09:17,819
of a problem now for other reasons so

2338
02:09:15,408 --> 02:09:20,969
you know originally you always baked

2339
02:09:17,819 --> 02:09:22,380
lighting pretty much period and the

2340
02:09:20,969 --> 02:09:24,448
reason you always baked lighting in was

2341
02:09:22,380 --> 02:09:25,159
just because you couldn't do it any

2342
02:09:24,448 --> 02:09:27,989
other way

2343
02:09:25,159 --> 02:09:30,809
nowadays pure baked lighting becomes

2344
02:09:27,989 --> 02:09:34,859
less likely largely for artists

2345
02:09:30,810 --> 02:09:38,280
turnaround time light baking is a slow

2346
02:09:34,859 --> 02:09:40,079
process offline as well and so people

2347
02:09:38,279 --> 02:09:45,119
have been looking for ways to speed up

2348
02:09:40,079 --> 02:09:47,010
the you know having real time or close

2349
02:09:45,119 --> 02:09:48,479
to real time lighting is not just

2350
02:09:47,010 --> 02:09:50,369
something that allows the game to

2351
02:09:48,479 --> 02:09:52,500
respond to changing lighting in the

2352
02:09:50,369 --> 02:09:54,779
environment it's something that helps

2353
02:09:52,500 --> 02:09:55,890
artists produce better art because if

2354
02:09:54,779 --> 02:09:58,800
the artists don't have to sit around

2355
02:09:55,890 --> 02:10:01,020
waiting for the lighting to be

2356
02:09:58,800 --> 02:10:02,520
recomputed then they can see their

2357
02:10:01,020 --> 02:10:07,050
changes more quickly and produce better

2358
02:10:02,520 --> 02:10:10,170
artwork so actually in terms of ray

2359
02:10:07,050 --> 02:10:13,199
tracing the lighting in sort of a slow

2360
02:10:10,170 --> 02:10:17,369
offline fashion and using a baked that's

2361
02:10:13,199 --> 02:10:20,130
actually becoming less common for other

2362
02:10:17,369 --> 02:10:21,720
reasons right that may have nothing to

2363
02:10:20,130 --> 02:10:24,180
do with the actual runtime performance

2364
02:10:21,720 --> 02:10:27,539
of the game and so schemes that don't

2365
02:10:24,180 --> 02:10:29,970
require that that don't require slow

2366
02:10:27,539 --> 02:10:33,449
offline bakes are actually becoming more

2367
02:10:29,970 --> 02:10:35,340
popular not because of the game runtime

2368
02:10:33,449 --> 02:10:39,359
but actually because of the asset

2369
02:10:35,340 --> 02:10:40,619
creation time do you have any good

2370
02:10:39,359 --> 02:10:44,479
sources for learning about making

2371
02:10:40,619 --> 02:10:44,479
lighting solutions uh no not really

2372
02:11:01,430 --> 02:11:07,050
how would we implement fog can we

2373
02:11:04,949 --> 02:11:12,569
simulate different media in where the

2374
02:11:07,050 --> 02:11:14,909
light properties um yeah I don't know

2375
02:11:12,569 --> 02:11:17,489
that you would really want to yeah I

2376
02:11:14,909 --> 02:11:19,769
mean yes you could but just I'm it's

2377
02:11:17,489 --> 02:11:23,550
good it's gonna add more noise right is

2378
02:11:19,770 --> 02:11:27,740
the problem so I guess what I would say

2379
02:11:23,550 --> 02:11:30,180
is you have to remember that the

2380
02:11:27,739 --> 02:11:33,750
something like fog like participating

2381
02:11:30,180 --> 02:11:36,210
media is requires you to take light that

2382
02:11:33,750 --> 02:11:39,449
passes through it and randomly pick a

2383
02:11:36,210 --> 02:11:42,329
point in the traversal region to bounce

2384
02:11:39,449 --> 02:11:46,679
the light out randomly that's just a

2385
02:11:42,329 --> 02:11:48,600
huge source of noise right so if you

2386
02:11:46,680 --> 02:11:50,310
actually wanted to simulate fog with

2387
02:11:48,600 --> 02:11:54,360
this system in some way that was

2388
02:11:50,310 --> 02:11:56,370
actually utilizing the system to fully

2389
02:11:54,359 --> 02:11:58,049
do the fog I think it would be way too

2390
02:11:56,369 --> 02:11:59,909
expensive I mean we're already fighting

2391
02:11:58,050 --> 02:12:03,449
to get the variance down just without

2392
02:11:59,909 --> 02:12:05,489
stuff like that in there so I would say

2393
02:12:03,449 --> 02:12:10,590
if you did want to do fog you might have

2394
02:12:05,489 --> 02:12:13,260
to do something less rigorous than that

2395
02:12:10,590 --> 02:12:15,989
and say look all we're gonna do is when

2396
02:12:13,260 --> 02:12:17,789
light passes through a fog area we're

2397
02:12:15,989 --> 02:12:20,039
just gonna add light to the fog in that

2398
02:12:17,789 --> 02:12:23,250
area period that's all we do we don't

2399
02:12:20,039 --> 02:12:24,689
bounce the light at all so the fog

2400
02:12:23,250 --> 02:12:26,850
doesn't contribute to the lighting

2401
02:12:24,689 --> 02:12:31,159
solution it only receives light from the

2402
02:12:26,850 --> 02:12:34,890
lighting solution that seems plausible

2403
02:12:31,159 --> 02:12:37,050
right and similarly the degree of

2404
02:12:34,890 --> 02:12:39,450
attenuation in light that happens when

2405
02:12:37,050 --> 02:12:41,100
it has to pass through fog that could be

2406
02:12:39,449 --> 02:12:44,340
done as well those two things I think

2407
02:12:41,100 --> 02:12:46,440
would be fine however random scattering

2408
02:12:44,340 --> 02:12:48,569
of light due to fog I don't think is on

2409
02:12:46,439 --> 02:12:51,779
the table I just don't think that's

2410
02:12:48,569 --> 02:12:53,250
feasible so I think you could integrate

2411
02:12:51,779 --> 02:12:55,019
fog into the system and do some

2412
02:12:53,250 --> 02:13:00,359
interesting things I don't think you

2413
02:12:55,020 --> 02:13:02,510
could go all the way with it that's just

2414
02:13:00,359 --> 02:13:02,509
my guess

2415
02:13:10,500 --> 02:13:14,789
alright that's about it

2416
02:13:20,890 --> 02:13:24,470
okay thank you everyone for joining me

2417
02:13:23,239 --> 02:13:25,670
for an episode of handmade hero it's

2418
02:13:24,470 --> 02:13:27,440
been a pleasure coding with you as

2419
02:13:25,670 --> 02:13:29,420
always if you would like to follow along

2420
02:13:27,439 --> 02:13:31,429
the series at home you can always peer

2421
02:13:29,420 --> 02:13:33,050
to the game on handmade hero org and it

2422
02:13:31,430 --> 02:13:36,079
comes with the source code so you could

2423
02:13:33,050 --> 02:13:37,820
follow along at home that's about it for

2424
02:13:36,079 --> 02:13:39,920
today we'll be back next week when we

2425
02:13:37,819 --> 02:13:42,380
will look at changing to bi-directional

2426
02:13:39,920 --> 02:13:44,239
transport and stratified sampling just

2427
02:13:42,380 --> 02:13:46,460
to see if we can get our variants down

2428
02:13:44,239 --> 02:13:48,529
per frame before we go ahead and

2429
02:13:46,460 --> 02:13:50,720
optimize ourselves some more with

2430
02:13:48,529 --> 02:13:53,750
possibly doing maybe multi-threaded or

2431
02:13:50,720 --> 02:13:55,070
GPU or at the very least taking a look

2432
02:13:53,750 --> 02:13:56,869
at our spatial hierarchy stuff and

2433
02:13:55,069 --> 02:13:58,549
improving that because we threw it in

2434
02:13:56,869 --> 02:14:03,199
there and we've never really gone and

2435
02:13:58,550 --> 02:14:05,779
given it the full sort of attention that

2436
02:14:03,199 --> 02:14:08,119
it's gonna need to be good but yeah

2437
02:14:05,779 --> 02:14:08,359
pretty happy with the light I'm liking

2438
02:14:08,119 --> 02:14:10,250
it

2439
02:14:08,359 --> 02:14:12,619
I like the current one that seems really

2440
02:14:10,250 --> 02:14:14,899
stable I'd like to reduce the variance a

2441
02:14:12,619 --> 02:14:16,250
little bit but it's you know honestly I

2442
02:14:14,899 --> 02:14:17,539
don't know if we optimized it it might

2443
02:14:16,250 --> 02:14:20,989
just be fine even the way it is right

2444
02:14:17,539 --> 02:14:22,310
now so we'll have to sort of continue on

2445
02:14:20,989 --> 02:14:24,079
with the other parts of the lighting

2446
02:14:22,310 --> 02:14:26,480
that it that need to get addressed I

2447
02:14:24,079 --> 02:14:29,029
think all right thanks for joining me

2448
02:14:26,479 --> 02:14:29,869
and I will catch you guys on the

2449
02:14:29,029 --> 02:14:32,289
Internet

2450
02:14:29,869 --> 02:14:32,289
take it easy everybody

