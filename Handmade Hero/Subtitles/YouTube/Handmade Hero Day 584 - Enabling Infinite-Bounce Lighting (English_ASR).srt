1
00:00:01,250 --> 00:00:04,890
hello everyone and welcome to hand made

2
00:00:03,779 --> 00:00:08,129
here oh sure we could a complete-game

3
00:00:04,889 --> 00:00:10,800
live on stream we are going to be

4
00:00:08,130 --> 00:00:15,719
continuing our lighting work today we

5
00:00:10,800 --> 00:00:18,240
actually were told specifically in the

6
00:00:15,718 --> 00:00:19,559
so we left on the thing where we gotta

7
00:00:18,239 --> 00:00:21,509
like all right we got to debug the

8
00:00:19,559 --> 00:00:25,018
lighting I cleaned up the sort of the

9
00:00:21,510 --> 00:00:26,099
path that the lighting goes through so

10
00:00:25,018 --> 00:00:28,799
that we weren't doing as much

11
00:00:26,099 --> 00:00:30,839
unnecessary work but I didn't actually

12
00:00:28,800 --> 00:00:33,570
have a chance to debug any of it or

13
00:00:30,839 --> 00:00:35,640
really finish it up so that's what we

14
00:00:33,570 --> 00:00:38,070
were gonna be doing this weekend we had

15
00:00:35,640 --> 00:00:40,530
some bugs in there well at least one bug

16
00:00:38,070 --> 00:00:42,390
in there and although we would have

17
00:00:40,530 --> 00:00:44,850
tried to find that today actually on the

18
00:00:42,390 --> 00:00:46,710
handmade hero github which I guess I'm

19
00:00:44,850 --> 00:00:49,890
not logged into right now but I probably

20
00:00:46,710 --> 00:00:54,299
should have done that we actually had

21
00:00:49,890 --> 00:00:56,960
someone scriber wrote in over the week

22
00:00:54,299 --> 00:01:01,169
saying hey by the way I found the bug

23
00:00:56,960 --> 00:01:03,539
already in the lighting and and I fixed

24
00:01:01,170 --> 00:01:06,090
it and so I'm actually tipped off to

25
00:01:03,539 --> 00:01:08,310
what the bug was so I can't actually do

26
00:01:06,090 --> 00:01:10,770
the work of finding it today or at least

27
00:01:08,310 --> 00:01:12,379
not that book because we've already sort

28
00:01:10,769 --> 00:01:14,879
of we know what it is now

29
00:01:12,379 --> 00:01:17,280
so let me just show you what the problem

30
00:01:14,879 --> 00:01:21,478
was when we did some of the work of

31
00:01:17,280 --> 00:01:23,099
moving to like the you know when we sort

32
00:01:21,478 --> 00:01:26,188
of said alright let's let's streamline

33
00:01:23,099 --> 00:01:29,489
this so we're gonna actually do

34
00:01:26,188 --> 00:01:32,129
everything directly in the voxel and

35
00:01:29,489 --> 00:01:35,129
we're gonna do a sim D version of the

36
00:01:32,129 --> 00:01:39,328
update and all that stuff when we were

37
00:01:35,129 --> 00:01:41,509
computing the weights I think one of the

38
00:01:39,328 --> 00:01:43,919
things and I'm not sure I can make it

39
00:01:41,509 --> 00:01:45,989
happen here because you can't really see

40
00:01:43,920 --> 00:01:48,299
it very well but one of the things we

41
00:01:45,989 --> 00:01:50,039
noticed is that there were like parts of

42
00:01:48,299 --> 00:01:53,130
the lighting that seemed like they were

43
00:01:50,040 --> 00:01:56,118
always black unnecessarily like they

44
00:01:53,129 --> 00:01:58,649
were supposed to not be but they were

45
00:01:56,118 --> 00:02:00,299
and it turns out that the reason for

46
00:01:58,649 --> 00:02:01,920
that at least assuming the bug report

47
00:02:00,299 --> 00:02:04,020
was correct I never looked at the code

48
00:02:01,920 --> 00:02:07,019
and unless we're on stream so I didn't

49
00:02:04,019 --> 00:02:10,019
go verify it but if you remember we

50
00:02:07,019 --> 00:02:12,959
create sort of this diffuse weight map

51
00:02:10,020 --> 00:02:13,710
concept here and we put a bunch of

52
00:02:12,959 --> 00:02:15,509
information

53
00:02:13,710 --> 00:02:19,349
to it that we're going to use to look up

54
00:02:15,509 --> 00:02:21,359
to do multiplies later and what we've

55
00:02:19,349 --> 00:02:22,620
got is just an off by one bug in there

56
00:02:21,360 --> 00:02:25,200
where we're putting in the wrong

57
00:02:22,620 --> 00:02:27,060
information I should say sorry we're

58
00:02:25,199 --> 00:02:28,349
putting the information into the slot

59
00:02:27,060 --> 00:02:30,270
wrong because one of our lookups is

60
00:02:28,349 --> 00:02:31,889
wrong and that's kind of makes sense

61
00:02:30,270 --> 00:02:33,180
because we haven't polished this code

62
00:02:31,889 --> 00:02:34,589
like we haven't gone through and

63
00:02:33,180 --> 00:02:36,689
actually cleaned up how are things being

64
00:02:34,590 --> 00:02:38,490
look we got weird constants like this -

65
00:02:36,689 --> 00:02:41,789
- and all that stuff in there we

66
00:02:38,490 --> 00:02:43,650
probably want to get rid of but so let

67
00:02:41,789 --> 00:02:51,659
me just show you where it is if we go -

68
00:02:43,650 --> 00:02:54,450
I think it's what is it called build

69
00:02:51,659 --> 00:02:57,990
diffuse light Maps that's the one so if

70
00:02:54,449 --> 00:03:00,750
we look in here and we look at how these

71
00:02:57,990 --> 00:03:03,600
things are being updated right and then

72
00:03:00,750 --> 00:03:10,439
we go to the code that actually uses

73
00:03:03,599 --> 00:03:12,810
them which is down in the nope where is

74
00:03:10,439 --> 00:03:14,639
it here it is I think no oh sorry right

75
00:03:12,810 --> 00:03:16,020
we're doing these multi-threaded now so

76
00:03:14,639 --> 00:03:19,049
it's actually in the compute light

77
00:03:16,020 --> 00:03:21,360
computation call yeah we've gotten

78
00:03:19,050 --> 00:03:23,280
pretty fancy haven't we so here's that

79
00:03:21,360 --> 00:03:27,450
work computation it's actually being

80
00:03:23,280 --> 00:03:29,490
done so it's actually out here and if we

81
00:03:27,449 --> 00:03:31,639
look at where this is being done so I

82
00:03:29,490 --> 00:03:37,469
believe this is it right here right and

83
00:03:31,639 --> 00:03:39,479
we've got our are pulling the map out so

84
00:03:37,469 --> 00:03:43,349
you can see here when we get the weights

85
00:03:39,479 --> 00:03:47,129
there's a T y -1 being done here and a t

86
00:03:43,349 --> 00:03:50,159
x -1 being done here and then when we

87
00:03:47,129 --> 00:03:53,250
look it up we've got a T Y and a TX

88
00:03:50,159 --> 00:03:54,810
minus 4 being done here so you can see

89
00:03:53,250 --> 00:03:56,909
that we're actually looking this up

90
00:03:54,810 --> 00:03:59,550
differently because this is the same

91
00:03:56,909 --> 00:04:02,069
loop on the outside right you can see

92
00:03:59,550 --> 00:04:04,050
that these are meant to line up but this

93
00:04:02,069 --> 00:04:07,280
one's looking it up with T Y and this

94
00:04:04,050 --> 00:04:10,110
one's looking it up with T y -1 so

95
00:04:07,280 --> 00:04:12,300
everything was shifted by a row which

96
00:04:10,110 --> 00:04:15,600
leads to lighting that sort of looks

97
00:04:12,300 --> 00:04:18,350
sort of correct but is off a little bit

98
00:04:15,599 --> 00:04:21,689
right like it's just it's rotated in our

99
00:04:18,350 --> 00:04:23,790
octahedron a little bit and then just

100
00:04:21,689 --> 00:04:26,790
one of the rows eventually we'll get to

101
00:04:23,790 --> 00:04:29,390
garbage and that's the last row that you

102
00:04:26,790 --> 00:04:29,390
see right

103
00:04:33,199 --> 00:04:40,649
from top to bottom there and that's just

104
00:04:37,199 --> 00:04:42,930
because again since this is picking from

105
00:04:40,649 --> 00:04:44,849
T Y it starts at one whereas this one

106
00:04:42,930 --> 00:04:46,410
starts at zero and it goes to the same

107
00:04:44,850 --> 00:04:48,990
number so it's just going to pull one

108
00:04:46,410 --> 00:04:50,370
off the end so we need to be able to

109
00:04:48,990 --> 00:04:52,560
look up our diffuse weight maps with the

110
00:04:50,370 --> 00:04:55,980
same thing that we were doing there and

111
00:04:52,560 --> 00:04:59,189
that's that's the crucial bit so that

112
00:04:55,980 --> 00:05:01,020
way you know this sort of unpacking here

113
00:04:59,189 --> 00:05:02,339
where this all does it's T X minus one

114
00:05:01,019 --> 00:05:03,810
nonsense and figures out where to put

115
00:05:02,339 --> 00:05:06,509
everything that was all fine because

116
00:05:03,810 --> 00:05:10,500
we're looking up just by TX 4

117
00:05:06,509 --> 00:05:13,769
so that's all fine but we we don't

118
00:05:10,500 --> 00:05:15,540
really have any way to recover from that

119
00:05:13,769 --> 00:05:18,089
T Y problem so we needed to make that B

120
00:05:15,540 --> 00:05:21,420
a minus 1 so let's go ahead and run it

121
00:05:18,089 --> 00:05:25,799
now and we should in theory have a

122
00:05:21,420 --> 00:05:27,509
slightly better version here and it

123
00:05:25,800 --> 00:05:29,040
looks alright except I'm not sure why

124
00:05:27,509 --> 00:05:30,509
we're not getting any lighting on the

125
00:05:29,040 --> 00:05:33,060
actual character that seems a little

126
00:05:30,509 --> 00:05:34,949
weird because we see it's kind of a

127
00:05:33,060 --> 00:05:39,750
little bit strange right so that that

128
00:05:34,949 --> 00:05:41,849
looks a little bit busted still but the

129
00:05:39,750 --> 00:05:43,500
actual lighting of the world seems

130
00:05:41,850 --> 00:05:45,810
correct so I'm not sure how exactly

131
00:05:43,500 --> 00:05:50,310
that's happening that might just be

132
00:05:45,810 --> 00:05:52,530
because of the way the random the that

133
00:05:50,310 --> 00:05:53,970
could just be randomly sort of the way

134
00:05:52,529 --> 00:05:56,069
that the character is because at the

135
00:05:53,970 --> 00:05:59,190
moment right there's no bounce lighting

136
00:05:56,069 --> 00:06:00,990
whatsoever on anything so you know

137
00:05:59,189 --> 00:06:03,269
depending on exactly where the character

138
00:06:00,990 --> 00:06:05,460
is relative to how you're viewing it

139
00:06:03,269 --> 00:06:08,279
right you can kind of see as it goes

140
00:06:05,459 --> 00:06:09,779
there so that that might be okay not

141
00:06:08,279 --> 00:06:11,309
really willing to say it is or isn't the

142
00:06:09,779 --> 00:06:15,119
moment but I'm really kind of only

143
00:06:11,310 --> 00:06:18,269
looking at the environment and so that

144
00:06:15,120 --> 00:06:19,949
looks pretty good right I mean you know

145
00:06:18,269 --> 00:06:23,490
if I look at the way the lighting is

146
00:06:19,949 --> 00:06:26,159
flowing again looks pretty reasonable we

147
00:06:23,490 --> 00:06:27,810
do have a problem with the way the voxel

148
00:06:26,160 --> 00:06:29,340
is aligned and we have to look at that

149
00:06:27,810 --> 00:06:31,680
at some point so do you see like that

150
00:06:29,339 --> 00:06:33,810
there that's because our voxel is not

151
00:06:31,680 --> 00:06:35,939
aligned to the two like that where the

152
00:06:33,810 --> 00:06:38,129
view is right it's aligned to the

153
00:06:35,939 --> 00:06:42,120
simulation region and that's like very

154
00:06:38,129 --> 00:06:44,839
unhelpful so do you see this box here

155
00:06:42,120 --> 00:06:48,689
this box is the thing that contains our

156
00:06:44,839 --> 00:06:50,638
lighting so that always has to be

157
00:06:48,689 --> 00:06:52,079
centered around the view if we want to

158
00:06:50,639 --> 00:06:54,930
make sure that there isn't a cutoff in

159
00:06:52,079 --> 00:06:58,529
lighting but at the moment it's not and

160
00:06:54,930 --> 00:06:59,970
so when you know when it does when it

161
00:06:58,529 --> 00:07:02,609
switches to the simulation center like

162
00:06:59,970 --> 00:07:04,889
that it's just a real issue because

163
00:07:02,610 --> 00:07:06,479
sometimes the simulation center might be

164
00:07:04,889 --> 00:07:07,590
at the exact center like that and

165
00:07:06,478 --> 00:07:09,478
everything's fine

166
00:07:07,589 --> 00:07:12,568
other times the simulation centers

167
00:07:09,478 --> 00:07:14,990
shifted to the - like here now one thing

168
00:07:12,569 --> 00:07:18,449
I don't know and it's probably worth

169
00:07:14,990 --> 00:07:21,900
exploring is if we look at what's going

170
00:07:18,449 --> 00:07:24,598
on here it's kind of an open question as

171
00:07:21,899 --> 00:07:27,959
to why the simulation center got set

172
00:07:24,598 --> 00:07:29,728
there because the simulation center

173
00:07:27,959 --> 00:07:31,799
should be centered around the room that

174
00:07:29,728 --> 00:07:34,529
we're in and for some reason the

175
00:07:31,800 --> 00:07:37,288
simulation center as you can see appears

176
00:07:34,529 --> 00:07:38,818
to be like over like I don't even know

177
00:07:37,288 --> 00:07:41,848
what's going on with the simulation

178
00:07:38,819 --> 00:07:47,069
center there but either way this is not

179
00:07:41,848 --> 00:07:48,899
helpful right and so that a couple of

180
00:07:47,069 --> 00:07:51,900
those things are just now in a janky

181
00:07:48,899 --> 00:07:54,209
state and that's okay because it doesn't

182
00:07:51,899 --> 00:07:56,008
affect our lighting computations at all

183
00:07:54,209 --> 00:07:58,948
so it's not something we need to fix

184
00:07:56,009 --> 00:08:00,930
immediately yeah it doesn't affect any

185
00:07:58,949 --> 00:08:03,210
more any other part of the algorithm so

186
00:08:00,930 --> 00:08:05,189
we can leave it to fix till later but

187
00:08:03,209 --> 00:08:08,848
it's worth noting that we do have issues

188
00:08:05,189 --> 00:08:10,348
with that that we want to address so I

189
00:08:08,848 --> 00:08:12,449
think we're okay for now

190
00:08:10,348 --> 00:08:16,379
with with like the way the lighting is

191
00:08:12,449 --> 00:08:19,080
working here and I think that the next

192
00:08:16,379 --> 00:08:20,519
natural step is of course to try and get

193
00:08:19,079 --> 00:08:22,968
this working with some actual Bounce

194
00:08:20,519 --> 00:08:22,968
lighting now

195
00:08:30,060 --> 00:08:35,168
and so what we want to be able to do now

196
00:08:33,639 --> 00:08:36,909
since you know this is what we're

197
00:08:35,168 --> 00:08:39,429
sending down here is this diffuse map

198
00:08:36,909 --> 00:08:43,569
and what we want to be able to do now is

199
00:08:39,429 --> 00:08:46,839
that dis fuse map needs to get used in

200
00:08:43,570 --> 00:08:48,670
our actual code path where we sample the

201
00:08:46,840 --> 00:08:50,440
lighting to figure out what the lighting

202
00:08:48,669 --> 00:08:55,089
is on things that we hit in the

203
00:08:50,440 --> 00:08:57,390
environment right and so again just like

204
00:08:55,090 --> 00:09:00,910
looking at what's happening here right

205
00:08:57,389 --> 00:09:02,649
this is just a test where we spam some

206
00:09:00,909 --> 00:09:07,029
light into the environment with a

207
00:09:02,649 --> 00:09:09,039
specific normal and it's really it's

208
00:09:07,029 --> 00:09:10,839
really just a test of the voxel

209
00:09:09,039 --> 00:09:12,579
interpolation and the octahedral map

210
00:09:10,840 --> 00:09:15,610
right it's just something to tell us if

211
00:09:12,580 --> 00:09:19,300
we're working vaguely correctly but it's

212
00:09:15,610 --> 00:09:21,159
totally wrong and doesn't actually talk

213
00:09:19,299 --> 00:09:23,409
about what the light is actually doing

214
00:09:21,159 --> 00:09:27,490
there much at all and also by the way

215
00:09:23,409 --> 00:09:30,730
let me just run our test sphere as well

216
00:09:27,490 --> 00:09:33,580
through here so that we can verify that

217
00:09:30,730 --> 00:09:36,850
that's giving proper value so here's our

218
00:09:33,580 --> 00:09:40,540
test sphere you can kind of see that

219
00:09:36,850 --> 00:09:44,500
just doing a fall-off light on the

220
00:09:40,539 --> 00:09:47,379
actual sphere you know looks fairly

221
00:09:44,500 --> 00:09:48,909
reasonable because remember basically

222
00:09:47,379 --> 00:09:51,189
what this is doing is anywhere that we

223
00:09:48,909 --> 00:09:53,500
hit it's just basically looking to see

224
00:09:51,190 --> 00:09:56,620
how much light bounces back from a

225
00:09:53,500 --> 00:09:58,600
sphere that's like right here and so

226
00:09:56,620 --> 00:10:01,149
it's you know it's a cosine weighting

227
00:09:58,600 --> 00:10:03,730
kind of a thing now I don't again

228
00:10:01,149 --> 00:10:05,470
actually know that we're totally correct

229
00:10:03,730 --> 00:10:06,879
at this point because we might be

230
00:10:05,470 --> 00:10:10,540
getting a little bit too much specular

231
00:10:06,879 --> 00:10:12,159
I'm not sure like I'm not sure how

232
00:10:10,539 --> 00:10:13,689
diffuse this should be I'd have to go

233
00:10:12,159 --> 00:10:15,309
through and kind of think about exactly

234
00:10:13,690 --> 00:10:17,500
what should be happening in terms of

235
00:10:15,309 --> 00:10:19,299
that cosine fall-off curve because since

236
00:10:17,500 --> 00:10:21,100
there is no indirect lighting it's kind

237
00:10:19,299 --> 00:10:22,329
of hard for me to think about exactly

238
00:10:21,100 --> 00:10:24,519
what we should be getting since we've

239
00:10:22,330 --> 00:10:27,009
got two cosine falls in there one from

240
00:10:24,519 --> 00:10:28,899
the actual light distribution that we

241
00:10:27,009 --> 00:10:32,500
stick in there and then one from the the

242
00:10:28,899 --> 00:10:35,199
actual diffuse so I'm not exactly sure

243
00:10:32,500 --> 00:10:39,009
what the correct thing to see in this

244
00:10:35,200 --> 00:10:40,690
case is also our clamping of lighting is

245
00:10:39,009 --> 00:10:41,569
a little aggressive here and so I think

246
00:10:40,690 --> 00:10:43,730
I'm going to go ahead

247
00:10:41,570 --> 00:10:51,340
and get rid of a little of that clamping

248
00:10:43,730 --> 00:10:59,450
just so we can like this right here no

249
00:10:51,340 --> 00:11:02,060
this right where's our clamp here it is

250
00:10:59,450 --> 00:11:05,420
so this right here we clamp sir one it's

251
00:11:02,059 --> 00:11:08,509
not super helpful so I probably want to

252
00:11:05,419 --> 00:11:11,029
clamp to something higher than one

253
00:11:08,509 --> 00:11:14,360
because over brighting the light is

254
00:11:11,029 --> 00:11:15,980
actually desirable in a lot of cases so

255
00:11:14,360 --> 00:11:17,659
we probably don't want to clamp it in

256
00:11:15,980 --> 00:11:20,120
that way like if we were gonna clamp it

257
00:11:17,659 --> 00:11:21,829
we'd tone map it or do something like

258
00:11:20,120 --> 00:11:24,740
that but clamping zero to one is not

259
00:11:21,830 --> 00:11:27,110
it's not really good so what I'd rather

260
00:11:24,740 --> 00:11:30,139
do here is say okay let's let's let this

261
00:11:27,110 --> 00:11:33,230
light go a little bit higher you can see

262
00:11:30,139 --> 00:11:34,549
we've got a clamp min/max here so I

263
00:11:33,230 --> 00:11:37,009
think I'm just gonna say alright let's

264
00:11:34,549 --> 00:11:40,699
clamp this between zero and double

265
00:11:37,009 --> 00:11:42,139
bright I mean I don't know what we want

266
00:11:40,700 --> 00:11:43,820
to do there in the long term we might

267
00:11:42,139 --> 00:11:46,279
want to have a tone map where we map

268
00:11:43,820 --> 00:11:47,570
values in some kind of way but you can

269
00:11:46,279 --> 00:11:48,980
see that that adds a little bit more

270
00:11:47,570 --> 00:11:52,120
character the lighting that's still not

271
00:11:48,980 --> 00:11:55,009
probably enough I'd go higher than that

272
00:11:52,120 --> 00:11:57,649
in terms of over brighting so that that

273
00:11:55,009 --> 00:11:59,269
just looks better right because it

274
00:11:57,649 --> 00:12:02,689
allows you to get a light source that

275
00:11:59,269 --> 00:12:06,379
actually like whitens things up a bit

276
00:12:02,690 --> 00:12:08,570
past past what their base value is so

277
00:12:06,379 --> 00:12:10,909
it's actually kind of like adding in a

278
00:12:08,570 --> 00:12:21,100
little bit of extra light there and that

279
00:12:10,909 --> 00:12:21,100
seems reasonable to me you know yeah

280
00:12:23,250 --> 00:12:32,679
not sure what the clamp tap value should

281
00:12:26,230 --> 00:12:34,600
be but that seems maybe more like it and

282
00:12:32,679 --> 00:12:35,829
then you know like eventually if you

283
00:12:34,600 --> 00:12:37,450
want to put some tone mapping in there

284
00:12:35,830 --> 00:12:40,379
we can but at the moment we would just

285
00:12:37,450 --> 00:12:43,240
turn like down the brightness of a light

286
00:12:40,379 --> 00:12:45,460
anyway that's looking really nice

287
00:12:43,240 --> 00:12:46,570
I mean again we probably slept some bugs

288
00:12:45,460 --> 00:12:48,100
in there and at some point we're gonna

289
00:12:46,570 --> 00:12:51,460
have to do like a really hardcore

290
00:12:48,100 --> 00:12:53,860
evaluation pass on this probably but at

291
00:12:51,460 --> 00:12:56,560
the moment at least as far as I can tell

292
00:12:53,860 --> 00:12:58,600
there's enough certainty that this is at

293
00:12:56,559 --> 00:13:00,759
least roughly reproducing the light

294
00:12:58,600 --> 00:13:02,649
field we put into it but I think we

295
00:13:00,759 --> 00:13:05,740
could start to work on the indirect pass

296
00:13:02,649 --> 00:13:07,269
and get that working right that way we

297
00:13:05,740 --> 00:13:10,149
at least have everything working and

298
00:13:07,269 --> 00:13:11,799
then we can start to do our sort of

299
00:13:10,149 --> 00:13:16,629
tune-up but getting everything debugged

300
00:13:11,799 --> 00:13:18,579
right all right so let's see and also

301
00:13:16,629 --> 00:13:20,830
speed optimize because right now that

302
00:13:18,580 --> 00:13:22,210
diffuse pass is really expensive and I

303
00:13:20,830 --> 00:13:23,889
don't know we may need to do something

304
00:13:22,210 --> 00:13:27,389
separable there or because there's just

305
00:13:23,889 --> 00:13:31,720
too much like too many flops in that

306
00:13:27,389 --> 00:13:35,049
conversion from the specular sample to

307
00:13:31,720 --> 00:13:38,080
the diffuse we don't really have a way

308
00:13:35,049 --> 00:13:40,569
of making that work at the moment fast

309
00:13:38,080 --> 00:13:43,210
enough so although the game appears to

310
00:13:40,570 --> 00:13:45,370
be running reasonably well you have to

311
00:13:43,210 --> 00:13:47,019
keep in mind that this is running at

312
00:13:45,370 --> 00:13:50,649
only 30 frames a second this isn't

313
00:13:47,019 --> 00:13:54,490
hitting 60 right now and it's not

314
00:13:50,649 --> 00:13:57,459
hitting 60 even though we're not doing

315
00:13:54,490 --> 00:13:59,379
the Ray casting right so if we were to

316
00:13:57,460 --> 00:14:01,360
actually turn the Ray casting on which

317
00:13:59,379 --> 00:14:03,189
doesn't quite work yet because we

318
00:14:01,360 --> 00:14:07,060
haven't actually gone through and gotten

319
00:14:03,190 --> 00:14:12,280
the sampling in there we would we would

320
00:14:07,059 --> 00:14:15,519
have an issue I'm gonna do test fear

321
00:14:12,279 --> 00:14:17,799
where's my oh I'm in the wrong file so

322
00:14:15,519 --> 00:14:21,419
if we were to turn these off and we

323
00:14:17,799 --> 00:14:26,819
actually run the full cast path here

324
00:14:21,419 --> 00:14:29,379
what's the problem lighting solution um

325
00:14:26,820 --> 00:14:33,749
what am i what am I getting complaints

326
00:14:29,379 --> 00:14:36,899
on what's what's full cast expect

327
00:14:33,749 --> 00:14:44,490
oh it expects the lighting work that's

328
00:14:36,899 --> 00:14:46,470
what it expects all right so here's

329
00:14:44,490 --> 00:14:47,698
running the indirect pass and just what

330
00:14:46,470 --> 00:14:54,209
you can see is like to see how that

331
00:14:47,698 --> 00:14:56,039
frame rate really tanks right and so the

332
00:14:54,208 --> 00:15:00,719
problem that we're gonna have also I'm

333
00:14:56,039 --> 00:15:02,248
not sure what's going on I don't know

334
00:15:00,720 --> 00:15:06,749
why everything is fulbright right now

335
00:15:02,249 --> 00:15:10,050
that's total mystery to me so but either

336
00:15:06,749 --> 00:15:14,249
way so with the full cast on you can see

337
00:15:10,049 --> 00:15:16,409
the speed is just horrible right so the

338
00:15:14,249 --> 00:15:18,928
problem is I don't think we are going to

339
00:15:16,409 --> 00:15:21,149
have the budget for doing indirect ray

340
00:15:18,928 --> 00:15:23,730
casting plus that really expensive

341
00:15:21,149 --> 00:15:25,919
diffuse those two things together are

342
00:15:23,730 --> 00:15:28,319
just you know either one of them is what

343
00:15:25,919 --> 00:15:30,928
we can afford and not both so we need to

344
00:15:28,318 --> 00:15:32,428
speed either both of them up or we need

345
00:15:30,928 --> 00:15:33,659
to at least beat up the diffuse one

346
00:15:32,428 --> 00:15:35,970
because the diffuse when we've looked at

347
00:15:33,659 --> 00:15:38,938
quite a bit less than the Ray casting

348
00:15:35,970 --> 00:15:41,160
which is already going considerably

349
00:15:38,938 --> 00:15:44,759
accelerated over its base rate of just a

350
00:15:41,159 --> 00:15:47,909
naive implementation and so you know I

351
00:15:44,759 --> 00:15:49,528
guess I would just say this is that

352
00:15:47,909 --> 00:15:52,948
that's where we're at right so we have

353
00:15:49,528 --> 00:15:54,928
issues there okay

354
00:15:52,948 --> 00:15:57,028
so I'm not sure why that was actually

355
00:15:54,928 --> 00:15:59,879
full braiding that was kind that's kind

356
00:15:57,028 --> 00:16:01,740
of a surprise to me I'm not sure what

357
00:15:59,879 --> 00:16:03,449
we're actually seeing there also I'm not

358
00:16:01,740 --> 00:16:11,669
sure why we're not seeing anything in

359
00:16:03,448 --> 00:16:14,338
here I'm a little bit tempted to to take

360
00:16:11,669 --> 00:16:15,419
a look at the well you know it might be

361
00:16:14,339 --> 00:16:16,740
that we just let some debug code in

362
00:16:15,419 --> 00:16:17,759
there but it sound like it did I'm a

363
00:16:16,740 --> 00:16:18,839
little bit tempted to take a look at

364
00:16:17,759 --> 00:16:20,699
what this texture actually is because

365
00:16:18,839 --> 00:16:23,549
I'm not sure why it doesn't show up as

366
00:16:20,698 --> 00:16:26,698
white or something in here

367
00:16:23,548 --> 00:16:28,948
so that's a little bit strange but again

368
00:16:26,698 --> 00:16:30,899
we haven't looked at this code in a

369
00:16:28,948 --> 00:16:34,828
little bit so let's just go in and see

370
00:16:30,899 --> 00:16:36,688
what's going on there so here's the full

371
00:16:34,828 --> 00:16:38,729
cast code and basically this is the code

372
00:16:36,688 --> 00:16:40,740
that we're calling if we wanted to stick

373
00:16:38,730 --> 00:16:43,829
stuff into the voxel that actually gets

374
00:16:40,740 --> 00:16:46,289
updated via ray casting rather than or

375
00:16:43,828 --> 00:16:46,559
via distributed Red casting rather than

376
00:16:46,289 --> 00:16:48,179
just

377
00:16:46,559 --> 00:16:51,659
like a single cast towards the light see

378
00:16:48,179 --> 00:16:53,489
if you hit it and what we get here is we

379
00:16:51,659 --> 00:16:57,719
can see that we come through here we've

380
00:16:53,490 --> 00:17:00,509
got our old moon light that's going to

381
00:16:57,720 --> 00:17:02,820
be placed in and we can turn off the

382
00:17:00,509 --> 00:17:04,920
moon light for now to avoid that being

383
00:17:02,820 --> 00:17:06,900
anything that is gonna cause us a

384
00:17:04,920 --> 00:17:09,420
problem you can see that the only place

385
00:17:06,900 --> 00:17:12,740
that actually comes in here is when we

386
00:17:09,420 --> 00:17:16,140
have light information coming down a

387
00:17:12,740 --> 00:17:19,410
path where we haven't hit anything at

388
00:17:16,140 --> 00:17:21,390
all right so our ray escapes the scene

389
00:17:19,410 --> 00:17:23,970
entirely and we put the moon light in

390
00:17:21,390 --> 00:17:25,709
there so we can get rid of that for now

391
00:17:23,970 --> 00:17:28,199
and the easiest way to do that is just

392
00:17:25,709 --> 00:17:30,810
the moon color here right we can turn

393
00:17:28,199 --> 00:17:35,400
off so we can just say like you know

394
00:17:30,809 --> 00:17:38,190
moon color equals nothing and then the

395
00:17:35,400 --> 00:17:42,690
moon is turned off and we can eliminate

396
00:17:38,190 --> 00:17:45,059
that from the front of you and you know

397
00:17:42,690 --> 00:17:46,620
if we turn that off then I don't see a

398
00:17:45,059 --> 00:17:48,029
thing different and you know what I saw

399
00:17:46,619 --> 00:17:49,079
some light in there so it looks like

400
00:17:48,029 --> 00:17:51,178
actually all that's happening is the

401
00:17:49,079 --> 00:17:56,250
lights just building up till infinite

402
00:17:51,179 --> 00:17:59,820
values probably something like that so

403
00:17:56,250 --> 00:18:02,039
that's fine so here's that casting code

404
00:17:59,819 --> 00:18:03,809
and what you can see here is it's going

405
00:18:02,039 --> 00:18:05,789
through this thing and doing a bias

406
00:18:03,809 --> 00:18:07,919
towards light version of the sampling

407
00:18:05,789 --> 00:18:10,230
here where we get this light leaf I'm

408
00:18:07,920 --> 00:18:12,960
not sure I really want to do that I

409
00:18:10,230 --> 00:18:15,900
think I might rather just not do any

410
00:18:12,960 --> 00:18:18,420
light biasing at the moment so this kind

411
00:18:15,900 --> 00:18:20,640
of situation I might want to turn off at

412
00:18:18,420 --> 00:18:22,200
the immediate moment and what you can

413
00:18:20,640 --> 00:18:26,480
see here is that the way that that

414
00:18:22,200 --> 00:18:28,799
startup works is we then start picking

415
00:18:26,480 --> 00:18:32,000
at the end or at least I thought we did

416
00:18:28,799 --> 00:18:36,750
maybe this is busted I thought we were

417
00:18:32,000 --> 00:18:43,049
looking up ray directions here so where

418
00:18:36,750 --> 00:18:46,049
does that so it looks like ray origin is

419
00:18:43,049 --> 00:18:48,799
not getting updated at all so this is

420
00:18:46,049 --> 00:18:52,579
just kind of garbage

421
00:18:48,799 --> 00:18:53,690
oh no it's not sorry Rea directions the

422
00:18:52,579 --> 00:19:01,490
only thing that needs to get updated

423
00:18:53,690 --> 00:19:05,210
what am I talking about so that's the

424
00:19:01,490 --> 00:19:07,009
part that we actually pick the new one

425
00:19:05,210 --> 00:19:09,890
right the sampling sphere with ray

426
00:19:07,009 --> 00:19:15,230
bundle index and that just goes through

427
00:19:09,890 --> 00:19:16,280
and picks each one of these out and I

428
00:19:15,230 --> 00:19:17,870
don't know that I actually want to do

429
00:19:16,279 --> 00:19:19,940
this add padding yet so what I'm going

430
00:19:17,869 --> 00:19:21,439
to do here again is just I'm not going

431
00:19:19,940 --> 00:19:24,080
to bias towards the light source at the

432
00:19:21,440 --> 00:19:26,600
moment I'm gonna go ahead and put this

433
00:19:24,079 --> 00:19:31,039
at the top like so

434
00:19:26,599 --> 00:19:36,819
oops so that we're actually not biasing

435
00:19:31,039 --> 00:19:40,670
towards light sources I'll do that later

436
00:19:36,819 --> 00:19:43,519
okay so here's this running without bias

437
00:19:40,670 --> 00:19:45,710
towards light sources and what you

438
00:19:43,519 --> 00:19:47,450
notice is it lights very quickly and so

439
00:19:45,710 --> 00:20:00,100
it's already a little suspicious

440
00:19:47,450 --> 00:20:03,710
oops more time I lied there we go

441
00:20:00,099 --> 00:20:05,389
alright so what you can see is we're

442
00:20:03,710 --> 00:20:08,029
getting still a lot of light coming in

443
00:20:05,390 --> 00:20:09,440
there and I'm not really sure why we're

444
00:20:08,029 --> 00:20:15,410
getting so much so that's one thing that

445
00:20:09,440 --> 00:20:17,779
I want to look at if we go to the update

446
00:20:15,410 --> 00:20:21,050
voxel call you can see here that what

447
00:20:17,779 --> 00:20:23,420
this is doing is a slow blend each time

448
00:20:21,049 --> 00:20:25,940
we do an update which is like this it's

449
00:20:23,420 --> 00:20:27,680
doing a slow blend towards whatever the

450
00:20:25,940 --> 00:20:30,740
lighting information is that we have

451
00:20:27,680 --> 00:20:34,190
here and so one of the things that I

452
00:20:30,740 --> 00:20:36,339
don't really want to do yet but that

453
00:20:34,190 --> 00:20:41,539
will do eventually is make sure that our

454
00:20:36,339 --> 00:20:45,079
actual light our point distribution

455
00:20:41,539 --> 00:20:47,180
actually tries to get different

456
00:20:45,079 --> 00:20:50,619
directions on the octahedral map each

457
00:20:47,180 --> 00:20:53,029
time but that's kind of a separate issue

458
00:20:50,619 --> 00:20:55,909
so the real question we want to ask now

459
00:20:53,029 --> 00:20:58,160
is when we do this ray cast why are we

460
00:20:55,910 --> 00:21:01,190
in a situation where the things that

461
00:20:58,160 --> 00:21:03,830
come out of here are too much

462
00:21:01,190 --> 00:21:07,159
represent too much light I assume that

463
00:21:03,829 --> 00:21:09,558
if transfer PPS is set to nothing so

464
00:21:07,159 --> 00:21:12,169
we're not trying to stuff any actual

465
00:21:09,558 --> 00:21:17,388
light into this thing that it would just

466
00:21:12,169 --> 00:21:20,629
remain dark right so you know there it

467
00:21:17,388 --> 00:21:23,269
is if we were trying to transmit a low

468
00:21:20,628 --> 00:21:26,058
amount of light so you know we're gonna

469
00:21:23,269 --> 00:21:29,298
transmit some white light let's say and

470
00:21:26,058 --> 00:21:32,298
we're just using a quarter light

471
00:21:29,298 --> 00:21:34,519
transmission so you know not anything

472
00:21:32,298 --> 00:21:37,398
particularly large then I would imagine

473
00:21:34,519 --> 00:21:41,839
that we should stay at a reasonable

474
00:21:37,398 --> 00:21:45,048
value right and I guess the only thing

475
00:21:41,839 --> 00:21:47,148
I'm not sure about here is if that's the

476
00:21:45,048 --> 00:21:49,908
transfer photons per second that we're

477
00:21:47,148 --> 00:21:53,538
seeing here I'm not sure why that got so

478
00:21:49,909 --> 00:21:55,369
bright right so I am a little confused

479
00:21:53,538 --> 00:21:56,868
about what's going on here so we may

480
00:21:55,368 --> 00:21:58,488
want to dig into that a little bit first

481
00:21:56,868 --> 00:22:00,288
because I'm just just to get my head

482
00:21:58,489 --> 00:22:06,259
oriented around it again it's been a

483
00:22:00,288 --> 00:22:07,398
while so if I look at update voxel and

484
00:22:06,259 --> 00:22:11,778
we just look at how much light is

485
00:22:07,398 --> 00:22:14,209
getting thrown in there in theory right

486
00:22:11,778 --> 00:22:18,888
that should always go towards this value

487
00:22:14,210 --> 00:22:22,548
which means that at least in theory that

488
00:22:18,888 --> 00:22:24,319
this is the expected result right and my

489
00:22:22,548 --> 00:22:26,358
assumption is that the only if if that

490
00:22:24,319 --> 00:22:29,509
was actually true meaning if this is

491
00:22:26,358 --> 00:22:31,189
actually working properly right now and

492
00:22:29,509 --> 00:22:33,288
in fact I wait but I kind of know it

493
00:22:31,190 --> 00:22:34,759
isn't so look at what's happening there

494
00:22:33,288 --> 00:22:37,608
do you see how it gradually gets

495
00:22:34,759 --> 00:22:39,499
brighter like that so why is that

496
00:22:37,608 --> 00:22:42,108
happening that's just really confusing

497
00:22:39,499 --> 00:22:45,379
because if we're always blending towards

498
00:22:42,108 --> 00:22:48,558
this value always something's not right

499
00:22:45,378 --> 00:22:51,589
here because this lerp should always be

500
00:22:48,558 --> 00:22:53,960
pushing us towards this one value but

501
00:22:51,589 --> 00:22:57,738
that's not what's happening so we've got

502
00:22:53,960 --> 00:23:00,348
some issue where we're I think I think

503
00:22:57,739 --> 00:23:03,139
we must be doing something in the light

504
00:23:00,348 --> 00:23:04,548
sea itself that we shouldn't be doing so

505
00:23:03,138 --> 00:23:07,089
let's just go take a look at what's

506
00:23:04,548 --> 00:23:07,089
happening there

507
00:23:09,759 --> 00:23:21,470
so so where is this who's actually

508
00:23:16,880 --> 00:23:27,080
touching these values so for example do

509
00:23:21,470 --> 00:23:28,880
you see this here right although this

510
00:23:27,079 --> 00:23:30,319
one here this is doing an update voxel

511
00:23:28,880 --> 00:23:32,540
so what are we doing differently so this

512
00:23:30,319 --> 00:23:35,059
update voxel right is going slowly

513
00:23:32,539 --> 00:23:37,490
towards a particular value as well but

514
00:23:35,059 --> 00:23:39,589
we're not getting that word bloom so let

515
00:23:37,490 --> 00:23:41,690
me just let me just indulge me for a

516
00:23:39,589 --> 00:23:46,699
second here if we switch to our test

517
00:23:41,690 --> 00:23:53,120
case right which is this is the test

518
00:23:46,700 --> 00:23:55,100
caster and I run it here's me jumping

519
00:23:53,119 --> 00:23:57,889
around with my test caster right and it

520
00:23:55,099 --> 00:24:00,079
seems to be working okay if we're in the

521
00:23:57,890 --> 00:24:02,150
test caster and now I was to say alright

522
00:24:00,079 --> 00:24:04,730
the test caster is just gonna output a

523
00:24:02,150 --> 00:24:06,350
flat value now right so the same

524
00:24:04,730 --> 00:24:08,360
situation I was just testing in there

525
00:24:06,349 --> 00:24:10,549
right here where we go to do update

526
00:24:08,359 --> 00:24:14,949
voxel instead of actually doing any kind

527
00:24:10,549 --> 00:24:18,259
of lighting I'm just gonna do a gray

528
00:24:14,950 --> 00:24:25,039
that is a constant value what happens to

529
00:24:18,259 --> 00:24:27,740
my light okay so I thought I was doing

530
00:24:25,039 --> 00:24:31,579
exactly the same thing what happens if I

531
00:24:27,740 --> 00:24:36,380
do this lots of times it shouldn't do

532
00:24:31,579 --> 00:24:38,240
anything different and it doesn't so you

533
00:24:36,380 --> 00:24:41,570
can see that something's up like

534
00:24:38,240 --> 00:24:44,569
something about the that pass is it's

535
00:24:41,569 --> 00:24:46,250
like we're doing something different in

536
00:24:44,569 --> 00:24:49,220
that pass such that that test code is

537
00:24:46,250 --> 00:24:51,710
failing there meaning that output of

538
00:24:49,220 --> 00:24:54,529
just a straightforward value is not

539
00:24:51,710 --> 00:24:56,120
working and I'm not sure why that would

540
00:24:54,529 --> 00:25:00,289
be so you can see that we've got some

541
00:24:56,119 --> 00:25:02,750
kind of a weird bug happening here and I

542
00:25:00,289 --> 00:25:04,460
don't know what it is so when we

543
00:25:02,750 --> 00:25:07,039
actually do our full cast we're getting

544
00:25:04,460 --> 00:25:08,690
just a much brighter value but I don't

545
00:25:07,039 --> 00:25:11,109
know why and so we're gonna have to

546
00:25:08,690 --> 00:25:12,830
figure out what's happening there

547
00:25:11,109 --> 00:25:16,250
because that shouldn't be happening

548
00:25:12,829 --> 00:25:18,579
right so when we actually do the full

549
00:25:16,250 --> 00:25:18,579
cast

550
00:25:19,170 --> 00:25:35,019
um the light devalue we don't use the

551
00:25:32,410 --> 00:25:40,540
octahedral offset shouldn't really much

552
00:25:35,019 --> 00:25:43,599
matter oh but it does so here's the

553
00:25:40,539 --> 00:25:47,829
thing the fact that this is setting the

554
00:25:43,599 --> 00:25:51,419
light incoming from multiple octahedral

555
00:25:47,829 --> 00:25:55,990
offsets would produce this result

556
00:25:51,420 --> 00:25:56,980
so having 0.25 amount of light in all of

557
00:25:55,990 --> 00:26:00,069
the directions

558
00:25:56,980 --> 00:26:03,490
I guess that's and then the cosine

559
00:26:00,069 --> 00:26:06,659
fall-off summation that we had turns out

560
00:26:03,490 --> 00:26:09,539
giving you this if you have a flat

561
00:26:06,660 --> 00:26:14,259
quarter light coming in everywhere I

562
00:26:09,539 --> 00:26:18,460
guess I'm still not 100% convinced of

563
00:26:14,259 --> 00:26:21,629
that though but it seems like that's the

564
00:26:18,460 --> 00:26:21,630
only real explanation

565
00:26:28,349 --> 00:26:39,079
I don't see really any other explanation

566
00:26:31,558 --> 00:26:41,940
for it so I assume that must be right

567
00:26:39,079 --> 00:26:44,970
again kind of hard to say so I'm not

568
00:26:41,940 --> 00:26:46,169
sure what to make of it exactly but when

569
00:26:44,970 --> 00:26:48,660
you have the light coming in from all

570
00:26:46,169 --> 00:26:50,910
directions yeah it's gonna sum to

571
00:26:48,660 --> 00:26:52,350
something higher now I don't know does

572
00:26:50,910 --> 00:26:53,880
that mean my coefficients are busted

573
00:26:52,349 --> 00:26:56,279
though because it doesn't seem like that

574
00:26:53,880 --> 00:26:58,830
much light should be getting in there I

575
00:26:56,279 --> 00:27:02,308
wonder if my summation so if we look at

576
00:26:58,829 --> 00:27:04,619
that diffuse map build is you know is

577
00:27:02,308 --> 00:27:06,569
it's is that actually using incorrect

578
00:27:04,619 --> 00:27:07,829
values right and I don't know so we

579
00:27:06,569 --> 00:27:10,889
should probably look at what these

580
00:27:07,829 --> 00:27:14,099
actually are it looks like a standard

581
00:27:10,890 --> 00:27:17,030
cosine fall-off curve right and it's

582
00:27:14,099 --> 00:27:24,389
clamped so it should be something that

583
00:27:17,029 --> 00:27:32,460
for the most part is exactly what you

584
00:27:24,390 --> 00:27:34,320
would expect so let's let me just go

585
00:27:32,460 --> 00:27:36,298
into that build a few slight Maps and

586
00:27:34,319 --> 00:27:41,038
take a look at what some of these light

587
00:27:36,298 --> 00:27:43,798
maps actually are right because I just

588
00:27:41,038 --> 00:27:47,940
want to see if those values make sense

589
00:27:43,798 --> 00:27:51,658
to me because I don't I don't really

590
00:27:47,940 --> 00:27:55,460
know my intuition is I'm a little

591
00:27:51,659 --> 00:27:58,200
confused about why a cosine fall-off

592
00:27:55,460 --> 00:28:00,480
filter on our incoming light would

593
00:27:58,200 --> 00:28:04,140
produce such a bright value for a flat

594
00:28:00,480 --> 00:28:06,058
known amount getting shoved in there

595
00:28:04,140 --> 00:28:08,490
right that that's the thing that's

596
00:28:06,058 --> 00:28:10,288
that's making me confused and it's

597
00:28:08,490 --> 00:28:13,558
possible that it's correct I don't know

598
00:28:10,288 --> 00:28:15,529
that it's wrong but I just don't know

599
00:28:13,558 --> 00:28:18,450
that it's right either and so I want to

600
00:28:15,529 --> 00:28:24,389
investigate a little so if I run this

601
00:28:18,450 --> 00:28:27,150
here and and I go to the full cast so

602
00:28:24,390 --> 00:28:31,259
here's where we're doing what we're

603
00:28:27,150 --> 00:28:36,720
doing I just want to go to the solution

604
00:28:31,259 --> 00:28:38,640
itself here there we go we got tons of

605
00:28:36,720 --> 00:28:41,009
threads right now I'm gonna go to the

606
00:28:38,640 --> 00:28:42,450
solution here and I just want to look

607
00:28:41,009 --> 00:28:48,240
and see

608
00:28:42,450 --> 00:28:51,720
for the for the diffuse map itself which

609
00:28:48,240 --> 00:28:53,609
is this diffuse wait map here I just

610
00:28:51,720 --> 00:28:57,750
want to look and see what kinds of

611
00:28:53,609 --> 00:29:00,649
values are in here so here's a

612
00:28:57,750 --> 00:29:05,430
particular entry into the diffuse map

613
00:29:00,650 --> 00:29:07,410
it's zero zero right and here's like the

614
00:29:05,430 --> 00:29:25,380
examples of the values this is kind of

615
00:29:07,410 --> 00:29:27,900
hard to read isn't it so I mean I guess

616
00:29:25,380 --> 00:29:34,820
what you can see is the fault it like

617
00:29:27,900 --> 00:29:34,820
there is a lot of one values in here

618
00:29:39,950 --> 00:29:48,029
like if you just look at the fall-off

619
00:29:42,329 --> 00:29:55,529
it's like one point nine point six right

620
00:29:48,029 --> 00:29:59,509
and that's so so yeah I mean that does

621
00:29:55,529 --> 00:29:59,509
make a fair bit of sense I guess

622
00:30:06,869 --> 00:30:10,719
if we're actually looking at what the

623
00:30:09,159 --> 00:30:13,240
transmission should be I'm trying to

624
00:30:10,720 --> 00:30:14,950
think if this is wrong or right but so

625
00:30:13,240 --> 00:30:19,329
the amount of light that's bounced off

626
00:30:14,950 --> 00:30:28,600
of this thing properly summed over the

627
00:30:19,329 --> 00:30:30,928
hemisphere I mean is that actually

628
00:30:28,599 --> 00:30:30,928
correct

629
00:30:43,730 --> 00:30:50,140
I guess one way to look at it would be

630
00:30:45,920 --> 00:30:50,140
if we assume that we only had one light

631
00:30:50,440 --> 00:30:57,830
yeah so I think there is a fundamental

632
00:30:53,740 --> 00:31:03,950
misunderstanding here perhaps by me I

633
00:30:57,829 --> 00:31:07,129
think we might want to look at just let

634
00:31:03,950 --> 00:31:13,660
me just work through an example for my

635
00:31:07,130 --> 00:31:18,050
own edification I'm gonna get the

636
00:31:13,660 --> 00:31:23,410
drawing tablet here and let me just see

637
00:31:18,049 --> 00:31:23,409
because I'm not convinced that actually

638
00:31:23,769 --> 00:31:28,039
I'm not convinced that we've actually

639
00:31:26,119 --> 00:31:31,159
got this equation right for the

640
00:31:28,039 --> 00:31:32,420
transmission and I I just want to look

641
00:31:31,160 --> 00:31:33,680
because I've never looked at it quite

642
00:31:32,420 --> 00:31:36,610
this way before where we're actually

643
00:31:33,680 --> 00:31:36,610
doing as a filter

644
00:31:44,740 --> 00:31:46,799
you

645
00:31:48,480 --> 00:32:02,140
so what we've got here is if you look at

646
00:31:57,720 --> 00:32:04,150
what's coming in I want to just see what

647
00:32:02,140 --> 00:32:06,880
the example would be in the case where

648
00:32:04,150 --> 00:32:11,440
we've got a single light source that's

649
00:32:06,880 --> 00:32:14,050
getting applied to one of our diffuse

650
00:32:11,440 --> 00:32:17,980
maps right so we effectively have a

651
00:32:14,049 --> 00:32:21,279
specular map that we're computing so

652
00:32:17,980 --> 00:32:24,039
this is like the input right and then we

653
00:32:21,279 --> 00:32:25,990
have the diffuse map that we're

654
00:32:24,039 --> 00:32:30,519
outputting and this is like the output

655
00:32:25,990 --> 00:32:33,130
right and so if we have a single pixel

656
00:32:30,519 --> 00:32:35,339
light source so you know there's a

657
00:32:33,130 --> 00:32:42,190
single direction that hits this light

658
00:32:35,339 --> 00:32:45,609
right then inside the diffuse map what

659
00:32:42,190 --> 00:32:49,779
we're gonna have is this light if it's

660
00:32:45,609 --> 00:32:52,000
directly on the diffuse map here is

661
00:32:49,779 --> 00:32:56,049
gonna say well alright for any given

662
00:32:52,000 --> 00:32:57,940
pixel I'm gonna sum the hemisphere area

663
00:32:56,049 --> 00:33:05,019
in here which you know probably looks

664
00:32:57,940 --> 00:33:07,420
like something like this right and only

665
00:33:05,019 --> 00:33:10,240
one of those pixels actually has any

666
00:33:07,420 --> 00:33:12,550
data in it so even if my coefficient is

667
00:33:10,240 --> 00:33:13,990
one for that pixel well I know it's not

668
00:33:12,549 --> 00:33:16,450
gonna get any brighter so I'm just gonna

669
00:33:13,990 --> 00:33:19,500
write it in there right

670
00:33:16,450 --> 00:33:22,480
so the outgoing transmitted the outgoing

671
00:33:19,500 --> 00:33:25,269
transmittance for whichever pixel I was

672
00:33:22,480 --> 00:33:26,500
looking at which you know in this case

673
00:33:25,269 --> 00:33:29,529
would have a one-to-one correspondence

674
00:33:26,500 --> 00:33:31,480
here this one will just get Fulbright

675
00:33:29,529 --> 00:33:37,829
and this one will get like slightly less

676
00:33:31,480 --> 00:33:37,829
right right around it right

677
00:33:38,839 --> 00:33:43,129
um so in the case of a single light

678
00:33:40,730 --> 00:33:45,769
source it seems correct and I guess the

679
00:33:43,130 --> 00:33:47,240
interesting thing there is I think we

680
00:33:45,769 --> 00:33:49,009
sort of have at least a little bit of

681
00:33:47,240 --> 00:33:50,870
verification that that was true because

682
00:33:49,009 --> 00:33:53,240
in the case where we were only filling

683
00:33:50,869 --> 00:33:56,659
in one direction the filter worked just

684
00:33:53,240 --> 00:33:59,150
fine so now the question is well what if

685
00:33:56,660 --> 00:34:02,540
we actually have two so let's suppose we

686
00:33:59,150 --> 00:34:04,340
have two lights one here and one here

687
00:34:02,539 --> 00:34:07,180
and now we want to know what this would

688
00:34:04,339 --> 00:34:09,920
be it's gonna be this one plus this one

689
00:34:07,180 --> 00:34:11,659
times like 0.9 right so it's gonna be

690
00:34:09,920 --> 00:34:13,490
they're gonna be pretty close and the

691
00:34:11,659 --> 00:34:15,739
question is is that correct

692
00:34:13,489 --> 00:34:19,369
right I mean is this what we expect to

693
00:34:15,739 --> 00:34:23,089
see so what's actually happening here

694
00:34:19,369 --> 00:34:25,730
well if we have a surface and this right

695
00:34:23,090 --> 00:34:29,269
here this diffuse map is basically

696
00:34:25,730 --> 00:34:33,349
asking how much light is leaving the

697
00:34:29,269 --> 00:34:35,929
surface at this point right I'm sorry

698
00:34:33,349 --> 00:34:41,409
in this direction so if we assume that

699
00:34:35,929 --> 00:34:49,489
this here corresponds to this right oh

700
00:34:41,409 --> 00:34:53,089
wait so there's at least there's at

701
00:34:49,489 --> 00:34:56,559
least one bug here which is that we're

702
00:34:53,090 --> 00:34:56,559
not using the reflection are we

703
00:35:03,869 --> 00:35:10,450
so we're we're doing one thing wrong

704
00:35:08,349 --> 00:35:13,239
aren't we here which is that we're

705
00:35:10,449 --> 00:35:18,689
computing the transmission as if both of

706
00:35:13,239 --> 00:35:18,690
these are the same and that's not right

707
00:35:20,639 --> 00:35:28,889
so okay so interest okay okay okay okay

708
00:35:38,320 --> 00:35:47,840
so the first things first here's our

709
00:35:41,989 --> 00:35:49,849
surface normal right and if we're

710
00:35:47,840 --> 00:35:52,370
talking about producing a thing that

711
00:35:49,849 --> 00:35:55,099
says we want to be able to sample you

712
00:35:52,369 --> 00:35:56,900
know these kind of rays from whatever

713
00:35:55,099 --> 00:35:58,309
our surface normal is and then we want

714
00:35:56,900 --> 00:36:01,090
the diffuse map to tell us what

715
00:35:58,309 --> 00:36:03,889
direction things were going off in right

716
00:36:01,090 --> 00:36:06,680
then if we're talking about these

717
00:36:03,889 --> 00:36:09,019
directions it seems like we need to talk

718
00:36:06,679 --> 00:36:13,029
about the transmittance function as

719
00:36:09,019 --> 00:36:15,920
being actually doing the bounce right

720
00:36:13,030 --> 00:36:18,890
because if we were like well you know

721
00:36:15,920 --> 00:36:21,590
here's here's this direction here in

722
00:36:18,889 --> 00:36:23,329
this direction here we're actually just

723
00:36:21,590 --> 00:36:24,980
taking the inner product of these two

724
00:36:23,329 --> 00:36:26,269
but we want to actually take the inner

725
00:36:24,980 --> 00:36:28,070
product of if we're looking in this

726
00:36:26,269 --> 00:36:30,259
direction we want this thing to bounce

727
00:36:28,070 --> 00:36:34,360
out this way and we want to take the

728
00:36:30,260 --> 00:36:38,960
inner product of the reflection right so

729
00:36:34,360 --> 00:36:41,120
that's kind of a bug right but in

730
00:36:38,960 --> 00:36:44,599
addition we're also not taking into

731
00:36:41,119 --> 00:36:45,949
account the incoming cosine so the thing

732
00:36:44,599 --> 00:36:47,179
that comes in from this angle for

733
00:36:45,949 --> 00:36:51,399
example should have already been

734
00:36:47,179 --> 00:36:51,399
directionally co-signed away I believe

735
00:36:51,429 --> 00:36:58,969
and it's not being so we've got two bugs

736
00:36:55,820 --> 00:37:00,920
I think the first bug is that the

737
00:36:58,969 --> 00:37:04,819
incoming light Direction needs to get

738
00:37:00,920 --> 00:37:10,490
co-signed by whatever the incidence on

739
00:37:04,820 --> 00:37:11,510
the normal is and I guess I'm not sure

740
00:37:10,489 --> 00:37:19,699
how to do that because we don't have a

741
00:37:11,510 --> 00:37:22,150
normal in this case I mean am I wrong

742
00:37:19,699 --> 00:37:22,149
with that

743
00:37:25,318 --> 00:37:29,838
because since this is a light map I

744
00:37:30,259 --> 00:37:35,818
guess the problem is since this is a

745
00:37:32,458 --> 00:37:37,528
this is a light probe right it's a thing

746
00:37:35,818 --> 00:37:40,018
that's sitting in space that's just like

747
00:37:37,528 --> 00:37:42,539
sending out rays in different directions

748
00:37:40,018 --> 00:37:46,998
and all it knows is it saw a particular

749
00:37:42,539 --> 00:37:46,999
amount of light coming in here right so

750
00:37:48,739 --> 00:38:02,880
I guess the problem unless I'm missing

751
00:37:54,478 --> 00:38:05,518
something is how would you compute the

752
00:38:02,880 --> 00:38:07,680
hemisphere oh but that's okay because

753
00:38:05,518 --> 00:38:10,078
you're doing it now you're trying to

754
00:38:07,679 --> 00:38:11,818
compute as if you had a hemisphere for

755
00:38:10,079 --> 00:38:15,660
the normal so you do know what the

756
00:38:11,818 --> 00:38:17,278
normal is you do know what the normal is

757
00:38:15,659 --> 00:38:18,719
and so what you're doing is you're

758
00:38:17,278 --> 00:38:22,170
taking the inner product of each of

759
00:38:18,719 --> 00:38:24,449
these right and saying we're gonna

760
00:38:22,170 --> 00:38:29,190
assume that this much light bounces out

761
00:38:24,449 --> 00:38:34,440
along the normal to the surface based on

762
00:38:29,190 --> 00:38:38,130
the incoming here that seems right right

763
00:38:34,440 --> 00:38:41,159
am I totally wrong on that I'm not sure

764
00:38:38,130 --> 00:38:42,539
but right think about that for a second

765
00:38:41,159 --> 00:38:44,759
so what we're actually doing is

766
00:38:42,539 --> 00:38:46,380
pretending we have a surface and we're

767
00:38:44,759 --> 00:38:48,659
saying let's suppose we have a surface

768
00:38:46,380 --> 00:38:52,140
that was passing through and this was

769
00:38:48,659 --> 00:38:54,929
the normal and all of this stuff right

770
00:38:52,139 --> 00:38:56,670
so all of this stuff is now not

771
00:38:54,929 --> 00:38:58,558
considered and that's correct because

772
00:38:56,670 --> 00:39:00,989
that would happen with this inner

773
00:38:58,559 --> 00:39:02,579
product and all of the stuff in here is

774
00:39:00,989 --> 00:39:04,559
considered and it's gonna be considered

775
00:39:02,579 --> 00:39:09,289
based on how much light would bounce out

776
00:39:04,559 --> 00:39:12,509
in this direction and that I guess is

777
00:39:09,289 --> 00:39:15,269
the incoming light it bounces out here

778
00:39:12,509 --> 00:39:17,818
and then presumably that's just the

779
00:39:15,268 --> 00:39:20,278
inner product of these two for Lamberson

780
00:39:17,818 --> 00:39:22,588
anyway which is what we're doing so I

781
00:39:20,278 --> 00:39:25,978
guess this is so I'm I'm recently

782
00:39:22,588 --> 00:39:27,719
comfortable with that right and I guess

783
00:39:25,978 --> 00:39:29,548
we would just say well if all of this

784
00:39:27,719 --> 00:39:31,349
light actually wasn't coming in from all

785
00:39:29,548 --> 00:39:36,440
of these directions it would actually be

786
00:39:31,349 --> 00:39:38,880
fairly bright probably I would assume

787
00:39:36,440 --> 00:39:40,380
but that actually does look correct I

788
00:39:38,880 --> 00:39:43,079
mean that that looks like what it should

789
00:39:40,380 --> 00:39:45,000
be I'm not sure that there's I'm not

790
00:39:43,079 --> 00:39:50,840
seeing anything weird about that right

791
00:39:45,000 --> 00:39:50,840
it looks pretty good or does it

792
00:40:09,409 --> 00:40:13,639
I'm gonna go with ya I mean I don't see

793
00:40:11,809 --> 00:40:20,599
anything particularly weird there that

794
00:40:13,639 --> 00:40:25,190
looks pretty much right to me so I don't

795
00:40:20,599 --> 00:40:28,940
see a lot of error with that and then

796
00:40:25,190 --> 00:40:31,099
when we're actually doing our lighting

797
00:40:28,940 --> 00:40:37,099
sampling I guess that is one thing I'm

798
00:40:31,099 --> 00:40:38,779
not sure about here let me just take a

799
00:40:37,099 --> 00:40:41,089
look at that see bathroom I don't really

800
00:40:38,780 --> 00:40:43,340
remember exactly how we process the

801
00:40:41,090 --> 00:40:46,280
light once we sampled it so you can see

802
00:40:43,340 --> 00:40:51,500
here where we were doing like our Texel

803
00:40:46,280 --> 00:40:52,700
fetches and we you know combine them we

804
00:40:51,500 --> 00:40:55,699
have a couple din ways we tried

805
00:40:52,699 --> 00:40:57,649
combining them but either way you know

806
00:40:55,699 --> 00:41:01,189
we're doing a fetch and we're combining

807
00:40:57,650 --> 00:41:07,760
our light sources and once we actually

808
00:41:01,190 --> 00:41:12,740
get that value back I guess what I would

809
00:41:07,760 --> 00:41:15,230
say is you know you look at the sample

810
00:41:12,739 --> 00:41:17,239
lighting here we're pulling out things

811
00:41:15,230 --> 00:41:20,269
from the octahedral map so you can see

812
00:41:17,239 --> 00:41:25,909
us doing that here we blend them

813
00:41:20,269 --> 00:41:29,090
together and I guess once we get that

814
00:41:25,909 --> 00:41:31,879
sort of back we're not accounting for

815
00:41:29,090 --> 00:41:35,630
the bounce off of this surface so I do

816
00:41:31,880 --> 00:41:37,789
think we're missing a cosine term here I

817
00:41:35,630 --> 00:41:40,309
could be wrong about that but if you

818
00:41:37,789 --> 00:41:43,670
think about what's going on in this

819
00:41:40,309 --> 00:41:49,849
sampling we just have a thing that's

820
00:41:43,670 --> 00:41:53,030
like how much light is would be leaving

821
00:41:49,849 --> 00:41:54,819
in the direction of this you know in

822
00:41:53,030 --> 00:41:58,850
this probe in this particular direction

823
00:41:54,820 --> 00:42:02,150
right or I shouldn't say how much is

824
00:41:58,849 --> 00:42:06,019
leaving this is how much is incident on

825
00:42:02,150 --> 00:42:09,619
this hemisphere right with this

826
00:42:06,019 --> 00:42:11,949
particular normal and so if we want to

827
00:42:09,619 --> 00:42:17,569
know how much light bounces off of that

828
00:42:11,949 --> 00:42:21,039
we would have to actually take into

829
00:42:17,570 --> 00:42:25,860
account the direction we're looking

830
00:42:21,039 --> 00:42:25,860
we'd have to actually modulate it by I

831
00:42:29,190 --> 00:42:37,840
mean like yeah I don't know we'd have to

832
00:42:36,250 --> 00:42:42,460
actually Mott we'd have to modulate it

833
00:42:37,840 --> 00:42:46,539
right by by the cosine of that angle I

834
00:42:42,460 --> 00:42:48,039
would think this is really tricky and

835
00:42:46,539 --> 00:42:49,960
the reason is because it's hard for me

836
00:42:48,039 --> 00:42:56,710
to really wrap my head around what it is

837
00:42:49,960 --> 00:42:57,550
we're storing in this map right so maybe

838
00:42:56,710 --> 00:43:03,340
I have to work through the entire

839
00:42:57,550 --> 00:43:06,760
sampling so let's see what would we do

840
00:43:03,340 --> 00:43:09,880
if let's suppose we've got an actual

841
00:43:06,760 --> 00:43:14,020
surface we're trying to sample so I have

842
00:43:09,880 --> 00:43:15,849
a surface here's the normal I'm looking

843
00:43:14,019 --> 00:43:21,909
in this direction right so here's my eye

844
00:43:15,849 --> 00:43:24,429
oh I should say eyes because yeah I mean

845
00:43:21,909 --> 00:43:26,440
I've got two eyes so the eyes are

846
00:43:24,429 --> 00:43:28,839
looking in this direction and then so we

847
00:43:26,440 --> 00:43:30,159
want to know right we're trying to

848
00:43:28,840 --> 00:43:32,380
produce like a lobe

849
00:43:30,159 --> 00:43:35,980
so most lighting right would look like

850
00:43:32,380 --> 00:43:39,970
something like this or something like

851
00:43:35,980 --> 00:43:41,199
that right so we're producing a fair

852
00:43:39,969 --> 00:43:42,639
amount of light coming from this

853
00:43:41,199 --> 00:43:45,189
direction and less from other directions

854
00:43:42,639 --> 00:43:46,420
and so on and so forth right so we're

855
00:43:45,190 --> 00:43:49,750
trying to figure out what the light is

856
00:43:46,420 --> 00:43:52,240
in this direction and so we go to our

857
00:43:49,750 --> 00:43:55,869
light probe and we say oh hello mr.

858
00:43:52,239 --> 00:43:59,649
probe right tell me what that same

859
00:43:55,869 --> 00:44:01,420
direction is for you and we're gonna use

860
00:43:59,650 --> 00:44:05,470
that value and pretend that that's how

861
00:44:01,420 --> 00:44:07,630
much light is coming in here right but

862
00:44:05,469 --> 00:44:09,159
if that's how much light but we have a

863
00:44:07,630 --> 00:44:10,210
couple different things right that's how

864
00:44:09,159 --> 00:44:12,190
much light is coming in this direction

865
00:44:10,210 --> 00:44:14,289
but we also want to know all of these

866
00:44:12,190 --> 00:44:16,269
other directions right so the specular

867
00:44:14,289 --> 00:44:18,250
probe would have told us that but we

868
00:44:16,269 --> 00:44:21,880
want kind of a summation of cosine

869
00:44:18,250 --> 00:44:25,119
curves around this guy for you know the

870
00:44:21,880 --> 00:44:27,119
Hemisphere as well I guess sampling you

871
00:44:25,119 --> 00:44:29,619
know if we were to sample the specular

872
00:44:27,119 --> 00:44:31,719
map a bunch of times with cosine

873
00:44:29,619 --> 00:44:33,130
fall-off that's what we would get but

874
00:44:31,719 --> 00:44:34,719
what we're trying to do here I guess is

875
00:44:33,130 --> 00:44:39,130
approximate what happens

876
00:44:34,719 --> 00:44:40,480
with this equation and so for diffuse

877
00:44:39,130 --> 00:44:43,240
lighting I guess what we're trying to

878
00:44:40,480 --> 00:44:45,699
say is well what's the average outgoing

879
00:44:43,239 --> 00:44:46,989
so we are actually trying to roll that

880
00:44:45,699 --> 00:44:49,989
into our precalc

881
00:44:46,989 --> 00:44:53,459
right so that would mean we actually

882
00:44:49,989 --> 00:44:59,679
want to roll in how much bounce is out

883
00:44:53,460 --> 00:45:01,720
in a particular direction for or how

884
00:44:59,679 --> 00:45:05,589
much is generally radiated out from the

885
00:45:01,719 --> 00:45:09,509
surface and that radiates that radiative

886
00:45:05,590 --> 00:45:13,090
transfer there is going to be based on

887
00:45:09,510 --> 00:45:18,220
the actual reflection amount for each of

888
00:45:13,090 --> 00:45:19,450
the incomings right so once we have that

889
00:45:18,219 --> 00:45:22,118
and we want to sample that from

890
00:45:19,449 --> 00:45:24,969
somewhere I mean it is generally true

891
00:45:22,119 --> 00:45:27,280
that it should it should less should

892
00:45:24,969 --> 00:45:29,949
exit depending on where if you're

893
00:45:27,280 --> 00:45:39,010
looking flat at it you should get more

894
00:45:29,949 --> 00:45:40,539
right is that actually true I mean not

895
00:45:39,010 --> 00:45:42,099
really because if you assume that it's

896
00:45:40,539 --> 00:45:44,259
radiating light evenly in all directions

897
00:45:42,099 --> 00:45:46,180
then it's only the initial bounce that

898
00:45:44,260 --> 00:45:47,260
takes the little bit of light away and

899
00:45:46,179 --> 00:45:50,250
then it's just scattering in all

900
00:45:47,260 --> 00:45:50,250
directions that's the point

901
00:45:53,039 --> 00:45:58,539
but I also guess that in this case you

902
00:45:56,440 --> 00:46:10,690
would say well as the light comes out at

903
00:45:58,539 --> 00:46:13,469
you you would be losing some where's Don

904
00:46:10,690 --> 00:46:13,470
Mitchell when you need him

905
00:46:16,170 --> 00:46:20,680
probably researching a space program

906
00:46:18,190 --> 00:46:22,809
that's usually what he's doing so yeah

907
00:46:20,679 --> 00:46:24,969
I'm just not sure I'm not sure about

908
00:46:22,809 --> 00:46:27,579
this this is one of those things that I

909
00:46:24,969 --> 00:46:30,549
find really difficult I wish I was

910
00:46:27,579 --> 00:46:31,809
better with lighting equations because I

911
00:46:30,550 --> 00:46:34,390
think what we would need to do here is

912
00:46:31,809 --> 00:46:36,039
actually write out the equation for what

913
00:46:34,389 --> 00:46:38,170
we would be doing if we were actually

914
00:46:36,039 --> 00:46:40,570
sampling the entire thing correctly and

915
00:46:38,170 --> 00:46:42,338
then we need to see how we make our

916
00:46:40,570 --> 00:46:43,970
diffuse map as close as possible to what

917
00:46:42,338 --> 00:46:47,570
that would actually be

918
00:46:43,969 --> 00:46:48,858
right and I'm just not sure I'm just not

919
00:46:47,570 --> 00:46:51,920
sure what those coefficients should be

920
00:46:48,858 --> 00:46:54,319
like in this in this particular piece of

921
00:46:51,920 --> 00:46:57,019
code here right I just don't really know

922
00:46:54,320 --> 00:46:58,340
like this is taking out that initial

923
00:46:57,019 --> 00:47:00,590
amount the bounce

924
00:46:58,340 --> 00:47:08,630
so the bounce footprint the fit this

925
00:47:00,590 --> 00:47:10,460
part so the size of the actual like

926
00:47:08,630 --> 00:47:13,099
micro surface off of which the light

927
00:47:10,460 --> 00:47:17,000
bounces that's that initial cosine term

928
00:47:13,099 --> 00:47:21,559
so that's like that's the cosine of the

929
00:47:17,000 --> 00:47:23,840
angle here but I don't know if there's

930
00:47:21,559 --> 00:47:25,670
an end we're summing all of those up so

931
00:47:23,840 --> 00:47:27,710
we're taking into account for each

932
00:47:25,670 --> 00:47:29,930
incoming light direction we're taking

933
00:47:27,710 --> 00:47:31,670
into account the footprint the micro

934
00:47:29,929 --> 00:47:33,649
surfers footprint that it bounces off of

935
00:47:31,670 --> 00:47:36,139
but what I'm just not sure of is then

936
00:47:33,650 --> 00:47:38,930
when we go to sample it do with an with

937
00:47:36,139 --> 00:47:40,789
an actual surface do we actually need to

938
00:47:38,929 --> 00:47:47,960
take into account anything about that

939
00:47:40,789 --> 00:47:49,789
angle and I just don't know because it's

940
00:47:47,960 --> 00:47:50,990
not really doing the right thing I mean

941
00:47:49,789 --> 00:47:56,269
I'm not sure how to state this in

942
00:47:50,989 --> 00:47:59,299
another way but we're taking a map that

943
00:47:56,269 --> 00:48:01,338
was computed by taking a summation of

944
00:47:59,300 --> 00:48:04,010
the incoming light source with the

945
00:48:01,338 --> 00:48:06,739
cosine footprint for some direction and

946
00:48:04,010 --> 00:48:09,470
then we've got a surface normal like

947
00:48:06,739 --> 00:48:11,479
this that then bounces light and we're

948
00:48:09,469 --> 00:48:16,669
then saying well okay

949
00:48:11,480 --> 00:48:18,889
actually should do this exactly right so

950
00:48:16,670 --> 00:48:20,059
we're taking then a view direction and

951
00:48:18,889 --> 00:48:21,710
we're bouncing like we're saying okay

952
00:48:20,059 --> 00:48:23,750
this direction and this direction are

953
00:48:21,710 --> 00:48:25,220
the same or they're close to the same

954
00:48:23,750 --> 00:48:26,869
because it's octahedral map so it's not

955
00:48:25,219 --> 00:48:30,379
gonna be exact but we're interpolating

956
00:48:26,869 --> 00:48:33,070
to get it and so we're gonna take all of

957
00:48:30,380 --> 00:48:36,230
what that incident light was here and

958
00:48:33,070 --> 00:48:43,789
assume that that is what you would be

959
00:48:36,230 --> 00:48:48,400
getting right it's assuming that that's

960
00:48:43,789 --> 00:48:48,400
what light was coming in here

961
00:48:54,659 --> 00:49:00,839
and that's not correct oh oh

962
00:49:01,619 --> 00:49:06,639
so but the only reason it's not correct

963
00:49:04,869 --> 00:49:09,190
is because we're using this direction

964
00:49:06,639 --> 00:49:11,799
and not this if we were actually using

965
00:49:09,190 --> 00:49:18,869
this it would be correct for a Lamberson

966
00:49:11,800 --> 00:49:18,870
surface so actually actually he says

967
00:49:19,769 --> 00:49:33,340
maybe all we really needed to do was say

968
00:49:25,659 --> 00:49:39,190
this part here actually should just be

969
00:49:33,340 --> 00:49:48,820
the normal so like the r-value here

970
00:49:39,190 --> 00:49:52,000
should actually just be this right so

971
00:49:48,820 --> 00:49:55,059
that is what we get for diffuse lighting

972
00:49:52,000 --> 00:49:57,820
which is what we were sampling from a

973
00:49:55,059 --> 00:50:02,190
diffuse map it actually should be that

974
00:49:57,820 --> 00:50:04,720
meaning it should look at the normal not

975
00:50:02,190 --> 00:50:06,670
the reflection vector because the

976
00:50:04,719 --> 00:50:10,959
reflection vector is not what the

977
00:50:06,670 --> 00:50:16,990
diffuse map actually captures right the

978
00:50:10,960 --> 00:50:24,789
specular map captures that let me go

979
00:50:16,989 --> 00:50:27,159
ahead and change back here so that would

980
00:50:24,789 --> 00:50:29,889
also mean you know let me go ahead and

981
00:50:27,159 --> 00:50:34,750
let me just run the test sphere or the

982
00:50:29,889 --> 00:50:36,730
test cast through here there we go so

983
00:50:34,750 --> 00:50:38,980
that would also explain where we're

984
00:50:36,730 --> 00:50:40,510
getting sort of some weird lookups in

985
00:50:38,980 --> 00:50:44,079
there I should run the tester actually

986
00:50:40,510 --> 00:50:46,500
too so if we actually look at what's

987
00:50:44,079 --> 00:50:49,139
happening where's my

988
00:50:46,500 --> 00:50:55,940
test cast that looks like the test cast

989
00:50:49,139 --> 00:50:55,940
is still doing this nonsense there we go

990
00:51:00,630 --> 00:51:11,430
so that should be more correct in terms

991
00:51:06,030 --> 00:51:12,869
of diffuse lighting right and and let's

992
00:51:11,429 --> 00:51:13,828
let's actually try the tester because

993
00:51:12,869 --> 00:51:15,838
that's the one that actually has the

994
00:51:13,829 --> 00:51:19,109
directionality to it so the test cast is

995
00:51:15,838 --> 00:51:27,199
not really correct for this test we want

996
00:51:19,108 --> 00:51:32,279
we want this there we go

997
00:51:27,199 --> 00:51:37,769
and that's that's what we would expect

998
00:51:32,280 --> 00:51:41,369
now so I think that's right and that's

999
00:51:37,769 --> 00:51:44,309
all good unfortunately this gives us

1000
00:51:41,369 --> 00:51:46,349
really no insight into our other problem

1001
00:51:44,309 --> 00:51:48,989
now it's worth noting that we should

1002
00:51:46,349 --> 00:51:51,539
send down both maps right like we should

1003
00:51:48,989 --> 00:51:55,889
send down the other map as well because

1004
00:51:51,539 --> 00:51:58,338
the other map is it would be good for

1005
00:51:55,889 --> 00:52:01,679
specular sampling so we could add some

1006
00:51:58,338 --> 00:52:04,259
reflection in there which we probably

1007
00:52:01,679 --> 00:52:05,730
want to do at some point but now you can

1008
00:52:04,260 --> 00:52:07,950
kind of see if we're just sampling based

1009
00:52:05,730 --> 00:52:09,809
on the normal now it removes that

1010
00:52:07,949 --> 00:52:12,000
directionality which is what we would

1011
00:52:09,809 --> 00:52:13,409
expect so I'm not that's why I was like

1012
00:52:12,000 --> 00:52:15,929
uncomfortable that before it's like yeah

1013
00:52:13,409 --> 00:52:18,029
duh like if you're trying to sample a

1014
00:52:15,929 --> 00:52:19,889
diffuse map you can't use a reflection

1015
00:52:18,030 --> 00:52:21,630
vector because how you couldn't possibly

1016
00:52:19,889 --> 00:52:22,858
have computed what that should be into a

1017
00:52:21,630 --> 00:52:24,329
diffuse map because you would have need

1018
00:52:22,858 --> 00:52:27,358
to known the normal of the surface first

1019
00:52:24,329 --> 00:52:29,519
which we wouldn't have known so since we

1020
00:52:27,358 --> 00:52:30,960
know now it's like oh right we're trying

1021
00:52:29,519 --> 00:52:34,949
ample diffuse so you sampled by the

1022
00:52:30,960 --> 00:52:36,630
normal that all seems reasonable okay

1023
00:52:34,949 --> 00:52:38,789
unfortunately that doesn't really give

1024
00:52:36,630 --> 00:52:40,349
us much information about what I was

1025
00:52:38,789 --> 00:52:42,719
actually wondering which is is the other

1026
00:52:40,349 --> 00:52:45,930
thing correct where our transfer PB s

1027
00:52:42,719 --> 00:52:47,818
here right and again it sort of seems

1028
00:52:45,929 --> 00:52:49,230
like it must be I don't know like I'm

1029
00:52:47,818 --> 00:52:51,210
still a little nervous about it but I

1030
00:52:49,230 --> 00:52:52,858
guess it just means if you have that

1031
00:52:51,210 --> 00:52:54,659
much actual incoming light in your

1032
00:52:52,858 --> 00:52:56,279
environment you're okay I don't know if

1033
00:52:54,659 --> 00:52:58,559
that's really true I feel like it

1034
00:52:56,280 --> 00:53:00,000
probably means that there's like maybe

1035
00:52:58,559 --> 00:53:02,460
the fact that

1036
00:53:00,000 --> 00:53:04,980
it might be a light fall-off issue you

1037
00:53:02,460 --> 00:53:07,559
know would be the other possibility so

1038
00:53:04,980 --> 00:53:10,530
one of the things I guess I'm not sure

1039
00:53:07,559 --> 00:53:14,519
about is where does fall-off come in to

1040
00:53:10,530 --> 00:53:17,820
this right and so when we're looking at

1041
00:53:14,519 --> 00:53:22,050
surface-to-surface transmission the

1042
00:53:17,820 --> 00:53:25,950
raycasting itself kind of does fall off

1043
00:53:22,050 --> 00:53:28,260
in a sense because if you're looking at

1044
00:53:25,949 --> 00:53:30,989
how many rays could possibly hit like a

1045
00:53:28,260 --> 00:53:34,500
light source that is accounted for in

1046
00:53:30,989 --> 00:53:37,250
the Ray casting so it may be that

1047
00:53:34,500 --> 00:53:41,190
actually this is what you would expect

1048
00:53:37,250 --> 00:53:43,380
right I'm just not sure and so one thing

1049
00:53:41,190 --> 00:53:44,700
I let me just make sure I mean let me do

1050
00:53:43,380 --> 00:53:48,090
a couple of tests to make sure that it's

1051
00:53:44,699 --> 00:53:49,439
even plausibly right what if I I should

1052
00:53:48,090 --> 00:53:52,400
be able to reduce this number down to

1053
00:53:49,440 --> 00:53:59,150
something that doesn't get super bright

1054
00:53:52,400 --> 00:53:59,150
right and and that is so

1055
00:54:05,059 --> 00:54:15,389
so you know I don't know I don't know

1056
00:54:09,929 --> 00:54:19,190
what to make of that I'm also not sure I

1057
00:54:15,389 --> 00:54:21,389
understand why this is still showing

1058
00:54:19,190 --> 00:54:28,050
some reasonable amount of lighting and

1059
00:54:21,389 --> 00:54:30,000
yet everything in our world is dark so

1060
00:54:28,050 --> 00:54:42,269
that that seems a little wrong doesn't

1061
00:54:30,000 --> 00:54:43,889
it I mean wouldn't you say oh no you

1062
00:54:42,269 --> 00:54:46,170
know what that is because we clamp our

1063
00:54:43,889 --> 00:54:50,579
lighting down to get better an edge

1064
00:54:46,170 --> 00:54:53,400
interpolation so that's all right so I

1065
00:54:50,579 --> 00:54:58,710
guess I'm gonna go with that seems okay

1066
00:54:53,400 --> 00:55:02,760
honestly so let's let's assume that

1067
00:54:58,710 --> 00:55:06,269
that's not an error and let's try to get

1068
00:55:02,760 --> 00:55:08,250
this thing working so if we get rid of

1069
00:55:06,269 --> 00:55:10,380
this then I'm assuming our immediate

1070
00:55:08,250 --> 00:55:13,380
problem is just that our transfer PPS is

1071
00:55:10,380 --> 00:55:16,230
code is kind of garbage and you know we

1072
00:55:13,380 --> 00:55:20,099
end up in a in a ridiculous like we're

1073
00:55:16,230 --> 00:55:21,840
pumping way too much light into there we

1074
00:55:20,099 --> 00:55:23,819
know we turned off the moon color so in

1075
00:55:21,840 --> 00:55:25,170
theory we should not so there's the moon

1076
00:55:23,820 --> 00:55:27,510
color right we know in theory we

1077
00:55:25,170 --> 00:55:29,070
shouldn't be pushing any in here so

1078
00:55:27,510 --> 00:55:32,520
basically what we're looking at here is

1079
00:55:29,070 --> 00:55:35,250
this path through the code now at least

1080
00:55:32,519 --> 00:55:37,500
in theory when we look at what's getting

1081
00:55:35,250 --> 00:55:40,889
summed here so you look at the the

1082
00:55:37,500 --> 00:55:43,860
transfer PPS that transfer PPS is is

1083
00:55:40,889 --> 00:55:47,129
getting done in here so in theory anyway

1084
00:55:43,860 --> 00:55:48,960
if we just got rid of this I don't know

1085
00:55:47,130 --> 00:55:50,789
what this light fall-off is there for

1086
00:55:48,960 --> 00:55:55,260
probably old school code where we were

1087
00:55:50,789 --> 00:55:57,179
actually passing that into the voxel if

1088
00:55:55,260 --> 00:55:58,380
we just get rid of this we should get no

1089
00:55:57,179 --> 00:56:00,539
lighting right I mean in other words

1090
00:55:58,380 --> 00:56:01,769
we're initializing the value to zero so

1091
00:56:00,539 --> 00:56:03,570
we should get no lighting in the case

1092
00:56:01,769 --> 00:56:05,099
where we nerf that because all of the

1093
00:56:03,570 --> 00:56:08,039
lighting should be coming from this path

1094
00:56:05,099 --> 00:56:10,259
right and if we take a look at the moon

1095
00:56:08,039 --> 00:56:12,360
color thing and I turn that back on well

1096
00:56:10,260 --> 00:56:14,910
this would probably be too bright at

1097
00:56:12,360 --> 00:56:16,620
this point but if I turn back on the

1098
00:56:14,909 --> 00:56:17,318
moon color we should be able to like get

1099
00:56:16,619 --> 00:56:20,348
the moon color

1100
00:56:17,318 --> 00:56:22,838
filter it back in there at a reasonable

1101
00:56:20,349 --> 00:56:25,690
rate right so here's the moon color

1102
00:56:22,838 --> 00:56:27,338
right and let's take a look at what's

1103
00:56:25,690 --> 00:56:29,108
going on with that so it currently looks

1104
00:56:27,338 --> 00:56:31,088
busted like it looks like it's writing

1105
00:56:29,108 --> 00:56:32,558
to the wrong location or something I

1106
00:56:31,088 --> 00:56:34,869
mean you know what I'm saying

1107
00:56:32,559 --> 00:56:36,548
so maybe let's just start with the moon

1108
00:56:34,869 --> 00:56:37,869
color and figure out because that's just

1109
00:56:36,548 --> 00:56:41,949
coming from a direction that's not

1110
00:56:37,869 --> 00:56:46,599
getting sampled so let's try to pull

1111
00:56:41,949 --> 00:56:48,130
that together better if I go over here

1112
00:56:46,599 --> 00:56:50,229
and look at what's happening with the

1113
00:56:48,130 --> 00:56:51,818
moon color we have a moon P which is

1114
00:56:50,228 --> 00:56:53,739
basically saying where is the moon and

1115
00:56:51,818 --> 00:56:55,748
in this case you know the moon is it

1116
00:56:53,739 --> 00:56:59,978
looks like just straight above us just Z

1117
00:56:55,748 --> 00:57:02,828
up directly Z up right and so if we take

1118
00:56:59,978 --> 00:57:05,978
a look here what's going on we expect to

1119
00:57:02,829 --> 00:57:09,609
see our get octahedral offset of the

1120
00:57:05,978 --> 00:57:12,308
negative emission direction so the

1121
00:57:09,608 --> 00:57:15,248
emission direction here is this this is

1122
00:57:12,309 --> 00:57:18,819
the look up here so that's saying all

1123
00:57:15,248 --> 00:57:20,889
right here's the REA direction and it's

1124
00:57:18,818 --> 00:57:23,139
I guess it wants to say what's coming

1125
00:57:20,889 --> 00:57:26,018
back from so I hit a point I want to

1126
00:57:23,139 --> 00:57:27,578
know what the emission is for the light

1127
00:57:26,018 --> 00:57:29,078
probe in that area so that makes sense

1128
00:57:27,579 --> 00:57:31,239
and then we're saying well we want to

1129
00:57:29,079 --> 00:57:34,499
know what the negative of that was right

1130
00:57:31,239 --> 00:57:38,079
because we need the negative of that to

1131
00:57:34,498 --> 00:57:39,939
figure out where we're gonna put the the

1132
00:57:38,079 --> 00:57:43,449
light that we see in this direction

1133
00:57:39,940 --> 00:57:46,269
right because we're saying that's the

1134
00:57:43,449 --> 00:57:48,369
the way we were looking so that seems

1135
00:57:46,268 --> 00:57:55,748
correct right I may not see anything

1136
00:57:48,369 --> 00:57:57,249
weird about that and I guess what I

1137
00:57:55,748 --> 00:57:59,978
would say is this equation just kind of

1138
00:57:57,248 --> 00:58:03,218
looks wrong to me the emission direction

1139
00:57:59,978 --> 00:58:04,808
here this this is the look direction so

1140
00:58:03,219 --> 00:58:06,699
the emission direction I think this

1141
00:58:04,809 --> 00:58:10,420
needed to get negated first of all

1142
00:58:06,699 --> 00:58:14,108
because we're actually doing a dot with

1143
00:58:10,420 --> 00:58:15,789
the moon and we say moon direction we

1144
00:58:14,108 --> 00:58:18,518
actually have one so I think this code

1145
00:58:15,789 --> 00:58:20,049
is just kind of busted yeah that's more

1146
00:58:18,518 --> 00:58:21,968
what we would expect this code is kind

1147
00:58:20,048 --> 00:58:24,309
of busted and wants to look at what the

1148
00:58:21,969 --> 00:58:26,858
direction to the moon would be I would

1149
00:58:24,309 --> 00:58:29,229
think so we probably want to do is

1150
00:58:26,858 --> 00:58:30,608
something more like this I would say

1151
00:58:29,228 --> 00:58:32,679
like the moon

1152
00:58:30,608 --> 00:58:35,889
should have a moon direction it's a

1153
00:58:32,679 --> 00:58:37,808
directional light source right so I

1154
00:58:35,889 --> 00:58:39,818
would say we probably want to take some

1155
00:58:37,809 --> 00:58:41,859
direction whatever that is and maybe

1156
00:58:39,818 --> 00:58:44,440
that direction is you know something

1157
00:58:41,858 --> 00:58:46,389
like a little bit of an

1158
00:58:44,440 --> 00:58:47,798
over-the-shoulder kind of a feel so

1159
00:58:46,389 --> 00:58:51,278
let's say that it would be something

1160
00:58:47,798 --> 00:58:56,949
like that

1161
00:58:51,278 --> 00:58:58,960
maybe I don't know something like this

1162
00:58:56,949 --> 00:59:00,639
and then what we would want to do is say

1163
00:58:58,960 --> 00:59:02,679
well we know the moon direction and we

1164
00:59:00,639 --> 00:59:06,879
know what direction we were looking

1165
00:59:02,679 --> 00:59:09,278
right so what we'd like to do is take

1166
00:59:06,880 --> 00:59:12,880
the inner product of those two so we've

1167
00:59:09,278 --> 00:59:17,349
got moon direction and emission

1168
00:59:12,880 --> 00:59:19,358
direction and again we don't want the

1169
00:59:17,349 --> 00:59:20,380
emission direction we want the negative

1170
00:59:19,358 --> 00:59:24,670
of that because this direction we're

1171
00:59:20,380 --> 00:59:27,160
looking times the moon color get rid of

1172
00:59:24,670 --> 00:59:35,440
that to do and that would give us a more

1173
00:59:27,159 --> 00:59:42,929
proper use of the moon I think oops all

1174
00:59:35,440 --> 00:59:45,249
right probe sample P equals moon P Oh

1175
00:59:42,929 --> 00:59:48,308
interesting so that's how we were doing

1176
00:59:45,248 --> 00:59:52,929
that before that makes sense so probe

1177
00:59:48,309 --> 00:59:55,048
sample P is done with what that's not

1178
00:59:52,929 --> 00:59:58,268
even a thing that we get but we use here

1179
00:59:55,048 --> 01:00:03,630
so that's that should just be in here

1180
00:59:58,268 --> 01:00:03,629
it's like right

1181
01:00:06,449 --> 01:00:13,559
I get rid of these for now cuz I don't

1182
01:00:11,400 --> 01:00:15,150
really know what I'm gonna I can put in

1183
01:00:13,559 --> 01:00:18,559
my looks fishy tests if I'm trying to

1184
01:00:15,150 --> 01:00:18,559
look for something fishy again later but

1185
01:00:21,199 --> 01:00:27,029
so I'm not sure why this is so slow but

1186
01:00:24,869 --> 01:00:31,710
I assume it's just because we're still

1187
01:00:27,030 --> 01:00:33,420
running the raycasting right which I

1188
01:00:31,710 --> 01:00:35,490
said is expensive and then we're also

1189
01:00:33,420 --> 01:00:37,588
doing the diffuse so that seems right so

1190
01:00:35,489 --> 01:00:39,750
now if I say all right how bright is the

1191
01:00:37,588 --> 01:00:41,250
moonlight and the moonlight is like that

1192
01:00:39,750 --> 01:00:44,599
I don't know why it was times three

1193
01:00:41,250 --> 01:00:54,659
probably cuz we had dimmer lights before

1194
01:00:44,599 --> 01:00:56,099
just see what we get here so we'll just

1195
01:00:54,659 --> 01:01:05,098
put that right at around the ambient

1196
01:00:56,099 --> 01:01:06,570
floor and that seems reasonable right I

1197
01:01:05,099 --> 01:01:10,490
mean I don't know if we'd actually want

1198
01:01:06,570 --> 01:01:10,490
the moonlight to be that bright but

1199
01:01:11,030 --> 01:01:14,569
seems reasonable

1200
01:01:22,039 --> 01:01:33,329
so maybe a little darker and so that's

1201
01:01:31,559 --> 01:01:35,608
good that just means our lighting is at

1202
01:01:33,329 --> 01:01:37,650
least somewhat stable there so we can

1203
01:01:35,608 --> 01:01:40,848
pump and ambient into it and it's okay

1204
01:01:37,650 --> 01:01:43,200
now I'm not sure why we're getting like

1205
01:01:40,849 --> 01:01:46,109
that's a little weird right so there's a

1206
01:01:43,199 --> 01:01:50,819
little bit of a weird darkening that's

1207
01:01:46,108 --> 01:01:56,219
happening here and oh I know why it's

1208
01:01:50,820 --> 01:01:58,200
hitting the light source interesting and

1209
01:01:56,219 --> 01:01:59,279
we can see a little bit of flicker so we

1210
01:01:58,199 --> 01:02:02,279
know we're actually sampling the

1211
01:01:59,280 --> 01:02:06,869
moonlight so yeah all right you know

1212
01:02:02,280 --> 01:02:08,790
looks okay and so now let's see if we

1213
01:02:06,869 --> 01:02:10,890
can actually start to push some actual

1214
01:02:08,789 --> 01:02:12,809
lights through this so here's us getting

1215
01:02:10,889 --> 01:02:16,159
where we sample the light from here's

1216
01:02:12,809 --> 01:02:19,679
the normal here's our reference color

1217
01:02:16,159 --> 01:02:23,608
which is just whatever the surface we

1218
01:02:19,679 --> 01:02:26,159
were bouncing off of was and here's the

1219
01:02:23,608 --> 01:02:27,960
emission level of that thing and so then

1220
01:02:26,159 --> 01:02:29,399
we want to do some we want to see

1221
01:02:27,960 --> 01:02:32,070
whether or not this thing was emissive

1222
01:02:29,400 --> 01:02:35,900
or not right so this is the the fall-off

1223
01:02:32,070 --> 01:02:39,570
bit here so the 1 minus emission and

1224
01:02:35,900 --> 01:02:41,608
then we just go like okay take the

1225
01:02:39,570 --> 01:02:43,800
emission direction and the probe sample

1226
01:02:41,608 --> 01:02:45,779
normal that's how much of the fall-off

1227
01:02:43,800 --> 01:02:48,089
we're gonna have for emissive I guess

1228
01:02:45,780 --> 01:02:51,089
and you can see us actually using that

1229
01:02:48,088 --> 01:02:55,190
here so it's it's this is basically a

1230
01:02:51,088 --> 01:02:55,190
linear blend right between those two

1231
01:02:56,570 --> 01:03:01,130
well it's not really labeling but sort

1232
01:02:58,920 --> 01:03:01,130
of is

1233
01:03:08,110 --> 01:03:12,240
so I think that all just works out I

1234
01:03:12,869 --> 01:03:21,849
mean that seems all correct to me not

1235
01:03:17,469 --> 01:03:24,159
sir sample D is already the emission

1236
01:03:21,849 --> 01:03:27,279
direction so I'm not sure what sample D

1237
01:03:24,159 --> 01:03:32,170
would be used for here if I'm looking at

1238
01:03:27,280 --> 01:03:34,030
it it just looks all of this stuff looks

1239
01:03:32,170 --> 01:03:36,099
a little questionable so Rea dot and

1240
01:03:34,030 --> 01:03:37,380
that's correct that's where we hit

1241
01:03:36,099 --> 01:03:41,710
that's the normal the surface we hit

1242
01:03:37,380 --> 01:03:44,530
sample D is is or we already have that

1243
01:03:41,710 --> 01:03:49,510
right sample D is just the emission

1244
01:03:44,530 --> 01:03:57,850
direction so that that doesn't really

1245
01:03:49,510 --> 01:03:59,860
make any sense I'm not sure what yeah so

1246
01:03:57,849 --> 01:04:03,369
so let's think about this so we're we've

1247
01:03:59,860 --> 01:04:06,910
hit a surface and at that surface we

1248
01:04:03,369 --> 01:04:09,489
want to know what the emission direction

1249
01:04:06,909 --> 01:04:12,129
was from there so this actually is not

1250
01:04:09,489 --> 01:04:14,739
right anyway this was just supposed to

1251
01:04:12,130 --> 01:04:17,410
be a mission direction right because

1252
01:04:14,739 --> 01:04:19,779
we're supposed to say at this point with

1253
01:04:17,409 --> 01:04:22,349
this normal what would you have bounced

1254
01:04:19,780 --> 01:04:22,350
in this direction

1255
01:04:22,590 --> 01:04:30,730
pretty sure right and the answer in this

1256
01:04:27,820 --> 01:04:32,559
case would be that you would just bounce

1257
01:04:30,730 --> 01:04:34,210
it would it doesn't actually matter

1258
01:04:32,559 --> 01:04:35,529
right meaning you wouldn't care because

1259
01:04:34,210 --> 01:04:37,150
they're all the immersion so you would

1260
01:04:35,530 --> 01:04:38,130
just say you're gonna get this much no

1261
01:04:37,150 --> 01:04:47,289
matter what direction you're looking

1262
01:04:38,130 --> 01:04:50,710
right I want to say I mean am I wrong

1263
01:04:47,289 --> 01:04:53,230
about that is it should just be whatever

1264
01:04:50,710 --> 01:04:54,250
the diffuse map says at that point you

1265
01:04:53,230 --> 01:04:58,449
shouldn't actually need the emission

1266
01:04:54,250 --> 01:05:05,789
direction again this is where I'd like

1267
01:04:58,449 --> 01:05:10,500
Tom Mitchell Don help us oh well

1268
01:05:05,789 --> 01:05:12,119
you can't hear us so yeah that my only

1269
01:05:10,500 --> 01:05:13,829
question there is do is you know I'm

1270
01:05:12,119 --> 01:05:16,589
going to continue passing this down but

1271
01:05:13,829 --> 01:05:17,909
I don't actually know that I don't know

1272
01:05:16,590 --> 01:05:19,710
that there's anywhere in the equations

1273
01:05:17,909 --> 01:05:23,069
for what we're doing right now to

1274
01:05:19,710 --> 01:05:25,110
actually have that happen right so when

1275
01:05:23,070 --> 01:05:28,490
we do compute voxel irradiance at and we

1276
01:05:25,110 --> 01:05:31,800
say P and n here we want to go like

1277
01:05:28,489 --> 01:05:33,779
outgoing right so which direction were

1278
01:05:31,800 --> 01:05:39,660
actually looking at we're trying to look

1279
01:05:33,780 --> 01:05:44,070
at and we're pretty much not we we're

1280
01:05:39,659 --> 01:05:45,359
not probably going to use this so if we

1281
01:05:44,070 --> 01:05:49,130
take a look at what's going on here

1282
01:05:45,360 --> 01:05:52,380
we're gonna need to do this computation

1283
01:05:49,130 --> 01:05:53,940
exactly the way that would be done and

1284
01:05:52,380 --> 01:05:57,510
you can see us doing it here we're

1285
01:05:53,940 --> 01:05:59,610
looking up the voxel information we

1286
01:05:57,510 --> 01:06:02,130
don't actually want to do this are any

1287
01:05:59,610 --> 01:06:04,140
more so I'm pretty sure this is exactly

1288
01:06:02,130 --> 01:06:07,320
analogous to the other case where we

1289
01:06:04,139 --> 01:06:09,329
just want to we just want to know in the

1290
01:06:07,320 --> 01:06:12,990
normal direction what is that map give

1291
01:06:09,329 --> 01:06:14,429
us this is not what we want what we

1292
01:06:12,989 --> 01:06:17,609
actually want to be doing is sampling

1293
01:06:14,429 --> 01:06:20,839
our other map right we want to be

1294
01:06:17,610 --> 01:06:24,900
sampling the the actual texture map here

1295
01:06:20,840 --> 01:06:28,050
and and that's what we want to be

1296
01:06:24,900 --> 01:06:33,480
outputting so so this part is incorrect

1297
01:06:28,050 --> 01:06:36,660
and the weird part to me and the reason

1298
01:06:33,480 --> 01:06:39,000
this is a little confusing now is that

1299
01:06:36,659 --> 01:06:43,190
this should actually give us back this

1300
01:06:39,000 --> 01:06:43,190
must be wrong this code must be busted

1301
01:06:43,789 --> 01:06:53,369
because this should always be giving us

1302
01:06:47,219 --> 01:06:57,419
back a lot less light than the diffuse

1303
01:06:53,369 --> 01:07:01,589
map would so if all we've got is

1304
01:06:57,420 --> 01:07:04,400
speculative bounce around here I would

1305
01:07:01,590 --> 01:07:07,680
think that that would produce totally

1306
01:07:04,400 --> 01:07:10,500
like way less light but the opposite

1307
01:07:07,679 --> 01:07:13,279
appears to be true so I don't know what

1308
01:07:10,500 --> 01:07:13,280
to make of that

1309
01:07:13,780 --> 01:07:16,390
so we're gonna have to step through this

1310
01:07:15,340 --> 01:07:17,680
could probably figure what the heck's

1311
01:07:16,389 --> 01:07:19,989
going on because that doesn't really

1312
01:07:17,679 --> 01:07:22,000
make any sense it should be reducing low

1313
01:07:19,989 --> 01:07:23,699
amounts of light but instead it's

1314
01:07:22,000 --> 01:07:28,239
reducing super high amounts of light

1315
01:07:23,699 --> 01:07:43,809
right like those are all really

1316
01:07:28,239 --> 01:07:50,759
highlight values you know I'm saying so

1317
01:07:43,809 --> 01:07:50,759
what's up what is up with that

1318
01:08:03,389 --> 01:08:09,039
because everything I would think should

1319
01:08:07,059 --> 01:08:10,829
indicate that we should be getting a lot

1320
01:08:09,039 --> 01:08:12,940
less light into this thing

1321
01:08:10,829 --> 01:08:14,380
and instead we're getting a lot more

1322
01:08:12,940 --> 01:08:15,970
light into this thing I guess one

1323
01:08:14,380 --> 01:08:22,329
question would be do we ever clear this

1324
01:08:15,969 --> 01:08:23,739
thing properly I assume we do but it's

1325
01:08:22,329 --> 01:08:26,680
just weird that we're getting any light

1326
01:08:23,739 --> 01:08:29,289
at all we should be getting really low

1327
01:08:26,680 --> 01:08:31,300
amounts of light because you without the

1328
01:08:29,289 --> 01:08:33,069
diffused summation in there we should

1329
01:08:31,300 --> 01:08:35,489
only be able to get light sources if we

1330
01:08:33,069 --> 01:08:38,680
actually bounce directly towards them

1331
01:08:35,489 --> 01:08:40,479
and so there should be a lot less light

1332
01:08:38,680 --> 01:08:43,420
because diffuse surfaces are things that

1333
01:08:40,479 --> 01:09:01,419
help lightly whole environment so we

1334
01:08:43,420 --> 01:09:03,279
shouldn't be get at yeah so that's

1335
01:09:01,420 --> 01:09:06,039
pretty bizarre and I do wonder if our

1336
01:09:03,279 --> 01:09:09,939
compute voxel irradiance at function is

1337
01:09:06,039 --> 01:09:13,029
kind of busted I don't really know

1338
01:09:09,939 --> 01:09:15,789
so let's take these things out sort of

1339
01:09:13,029 --> 01:09:19,479
one by one if I go to the computer a

1340
01:09:15,789 --> 01:09:22,180
Tian's function and just stuff it to

1341
01:09:19,479 --> 01:09:30,068
produce something that's just a flat

1342
01:09:22,180 --> 01:09:32,680
light like so my first question would be

1343
01:09:30,069 --> 01:09:34,270
is a flat light going to still have

1344
01:09:32,680 --> 01:09:35,829
these errors because if it was then it's

1345
01:09:34,270 --> 01:09:41,310
not actually our light sampling it's

1346
01:09:35,829 --> 01:09:41,309
some other aspect right all right so I

1347
01:09:42,390 --> 01:09:48,300
guess I'll basically say that that is

1348
01:09:45,130 --> 01:09:48,300
somewhat surprising

1349
01:09:51,729 --> 01:10:04,089
I guess the reason for that is because

1350
01:09:54,609 --> 01:10:05,500
the emission interesting so we're

1351
01:10:04,090 --> 01:10:07,659
actually still getting the lighting

1352
01:10:05,500 --> 01:10:10,630
because the emission if you hit an

1353
01:10:07,659 --> 01:10:13,539
emitter it's going to put emission into

1354
01:10:10,630 --> 01:10:15,279
the system and if you hit anything else

1355
01:10:13,539 --> 01:10:17,590
it's gonna put Bounce lighting into the

1356
01:10:15,279 --> 01:10:21,399
system and so in this particular case

1357
01:10:17,590 --> 01:10:32,130
that turns out actually giving you some

1358
01:10:21,399 --> 01:10:32,129
lighting right which is real weird

1359
01:10:33,539 --> 01:10:45,250
and so I guess that's just giving you a

1360
01:10:39,430 --> 01:10:49,000
single bounce light with no movement of

1361
01:10:45,250 --> 01:10:52,738
the light throughout the scene looks

1362
01:10:49,000 --> 01:10:52,738
kind of cool though I can tell you that

1363
01:10:55,680 --> 01:11:05,739
hmm hmm I say so let me go ahead and

1364
01:11:04,000 --> 01:11:07,600
lock knock out the moon light one more

1365
01:11:05,738 --> 01:11:09,169
time

1366
01:11:07,600 --> 01:11:12,329
and just like

1367
01:11:09,170 --> 01:11:12,328
[Music]

1368
01:11:15,000 --> 01:11:19,760
yeah there we go right

1369
01:11:25,439 --> 01:11:33,069
interesting so that wasn't exactly what

1370
01:11:30,909 --> 01:11:35,050
I expected to see I was kind of

1371
01:11:33,069 --> 01:11:42,609
expecting to see something more related

1372
01:11:35,050 --> 01:11:43,900
to like like yeah that's just very

1373
01:11:42,609 --> 01:11:45,429
surprising but I guess that makes sense

1374
01:11:43,899 --> 01:11:47,679
because we do have single bounce

1375
01:11:45,430 --> 01:11:49,119
lighting now that's actually computing

1376
01:11:47,680 --> 01:11:50,590
all this lighting properly so it's like

1377
01:11:49,119 --> 01:11:54,069
oh you can see this light on this

1378
01:11:50,590 --> 01:11:55,840
surface and all that stuff and like wow

1379
01:11:54,069 --> 01:12:02,889
okay it's better than I thought it would

1380
01:11:55,840 --> 01:12:04,930
be so I moonlight back in that all looks

1381
01:12:02,890 --> 01:12:07,390
right and so the only question is now

1382
01:12:04,930 --> 01:12:09,670
why is our compute voxel irradiance

1383
01:12:07,390 --> 01:12:11,680
kicking back such ridiculous values or

1384
01:12:09,670 --> 01:12:16,239
is it just that we're overloading the

1385
01:12:11,680 --> 01:12:17,950
light somehow because it's specular I'm

1386
01:12:16,239 --> 01:12:21,250
just I'm assuming it's got to just be a

1387
01:12:17,949 --> 01:12:24,189
bug and it's busted but I don't really

1388
01:12:21,250 --> 01:12:27,399
know so let's take a look at what we're

1389
01:12:24,189 --> 01:12:29,799
doing here we're doing a mapping of the

1390
01:12:27,399 --> 01:12:31,210
sample position as you can see here

1391
01:12:29,800 --> 01:12:36,369
we're taking wherever the sample is

1392
01:12:31,210 --> 01:12:43,600
taking the corner out of it doing a off

1393
01:12:36,369 --> 01:12:44,800
set off set by the center oh no that's

1394
01:12:43,600 --> 01:12:46,180
right so we're multiplying by the

1395
01:12:44,800 --> 01:12:50,400
inverse dim first and then doing an

1396
01:12:46,180 --> 01:12:53,409
offset to get us back to the center

1397
01:12:50,399 --> 01:12:57,279
we're then doing a floor I'll be honest

1398
01:12:53,409 --> 01:12:59,680
that doesn't look right to me so the

1399
01:12:57,279 --> 01:13:05,500
inverse Fox will sell dim this puts us

1400
01:12:59,680 --> 01:13:09,070
into yeah so if we're flooring if we're

1401
01:13:05,500 --> 01:13:11,710
flooring I feel like that should have

1402
01:13:09,069 --> 01:13:14,429
been a plus let me just double-check

1403
01:13:11,710 --> 01:13:14,430
something Oh

1404
01:13:18,420 --> 01:13:26,140
double check duh that's not gonna do

1405
01:13:21,399 --> 01:13:29,170
nothing we're not running this path yeah

1406
01:13:26,140 --> 01:13:32,190
so it's a little confusing the in voxel

1407
01:13:29,170 --> 01:13:32,190
seldom there

1408
01:13:33,738 --> 01:13:38,448
something's a little a little iffy

1409
01:13:40,519 --> 01:13:45,179
because this is saying all right where

1410
01:13:42,809 --> 01:13:48,599
are we relative to the corner now which

1411
01:13:45,179 --> 01:13:50,809
cell are we in right and if we floored

1412
01:13:48,599 --> 01:13:54,059
that that would just give us which cell

1413
01:13:50,809 --> 01:13:58,050
that we're in but we're subtracting the

1414
01:13:54,059 --> 01:13:59,489
oh five to offset by the center which by

1415
01:13:58,050 --> 01:14:03,000
the way looks wrong there too

1416
01:13:59,488 --> 01:14:08,848
let me let me let me wait to see cuz

1417
01:14:03,000 --> 01:14:14,969
we're doing that in here right so we're

1418
01:14:08,849 --> 01:14:29,480
doing that in here too I assume for our

1419
01:14:14,969 --> 01:14:34,980
box I yeah so in here where we do our

1420
01:14:29,479 --> 01:14:38,759
vox uvw so to produce our vox I we just

1421
01:14:34,979 --> 01:14:42,388
use the floor and so I wonder if that's

1422
01:14:38,760 --> 01:14:43,739
actually wrong then because we've got I

1423
01:14:42,389 --> 01:14:46,139
wonder if that point five should

1424
01:14:43,738 --> 01:14:50,009
actually be in there here so the vox r

1425
01:14:46,139 --> 01:14:54,590
LP when we actually do the you know we

1426
01:14:50,010 --> 01:14:57,480
actually do this this stuff here right i

1427
01:14:54,590 --> 01:14:58,860
wonder if this should actually be a - i

1428
01:14:57,479 --> 01:15:01,399
wonder if this guy should actually have

1429
01:14:58,859 --> 01:15:01,399
this in here

1430
01:15:01,488 --> 01:15:08,448
let's see just want to see what happens

1431
01:15:06,328 --> 01:15:08,448
ooh

1432
01:15:13,289 --> 01:15:19,170
oh wait sorry

1433
01:15:15,510 --> 01:15:22,230
that's the Vox in total dim times the

1434
01:15:19,170 --> 01:15:25,230
relative P so that's actually giving you

1435
01:15:22,229 --> 01:15:38,309
the the full map inside so I didn't

1436
01:15:25,229 --> 01:15:48,449
really want to do that so I guess I

1437
01:15:38,310 --> 01:15:49,740
actually want it here yeah so now you

1438
01:15:48,449 --> 01:15:51,720
can kind of see that the light is

1439
01:15:49,739 --> 01:15:54,179
actually centered properly so I guess

1440
01:15:51,720 --> 01:15:55,920
that was actually a bug in the shader

1441
01:15:54,180 --> 01:15:57,000
code because remember this the light was

1442
01:15:55,920 --> 01:15:59,130
lit was looking like I was off to the

1443
01:15:57,000 --> 01:16:02,220
side a little bit so we we actually were

1444
01:15:59,130 --> 01:16:05,100
looking it up incorrectly there which

1445
01:16:02,220 --> 01:16:06,900
was a screw-up on my part right so this

1446
01:16:05,100 --> 01:16:13,440
is actually what it should look like and

1447
01:16:06,899 --> 01:16:15,629
now you can kind of see yeah now already

1448
01:16:13,439 --> 01:16:19,139
you know it's it's so fascinating to

1449
01:16:15,630 --> 01:16:22,409
write like we didn't do any work to make

1450
01:16:19,140 --> 01:16:23,820
moonlight not show up downstairs but the

1451
01:16:22,409 --> 01:16:26,279
reason it's not showing up is because

1452
01:16:23,819 --> 01:16:29,130
there's actually a floor above us so it

1453
01:16:26,279 --> 01:16:31,409
can't find the moon which is pretty cool

1454
01:16:29,130 --> 01:16:32,909
I don't know how we're gonna maintain

1455
01:16:31,409 --> 01:16:34,739
that all the time because there's places

1456
01:16:32,909 --> 01:16:36,720
now if you go there's nothing above it

1457
01:16:34,739 --> 01:16:38,939
so I don't know that that's a long-term

1458
01:16:36,720 --> 01:16:41,100
solution like so here the moonlight is

1459
01:16:38,939 --> 01:16:45,299
getting in because there's nothing above

1460
01:16:41,100 --> 01:16:46,800
this right and furthermore it's a little

1461
01:16:45,300 --> 01:16:48,779
weird because there's like shadow over

1462
01:16:46,800 --> 01:16:51,630
here because there is something above it

1463
01:16:48,779 --> 01:16:53,789
there right so we kind of need to put

1464
01:16:51,630 --> 01:16:56,069
ceilings on things if we wanted that to

1465
01:16:53,789 --> 01:16:58,319
actually happen but it's kind of cool

1466
01:16:56,069 --> 01:16:59,729
right and this is why simulation is

1467
01:16:58,319 --> 01:17:03,289
always interesting because you get

1468
01:16:59,729 --> 01:17:06,479
natural interesting effects out of it

1469
01:17:03,289 --> 01:17:08,310
and it's just pretty interesting alright

1470
01:17:06,479 --> 01:17:09,929
so I guess you know this was actually

1471
01:17:08,310 --> 01:17:11,640
correct and we just hadn't thought it

1472
01:17:09,930 --> 01:17:14,130
through in our actual shader so this is

1473
01:17:11,640 --> 01:17:17,610
right and you can see us doing it here

1474
01:17:14,130 --> 01:17:19,800
so we're doing the inbox seldom here and

1475
01:17:17,609 --> 01:17:23,609
then subtracting that so that we end up

1476
01:17:19,800 --> 01:17:25,989
with our actual indices so here we look

1477
01:17:23,609 --> 01:17:29,469
up our box index ru VW's the f

1478
01:17:25,988 --> 01:17:31,089
Kord - the actual read multiple

1479
01:17:29,469 --> 01:17:35,319
occasions of this thing which that all

1480
01:17:31,090 --> 01:17:38,050
seems right to me

1481
01:17:35,319 --> 01:17:40,509
that should come out okay then we're

1482
01:17:38,050 --> 01:17:43,630
actually doing a lookup of the voxel by

1483
01:17:40,510 --> 01:17:47,289
taking all of the different offsets same

1484
01:17:43,630 --> 01:17:49,659
as we were doing right and so we have

1485
01:17:47,288 --> 01:17:51,460
all those cell pointers now then we're

1486
01:17:49,658 --> 01:17:53,710
just saying are ain't let's go ahead and

1487
01:17:51,460 --> 01:18:00,248
get the octahedral offset lerp the

1488
01:17:53,710 --> 01:18:06,670
results together and off we go well this

1489
01:18:00,248 --> 01:18:12,010
is wrong is it or no it's nuts nuts not

1490
01:18:06,670 --> 01:18:15,609
so this is always between between X's so

1491
01:18:12,010 --> 01:18:21,280
that's fine and then this is wise and

1492
01:18:15,609 --> 01:18:24,009
the disease the interior so you know I

1493
01:18:21,279 --> 01:18:25,658
guess I'm not sure what's but what's

1494
01:18:24,010 --> 01:18:27,880
broken about that

1495
01:18:25,658 --> 01:18:30,308
let me try knocking it down a little bit

1496
01:18:27,880 --> 01:18:34,359
just so we can see if it's a lighting

1497
01:18:30,309 --> 01:18:37,480
amount problem and just so I can play

1498
01:18:34,359 --> 01:18:40,359
with those levels a little bit so let me

1499
01:18:37,479 --> 01:18:44,379
go ahead and run that here's it running

1500
01:18:40,359 --> 01:18:47,799
and even with it knocked down quite a

1501
01:18:44,380 --> 01:18:49,359
bit it still gets out of hand so it

1502
01:18:47,800 --> 01:18:52,719
feels like there must be something wrong

1503
01:18:49,359 --> 01:18:55,420
with that computation but you know I

1504
01:18:52,719 --> 01:18:58,618
don't I don't know obviously

1505
01:18:55,420 --> 01:18:59,920
so here's with it with it knocked down

1506
01:18:58,618 --> 01:19:04,029
dramatically

1507
01:18:59,920 --> 01:19:06,340
right and let me go ahead and knock it

1508
01:19:04,029 --> 01:19:07,868
up a little bit just to see where the

1509
01:19:06,340 --> 01:19:14,889
explosion point is just for my

1510
01:19:07,868 --> 01:19:18,788
edification so you can see it's like

1511
01:19:14,889 --> 01:19:22,090
really just behaving it really kind of

1512
01:19:18,788 --> 01:19:25,599
feeds back on itself right even at very

1513
01:19:22,090 --> 01:19:30,010
low levels which I would assume just

1514
01:19:25,599 --> 01:19:34,179
means mostly that we've forgotten some

1515
01:19:30,010 --> 01:19:36,248
kind of damping right like we're not

1516
01:19:34,179 --> 01:19:39,579
thinking about this in terms of photons

1517
01:19:36,248 --> 01:19:41,260
per second flowing through this thing

1518
01:19:39,579 --> 01:19:45,670
the way we were thinking about it before

1519
01:19:41,260 --> 01:19:48,070
and we're not using a diffuse map yet so

1520
01:19:45,670 --> 01:19:50,859
obviously that's a difference but just

1521
01:19:48,069 --> 01:19:52,960
where this why you would need to damp

1522
01:19:50,859 --> 01:19:54,849
this down all the way to like basically

1523
01:19:52,960 --> 01:19:58,390
at least there I might even be a little

1524
01:19:54,850 --> 01:20:03,539
lower than there in order to get that to

1525
01:19:58,390 --> 01:20:03,539
not feedback is confusing right

1526
01:20:18,159 --> 01:20:26,500
like that still feeds back right all the

1527
01:20:23,289 --> 01:20:28,750
way out so we at least know what it is

1528
01:20:26,500 --> 01:20:32,170
that's happening right it is the fact

1529
01:20:28,750 --> 01:20:34,180
that light is our lighting equation we

1530
01:20:32,170 --> 01:20:36,730
have this when we first did it to when

1531
01:20:34,180 --> 01:20:40,630
we first at our distributor we had

1532
01:20:36,729 --> 01:20:43,029
exactly the same problem right and you

1533
01:20:40,630 --> 01:20:44,319
can see like it gets these like oh I got

1534
01:20:43,029 --> 01:20:45,880
transferred a certain amount of light

1535
01:20:44,319 --> 01:20:52,109
and that light was too much or whatever

1536
01:20:45,880 --> 01:20:55,119
right and so we're not conceiving of the

1537
01:20:52,109 --> 01:20:57,130
photons per second anymore the way that

1538
01:20:55,119 --> 01:21:03,369
we should like we've got an issue with

1539
01:20:57,130 --> 01:21:05,289
how that's being looked at right and I'm

1540
01:21:03,369 --> 01:21:07,510
gonna have to remember kind of how we

1541
01:21:05,289 --> 01:21:11,710
conceptualize that to make sure that we

1542
01:21:07,510 --> 01:21:13,840
don't have that problem so when we talk

1543
01:21:11,710 --> 01:21:16,239
about how many photons per second are

1544
01:21:13,840 --> 01:21:20,289
flowing through something I guess the

1545
01:21:16,239 --> 01:21:24,449
problem is that that thing well we're

1546
01:21:20,289 --> 01:21:24,449
always blending towards a value though

1547
01:21:26,159 --> 01:21:31,479
so that's a little weird so yeah I mean

1548
01:21:29,350 --> 01:21:35,350
the interesting thing is we're always

1549
01:21:31,479 --> 01:21:39,459
blending towards a new photons per

1550
01:21:35,350 --> 01:21:45,090
second value right so what would cause

1551
01:21:39,460 --> 01:21:45,090
that value to creep upward like that

1552
01:21:46,140 --> 01:21:55,539
because we it should only be summing the

1553
01:21:49,539 --> 01:22:01,590
light probe stuff so somehow this

1554
01:21:55,539 --> 01:22:10,329
produces values that are like growing

1555
01:22:01,590 --> 01:22:12,789
which I'm not sure why it would so so

1556
01:22:10,329 --> 01:22:15,519
what's weirder to me still is that this

1557
01:22:12,789 --> 01:22:17,710
produces values that are growing when

1558
01:22:15,520 --> 01:22:20,970
you turn this on but the version that

1559
01:22:17,710 --> 01:22:24,970
actually adds the emission in does not

1560
01:22:20,970 --> 01:22:29,380
right so this doesn't actually do that

1561
01:22:24,970 --> 01:22:31,570
so let me think about what this ref

1562
01:22:29,380 --> 01:22:32,139
fall-off thing is here so first of all I

1563
01:22:31,569 --> 01:22:38,768
want to

1564
01:22:32,139 --> 01:22:41,309
that emission is always less than or

1565
01:22:38,769 --> 01:22:44,679
equal to one like I don't actually want

1566
01:22:41,309 --> 01:22:46,860
to ever see anything where that's not

1567
01:22:44,679 --> 01:22:53,349
the case

1568
01:22:46,859 --> 01:22:55,029
good so if a mission is always owned you

1569
01:22:53,349 --> 01:23:02,380
know these are all on right just to make

1570
01:22:55,029 --> 01:23:05,800
sure yeah so we know that the ref fall

1571
01:23:02,380 --> 01:23:07,389
off if the emissions on ref fall off

1572
01:23:05,800 --> 01:23:09,579
will be zero so it won't do anything

1573
01:23:07,389 --> 01:23:12,010
here and it will just add in the

1574
01:23:09,578 --> 01:23:15,069
emission times whatever the emitter

1575
01:23:12,010 --> 01:23:17,469
actually was doing so assuming that the

1576
01:23:15,069 --> 01:23:20,259
emission is off so assuming emission is

1577
01:23:17,469 --> 01:23:22,958
zero then this will not add anything and

1578
01:23:20,260 --> 01:23:25,030
so we're talking about only the sample n

1579
01:23:22,958 --> 01:23:27,519
times the emission direction so we're

1580
01:23:25,029 --> 01:23:34,328
talking about a fall-off curve that's

1581
01:23:27,519 --> 01:23:35,679
based on you know whatever the about the

1582
01:23:34,328 --> 01:23:39,788
the thing that we're point that's

1583
01:23:35,679 --> 01:23:42,179
pointing at us and what direction we

1584
01:23:39,788 --> 01:23:48,639
were actually trying to do an outgoing

1585
01:23:42,179 --> 01:23:50,469
vector of now I'm not sure that fall-off

1586
01:23:48,639 --> 01:23:51,819
actually is supposed to be there because

1587
01:23:50,469 --> 01:23:55,479
that should have already been accounted

1588
01:23:51,819 --> 01:23:56,590
for by the diffuse map so once we switch

1589
01:23:55,479 --> 01:23:58,749
to the diffuse map I'm not sure that

1590
01:23:56,590 --> 01:24:01,389
actually supposed to be there but if we

1591
01:23:58,748 --> 01:24:04,630
look at what happens with it it can only

1592
01:24:01,389 --> 01:24:07,929
reduce the transmission right it can

1593
01:24:04,630 --> 01:24:09,578
only knock it down from what it was so

1594
01:24:07,929 --> 01:24:11,859
then when we multiply by here that

1595
01:24:09,578 --> 01:24:15,219
that's never gonna add energy into the

1596
01:24:11,859 --> 01:24:16,988
system it can only subtract it so we

1597
01:24:15,219 --> 01:24:18,399
really are just taking whatever the

1598
01:24:16,988 --> 01:24:20,049
light sample is and multiplying it by

1599
01:24:18,399 --> 01:24:21,849
the sample ref color and the sample ref

1600
01:24:20,050 --> 01:24:24,219
color in theory should never be above

1601
01:24:21,849 --> 01:24:26,199
one either I guess we could assert that

1602
01:24:24,219 --> 01:24:30,090
too

1603
01:24:26,198 --> 01:24:30,089
and in fact maybe we should

1604
01:24:36,770 --> 01:24:50,190
so maybe I should just do this and run

1605
01:24:45,569 --> 01:24:52,799
it alright so I just want to make sure

1606
01:24:50,189 --> 01:24:55,109
there was no funny business so when we

1607
01:24:52,800 --> 01:24:57,510
get to compute voxel irradiance ATS the

1608
01:24:55,109 --> 01:25:00,500
question is how is this taking a sum of

1609
01:24:57,510 --> 01:25:06,360
photons per second transmission values

1610
01:25:00,500 --> 01:25:10,770
and getting a number that's actually

1611
01:25:06,359 --> 01:25:12,899
higher than any of the other photon

1612
01:25:10,770 --> 01:25:14,160
changes and it's not necessarily doing

1613
01:25:12,899 --> 01:25:16,079
that I mean it could be that the light

1614
01:25:14,159 --> 01:25:19,010
is bouncing around now it is doing that

1615
01:25:16,079 --> 01:25:24,149
because we've seen what the emission

1616
01:25:19,010 --> 01:25:26,840
values are and they're not that so how

1617
01:25:24,149 --> 01:25:26,839
is it doing that

1618
01:25:32,840 --> 01:25:39,210
how is it producing values that are

1619
01:25:36,000 --> 01:25:42,140
going above the actual emission that

1620
01:25:39,210 --> 01:25:42,140
we're introducing

1621
01:25:48,909 --> 01:25:55,420
so let's try this I'm curious to know so

1622
01:25:53,109 --> 01:25:59,859
let's suppose we set the emission value

1623
01:25:55,420 --> 01:26:04,329
to zero everywhere right so we just said

1624
01:25:59,859 --> 01:26:07,679
look there's no emission ever so the

1625
01:26:04,329 --> 01:26:12,340
moonlight is all you get right that's it

1626
01:26:07,680 --> 01:26:14,950
so here we are hopping around right and

1627
01:26:12,340 --> 01:26:17,440
we're just moonlight so we're able to

1628
01:26:14,949 --> 01:26:21,550
convict moonlight around now if we want

1629
01:26:17,439 --> 01:26:25,059
to right but that's all and so then we

1630
01:26:21,550 --> 01:26:27,550
go into this voxel radiance function and

1631
01:26:25,060 --> 01:26:29,680
I delete the damping so there's just

1632
01:26:27,550 --> 01:26:34,750
moonlight around what happens with just

1633
01:26:29,680 --> 01:26:37,420
that so all right this should give us a

1634
01:26:34,750 --> 01:26:40,329
way to debug this program right because

1635
01:26:37,420 --> 01:26:44,190
here's what's happening nothing were

1636
01:26:40,329 --> 01:26:48,130
ever injecting into this system ever is

1637
01:26:44,189 --> 01:26:53,669
now gonna be above the moon color which

1638
01:26:48,130 --> 01:26:57,970
is super low right it's this at maximum

1639
01:26:53,670 --> 01:27:00,190
point one brightness so if we're

1640
01:26:57,970 --> 01:27:02,920
injecting such little light into the

1641
01:27:00,189 --> 01:27:07,000
system how can something that only

1642
01:27:02,920 --> 01:27:09,930
returns the lerp of at most that value

1643
01:27:07,000 --> 01:27:12,819
return something greater than that value

1644
01:27:09,930 --> 01:27:15,909
how is that happening do you see what

1645
01:27:12,819 --> 01:27:19,779
I'm saying like to me that says we

1646
01:27:15,909 --> 01:27:22,779
definitely have a bug here right like

1647
01:27:19,779 --> 01:27:27,849
something really bad is happening

1648
01:27:22,779 --> 01:27:28,989
and I just don't know where so there's a

1649
01:27:27,850 --> 01:27:30,490
couple places that this could be

1650
01:27:28,989 --> 01:27:32,559
happening one it could be happening

1651
01:27:30,489 --> 01:27:34,269
inside the octahedral map by sampling

1652
01:27:32,560 --> 01:27:36,640
something erroneous so let's say we've

1653
01:27:34,270 --> 01:27:40,450
got like an off error these are some

1654
01:27:36,640 --> 01:27:42,160
tile bogus values I'm not sure

1655
01:27:40,449 --> 01:27:46,659
and we're sampling off the end of this

1656
01:27:42,159 --> 01:27:49,300
thing and grabbing garbage or something

1657
01:27:46,659 --> 01:27:52,779
like that we could have a math bug where

1658
01:27:49,300 --> 01:27:54,190
this lerp is not right but basically

1659
01:27:52,779 --> 01:27:56,649
what I want to find out is how are we

1660
01:27:54,189 --> 01:27:59,559
getting back values that are outside

1661
01:27:56,649 --> 01:28:01,929
this range so what am I try doing is I'm

1662
01:27:59,560 --> 01:28:06,820
going to try asserting here

1663
01:28:01,930 --> 01:28:09,750
that my results are is let's say less

1664
01:28:06,819 --> 01:28:09,750
than or equal to 0.5

1665
01:28:10,770 --> 01:28:15,400
and so I just want to say like look

1666
01:28:13,210 --> 01:28:17,470
let's just say we know that this should

1667
01:28:15,399 --> 01:28:18,849
never really be able to have produced

1668
01:28:17,470 --> 01:28:21,730
anything even close to that

1669
01:28:18,850 --> 01:28:23,200
so just just that should stop at some

1670
01:28:21,729 --> 01:28:26,949
point right

1671
01:28:23,199 --> 01:28:30,250
and it should return it should like halt

1672
01:28:26,949 --> 01:28:32,260
there because it has to right and maybe

1673
01:28:30,250 --> 01:28:34,000
if we just do this in debug mode then we

1674
01:28:32,260 --> 01:28:35,770
can go look at what the various cells

1675
01:28:34,000 --> 01:28:37,659
are that we were sampling see what the

1676
01:28:35,770 --> 01:28:40,180
actual values are and how the heck we

1677
01:28:37,659 --> 01:28:44,109
got a value that high right

1678
01:28:40,180 --> 01:28:47,909
so again just trying to figure out where

1679
01:28:44,109 --> 01:28:57,880
my where my mistake is by paring it down

1680
01:28:47,909 --> 01:29:00,720
so go ahead and run it don't want to

1681
01:28:57,880 --> 01:29:00,720
actually break here

1682
01:29:08,880 --> 01:29:14,230
and I'm just waiting for the assertion

1683
01:29:12,180 --> 01:29:23,100
which will be a while because this is

1684
01:29:14,229 --> 01:29:27,279
the super slow path oops there we go and

1685
01:29:23,100 --> 01:29:29,470
so now we can look at the results we see

1686
01:29:27,279 --> 01:29:32,109
that we've got absurdly high values in

1687
01:29:29,470 --> 01:29:36,940
here and so let's just see what we've

1688
01:29:32,109 --> 01:29:44,529
got for our cell values right so here's

1689
01:29:36,939 --> 01:29:46,799
our cells we've got yet here's all of

1690
01:29:44,529 --> 01:29:46,800
ourselves

1691
01:29:51,168 --> 01:30:00,288
right so here's the light color and I

1692
01:29:58,158 --> 01:30:02,868
guess I forgot to look at which one

1693
01:30:00,288 --> 01:30:11,978
we're looking at so we're looking at

1694
01:30:02,868 --> 01:30:11,978
five one right in here so T YT X so oops

1695
01:30:14,590 --> 01:30:20,479
where did that go

1696
01:30:16,840 --> 01:30:21,019
did I where did cells go did I delete it

1697
01:30:20,479 --> 01:30:25,369
somehow

1698
01:30:21,019 --> 01:30:30,159
how's weird so anyway inside cells let's

1699
01:30:25,368 --> 01:30:34,268
look here so we're looking at five one

1700
01:30:30,158 --> 01:30:36,498
so there's no light coming in there

1701
01:30:34,269 --> 01:30:38,168
maybe I should just pull these out to

1702
01:30:36,498 --> 01:30:41,748
something easier for me to look at but

1703
01:30:38,168 --> 01:30:50,498
you know what I can do it this way so

1704
01:30:41,748 --> 01:30:56,988
let me look up zero zero zero light c-51

1705
01:30:50,498 --> 01:31:04,219
so there's the light here there's the

1706
01:30:56,988 --> 01:31:07,668
light there so like all of this is

1707
01:31:04,219 --> 01:31:10,868
nothing so there must just be one of

1708
01:31:07,668 --> 01:31:10,868
these that's weird

1709
01:31:24,418 --> 01:31:37,418
all right so am I missing something like

1710
01:31:28,260 --> 01:31:42,668
we've got what's what the heck all right

1711
01:31:37,418 --> 01:31:45,639
that would do it so yeah not great so

1712
01:31:42,668 --> 01:31:50,349
this is garbage right here is basically

1713
01:31:45,639 --> 01:31:51,939
what we're looking at not our finest

1714
01:31:50,349 --> 01:31:54,399
hour to say the least

1715
01:31:51,939 --> 01:31:56,260
not sure why but let's take a look at

1716
01:31:54,399 --> 01:31:58,269
how this was being calculated so our

1717
01:31:56,260 --> 01:32:00,909
blending coefficients are complete

1718
01:31:58,269 --> 01:32:04,628
garbage so let's take a look at our F

1719
01:32:00,908 --> 01:32:06,038
chord here so our F chord is supposed to

1720
01:32:04,628 --> 01:32:10,448
be well let's let's start even before

1721
01:32:06,038 --> 01:32:12,038
that so sample P is is where we're going

1722
01:32:10,448 --> 01:32:16,268
like that's what we're supposed to be

1723
01:32:12,038 --> 01:32:19,118
looking at so here's the location in the

1724
01:32:16,269 --> 01:32:25,418
world that we want to look at and our

1725
01:32:19,118 --> 01:32:28,118
solution Vox min corner that's the basis

1726
01:32:25,418 --> 01:32:30,398
of the voxel right so this thing is

1727
01:32:28,118 --> 01:32:31,898
definitely inside the voxel well

1728
01:32:30,399 --> 01:32:33,699
actually I don't know how large the

1729
01:32:31,899 --> 01:32:35,139
voxel is so maybe not but at least point

1730
01:32:33,698 --> 01:32:37,538
being it's not on the let it's not on

1731
01:32:35,139 --> 01:32:39,010
the min side of the voxel so when we

1732
01:32:37,538 --> 01:32:41,618
produce our F chord we should get

1733
01:32:39,010 --> 01:32:43,719
something centered around this thing

1734
01:32:41,618 --> 01:32:51,398
times the Inbox seldom what is that in

1735
01:32:43,719 --> 01:32:57,099
Vox seldom by the way all right so it's

1736
01:32:51,399 --> 01:32:59,439
you know 0.7 is the cell dim so that's

1737
01:32:57,099 --> 01:33:00,969
actually gonna give us back the index

1738
01:32:59,439 --> 01:33:09,309
into the voxel and I don't know how big

1739
01:33:00,969 --> 01:33:12,309
the voxel is actually oh I see what the

1740
01:33:09,309 --> 01:33:18,189
problem is this thing is outside the

1741
01:33:12,309 --> 01:33:20,319
voxel so we just don't because our voxel

1742
01:33:18,189 --> 01:33:21,969
ends up getting clamped no but that

1743
01:33:20,319 --> 01:33:23,559
doesn't no that's wrong cuz this should

1744
01:33:21,969 --> 01:33:27,248
still that we don't account for that

1745
01:33:23,559 --> 01:33:28,418
anywhere so it's fine right because we

1746
01:33:27,248 --> 01:33:30,068
should still have produced in there

1747
01:33:28,418 --> 01:33:30,920
value here all right so let's just hold

1748
01:33:30,069 --> 01:33:32,780
on

1749
01:33:30,920 --> 01:33:33,980
bear with me for one second let's just

1750
01:33:32,779 --> 01:33:36,639
do this computation slightly differently

1751
01:33:33,979 --> 01:33:42,079
so we can look at all the parts so let's

1752
01:33:36,640 --> 01:33:50,530
do our like our base scored here so this

1753
01:33:42,079 --> 01:33:54,050
would be like the the basis there right

1754
01:33:50,529 --> 01:33:55,579
and this way we can say like look this

1755
01:33:54,050 --> 01:33:57,230
is where we're looking up and here's how

1756
01:33:55,579 --> 01:34:01,969
far away from the thing we're looking up

1757
01:33:57,229 --> 01:34:04,159
we actually are right and go ahead and

1758
01:34:01,969 --> 01:34:05,899
make sure that works now also we should

1759
01:34:04,159 --> 01:34:10,219
double-check the one in the Z bias

1760
01:34:05,899 --> 01:34:11,750
shader for this so if we if you look at

1761
01:34:10,219 --> 01:34:12,619
what happens inside the Z bias program I

1762
01:34:11,750 --> 01:34:19,399
just want to make sure this one's

1763
01:34:12,619 --> 01:34:21,738
working well is right as well so when we

1764
01:34:19,399 --> 01:34:23,750
floor Vox I yeah so we do a floor and

1765
01:34:21,738 --> 01:34:26,178
then we just do a subtract of these two

1766
01:34:23,750 --> 01:34:28,488
things right which is what you would

1767
01:34:26,179 --> 01:34:30,250
expect so actually like when you look

1768
01:34:28,488 --> 01:34:32,629
here

1769
01:34:30,250 --> 01:34:34,219
in fact when you look here at this I'm

1770
01:34:32,630 --> 01:34:37,119
not sure why we're even doing this this

1771
01:34:34,219 --> 01:34:39,770
way why is this getting multiplied out

1772
01:34:37,119 --> 01:34:40,849
so I think that was most of our only

1773
01:34:39,770 --> 01:34:42,710
problem with that was that was probably

1774
01:34:40,850 --> 01:34:46,039
our only pray this this is the actual

1775
01:34:42,710 --> 01:34:48,679
equation right we just had the length in

1776
01:34:46,039 --> 01:34:51,439
there for no reason but I think that's

1777
01:34:48,679 --> 01:34:55,390
all we actually need and let's just

1778
01:34:51,439 --> 01:34:55,389
verify that real quick

1779
01:35:02,979 --> 01:35:20,860
mm how do I get this thing - oh this is

1780
01:35:16,269 --> 01:35:24,639
the release mode all right wait no it's

1781
01:35:20,859 --> 01:35:26,109
not it's not release mode I guess this

1782
01:35:24,639 --> 01:35:37,630
is just having trouble with threading

1783
01:35:26,109 --> 01:35:37,988
run - there please what's going on there

1784
01:35:37,630 --> 01:35:40,300
we go

1785
01:35:37,988 --> 01:35:42,638
um so let me just look at the UV the w

1786
01:35:40,300 --> 01:35:49,809
values now so that's more what we expect

1787
01:35:42,639 --> 01:35:52,659
right okay so that sure seemed like our

1788
01:35:49,809 --> 01:35:54,820
problem why this is always at 0.5 I

1789
01:35:52,658 --> 01:35:57,458
don't know but probably because we have

1790
01:35:54,819 --> 01:35:59,849
particular Heights for off the ground

1791
01:35:57,458 --> 01:36:02,569
that our things are or whatever but

1792
01:35:59,849 --> 01:36:05,630
that's separate you so anyway

1793
01:36:02,569 --> 01:36:05,630
[Music]

1794
01:36:11,000 --> 01:36:14,600
I still think we want to look at this

1795
01:36:12,890 --> 01:36:16,430
code a little more carefully but I'm

1796
01:36:14,600 --> 01:36:18,079
gonna run it now just to see what the

1797
01:36:16,430 --> 01:36:20,030
result is because we are out of time for

1798
01:36:18,079 --> 01:36:21,739
today and tomorrow we can start looking

1799
01:36:20,029 --> 01:36:34,579
at it more carefully but I just want to

1800
01:36:21,739 --> 01:36:37,219
see what's going on here all right so

1801
01:36:34,579 --> 01:36:39,829
good now we're actually in a state where

1802
01:36:37,220 --> 01:36:42,650
things make a lot more sense that's what

1803
01:36:39,829 --> 01:36:46,039
I would have expected to see when we are

1804
01:36:42,649 --> 01:36:48,859
not injecting any emission in the system

1805
01:36:46,039 --> 01:36:50,359
and it's just the moonlight right and so

1806
01:36:48,859 --> 01:36:52,039
now if I turn the emission back on

1807
01:36:50,359 --> 01:36:54,109
hopefully we get something at least a

1808
01:36:52,039 --> 01:36:55,369
little more sane so that we can be in a

1809
01:36:54,109 --> 01:36:59,229
better debugging you know stronger

1810
01:36:55,369 --> 01:36:59,229
debugging situation starting tomorrow

1811
01:36:59,409 --> 01:37:10,090
okay so that's like way more sane right

1812
01:37:04,670 --> 01:37:13,989
I mean that looks a lot more like a

1813
01:37:10,090 --> 01:37:13,989
reasonable lighting computation

1814
01:37:19,770 --> 01:37:31,620
and the transfer is now much more stable

1815
01:37:24,140 --> 01:37:34,110
right okay so our biggest problem now is

1816
01:37:31,619 --> 01:37:36,300
just that we're not actually using a

1817
01:37:34,109 --> 01:37:38,309
diffuse map for sampling the lighting

1818
01:37:36,300 --> 01:37:40,680
for our bounced Lighting's so it's all

1819
01:37:38,310 --> 01:37:42,660
kind of garbage and so the biggest thing

1820
01:37:40,680 --> 01:37:47,520
we kind of need to do there is just make

1821
01:37:42,659 --> 01:37:50,760
sure we can actually get a you know an

1822
01:37:47,520 --> 01:37:53,340
actual emissive an actual diffuse map

1823
01:37:50,760 --> 01:37:56,640
for that but otherwise I think we're in

1824
01:37:53,340 --> 01:38:04,560
good shape now this is this is nice and

1825
01:37:56,640 --> 01:38:06,420
stable it's actually not that slow looks

1826
01:38:04,560 --> 01:38:17,300
like we've got a bug here with our cell

1827
01:38:06,420 --> 01:38:17,300
lookup though but I'm not sure why so

1828
01:38:17,359 --> 01:38:21,539
probably can't look at these values so

1829
01:38:19,920 --> 01:38:24,779
say we've got a bug here for lookups

1830
01:38:21,539 --> 01:38:29,300
where our clamped is not doing the right

1831
01:38:24,779 --> 01:38:29,300
thing let me just take a look

1832
01:38:41,960 --> 01:38:49,670
I mean that looks like it should be

1833
01:38:44,569 --> 01:38:51,619
fairly protected so I'm not sure why

1834
01:38:49,670 --> 01:38:56,480
we're getting that bug but it could be

1835
01:38:51,619 --> 01:38:59,630
also that maybe this the TYT x values

1836
01:38:56,479 --> 01:39:09,769
could be bogus as well not 100% sure

1837
01:38:59,630 --> 01:39:16,550
about that either way oops yeah so we're

1838
01:39:09,770 --> 01:39:18,740
gonna need to like let's go to briefed

1839
01:39:16,550 --> 01:39:29,920
QX I think that's it for today we'll

1840
01:39:18,739 --> 01:39:31,579
pick that up tomorrow at that point what

1841
01:39:29,920 --> 01:39:35,710
there we go

1842
01:39:31,579 --> 01:39:35,710
freak out what the heck - type

1843
01:39:54,658 --> 01:39:59,888
the UI is drawn at Z levels less than

1844
01:39:58,389 --> 01:40:02,380
negative nine nine nine

1845
01:39:59,889 --> 01:40:05,529
so to disable the lighting just compare

1846
01:40:02,380 --> 01:40:10,380
the Z to negative nine nine nine can you

1847
01:40:05,529 --> 01:40:24,609
quickly re-enable it so you just mean

1848
01:40:10,380 --> 01:40:26,889
you you want me to do in here you're

1849
01:40:24,609 --> 01:40:32,500
talking about this like you want a thing

1850
01:40:26,889 --> 01:40:45,059
inside the you want to think inside here

1851
01:40:32,500 --> 01:40:45,059
that's like where's our world position

1852
01:40:48,420 --> 01:40:56,460
I don't actually know where our world

1853
01:40:51,119 --> 01:41:02,760
position is role-p so you're saying

1854
01:40:56,460 --> 01:41:05,329
world P you want this I'm not sure if

1855
01:41:02,760 --> 01:41:05,329
that's what you mean

1856
01:41:11,090 --> 01:41:14,750
is this what we're talking about

1857
01:41:21,359 --> 01:41:29,099
which is fine although I'm not sure I

1858
01:41:23,039 --> 01:41:32,760
would want to actually do it that way in

1859
01:41:29,100 --> 01:41:34,980
for the in the long run right I mean I'm

1860
01:41:32,760 --> 01:41:38,789
gonna want to actually turn it off for

1861
01:41:34,979 --> 01:41:45,629
reals so that's not something I would

1862
01:41:38,789 --> 01:41:46,109
want to leave in there but but sure why

1863
01:41:45,630 --> 01:41:52,440
not

1864
01:41:46,109 --> 01:41:57,420
I think mostly yeah I mean if we look at

1865
01:41:52,439 --> 01:41:58,859
the light propagation work here so I

1866
01:41:57,420 --> 01:42:00,329
mean the thing that that I would want to

1867
01:41:58,859 --> 01:42:01,979
know you know if we were gonna play

1868
01:42:00,329 --> 01:42:03,840
around this I'd want to know which one

1869
01:42:01,979 --> 01:42:07,889
of these two passes is our actual hot

1870
01:42:03,840 --> 01:42:10,650
spot now so if we take a look at this

1871
01:42:07,890 --> 01:42:13,850
time function what I'd actually want to

1872
01:42:10,649 --> 01:42:15,719
do here is split this in half so in our

1873
01:42:13,850 --> 01:42:24,660
probably want to break it into two

1874
01:42:15,719 --> 01:42:27,560
blocks time to block like in here so I

1875
01:42:24,659 --> 01:42:35,939
would probably want to do like you know

1876
01:42:27,560 --> 01:42:36,810
it's timed block or you know what I

1877
01:42:35,939 --> 01:42:46,488
don't even really need to do that I

1878
01:42:36,810 --> 01:42:49,230
guess I think I can just do this mmm

1879
01:42:46,488 --> 01:42:51,179
well so this is hard because we'd have

1880
01:42:49,229 --> 01:42:57,179
to actually start at each time but all

1881
01:42:51,180 --> 01:43:02,550
right so maybe this this is a little

1882
01:42:57,180 --> 01:43:04,500
janky but we'll see behind previous

1883
01:43:02,550 --> 01:43:11,279
declaration oh come on

1884
01:43:04,500 --> 01:43:13,850
all right I'm I don't care that it hides

1885
01:43:11,279 --> 01:43:17,130
the previous declaration is the thing

1886
01:43:13,850 --> 01:43:25,710
like I don't care about that even a

1887
01:43:17,130 --> 01:43:28,230
little bit but yeah oh you know what I

1888
01:43:25,710 --> 01:43:32,458
can do here's what I can do I'll just

1889
01:43:28,229 --> 01:43:34,839
time full cast that's what I'll do

1890
01:43:32,458 --> 01:43:35,800
so if you want to look at the time I'm

1891
01:43:34,840 --> 01:43:37,119
assuming the reason you wanted the

1892
01:43:35,800 --> 01:43:39,429
profile on is because you just wanted to

1893
01:43:37,118 --> 01:43:41,668
see the where the time is being spent

1894
01:43:39,429 --> 01:43:47,408
because obviously we need to know that

1895
01:43:41,668 --> 01:43:49,679
for later but so if we look in here you

1896
01:43:47,408 --> 01:43:49,679
just

1897
01:44:03,680 --> 01:44:07,070
so you can kind of see like a little bit

1898
01:44:05,840 --> 01:44:09,739
of a breakdown here and you don't know

1899
01:44:07,069 --> 01:44:11,420
how accurate that really is timing wise

1900
01:44:09,739 --> 01:44:13,250
so it's probably not too far off from

1901
01:44:11,420 --> 01:44:16,100
the truth so if you take a look here you

1902
01:44:13,250 --> 01:44:18,829
can see that a significant amount of

1903
01:44:16,100 --> 01:44:22,550
time is spent in just the filtering of

1904
01:44:18,829 --> 01:44:25,069
the maps so you know full cast is

1905
01:44:22,550 --> 01:44:27,619
definitely the big loser presumably

1906
01:44:25,069 --> 01:44:32,449
because of the filters the sampling step

1907
01:44:27,619 --> 01:44:35,439
so I'm guessing and I could be wrong but

1908
01:44:32,449 --> 01:44:38,590
I'm guessing that this disaster here is

1909
01:44:35,439 --> 01:44:42,859
most of the issue I don't know for sure

1910
01:44:38,590 --> 01:44:45,319
but just assuming that we actually told

1911
01:44:42,859 --> 01:44:47,329
the optimizer like hey man don't bother

1912
01:44:45,319 --> 01:44:54,649
with any of that just use like one of

1913
01:44:47,329 --> 01:45:00,340
these things so that we weren't looking

1914
01:44:54,649 --> 01:45:03,879
up all that stuff I'm assuming then the

1915
01:45:00,340 --> 01:45:07,300
it would get a little bit more generous

1916
01:45:03,880 --> 01:45:07,300
or maybe not

1917
01:45:10,539 --> 01:45:16,430
is that really true that this is not a

1918
01:45:15,079 --> 01:45:20,619
particularly expensive part of the

1919
01:45:16,430 --> 01:45:24,430
process this is going to throw our

1920
01:45:20,619 --> 01:45:24,430
numbers off a lot but

1921
01:45:32,199 --> 01:45:37,159
seems like you can't actually do

1922
01:45:35,020 --> 01:45:39,290
insertions of those which makes sense

1923
01:45:37,159 --> 01:45:45,170
because I guess they change how the

1924
01:45:39,289 --> 01:45:47,590
numbering scheme goes but what just

1925
01:45:45,170 --> 01:45:47,590
happened

1926
01:45:55,470 --> 01:46:00,630
so how are we getting a error on that

1927
01:46:00,899 --> 01:46:07,779
why would we not be able to have a timed

1928
01:46:03,310 --> 01:46:12,160
function inside here oh because we call

1929
01:46:07,779 --> 01:46:15,279
it too many times right yeah all right

1930
01:46:12,159 --> 01:46:16,659
now that's fair it's just gonna we're

1931
01:46:15,279 --> 01:46:18,219
not even have enough room in the debug

1932
01:46:16,659 --> 01:46:19,619
log to store how many times they call it

1933
01:46:18,220 --> 01:46:29,320
cuz we call it so many times

1934
01:46:19,619 --> 01:46:32,949
fair enough so alright not great not

1935
01:46:29,319 --> 01:46:34,389
great so I'm not sure how to really get

1936
01:46:32,949 --> 01:46:36,789
too much information out of that other

1937
01:46:34,390 --> 01:46:39,789
than to just say well we can get rid of

1938
01:46:36,789 --> 01:46:42,250
the call to it right and see how bad

1939
01:46:39,789 --> 01:46:46,300
that is so we could just say here look

1940
01:46:42,250 --> 01:46:48,970
the light sample that comes back here is

1941
01:46:46,300 --> 01:47:01,119
just going to be some other thing so you

1942
01:46:48,970 --> 01:47:04,199
know it's like something like this so

1943
01:47:01,119 --> 01:47:10,449
like yeah the light sample zoe's some

1944
01:47:04,199 --> 01:47:15,309
stupid light in this case so if we have

1945
01:47:10,449 --> 01:47:17,619
the ability to switch between those like

1946
01:47:15,310 --> 01:47:19,300
so we could flick them on and off and

1947
01:47:17,619 --> 01:47:23,769
see what the optimizer produces for

1948
01:47:19,300 --> 01:47:28,029
those two cases so here's what we would

1949
01:47:23,770 --> 01:47:30,760
get if we're running with a light source

1950
01:47:28,029 --> 01:47:32,979
just stuffed in there so without compute

1951
01:47:30,760 --> 01:47:37,090
voxel irradiance at causing any problems

1952
01:47:32,979 --> 01:47:39,250
for us in theory and actually the

1953
01:47:37,090 --> 01:47:40,480
difference isn't that much so that's

1954
01:47:39,250 --> 01:47:44,260
pretty interesting to me because that

1955
01:47:40,479 --> 01:47:47,289
actually means so it's just the raycast

1956
01:47:44,260 --> 01:47:48,970
cost and the sampling the light is the

1957
01:47:47,289 --> 01:47:51,130
light if the result is not a big deal

1958
01:47:48,970 --> 01:47:52,329
which is interesting to me I mean if

1959
01:47:51,130 --> 01:47:54,159
that's the case that's actually great

1960
01:47:52,329 --> 01:47:56,760
because the raycast is a lot easier for

1961
01:47:54,159 --> 01:47:56,760
us to fix

1962
01:48:05,180 --> 01:48:15,659
so turning it on I mean it does get

1963
01:48:12,569 --> 01:48:18,359
slower but not nearly as slower as I

1964
01:48:15,659 --> 01:48:20,729
would have thought so I guess that's

1965
01:48:18,359 --> 01:48:22,319
really kind of encouraging because it

1966
01:48:20,729 --> 01:48:24,989
means the hardest thing to speed up

1967
01:48:22,319 --> 01:48:27,619
which is this is actually and we can do

1968
01:48:24,989 --> 01:48:31,469
it wide so that'll speed it up a little

1969
01:48:27,619 --> 01:48:33,269
but it means that the actual raycast

1970
01:48:31,470 --> 01:48:35,579
is the thing that's causing the most

1971
01:48:33,270 --> 01:48:36,960
pain and that's good actually because

1972
01:48:35,579 --> 01:48:40,909
that's the thing we probably have the

1973
01:48:36,960 --> 01:48:44,520
most control over to a certain extent

1974
01:48:40,909 --> 01:48:50,489
just in terms of like what we can speed

1975
01:48:44,520 --> 01:48:55,320
up and what we can't that's what I'd say

1976
01:48:50,489 --> 01:48:58,189
about that so yeah I guess that leaves

1977
01:48:55,319 --> 01:48:58,189
us in a pretty good place

1978
01:49:09,408 --> 01:49:12,918
I think you mentioned before that you

1979
01:49:11,599 --> 01:49:14,779
don't like regular expressions can you

1980
01:49:12,918 --> 01:49:17,448
elaborate on why yeah it's pretty simple

1981
01:49:14,779 --> 01:49:20,179
I just think that the syntax is so

1982
01:49:17,448 --> 01:49:22,399
cryptic and weird that it just doesn't

1983
01:49:20,179 --> 01:49:25,069
make a lot of sense to me why you would

1984
01:49:22,399 --> 01:49:28,339
standardize on this like the amount of

1985
01:49:25,069 --> 01:49:31,340
time it takes me to type in something I

1986
01:49:28,340 --> 01:49:34,760
want to find in my text is not a huge

1987
01:49:31,340 --> 01:49:38,900
deal so why not just give me a more

1988
01:49:34,760 --> 01:49:42,979
straightforward easy to read thing that

1989
01:49:38,899 --> 01:49:46,129
I can do like why do I want to remember

1990
01:49:42,979 --> 01:49:49,219
what like brackets dot slash three star

1991
01:49:46,130 --> 01:49:52,219
brackets star plus means or something

1992
01:49:49,219 --> 01:49:54,109
right when you could have just made it

1993
01:49:52,219 --> 01:49:56,719
an actual reasonable language to read

1994
01:49:54,109 --> 01:49:58,998
because the number of times that I type

1995
01:49:56,719 --> 01:50:00,679
these in is pretty low and the number of

1996
01:49:58,998 --> 01:50:03,498
times I have to sit there going oh wait

1997
01:50:00,679 --> 01:50:05,840
so what's the right way to say that I do

1998
01:50:03,498 --> 01:50:08,208
want a space but I don't want to this

1999
01:50:05,840 --> 01:50:12,010
you know just like it's just a bad it's

2000
01:50:08,208 --> 01:50:15,529
just bad design in my opinion you know

2001
01:50:12,010 --> 01:50:17,840
it's just it's just bad design I don't

2002
01:50:15,529 --> 01:50:21,498
think there's anything wrong with making

2003
01:50:17,840 --> 01:50:23,869
a subset of the parsable things that we

2004
01:50:21,498 --> 01:50:28,550
know we can accelerate so that part's

2005
01:50:23,868 --> 01:50:32,438
okay but just the syntax is just garbage

2006
01:50:28,550 --> 01:50:32,439
in my opinion and it should be replaced

2007
01:50:34,689 --> 01:50:39,139
if we have a probe in your wall and that

2008
01:50:37,578 --> 01:50:40,698
probe is updated with a color sample at

2009
01:50:39,139 --> 01:50:42,139
the wall the next frame the wall might

2010
01:50:40,698 --> 01:50:43,728
be brighter due to the new probe color

2011
01:50:42,139 --> 01:50:46,429
couldn't this spiral up to very bright

2012
01:50:43,729 --> 01:50:49,880
probe has to prevent this so the ideas

2013
01:50:46,429 --> 01:50:51,800
no absent bugs like the one that we had

2014
01:50:49,880 --> 01:50:54,559
there the ideas that no it wouldn't and

2015
01:50:51,800 --> 01:50:57,708
the reason for that is because the probe

2016
01:50:54,559 --> 01:51:01,130
is measuring how much light flow there

2017
01:50:57,708 --> 01:51:04,208
is through that probe and in theory when

2018
01:51:01,130 --> 01:51:07,900
it samples a wall it can only get some

2019
01:51:04,208 --> 01:51:12,859
convex combination of light flowing

2020
01:51:07,899 --> 01:51:15,408
through that from that wall right and so

2021
01:51:12,859 --> 01:51:18,139
at no point should we ever be able to

2022
01:51:15,408 --> 01:51:20,089
actually produce more flowing light than

2023
01:51:18,139 --> 01:51:23,210
we ever introduced into the system to

2024
01:51:20,090 --> 01:51:25,340
begin with right the whole point is

2025
01:51:23,210 --> 01:51:27,109
if we just measure the light flow how

2026
01:51:25,340 --> 01:51:29,659
much light is flowing through that area

2027
01:51:27,109 --> 01:51:31,549
it shouldn't ever be able to be more

2028
01:51:29,659 --> 01:51:34,689
than the maximum amount of light that we

2029
01:51:31,550 --> 01:51:38,750
ever have flowing that we inject right

2030
01:51:34,689 --> 01:51:40,819
so what we want to avoid is accumulating

2031
01:51:38,750 --> 01:51:42,710
light but we try not to do that by just

2032
01:51:40,819 --> 01:51:46,159
always measuring the amount of light

2033
01:51:42,710 --> 01:51:48,560
flowing right so we try not to store up

2034
01:51:46,159 --> 01:51:50,569
light in a way that can accumulate over

2035
01:51:48,560 --> 01:51:52,910
time instead we try to just blend

2036
01:51:50,569 --> 01:51:54,049
towards a value that is how much light

2037
01:51:52,909 --> 01:51:58,309
is flowing now

2038
01:51:54,050 --> 01:52:01,360
and so in hopefully no we don't have the

2039
01:51:58,310 --> 01:52:01,360
situation that you're talking about

2040
01:52:02,770 --> 01:52:15,920
that's the idea anyway it's post food

2041
01:52:09,800 --> 01:52:17,539
time the post coming she's surveying the

2042
01:52:15,920 --> 01:52:20,359
landscape you can't see her but she's

2043
01:52:17,539 --> 01:52:24,289
looking around she's decided the bowl is

2044
01:52:20,359 --> 01:52:27,670
safe to approach and now the food food

2045
01:52:24,289 --> 01:52:27,670
conching will begin

2046
01:52:35,560 --> 01:52:37,620
you

2047
01:52:43,460 --> 01:52:47,750
all right I think we're all good here

2048
01:52:55,579 --> 01:52:59,010
actually I guess I can leave that in

2049
01:52:57,479 --> 01:53:07,919
that was not really causing a problem I

2050
01:52:59,010 --> 01:53:09,900
guess also what's our rate bundle count

2051
01:53:07,920 --> 01:53:12,510
like if we change the rate bundle

2052
01:53:09,899 --> 01:53:17,399
countdown how many seer sample

2053
01:53:12,510 --> 01:53:22,850
directions are there how much does it

2054
01:53:17,399 --> 01:53:22,849
cost to do one just curious

2055
01:53:27,859 --> 01:53:38,569
so just doing one raycast is actually

2056
01:53:32,640 --> 01:53:40,950
fairly inexpensive right looks like and

2057
01:53:38,569 --> 01:53:44,210
then you really get the run time

2058
01:53:40,949 --> 01:53:46,619
dominated by filtering that diffuse map

2059
01:53:44,210 --> 01:53:48,390
so that's pretty interesting we need to

2060
01:53:46,619 --> 01:53:55,739
change to actually using the diffuse map

2061
01:53:48,390 --> 01:53:57,960
in practice but interesting it's kind of

2062
01:53:55,739 --> 01:54:00,210
fun you you end up like with that slow

2063
01:53:57,960 --> 01:54:03,840
of an update rate you end up kind of

2064
01:54:00,210 --> 01:54:07,770
like dropping light behind you as you go

2065
01:54:03,840 --> 01:54:13,039
which is kind of fun so what is that

2066
01:54:07,770 --> 01:54:13,040
like what about if it was for

2067
01:54:22,220 --> 01:54:28,650
so the game actually runs not that

2068
01:54:25,079 --> 01:54:30,539
poorly with you know reasonable indirect

2069
01:54:28,649 --> 01:54:31,829
lighting already I mean I'm pretty happy

2070
01:54:30,539 --> 01:54:33,210
with where this is at right I think

2071
01:54:31,829 --> 01:54:36,600
we're gonna be able to tighten this down

2072
01:54:33,210 --> 01:54:38,369
it's looking pretty cool and honestly at

2073
01:54:36,600 --> 01:54:39,960
this point like I think we're within

2074
01:54:38,369 --> 01:54:43,769
striking distance we have a lot of

2075
01:54:39,960 --> 01:54:45,409
finishing work to do but yeah it's it's

2076
01:54:43,770 --> 01:54:48,450
it's not looking too bad

2077
01:54:45,409 --> 01:54:54,000
so I also wonder can we now turn our

2078
01:54:48,449 --> 01:54:55,979
bias towards the light source back on I

2079
01:54:54,000 --> 01:54:58,319
don't really know that we want this I'm

2080
01:54:55,979 --> 01:55:05,759
still not sure if this is a good idea or

2081
01:54:58,319 --> 01:55:09,000
a bad idea but I'm just curious what so

2082
01:55:05,760 --> 01:55:10,949
what's going on here I so okay we've got

2083
01:55:09,000 --> 01:55:15,420
a start-up situation I'm not gonna end

2084
01:55:10,949 --> 01:55:17,970
for the day I want to I want to see what

2085
01:55:15,420 --> 01:55:20,310
that bug is so we should since we can

2086
01:55:17,970 --> 01:55:22,710
just start the code now I should be able

2087
01:55:20,310 --> 01:55:25,710
to run it in debug mode get whatever the

2088
01:55:22,710 --> 01:55:30,119
out-of-bounds error is here and look at

2089
01:55:25,710 --> 01:55:33,000
what the problem is so you know those

2090
01:55:30,119 --> 01:55:34,229
are not great values of T Y and T X you

2091
01:55:33,000 --> 01:55:36,960
know if we're gonna go ahead and be

2092
01:55:34,229 --> 01:55:43,409
completely honest about it so what's the

2093
01:55:36,960 --> 01:55:44,939
problem here so we've got all 0 R so

2094
01:55:43,409 --> 01:55:46,349
we're the octahedral offs that we're

2095
01:55:44,939 --> 01:55:50,989
asking for is R and we're getting back

2096
01:55:46,350 --> 01:55:50,990
garbage so what's up with that

2097
01:55:54,679 --> 01:56:06,199
I don't actually know how to lets

2098
01:55:59,090 --> 01:56:08,119
provoke this so here's get octahedral

2099
01:56:06,198 --> 01:56:11,118
offset and we're passing zero in here

2100
01:56:08,118 --> 01:56:13,368
right and so I just want to know is it

2101
01:56:11,118 --> 01:56:15,978
because of like the floor function is

2102
01:56:13,368 --> 01:56:16,488
broken or something let's find out what

2103
01:56:15,979 --> 01:56:22,458
we're getting

2104
01:56:16,488 --> 01:56:26,109
so if Durr is all zeros we're saying we

2105
01:56:22,458 --> 01:56:26,109
get garbage back is that correct

2106
01:56:41,069 --> 01:56:49,329
and neglected to actually look at the

2107
01:56:43,300 --> 01:56:52,480
function okay so here we are get actor

2108
01:56:49,329 --> 01:56:57,368
he to offset I'm cold I'm gonna cold set

2109
01:56:52,479 --> 01:56:59,618
this to 0 0 0 there so unfortunately

2110
01:56:57,368 --> 01:57:01,750
this is still multi-threaded as well so

2111
01:56:59,618 --> 01:57:02,859
that's a bit of an issue so I guess we

2112
01:57:01,750 --> 01:57:12,069
really just want to set the breakpoint

2113
01:57:02,859 --> 01:57:13,839
there and not there all right so Dirk

2114
01:57:12,069 --> 01:57:15,599
came in as zero zero zero well didn't

2115
01:57:13,840 --> 01:57:18,210
come in 0 we said 2 zero zero zero

2116
01:57:15,600 --> 01:57:22,840
what's the result

2117
01:57:18,210 --> 01:57:23,500
yep it's garbage so what's the UV the UV

2118
01:57:22,840 --> 01:57:26,230
is garbage

2119
01:57:23,500 --> 01:57:27,460
so it's this octahedral from unit vector

2120
01:57:26,229 --> 01:57:29,559
that's messed up

2121
01:57:27,460 --> 01:57:30,908
so if you pass all zeros to octahedral

2122
01:57:29,560 --> 01:57:36,789
from unit vector you get a garbage value

2123
01:57:30,908 --> 01:57:39,069
out so let's find out what that is so

2124
01:57:36,789 --> 01:57:42,670
here's the doctor he get here is

2125
01:57:39,069 --> 01:57:45,009
octahedral from unit vector and somehow

2126
01:57:42,670 --> 01:57:51,609
if this is all zeros then you get that

2127
01:57:45,010 --> 01:57:53,800
oh well it's cuz of that oh but actually

2128
01:57:51,609 --> 01:57:56,229
we yeah so how do you pass zero zero

2129
01:57:53,800 --> 01:57:57,820
zero to something now that I think about

2130
01:57:56,229 --> 01:57:58,448
it that makes perfect sense that can't

2131
01:57:57,819 --> 01:57:59,979
be right

2132
01:57:58,448 --> 01:58:03,849
because you're not allowed to actually

2133
01:57:59,979 --> 01:58:06,519
do that so this one norm yeah hmm

2134
01:58:03,850 --> 01:58:08,079
so I'm not sure how we would avoid that

2135
01:58:06,520 --> 01:58:10,179
but presumably what we would want to do

2136
01:58:08,079 --> 01:58:12,819
is avoid that earlier on right because

2137
01:58:10,179 --> 01:58:14,800
yeah this is not defined for that and

2138
01:58:12,819 --> 01:58:16,599
what we're that's coming from is if you

2139
01:58:14,800 --> 01:58:21,550
have to sample the light direction and

2140
01:58:16,600 --> 01:58:24,850
the light Direction is is ill-defined

2141
01:58:21,550 --> 01:58:29,770
right so let me just go take a look at

2142
01:58:24,850 --> 01:58:31,900
that so if we do a get octahedral offset

2143
01:58:29,770 --> 01:58:36,820
and we look at where that's actually

2144
01:58:31,899 --> 01:58:39,009
happening so the normals should never be

2145
01:58:36,819 --> 01:58:43,069
able to do that so we're really looking

2146
01:58:39,010 --> 01:58:44,609
at yeah yeah so

2147
01:58:43,069 --> 01:58:47,488
[Music]

2148
01:58:44,609 --> 01:58:52,189
this emission direction here would be

2149
01:58:47,488 --> 01:58:55,049
the problem and basically like this

2150
01:58:52,189 --> 01:58:57,359
right here would be would be an issue if

2151
01:58:55,050 --> 01:59:01,109
point on light and Ray origin are the

2152
01:58:57,359 --> 01:59:04,019
same you know I'm saying that would be

2153
01:59:01,109 --> 01:59:07,139
an issue and so we need some way of

2154
01:59:04,019 --> 01:59:09,300
avoiding that actual eventualities so I

2155
01:59:07,139 --> 01:59:10,708
guess we would just have to I don't know

2156
01:59:09,300 --> 01:59:15,779
what we would do in that case

2157
01:59:10,708 --> 01:59:22,378
but that would be our issue so the aprox

2158
01:59:15,779 --> 01:59:31,368
nas here that we're doing you know I

2159
01:59:22,378 --> 01:59:31,368
don't know like where we do this select

2160
01:59:31,908 --> 01:59:39,029
and we're selecting from the original

2161
01:59:37,498 --> 01:59:41,188
result value it's almost like this thing

2162
01:59:39,029 --> 01:59:43,198
needs to be filled with real values at

2163
01:59:41,189 --> 01:59:45,628
that point right

2164
01:59:43,198 --> 01:59:50,819
you don't want nas you want like a procs

2165
01:59:45,628 --> 01:59:58,668
you want like a procs normal or you know

2166
01:59:50,819 --> 02:00:05,478
up or something right so you want that I

2167
01:59:58,668 --> 02:00:05,479
think so in here you basically say like

2168
02:00:12,738 --> 02:00:18,898
initialize this to the up Vector or

2169
02:00:15,448 --> 02:00:21,118
something right and that way if you try

2170
02:00:18,899 --> 02:00:22,939
to normalize something and fail you hand

2171
02:00:21,118 --> 02:00:27,148
at the up Vector back instead of nothing

2172
02:00:22,939 --> 02:00:28,439
right so presumably you want something

2173
02:00:27,149 --> 02:00:31,169
like that now of course I don't actually

2174
02:00:28,439 --> 02:00:32,519
know where this particular ones coming

2175
02:00:31,168 --> 02:00:34,630
from so I'm going to try and find out

2176
02:00:32,519 --> 02:00:37,708
right

2177
02:00:34,630 --> 02:00:37,708
[Music]

2178
02:00:40,989 --> 02:00:47,929
what are we looking at here emission

2179
02:00:43,369 --> 02:00:52,460
direction so how are we getting when do

2180
02:00:47,930 --> 02:00:56,240
look well that's weird so the emission

2181
02:00:52,460 --> 02:01:00,529
direction here though is not zeros did I

2182
02:00:56,239 --> 02:01:06,590
forget to get rid of the zero or

2183
02:01:00,529 --> 02:01:16,309
something no so how how is that

2184
02:01:06,590 --> 02:01:17,449
producing an all zero value there do we

2185
02:01:16,310 --> 02:01:25,400
actually have a surface normal that's

2186
02:01:17,449 --> 02:01:29,619
zero so how are we getting a surface

2187
02:01:25,399 --> 02:01:32,359
normal that's zero what's up with that

2188
02:01:29,619 --> 02:01:35,680
so the sample end that we're passing

2189
02:01:32,359 --> 02:01:35,679
down here is wrong

2190
02:01:36,069 --> 02:01:49,609
it's a probe sample n right so we said

2191
02:01:46,310 --> 02:01:52,400
we hit a surface but we didn't fill in

2192
02:01:49,609 --> 02:01:56,839
any normal for that surface apparently

2193
02:01:52,399 --> 02:01:59,569
right which is total garbage so how did

2194
02:01:56,840 --> 02:02:03,170
that happen because that's like never

2195
02:01:59,569 --> 02:02:04,639
supposed to happen and I'm not sure like

2196
02:02:03,170 --> 02:02:07,039
I'm not sure what we did there but we

2197
02:02:04,640 --> 02:02:11,710
did something wrong so our raycast here

2198
02:02:07,039 --> 02:02:15,769
is busted at least a little bit because

2199
02:02:11,710 --> 02:02:19,460
the where we actually do our computation

2200
02:02:15,770 --> 02:02:21,020
here it looks like the hit normal for

2201
02:02:19,460 --> 02:02:23,300
one of the lanes that said it actually

2202
02:02:21,020 --> 02:02:28,520
got hit did not produce an a valid

2203
02:02:23,300 --> 02:02:32,690
normal right so there's something busted

2204
02:02:28,520 --> 02:02:35,570
there I'm not sure what but that's yeah

2205
02:02:32,689 --> 02:02:37,969
that's what that is in the case where we

2206
02:02:35,569 --> 02:02:39,500
hit something emissive it should still

2207
02:02:37,970 --> 02:02:45,010
give us a normal right like we should

2208
02:02:39,500 --> 02:02:45,010
never actually have that case and

2209
02:02:51,248 --> 02:02:54,248
yeah

2210
02:02:59,029 --> 02:03:04,988
it looks like we must have a bug in this

2211
02:03:01,340 --> 02:03:10,029
code somewhere in order to produce that

2212
02:03:04,988 --> 02:03:14,888
because we're generating this normal so

2213
02:03:10,029 --> 02:03:19,069
it should never actually be the case

2214
02:03:14,889 --> 02:03:21,469
that one of these things that did hit so

2215
02:03:19,069 --> 02:03:24,920
basically this hit normal this code

2216
02:03:21,469 --> 02:03:30,170
should always produce a valid normal if

2217
02:03:24,920 --> 02:03:31,819
you ever had a valid hit and it's not

2218
02:03:30,170 --> 02:03:33,789
doing that so this code is probably

2219
02:03:31,819 --> 02:03:36,828
garbage

2220
02:03:33,789 --> 02:03:36,828
[Music]

2221
02:03:47,229 --> 02:03:55,909
so if the ex mask why mask Zi mask are

2222
02:03:51,439 --> 02:04:00,409
not properly computed so this is an X

2223
02:03:55,909 --> 02:04:05,510
less than Y and X less than Z this is a

2224
02:04:00,409 --> 02:04:07,159
y less than X y less than Z so I mean I

2225
02:04:05,510 --> 02:04:15,020
guess part of the problem is if this hit

2226
02:04:07,159 --> 02:04:17,149
directly no one would trigger right so

2227
02:04:15,020 --> 02:04:19,250
probably this sort of thing has to be

2228
02:04:17,149 --> 02:04:30,139
like a less than or equal to for

2229
02:04:19,250 --> 02:04:31,579
somebody right trying to think of how

2230
02:04:30,140 --> 02:04:34,910
that would work but let's suppose that

2231
02:04:31,579 --> 02:04:36,829
all these values are zero if all these

2232
02:04:34,909 --> 02:04:40,930
values is zero then none of this comes

2233
02:04:36,829 --> 02:04:43,819
back right you know what I mean

2234
02:04:40,930 --> 02:04:46,820
it's like so when values are equal you

2235
02:04:43,819 --> 02:04:50,599
have a problem if you change them all to

2236
02:04:46,819 --> 02:04:52,009
great so if you have a case where yeah I

2237
02:04:50,600 --> 02:04:53,780
mean I guess what I'd say is what you

2238
02:04:52,010 --> 02:05:00,170
probably want is something like this if

2239
02:04:53,779 --> 02:05:01,729
X is less than or equal to Y X is less

2240
02:05:00,170 --> 02:05:05,359
than you go to Z so in the in the case

2241
02:05:01,729 --> 02:05:08,389
where all three are equal if if not all

2242
02:05:05,359 --> 02:05:13,309
three things are equal then one of these

2243
02:05:08,390 --> 02:05:14,030
things would work normally right no

2244
02:05:13,310 --> 02:05:16,600
that's not true

2245
02:05:14,029 --> 02:05:16,599
so

2246
02:05:20,569 --> 02:05:27,679
how about that so if all three things

2247
02:05:23,689 --> 02:05:31,460
are equal X will fire so it will get set

2248
02:05:27,680 --> 02:05:35,420
and Y will not write because this one

2249
02:05:31,460 --> 02:05:37,939
won't work if just two of them are equal

2250
02:05:35,420 --> 02:05:42,949
then there's either x and y are equal x

2251
02:05:37,939 --> 02:05:44,899
and z or y&amp;z if x and y are equal then

2252
02:05:42,949 --> 02:05:49,670
this one will trigger and this one won't

2253
02:05:44,899 --> 02:05:52,489
right if exit and obviously this one

2254
02:05:49,670 --> 02:05:56,029
won't if x and z are equal then this one

2255
02:05:52,489 --> 02:06:05,059
will trigger and this one won't right

2256
02:05:56,029 --> 02:06:09,199
and if y and z are equal then well i

2257
02:06:05,060 --> 02:06:14,930
guess i said that a little bit wrong so

2258
02:06:09,199 --> 02:06:19,899
if x and y are equal but z is not then

2259
02:06:14,930 --> 02:06:19,900
this should fail and this should succeed

2260
02:06:21,430 --> 02:06:25,570
i'm not thinking about this correctly

2261
02:06:33,998 --> 02:06:41,059
so in the case where X and y are equal

2262
02:06:38,118 --> 02:06:43,728
but Z is not then you would get a

2263
02:06:41,059 --> 02:06:46,219
situation here I guess which would

2264
02:06:43,729 --> 02:06:48,639
develop so okay so I'm just bear with me

2265
02:06:46,219 --> 02:06:58,729
for a second I want to see if this

2266
02:06:48,639 --> 02:07:01,519
corrects that particular problem yeah so

2267
02:06:58,729 --> 02:07:21,860
I do think I want to put in oppression

2268
02:07:01,519 --> 02:07:24,708
start on this today but so I'm not sure

2269
02:07:21,859 --> 02:07:26,389
about that one there right like I'm not

2270
02:07:24,708 --> 02:07:28,340
sure that really did the trick

2271
02:07:26,389 --> 02:07:31,668
but basically what we need to do is make

2272
02:07:28,340 --> 02:07:35,149
sure that this always produces a normal

2273
02:07:31,668 --> 02:07:37,630
that has only one one value right no

2274
02:07:35,149 --> 02:07:37,630
matter what

2275
02:07:46,619 --> 02:07:54,180
yeah so okay so this is the version that

2276
02:07:51,359 --> 02:07:57,299
biases towards the lights as well so the

2277
02:07:54,180 --> 02:08:00,869
first direction is always probing the

2278
02:07:57,300 --> 02:08:02,909
light source and you know I'm not sure

2279
02:08:00,869 --> 02:08:05,149
again like that this really makes a

2280
02:08:02,909 --> 02:08:08,579
difference so we may just take that out

2281
02:08:05,149 --> 02:08:11,909
looking at it here if I go back to the

2282
02:08:08,579 --> 02:08:13,829
full cast routine

2283
02:08:11,909 --> 02:08:20,489
the only difference right is you put

2284
02:08:13,829 --> 02:08:21,899
this guy up here or you don't right so

2285
02:08:20,489 --> 02:08:23,760
if you look at the difference between

2286
02:08:21,899 --> 02:08:26,699
the two

2287
02:08:23,760 --> 02:08:31,560
they're pretty minimal so I mean it

2288
02:08:26,699 --> 02:08:35,069
could be busted right as well so I don't

2289
02:08:31,560 --> 02:08:38,670
actually know but I'm tempted to say we

2290
02:08:35,069 --> 02:08:42,689
don't care about that very much so we

2291
02:08:38,670 --> 02:08:46,109
may just not need to do that we'll see

2292
02:08:42,689 --> 02:08:50,699
but yeah I don't I don't know that it

2293
02:08:46,109 --> 02:08:52,500
matters much right actually I guess if

2294
02:08:50,699 --> 02:08:54,569
it doesn't matter I'd probably leave it

2295
02:08:52,500 --> 02:08:57,560
this way so you just sample the right

2296
02:08:54,569 --> 02:09:03,439
bundle and then in here you would just

2297
02:08:57,560 --> 02:09:03,440
you know get rid of this

2298
02:09:09,520 --> 02:09:19,550
so we just do something like that and

2299
02:09:16,868 --> 02:09:21,009
and there we go so I'll probably just

2300
02:09:19,550 --> 02:09:23,389
leave it like that for now because it

2301
02:09:21,010 --> 02:09:24,739
doesn't seem like that's necessary and

2302
02:09:23,389 --> 02:09:26,929
the way that the lighting works I think

2303
02:09:24,738 --> 02:09:28,939
it seems like we'll be alright so we'll

2304
02:09:26,929 --> 02:09:37,760
see I think that biasing might not be

2305
02:09:28,939 --> 02:09:38,899
necessary all right so I think we're all

2306
02:09:37,760 --> 02:09:40,159
right so I'm gonna go ahead and close it

2307
02:09:38,899 --> 02:09:41,420
down I got a question how do you share

2308
02:09:40,158 --> 02:09:43,009
memory across functions in shared

2309
02:09:41,420 --> 02:09:44,539
library I know the user could allocate

2310
02:09:43,010 --> 02:09:45,500
memory and pass that to the library but

2311
02:09:44,539 --> 02:09:47,510
I was wondering how to have the library

2312
02:09:45,500 --> 02:09:48,618
allocate memory for internal use the

2313
02:09:47,510 --> 02:09:50,360
library users are having to know

2314
02:09:48,618 --> 02:09:52,488
anything about it

2315
02:09:50,359 --> 02:09:57,789
I guess what I would say is I generally

2316
02:09:52,488 --> 02:10:00,769
don't think that's a good idea but

2317
02:09:57,789 --> 02:10:08,059
that's beside the point if it's just

2318
02:10:00,770 --> 02:10:10,820
you're asking how do I do it you should

2319
02:10:08,059 --> 02:10:12,529
be able to do what you said so when you

2320
02:10:10,819 --> 02:10:14,269
say I tried using global that gets

2321
02:10:12,529 --> 02:10:15,859
initialized in the DLL main with virtual

2322
02:10:14,270 --> 02:10:19,369
Alec but later when I call a function

2323
02:10:15,859 --> 02:10:20,868
the library exports the global 0 that

2324
02:10:19,368 --> 02:10:23,210
sounds like there's a you have a

2325
02:10:20,868 --> 02:10:26,089
different problem because you should be

2326
02:10:23,210 --> 02:10:29,149
able to do that right that should

2327
02:10:26,090 --> 02:10:32,239
actually work so you probably have a

2328
02:10:29,149 --> 02:10:34,339
different problem happening because you

2329
02:10:32,238 --> 02:10:37,609
should be allowed to in DLL main do a

2330
02:10:34,340 --> 02:10:40,130
virtual a lock and store that and then

2331
02:10:37,609 --> 02:10:43,069
use it so something else is probably

2332
02:10:40,130 --> 02:10:44,170
happening but you should be able to do

2333
02:10:43,069 --> 02:10:48,039
what you're talking about

2334
02:10:44,170 --> 02:10:48,039
alright let's go ahead and wrap it up

2335
02:10:51,680 --> 02:10:54,720
thank you everyone for joining me for an

2336
02:10:53,609 --> 02:10:56,699
episode of hand made here oh it's my

2337
02:10:54,720 --> 02:10:58,500
pleasure coding with you as always I

2338
02:10:56,699 --> 02:11:00,179
pretty excited with how that lighting is

2339
02:10:58,500 --> 02:11:02,159
turning out I think we've only got a

2340
02:11:00,180 --> 02:11:04,170
little bit more of a push before we've

2341
02:11:02,159 --> 02:11:06,420
got a really snazzy lighting system

2342
02:11:04,170 --> 02:11:07,109
looking there in this one unlike first

2343
02:11:06,420 --> 02:11:09,989
one we wrote

2344
02:11:07,109 --> 02:11:11,369
this one works for purpose of lighting

2345
02:11:09,989 --> 02:11:15,000
everywhere in the whole game at all

2346
02:11:11,369 --> 02:11:16,470
times - which is pretty great so I'm

2347
02:11:15,000 --> 02:11:19,020
really excited to kind of push forward

2348
02:11:16,470 --> 02:11:20,280
on that a little bit more as usual if

2349
02:11:19,020 --> 02:11:21,450
you want to follow along with the series

2350
02:11:20,279 --> 02:11:23,219
at home you can always pre-order the

2351
02:11:21,449 --> 02:11:25,739
game on handmade hero organic comes with

2352
02:11:23,220 --> 02:11:27,150
a source code so you can do your own

2353
02:11:25,739 --> 02:11:28,859
experiments with it maybe you can figure

2354
02:11:27,149 --> 02:11:32,009
out some ways to optimize our lighting

2355
02:11:28,859 --> 02:11:33,149
before I get to it tomorrow but I will

2356
02:11:32,010 --> 02:11:35,190
be back here tomorrow to start looking

2357
02:11:33,149 --> 02:11:36,899
at exactly that so hopes to you're back

2358
02:11:35,189 --> 02:11:39,389
here for that until then have fun

2359
02:11:36,899 --> 02:11:42,379
programming everyone and I'll see on the

2360
02:11:39,390 --> 02:11:42,380
Internet take it easy everybody

